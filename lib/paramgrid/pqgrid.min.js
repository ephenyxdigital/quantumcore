/*!
 * ParamQuery Pro v11.1.0
 * 
 * Copyright (c) 2012-2026 Paramvir Dhindsa (http://paramquery.com)
 * Released under Commercial license
 * http://paramquery.com/pro/license
 * 
 */
if("function"==typeof require){var jQuery=require("jquery-ui-pack"),pq={},JSZip=require("jszip");module.exports=pq}else jQuery=window.jQuery,pq=window.pq=window.pq||{},JSZip=window.JSZip;!function(t){var e=pq.mixin={};e.render={getRenderVal:function(t,e,n){var r=t.column.exportRender;return e&&!1!==r||r?n.renderCell(t):[t.rowData[t.dataIndx],""]},getTitle:function(t,e){var n=t.title;return null!=n?pq.isFn(n)&&(n=n.call(this.that,{colIndx:e,column:t,dataIndx:t.dataIndx,Export:!0})):n="",n}},e.GrpTree={buildCache:function(){for(var t,e,n=this,r=n.that.options,i=n.isTree,o=i?r.dataModel.data:n.that.pdata,a=n.cache={},l=n.id,s=0,c=o.length;s<c;s++)if(t=o[s],i||t.pq_gtitle){if(null==(e=t[l]))throw"unknown id of row";a[e]=t}},cascadeInit:function(){if(this.getCascadeInit()){for(var t,e=this,n=[],r=e.cbId,i=e.that,o=e.Model.select,a=i.pdata,l=0,s=a.length;l<s;l++)(t=a[l])[r]?e.isEditable(t)?(n.push(t),delete t[r]):o&&(t.pq_rowselect=!0):null===t[r]&&delete t[r];n.length&&e.checkNodes(n,null,null,!0)}},cascadeNest:function(t){for(var e,n,r,i=this,o=i.cbId,a=i.prop,l=i.childstr,s=t.length,c=0;c<s;c++)(n=t[c])[a]&&(e=!0,i.eachChild(n,i.chkEachChild(o,n[o],a)),delete n[a]),(r=n[l])&&r.length&&i.cascadeNest(r);e&&i.hasParent(n)&&i.eachParent(n,i.chkEachParent(o))},checkAll:function(t,e){t=null==t||t;var n=this.that;return this.checkNodes(n.pdata,t,e,null,!0)},checkNodes:function(t,e,n,r,i){null==e&&(e=!0);for(var o,a,l,s=0,c=t.length,d=[],u={check:e},h=this,f=h.that,p=(f.riOffset,h.cbId),g=h.prop,m=h.Model,v=!i&&h.isCascade(m),w=r&&m.eventForInit||!r,x=m.select;s<c;s++)o=t[s],this.isEditable(o)&&(a=o.pq_ri,d.push({rowData:o,rowIndx:a}));if(u.rows=d,u.dataIndx=h.colUI.dataIndx,r&&(u.init=r),w&&(l=f._trigger("beforeCheck",n,u)),!1!==l&&(c=(d=u.rows).length)){var y=this.chkRows=[];for(s=0;s<c;s++)o=d[s].rowData,v&&(o[g]=!0),y.push({rd:o,val:e,oldVal:o[p]}),o[p]=e;v&&h.cascadeNest(h.getRoots()),x&&this.selectRows(),v&&(u.getCascadeList=h.getCascadeList(h)),w&&f._trigger("check",n,u),y.length=0}h.setValCBox(),r||f.refresh({header:!1})},chkEachChild:function(t,e,n){return function(r){if(this.isEditable(r)&&(!n||!r[n])){var i=r[t];null!==e&&i!==e&&(this.chkRows.push({rd:r,val:e,oldVal:i}),r[t]=e)}}},chkEachParent:function(t){var e=this.childstr;return function(n){if(this.isEditable(n)){for(var r,i,o,a=n[e],l=0,s=0,c=n[t],d=0,u=a.length;d<u;d++)if(r=a[d],this.isEditable(r)){if(o=r[t])l++;else{if(null===o){i=null;break}s++}if(l&&s){i=null;break}}void 0===i&&(i=!!l),c!==i&&(this.chkRows.push({rd:n,val:i,oldVal:c}),n[t]=i)}}},eachChild:function(t,e,n){e.call(this,t,n);for(var r,i=this.childstr,o=t[i]||[],a=0,l=o.length;a<l;a++)(r=o[a])[i]?this.eachChild(r,e,t):e.call(this,r,t)},eachParent:function(t,e){for(;t=this.getParent(t);)e.call(this,t)},_flatten:function(t,e,n,r){for(var i,o,a=this,l=t.length,s=a.id,c=a.parentId,d=0,u=a.childstr;d<l;d++)(i=t[d]).pq_level=n,r.push(i),e&&(i[c]=s?e[s]:e),(o=i[u])&&a._flatten(o,i,n+1,r)},flatten:function(t){var e=[];return this._flatten(t,null,0,e),e},getUniqueNodes:function(t){var e=[],n={},r=this.parentId,i=this.id;return t.forEach(function(t){null!=t[i]&&(n[t[i]]=1)}),t.forEach(function(t){n[t[r]]||e.push(t)}),e},getCascadeInit:function(){var t=this._cascadeInit;return this._cascadeInit=!0,t},indentUnit:t=>t>3?"px":"em",getLines:function(t,e,n,r,i){for(var o,a,l=e.pq_gsummary,s=this.indentUnit(r),c=[],d=n=l?n+1:n;d>=1;d--)if(o=i+":"+d*r+s+";width:"+r+s+";",a=this.getParent(e)){var u=this.getChildren(a),h=u[u.length-1]==e,f=h&&d<n||l&&d==n?"":"<span class='pq-tree-line-vert pq-border-0' style='"+o+(h&&d==n&&!l?"height:50%;":"")+"'></span>",p=d<n||l?"":"<span class='pq-tree-line-horz pq-border-0' style='"+o+(t?"width:"+.25*r+s+";":"")+"'></span>";c.push(f,p),e=a}return c.join("")},getNode:function(t){return this.cache[t]},getParent:function(t){var e=t[this.parentId];return this.cache[e]},fillState:function(t){var e,n,r=this.childstr,i=this.cache;for(e in i)(n=i[e])[r]&&(t[e]=n.pq_close||!1);return t},hasParent:function(t){return null!=t[this.parentId]},getRoots:function(t){for(var e,n=this.that,r=t||n.pdata||[],i=r.length,o=0,a=[];o<i;o++)0!==(e=r[o]).pq_level||e.pq_gsummary||a.push(e);return i&&!a.length&&(a=r),a},setCascadeInit:function(t){this._cascadeInit=t},getCascadeList:function(t){var e=[];return function(){if(!e.length)for(var n=t.chkRows,r=0,i=t.cbId,o=n.length;r<o;r++){var a=n[r],l=a.rd,s=l.pq_ri,c={},d={};c[i]=a.val,d[i]=a.oldVal,e.push({rowIndx:s,rowData:l,newRow:c,oldRow:d})}return e}},getChildren:function(t){return(t?t[this.childstr]:this.getRoots())||[]},getChildrenAll:function(t,e){for(var n,r=this.childstr,i=t[r]||[],o=i.length,a=0,l=e||[];a<o;a++)n=i[a],l.push(n),n[r]&&this.getChildrenAll(n,l);return l},getSummary:function(t){return t.pq_child_sum},isAncestor:function(t,e){for(var n=t;n=this.getParent(n);)if(n==e)return!0},isEmpty:function(t){return!(t[this.childstr]||[]).length},isCascade:function(t){return t.cascade&&t.checkbox&&!t.maxCheck},isEditable:function(t){if(t.pq_gsummary)return!1;var e,n=this.that,r=this.colCB;return!r||null==(e=r.editable)||(pq.isFn(e)?e.call(n,{rowData:t}):e)},isFolder:function(t){return null!=t.pq_close||!!t[this.childstr]},onCheckbox:function(t,e){return function(n,r){e.checkbox&&t.colUI==r.column&&t.checkNodes([r.rowData],r.input.checked,n)}},onCMInit:function(){var t,e,n,r=this,i=r.that,o=i.columns,a=r.isTree,l=i.colModel,s=r.Model;s.titleInFirstCol&&l&&(n=l.find(function(t){return!t.hidden}),s.titleIndx=n.dataIndx=(n.dataIndx??Math.random()).toString()),s.checkbox&&o&&((e=o[s.cbId]||{dataIndx:s.cbId}).cb={check:!0,uncheck:!1,select:s.select,header:s.checkboxHead,maxCheck:s.maxCheck},t=a?o[s.dataIndx]:o[s.titleIndx]),r.colCB=e,r.colUI=t,o&&a&&r.setCellRender()},onCustomSortTree:function(t,e){var n=this,r=n.getRoots(e.data);return n.sort(r,e.sort_composite),e.data=n.flatten(r),!1},onRefresh:function(t,e){return function(){if(e.checkbox)for(var t=this.$cont.find(".pq_indeter"),n=t.length;n--;)t[n].indeterminate=!0}},refreshView:function(t){this.that.refreshView({header:!1,source:t})},renderCB:function(t,e,n){if(e.pq_gsummary)return"";var r,i=this.that,o="",a="",l="";return pq.isFn(t)&&(t=t.call(i,e)),t?(e[n]&&(o="checked"),this.isEditable(e)||(a="disabled",r="pq_disable"),null===e[n]&&(l="class='pq_indeter'"),["<input type='checkbox' tabindex='-1' "+l+" "+o+" "+a+"/>",r]):void 0},selectRows:function(){for(var t=0,e=this.chkRows,n=e.length;t<n;t++){var r=e[t],i=r.rd,o=r.val;i.pq_rowselect=o}},sort:function(t,e){var n=this.childstr,r=function(){return pq.isFn(e)?e:e.shift()};!function t(e,i){var o,a=e.length,l=0;if(a)for(i&&e.sort(i),i=r();l<a;l++)(o=e[l][n])&&t(o,i)}(t,r())},copyArray:function(t,e){for(var n=0,r=e.length;n<r;n++)t.push(e[n])},_summaryT:function(t,e,n,r,i,o,a,l,s){for(var c,d,u,h,f,p=this,g=p.childstr,m=p.isGroup,v=p.isTree,w=o.summaryInTitleRow,x=o.showSummary,y=!o.skipSingleSummary,b=o.titleIndx,C=0,q=t.length,I=0,_={},R={},D=p.id,M=p.parentId,S=m&&a?o.dataIndx[a.pq_level]:"",T=[],F=n.length,k=pq.aggregate;I<F;I++)_[f=n[I]]=[];for(;C<q;C++){if(d=t[C],c=null,e.push(d),u=d[g]){for(c=p._summaryT(u,e,n,r,i,o,d,l),I=0;I<F;I++)f=n[I],p.copyArray(_[f],c[1][f]);p.copyArray(T,c[2])}if(v&&(!w||!p.isFolder(d))||m&&!d.pq_gtitle){for(I=0;I<F;I++)_[f=n[I]].push(d[f]);T.push(d)}}for(R.pq_level=a?a.pq_level:0,s&&(R.pq_grandsummary=!0),a&&(v&&!w||m&&x[a.pq_level])&&(R[M]=a[D],y||q>1?e.push(R):R.pq_ghidden=!0,a.pq_child_sum=R,R.pq_hidden=a.pq_close),I=0;I<F;I++)f=n[I],"count"==(h=(h=r[I])[S]||h.type)&&R.pq_grandsummary&&l&&(h="sum"),R[f]=k[h](_[f],i[I],T,R),w&&a&&f!=b&&(a[f]=R[f]);return R.pq_gsummary=!0,[R,_,T]},summaryT:function(t){for(var e,n,r,i=this,o=i.that,a=o.options,l=i.Model,s=i.getRoots(),c=[],d=[],u=[],h=[],f=0,p=o.colModel,g=p.length;f<g;f++)(n=(e=p[f]).summary)&&n.type&&(u.push(e.dataIndx),h.push(e),d.push(n));r=i._summaryT(s,c,u,d,h,l,null,t,!0)[0],l.grandSummary?i.summaryData=a.summaryData=[r]:(i.summaryData||[]).length=0,o.pdata=c}}}(),function(t){var e=pq.mixin,n=!0;t(document).one("pq:ready",function(){var e=t("<input type='checkbox' style='position:fixed;left:-50px;top:-50px;'/>").appendTo(document.body);e[0].indeterminate=!0,e.on("change",function(){n=!1}),e.click(),e.remove()}),e.ChkGrpTree={onCellKeyDown:function(t,e){var n=this.colUI;if(n&&e.dataIndx==n.dataIndx&&32==t.keyCode)return this.that.getCell(e).find("input").click(),!1},getCheckedNodes:function(t){var e,n=this.that,r=t?n.getData():n.options.dataModel.data,i=r.length,o=0,a=[],l=this.colCB||{},s=(l.cb||{}).check,c=l.dataIndx;if(null!=c)for(;o<i;o++)(e=r[o])[c]===s&&a.push(e);return a},hasCboxHead:function(){return((this.colCB||{}).cb||{}).header},isHeadChecked:function(){return this.inpVal},onBeforeCheck:function(t,e){if(e.check&&this.colCB){var n=this.colCB,r=n.cb,i=r.select,o=r.maxCheck;if(o&&this.colUI.dataIndx==e.dataIndx){var a=e.rows.slice(0,o),l=a.length,s=n.dataIndx,c=this.getCheckedNodes(!0),d=l+c.length-o;d>0&&c.slice(0,d).forEach(function(t){t[s]=r.uncheck,i&&delete t.pq_rowselect}),e.rows=a}}},onHeaderChange:function(t){!1===this.checkAll(t.target.checked,t)&&this.refreshHeadVal()},onRefreshHeader:function(){var t=this,e=t.that;if(t.hasCboxHead()){if("groupModel"==t.model&&!e.options[t.model].on)return;var r=e.getCellHeader({dataIndx:t.colUI.dataIndx}),i=r.find("input");i.length||(r.find(".pq-title-span").prepend('<input type="checkbox" tabindex="-1" />'),i=r.find("input")),t.$inp&&i[0]==t.$inp[0]||(t.$inp=i,t.refreshHeadVal(),n&&i.on("click",function(e){null==i.data("pq_value")&&(i[0].checked=!0,i.data("pq_value",!0),t.onHeaderChange(e))}),i.on("change",function(e){t.onHeaderChange(e)}))}},refreshHeadVal:function(){if(this.$inp){let t=this.inpVal;this.$inp.attr("aria-label",null==t?"indeterminate":t?"checked":"unchecked").pqval({val:t})}},setValCBox:function(){if(this.hasCboxHead()){var t,e,n=this.that,r=n.options,i=this.colCB,o=i.dataIndx,a=n.colIndxs[o],l=i.cb,s=l.all,c="remote"==r.pageModel.type||!s?n.riOffset:0,d=s?r.dataModel.data:n.pdata,u=null,h=0,f=0,p=0;if(d){for(var g=0,m=d.length;g<m;g++)(t=d[g])&&(e=g+c,t.pq_gsummary||t.pq_gtitle||!this.isEditable(t,i,e,a,o,g)||(f++,t[o]===l.check?h++:p++));h==f&&f?u=!0:p==f&&(u=!1),this.inpVal=u,this.refreshHeadVal()}}},unCheckAll:function(){this.checkAll(!1)},unCheckNodes:function(t,e){this.checkNodes(t,!1,e)}}}(jQuery),function(t){var e=t.paramquery=t.paramquery||{},n=function(t,e,n,r){for(var i=e.slice(),o=0,a=i.length,l=[];o<a;o++){var s=i[o],c=s.cb,d=s.one;if(d){if(s._oncerun)continue;s._oncerun=!0}if(!1===c.call(t,n,r)&&(n.preventDefault(),n.stopPropagation()),d&&l.push(o),n.isImmediatePropagationStopped())break}if(a=l.length)for(o=a-1;o>=0;o--)i.splice(l[o],1)};e._trigger=function(e,r,i){var o,a,l=this,s=l.listeners,c=s[e],d=l.options,u=d.allEvents,h=d.bubble,f=l.element,p=d[e];if(i=i||{},(r=t.Event(r)).type=l.widgetName+":"+e,r.target=f[0],a=r.originalEvent)for(o in a)o in r||(r[o]=a[o]);if(u&&pq.isFn(u)&&u.call(l,r,i),c&&c.length&&(n(l,c,r,i),r.isImmediatePropagationStopped()))return!r.isDefaultPrevented();if(d.trigger&&(f[h?"trigger":"triggerHandler"](r,i),r.isImmediatePropagationStopped()))return!r.isDefaultPrevented();p&&(!1===p.call(l,r,i)&&(r.preventDefault(),r.stopPropagation()));return(c=s[e+"Done"])&&c.length&&n(l,c,r,i),!r.isDefaultPrevented()};var r=function(t,e,n,r,i){var o=t.listeners[e];o||(o=t.listeners[e]=[]),o[i?"unshift":"push"]({cb:n,one:r})};e.on=function(){var t=arguments;if("boolean"==typeof t[0])var e=t[0],n=t[1],i=t[2],o=t[3];else n=t[0],i=t[1],o=t[2];for(var a=n.split(" "),l=0;l<a.length;l++){var s=a[l];s&&r(this,s,i,o,e)}return this},e.one=function(){for(var t=arguments.length,e=[],n=0;n<t;n++)e[n]=arguments[n];return e[t]=!0,this.on.apply(this,e)};var i=function(t,e,n){if(n){var r=t.listeners[e];if(r){for(var i=[],o=0,a=r.length;o<a;o++){n==r[o].cb&&i.push(o)}if(i.length)for(o=i.length-1;o>=0;o--)r.splice(i[o],1)}}else delete t.listeners[e]};e.off=function(t,e){for(var n=t.split(" "),r=0;r<n.length;r++){var o=n[r];o&&i(this,o,e)}return this},t.widget("paramquery.pqTooltip",t.ui.tooltip,{options:{items:".pq-grid-cell.pq-has-tooltip,.pq-grid-cell[title]",position:{my:"center top",at:"center bottom"},content:function(){var e,n=t(this),r=n.closest(".pq-grid").pqGrid("instance"),i=r.getCellIndices({$td:n});if(i.data="pq_valid",e=r.data(i).data){var o=e.icon,a=""==o?"":"<span class='ui-icon "+o+" pq-tooltip-icon'></span>",l=e.msg;return a+(null!=l?l:"")}return n.attr("title")}},_create:function(){this._super();var e=this.element,n=e.pqGrid("instance"),r=this.eventNamespace;n.on("change",function(){n.one("refresh",function(){n.getCell(n.getFocus()).trigger("focusin")})}),e.on("pqtooltipopen"+r,function(e,r){var i=t(e.target),o=t(e.originalEvent.target);if(o.on("remove.pqtt",function(t){i.pqTooltip("close",t,!0)}),i.is(".pq-grid")){var a,l=n.getCellIndices({$td:o});if(l.data="pq_valid",a=n.data(l).data){var s,c=a.style,d=a.cls,u=r.tooltip;u.addClass(d),s=u.attr("style"),u.attr("style",s+";"+c)}}}).on("pqtooltipclose"+r,function(e,n){t(e.originalEvent.target).off(".pqtt")})}})}(jQuery),function(t){var e,n,r=t.paramquery,i=Array.prototype;!i.find&&(i.find=function(t,e){for(var n,r=0,i=this.length;r<i;r++)if(n=this[r],t.call(e,n,r,this))return n}),!i.findIndex&&(i.findIndex=function(t,e){for(var n,r=0,i=this.length;r<i;r++)if(n=this[r],t.call(e,n,r,this))return r;return-1}),t.extend(pq,{_hw:function(t,e,n,r){var i="border-",o="padding-",a="-width";return t[0]["offset"+e]-[i+n+a,i+r+a,o+n,o+r].reduce(function(e,n){return e+(parseInt(t.css(n))||0)},0)},height:function(t){return this._hw(t,"Height","top","bottom")},width:function(t){return this._hw(t,"Width","left","right")},position:function(e,n){function r(t){var e=t.split(" ");return"center"==t?e=[t,t]:"top"==t||"bottom"==t?e=["center",t]:"left"!=t&&"right"!=t||(e=[t,"center"]),e.forEach((t,n)=>{var r,i=0;(r=t.match(/([a-z]+)(\+|-)([\d]+)(\%?)/))&&(e[n]=r[1],i=r[2]+r[3],i=r[4]?i+"%":1*i),e[2+n]=i}),e}var i=n.of,o=r(n.my||"center"),a=r(n.at||"center"),l=a[0],s=a[1],c=a[2],d=a[3],u=o[0],h=o[1],f=o[2],p=o[3],g=null!=i.pageX,m=(i.originalEvent||i).target||i[0]||i,v=e[0],w=v.getBoundingClientRect(),x=w.width,y=w.height,b=m.getBoundingClientRect(),C=b.width,q=b.height,I=(t,e)=>1*t==t?t:parseInt(t)*e/100,_=(f=I(f,x),p=I(p,y),c=I(c,C),d=I(d,q),b.left),R=b.top,D=v.parentNode,M=D==document.body,S=D.getBoundingClientRect(),T=M?0:S.left,F=M?0:S.top,k=pq.getScale(D),E=k[0],P=k[1],$=pq.getScale(m),A=$[0],H=$[1],O={left:0,center:.5,right:1},L={top:0,center:.5,bottom:1},N=(N=_+(g?i.offsetX*A:O[l]*C-O[u]*x)-T)+(c-f),V=(V=R+(g?i.offsetY*H:L[s]*q-L[h]*y)-F)+(d-p),j=window,B=N+x+T-t(j).width(),z=V+y+F-t(j).height();N=(N-=B>0?B:0)+T<0?-T:N,V=(V-=z>0?z:0)+F<0?-F:V,M&&(N+=j.scrollX,V+=j.scrollY),e.css({left:N/E,top:V/P})},addDefault(t,e){var n,r,i;for(n in e)r=e[n],i=Object.getOwnPropertyDescriptor(e,n),"object"==typeof r?r instanceof Array?null==t[n]&&(t[n]=r):(t[n]||={},this.addDefault(t[n],r)):i.get||i.set?Object.defineProperty(t,n,i):null==t[n]&&(t[n]=r);return t},arrayUnique:function(t,e){var n,r,i,o=[],a=t.length,l={};for(n=0;n<a;n++)r=t[n],1!=l[i=e?r[e]:r]&&(l[i]=1,o.push(r));return o},cap1:function(t){return t&&t.length?t[0].toUpperCase()+t.slice(1):""},elementFromXY:function(e){var n,r=e.clientX,i=e.clientY,o=t(document.elementFromPoint(r,i));return o.closest(".ui-draggable-dragging").length&&((n=o).hide(),o=t(document.elementFromPoint(r,i)),n.show()),o},getFocusEle:function(e,n){var r=["a","textarea","button","input","select","[tabindex]","div[contenteditable]"].map(function(t){return t+':not([disabled],[tabindex="-1"])'}).join(","),i=document.activeElement,o=t(i);if(n=n||document.body,i){var a=[].filter.call(t(n).find(r),function(t){return(t.offsetWidth>0||t.offsetHeight>0||t==i)&&-1==t.className.indexOf("pq-box-focus")}),l=a.indexOf(i);return-1==l&&(l=a.indexOf(o.closest("[tabindex=0]")[0])),l>-1?e?a[l-1]:a[l+1]:e?a[a.length-1]:a[0]}},focusEle:function(e,n){var r=this.getFocusEle(e,n);return r&&t(r).focus(),r},escapeHtml:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},juiToExcel:(n={},function(t){var e=n[t];return e||"string"!=typeof t||(e=t.replace(/y/g,"yy").replace(/DD/g,"dddd").replace(/D/g,"ddd").replace(/MM/g,"mmmm").replace(/M/g,"mmm"),n[t]=e),e||""}),excelToJui:function(){var t={};return function(e){var n=t[e];return n||"string"!=typeof e||(n=e.replace(/yy/g,"y").replace(/dddd/g,"DD").replace(/ddd/g,"D").replace(/mmmm/g,"MM").replace(/mmm/g,"M"),t[e]=n),n||""}}(),mergeDeep(e,...n){let r,i,o;for(o of n)for(r in o)i=o[r],t.isPlainObject(i)?pq.mergeDeep(e[r]||={},i):e[r]=i;return e},getOldCellX(e,n,r){let i=e[r],o=n[r];return o&&"object"==typeof o&&(i=t.extend(!0,{},i)),i},offsetLeft(t,e){if(e){return t.offsetParent.clientWidth-(t.offsetLeft+t.offsetWidth)}return t.offsetLeft},offset:function(t,e){var n=0,r=0;do{if(t==e)break;n+=t.offsetLeft-t.scrollLeft,r+=t.offsetTop-t.scrollTop}while(t=t.offsetParent);return{left:n,top:r}},copyObj:function(e,n,r){var i,o,a=pq.objectify(r);for(i in n)a[i]||(o=n[i],e[i]=t.isPlainObject(o)?t.extend(!0,{},o):o);return e},exportCsv:function(t,e,n={}){var r,i,o=[],a=n.separator||",";function l(t){t.forEach(function(t){r=[],t.cells.forEach(function(t){i=t.text,i??="",i=(i+"").replace(/\"/g,'""'),r.push('"'+i+'"')}),o.push(r.join(a))})}return l(t),l(e),(n.skipBOM?"":"\ufeff")+o.join("\n")},exportHtm:function(t,e,n){var r=n.grid,i=r.options.rtl?"direction:rtl;":"",o=r.element.find(".pq-table"),a=o.css("font-family"),l=o.css("font-size"),s="td,th{padding: 5px;}"+(n.cssRules||""),c="empty-cells:show;font-family:"+a+";font-size:"+l+";border-spacing:0;"+i+(n.cssTable||""),d=[];function u(t,e){e&&d.push("<thead>"),t.forEach(function(t){var n,r=[];(n=t.attr)&&r.push(n),(n=t.css)&&r.push("style='"+pq.styleStr(n)+"'"),r=r.length?" "+r.join(" "):"",d.push("<tr",r,">"),t.cells.forEach(function(t){if(!t.empty){var r=t.html||t.text,i="",o=[];(n=t.colSpan)&&o.push("colspan="+n),(n=t.rowSpan)&&o.push("rowspan="+n),(n=t.alignment)&&(i+="text-align:"+n+";"),(n=t.valign)&&(i+="vertical-align:"+("center"==n?"middle":n)+";"),(n=t.css)&&(i+=pq.styleStr(n)),i&&o.push("style='"+i+"'"),o=o.length?" "+o.join(" "):"",e?d.push("<th",o,">",r,"</th>"):d.push("<td",o,">",pq.newLine(r),"</td>")}}),d.push("</tr>")}),e&&d.push("</thead>")}return d.push("<style>"+s+"</style>"),d.push("<table class='pq-export-table' style='"+c+"'>"),t.length&&u(t,!0),u(e),d.push("</table>"),d.join("")},borderP:["left","top","right","bottom"],getPdfStyle:function(t,e){var n,r,i=function(e,n){null==t[e]&&(t[e]=n)};(n=e["background-color"])&&i("fillColor",n),(n=e["font-size"])&&i("fontSize",parseFloat(n)),(n=e.color)&&i("color",n),(n=e["font-weight"])&&i("bold","bold"==n),(n=e["white-space"])&&i("noWrap","nowrap"==n),(n=e["font-style"])&&i("italics","italic"==n),(n=e["text-decoration"])&&(n=pq.camelCase(n),["underline","lineThrough","overline"].indexOf(n)>=0&&i("decoration",n)),pq.borderP.forEach(function(i,o){(n=e["border-"+i])&&((r=t.borderColor=t.borderColor||[])[o]||(r[o]=n.split(" ")[2]))}),t.border=t.borderColor},exportPdf:function(t,e){var n,r,i,o,a,l=this,s=t.length,c=s?t[0].cells.length:e[0]?e[0].cells.length:0,d=[];function u(t){t.forEach(function(t){for((n=t.css)&&(n=pq.styleObj(n)),i=t.cells,o=[],r=0;r<c;r++)(a=i[r]||{}).css&&l.getPdfStyle(a,pq.styleObj(a.css)),n&&l.getPdfStyle(a,n),o[r]=a;d.push(o)})}return u(t),u(e),{body:d,headerRows:s}},extendT:function(e,n){var r,i,o,a;for(r in n)if(void 0===e[r]){if((o=Object.getOwnPropertyDescriptor(n,r)).get||o.set){Object.defineProperty(e,r,o);continue}a=i=n[r],i&&"object"==typeof i&&(a={},t.extend(!0,a,i)),e[r]=a}return e},flatten:function(t,e){var n,r=0,i=t.length;for(e=e||[];r<i;r++)null!=(n=t[r])&&(n.push?pq.flatten(n,e):e.push(n));return e},toRC:function(t){var e,n=t.match(/([A-Z]*)(\d*)/),r=pq.toNumber(n[1]);return n[2]&&(e=n[2]-1),[e,r]},pad:function(t){return 1==(t+="").length?"0"+t:t},getDataTypeFromVal(t){if(null!=t){var e=typeof t;if("number"==e)return"Number";if("string"==e){if(parseFloat(t)==t)return"Number";if(pq.testFmtDate(t,["yyyy-mm-dd ","mm/dd/yyyy"]))return"Date"}}},onResize:function(e,n){e.attachEvent?e.attachEvent("onresize",n):window.ResizeObserver?new window.ResizeObserver(n).observe(e):window.addResizeListener?window.addResizeListener(e,n):t(e).resize(n)},fileRead:function(t,e,n){var r=new FileReader;r.onload=function(){n(r.result)},r[e](t)},fileToBase:function(t,e){pq.fileRead(t,"readAsDataURL",e)},xmlhttp(t,e,n){fetch(t).then(t=>{if(!t.ok)throw new Error(t.statusText);return t[e||"text"]()}).then(t=>n(t)).catch(t=>{console.error("Fetch: ",t),n(null)})},urlToBase:function(t,e){pq.xmlhttp(t,"blob",function(t){if(!t)return console.error("urlToBase failed due to failed xmlhttp request."),e(null);pq.fileToBase(t,e)})},getMimeType(t){var e=e=>t.startsWith(e);if(e("data:")){var n=t.indexOf(";");return t.slice(5,n)}return e("/9j/")||e("/8j/")||e("/+j/")?"image/jpeg":e("iVBORw0KGgo")?"image/png":e("R0lGOD")?"image/gif":e("Qk0")?"image/bmp":e("SUk")?"image/tiff":"image/jpg"},convertToPNG:async t=>new Promise((e,n)=>{var r=new Image,i=document.createElement("canvas"),o=i.getContext("2d");r.onload=t=>{i.width=r.width,i.height=r.height,o.drawImage(r,0,0),e(i.toDataURL("image/png"))},r.onerror=t=>{n()},r.src=t}),objectAttr:function(t){t&&(t=t.split(" "))},fakeEvent:function(e,n,r){if("timeout"==n){let n,i,o=e=>{t(e).val()!=i&&(i=t(e).val(),t(e).triggerHandler("timeout"))};e.off("input change beforeinput").on({beforeinput(){null==i&&(i=t(this).val())},input(){clearTimeout(n),n=setTimeout(t=>{o(this)},r)},change(){o(this)}})}},getScript:function(e,n){if(t('script[src="'+e+'"]').length)n();else{var r=document.createElement("script");r.onload=n,r.src=e,document.head.appendChild(r)}},getScripts:function(t,e,n){n=n||0,pq.getScript(t[n],function(){++n==t.length?e():pq.getScripts(t,e,n)})},getAddress:function(t){var e,n,r=t.split(":"),i=this.toRC(r[0]),o=i[0],a=i[1],l=this.toRC(r[1]||r[0]),s=l[0],c=l[1];return isNaN(s)||(e=s-o+1),isNaN(c)||(n=c-a+1),{r1:o,c1:a,rc:e,cc:n,r2:s,c2:c}},getClsVal:function(t,e){var n=t.match(new RegExp("\\b"+e+"(\\S+)\\b"));return n?n[1]:null},getDataType:function(t){var e=t.dataType;return"float"!=e&&"integer"!=e||(e="number"),e||"string"},getFn:(e={},function(t){var n=t;return pq.isStr(t)&&((n=e[t])||(n=window,t.split(".").forEach(function(t){n=n[t]}),e[t]=n)),n}),isLink:function(t){return(t+"").match(/^<a\s+href=(?:"([^"]+)"|'([^']+)').*?>(.*?)<\/a>$/)},isFn:function(t){return"function"==typeof t},isStr:function(t){return"string"==typeof(null!=t?t.valueOf():t)},isCtrl:function(t){return t.ctrlKey||t.metaKey},getROS(t){return Object.values(this.RichObjs).filter(e=>e[t])},getROFn(t){let e=pq.getROS(t);return e.length?(...n)=>{let r,i;for(i of e)if(r=i[t](...n),r)return r}:t=>{}},getHex(t){let e=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(e){return"#"+(e[1]<<16|e[2]<<8|e[3]).toString(16).padStart(6,"0")}return t},parseStyle(t){const e={},n=/([\w-]+)\s*:\s*((?:"[^"]*"|[^;])*)/g;let r;for(;null!==(r=n.exec(t));){let t=r[1].trim(),n=r[2];"mso-number-format"==t&&(n=n.replace(/\\0022/g,'"')),e[t]=n}return e},extractCells(t){let e=t.match(/<style>([\s\S]*?)<\/style>/),n=e?e[1].replace(/(<!--|-->)/,""):"",r={};return n.replace(/\.([^\s{]+)\s*{([^}]*)}/g,(t,e,n)=>{r[e]=n.trim()}),[...t.matchAll(/<tr(.*?)>(.*?)<\/tr>/gs)].map(t=>[...t[2].matchAll(/<td(.*?)>(.*?)<\/td>/gs)].map(t=>{let e=t[1],n=t[2],i=e.match(/style=(['"])(.*?)\1/),o=i?.[2];o=(o||"").replace(/&quot;/g,'"');let a=e.match(/class=(["'])([^"'<>]+)\1|class=([^\s<>]+)/),l=a?a[2]||a[3]:null,s=l&&r[l]?r[l]:null;return{val:n,style:pq.parseStyle([o,s].join(";"))}}))},stripHtml(t){if(/</.test(t)){var e=document.createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""}return t},parseMsoNumberFormat(t){if(!t)return"";let e=t.replace(/^mso-number-format:/i,"").trim();return e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1)),e=e.replace(/\\\\/g,"\\"),e=e.replace(/\\#/g,"#").replace(/\\0/g,"0").replace(/\\,/g,",").replace(/\\\./g,".").replace(/\\-/g,"-").replace(/\\ /g," ").replace(/\\([a-zA-Z])/g,"\\$1"),e},getRowsFromHtml(t){var e=["text-decoration","font-family","font-weight","font-style","font-size","background-color","color","background"],n={background:"background-color"},r=[];if(t.match(/<table[\s\S]*<\/table>/)){var i,o,a=pq.extractCells(t),l=pq.getROFn("toObject");for(i of a){o=[];for(let t of i){let r,i,a=t.style,s={},c=t.val;r=l(c)||{val:pq.stripHtml(c)},i=r.prop||={};for(let t in a)c=a[t].trim(),"mso-number-format"==t?(c=pq.parseMsoNumberFormat(c),i.format=c,r.val=pq[pq.isDateFormat(c)?"parseDate":"deFormatNumber"](r.val)):"text-align"==t?i.align=c:e.includes(t)&&(s[n[t]||t]=pq.getHex(c));r.style=s,o.push(r)}r.push(o)}return r}},getStrFromHtml:(t,e)=>(pq.getRowsFromHtml(t,e)||[[]]).map(t=>t.map(t=>t.val).join("\t")).join("\n"),getRowsFromStr:function(t,e){t=t.replace(/\n$/,"");var n=Math.random()+"",r=pq.getROFn("toObject"),i=new RegExp(n,"g");return(t=t.replace(/(^|\t|\n)"(?=[^\t]*?[\r\n])([^"]|"")*"(?=$|\t|\n)/g,function(t){return t.replace(/(?!^(\r\n|\n))\n/g,n).replace(/^(\t|\n)?"/,"$1").replace(/"$/,"").replace(/""/g,'"')})).split("\n").map(function(t){return t.replace(/\r$/,"").replace(i,"\n").split("\t").map(t=>r(t)||t)})},Cell:class{constructor(t={}){Object.assign(this,t)}toString(){return this.val}valueOf(){return this.val}},fillNewRow(t,e,n,r,i){if(n&&"object"==typeof n){t[i]=n.val;let o="pq_cellstyle",a="pq_cellprop",l=n.style,s=n.prop;l&&((t[o]||={})[i]=n.style,e&&((e[o]||={})[i]=r[o]?.[i])),s&&((t[a]||={})[i]=n.prop,e&&((e[a]||={})[i]=r[a]?.[i]))}else t[i]=n;e&&(e[i]=r[i])},isEmpty:function(t){for(var e in t)return!1;return!0},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},getScale(t){var e=t.getBoundingClientRect();return[Math.round(e.width)/t.offsetWidth||1,Math.round(e.height)/t.offsetHeight||1]},makePopup:function(e,n,r){var i=(Math.random()+"").replace(".",""),o=r.onPopupRemove,a=r.noCloseSelector,l=r.keepPopupWithoutEle,s=r.closeOnEle,c=pq.getScale(n),d=pq.getScale(e.parentNode),u=parseFloat(t(n).css("font-size")),h="mousedown.pq"+i,f=(n.nodeName||"").toLowerCase(),p="input"==f||"textarea"==f,g=function(t){t&&p&&document.body.contains(n)?m.hide():m.remove()},m=t(e);m.css({scale:c[0]/d[0]+" "+c[1]/d[1],"font-size":u,"transform-origin":"0 0"}),m.addClass("pq-popup").on("keydown",function(e){e.keyCode!=t.ui.keyCode.ESCAPE||e.isDefaultPrevented()||(g(!0),n&&document.contains(n)&&n.focus())}),l||t(n).one("remove",function(){g()}),m.one("remove",function(){t(document).off(h),o&&o()}),requestAnimationFrame(function(){t(document).on(h,function(r){var i=r.target,o=t(i);!m.is(":visible")||e.contains(i)||pq.isCtrl(r)||o.closest(".ui-datepicker").length||a&&o.closest(a).length||!s&&n.contains(i)||g(!0)})})},rtlIcons:(t,e)=>e?t.map(function(t){return t.replace(/-(s)?e$/,"-$1w")}):t,setTitle(t,e){t.attr("title",e).attr("aria-label",e)},createUIButton:(t,e="",n="")=>`<button type="button" class='ui-widget ui-button ui-corner-all ui-button-icon-only ${n}' title="${e}" aria-label="${e}">\n<span class='ui-icon ui-icon-${t}'></span>\n ${e||"undefined"}\n</button>`,moveItem:function(t,e,n,r){return n>r?(e.splice(n,1),e.splice(r++,0,t)):n==r?r++:(e.splice(r,0,t),e.splice(n,1)),r},newLine:function(t){return isNaN(t)&&pq.isStr(t)?t.replace(/(\r\n|\r|\n)/g,"<br>"):t},objectify:function(t){for(var e={},n=t.length;n--;)e[t[n]]=1;return e},async zip(t,e,n){var r=JSZip();return r.file(t,e),await r[r.generateAsync?"generateAsync":"generate"]({type:n||"base64",compression:"DEFLATE"})},postData:function(e,n,r){t.ajax(t.extend({url:e,type:"POST",cache:!1,data:n,success:function(n){e=e+(e.indexOf("?")>0?"&":"?")+"pq_filename="+n,t(document.body).append("<iframe height='0' width='0' frameborder='0' src=\""+e+'"></iframe>')}},r))},saveAs:function(e,n){var r="string"==typeof e?new Blob([e]):e;if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(r,n);else{var i=document.createElement("a"),o=t(i),a=i.href=URL.createObjectURL(r);i.download=n,t(document.body).append(i),i.click(),o.remove(),URL.revokeObjectURL(a)}},styleObj:function(t,e){function n(){""===i?delete e[r]:e[r]=i}if(pq.isStr(t)){e||={};var r,i,o=t.split(";");o.forEach(function(t){t&&(o=t.split(":"),r=o[0],i=o[1],r&&null!=i&&(i=i.trim(),"border"==r?pq.borderP.forEach(function(t){r="border-"+t,n()}):n()))})}else{if(!e)return t;for(r in t)i=t[r],n()}return e},tint:function(t,e){t=t.replace(/^#/,""),e*=1;var n=function(t,e){return t=t.slice(e,e+2),parseInt(t,16)},r=function(t){return t+=(255-t)*e,(t=(t=Math.round(t))>255?255:t).toString(16).toUpperCase()},i=n(t,0),o=n(t,2),a=n(t,4);return r(i)+r(o)+r(a)},capitalF:function(t){if(t)return t[0].toUpperCase()+t.slice(1)},camelCase:function(t){if(t){var e=t.split("-"),n=e[1];return e[0]+(n?n[0].toUpperCase()+n.slice(1):"")}},styleStr:function(t){if("string"!=typeof t){var e,n,r=[];for(e in t)null!=(n=t[e])&&r.push(e+":"+n);t=r.length?r.join(";")+";":""}return t},escapeXml:function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};return t?(t+"").replace(/(&|\<|\>|"|')/g,function(t,n){return e[n]}):t},escapeXmlAttr:function(t){var e={"&":"&amp;","<":"&lt;",'"':"&quot;"};return t?(t+"").replace(/(&|\<|")/g,function(t,n){return e[n]}):t},unescapeXml:function(){var t={amp:"&",lt:"<",gt:">",quot:'"',apos:"'"};return function(e){return e.replace(/&(amp|lt|gt|quot|apos);/g,function(e,n){return t[n]})}}()}),r.select=function(t){var e,n,r,i=t.attr,o=t.options||[],a=t.groupIndx,l=t.labelIndx,s=t.valueIndx,c=null!=l&&null!=s,d=null!=a,u=t.prepend,h=t.dataMap,f=function(){for(var t={},e=0;e<h.length;e++){var n=h[e];t[n]=m[n]}return"data-map='"+JSON.stringify(t)+"'"},p=["<select ",i," >"];if(u)for(var g in u)p.push('<option value="',g,'">',u[g],"</option>");for(var m of o)if(c){var v=m[s],w=m.style?`style="${m.style}" `:"",x=m.pq_disabled?'disabled="disabled" ':"",y=m.pq_selected?'selected="selected" ':"";if(null==v)continue;if(r=h?f():"",d){var b=m.pq_disabled_group?'disabled="disabled" ':"";n!=(e=m[a])&&(null!=n&&p.push("</optgroup>"),p.push('<optgroup label="',e,'" ',b," >"),n=e)}if(l==s)p.push("<option ",w,y,x,r,">",v,"</option>");else{var C=m[l];p.push("<option ",w,y,x,r,' value="',v,'">',C,"</option>")}}else if("object"==typeof m)for(var g in v=t.value,m)y=v==g?'selected="selected" ':"",p.push("<option "+y+' value="',g,'">',m[g],"</option>");else p.push("<option>",m,"</option>");return d&&p.push("</optgroup>"),p.push("</select>"),p.join("")},t.fn.pqval=function(t){if(t){if(t.incr){var e=this.data("pq_value");return this.prop("indeterminate",!1),e?(e=!1,this.prop("checked",!1)):!1===e?(e=null,this.prop("indeterminate",!0),this.prop("checked",!1)):(e=!0,this.prop("checked",!0)),this.data("pq_value",e),e}return e=t.val,this.data("pq_value",e),this.prop("indeterminate",!1),null===e?(this.prop("indeterminate",!0),this.prop("checked",!1)):e?this.prop("checked",!0):this.prop("checked",!1),this}return this.data("pq_value")},r.xmlToArray=function(e,n){var r=n.itemParent,i=n.itemNames,o=[];return t(e).find(r).each(function(e,n){var r=t(n),a=[];t(i).each(function(t,e){a.push(r.find(e).text().replace(/\r|\n|\t/g,""))}),o.push(a)}),o},r.xmlToJson=function(e,n){var r=n.itemParent,i=n.itemNames,o=[];return t(e).find(r).each(function(e,n){for(var r=t(n),a={},l=0,s=i.length;l<s;l++){var c=i[l];a[c]=r.find(c).text().replace(/\r|\n|\t/g,"")}o.push(a)}),o},r.tableToArray=function(e){var n=t(e),r=[],i=[],o=n.children("tbody").children("tr"),a=o.length?t(o[0]):t(),l=o.length>1?t(o[1]):t();return a.children("th,td").each(function(e,n){var i=t(n),o=i.html(),a=i.width(),s="left";if(l.length){var c=l.find("td:eq("+e+")").attr("align");s=c||s}var d={title:o,width:a,dataType:"string",align:s,dataIndx:e};r.push(d)}),o.each(function(e,n){if(0!=e){var r=t(n),o=[];r.children("td").each(function(e,n){o.push(t.trim(t(n).html()))}),i.push(o)}}),{data:i,colModel:r}},pq.valid={isFloat:function(t){var e=1*t;return!isNaN(e)&&e==t},isInt:function(t){var e=parseInt(t);return!isNaN(e)&&e==t},isDate:function(t){return!isNaN(Date.parse(t))}};var o=[],a={},l=pq.toLetter=function(t){var e=o[t];if(!e){var n=++t%26,r=t/26|0,i=n?String.fromCharCode(64+n):(--r,"Z");e=r?l(r-1)+i:i,t--,o[t]=e,a[e]=t}return e};function s(t){return t.charCodeAt(0)-64}pq.toNumber=function(t){var e,n,r,i=a[t];if(null==i&&t){for(e=t.length,i=-1,n=0;n<e;n++)r=e-n-1,i+=s(t[n])*Math.pow(26,r);o[i]=t,a[t]=i}return i},pq.generateData=function(t,e){for(var n=[],r=0;r<e;r++)n[r]=l(r);var i=[];for(r=0;r<t;r++)for(var o=i[r]=[],a=0;a<e;a++)o[a]=n[a]+(r+1);return i},pq.scrollLeft=(t,e,n)=>{if(null==e)return Math.abs(t.scrollLeft);t.scrollLeft=(n?-1:1)*Math.abs(e)},pq.scrollTop=t=>t.scrollTop}(jQuery),function(t){pq.validations={minLen:function(t,e,n){if(e*=1,(t=n(t)).length>=e)return!0},nonEmpty:function(t){if(null!=t&&""!==t)return!0},maxLen:function(t,e,n){if(e*=1,(t=n(t)).length<=e)return!0},gt:function(t,e,n){if((t=n(t))>(e=n(e)))return!0},gte:function(t,e,n){if((t=n(t))>=(e=n(e)))return!0},lt:function(t,e,n){if((t=n(t))<(e=n(e)))return!0},lte:function(t,e,n){if((t=n(t))<=(e=n(e)))return!0},neq:function(t,e,n){if((t=n(t))!==(e=n(e)))return!0},regexp:function(t,e){if(new RegExp(e).test(t))return!0}};var e=t.paramquery;e.cValid=function(t){this.that=t},e.cValid.prototype={_isValidCell:function(t){var e=this.that,n=t.column,r=pq.validations,i=n.validations;if(!i||!i.length)return{valid:!0};var o,a=t.value,l=n.dataType,s=function(t){return e.getValueFromDataType(t,l,!0)},c=t.rowData;if(!c)throw"rowData required.";for(var d=0;d<i.length;d++){var u=i[d],h=u.on,f=u.type,p=!1,g=u.msg,m=u.value;if(!1!==h){if(o=r[f])p="nonEmpty"!=f&&!r.nonEmpty(a)||o(a,m,s);else if(f){var v={column:n,value:a,rowData:c,msg:g};!1===e.callFn(f,v)?(p=!1,g=v.msg):p=!0}else p=!0;if(!p)return{valid:!1,msg:g,column:n,warn:u.warn,dataIndx:n.dataIndx,validation:u}}}return{valid:!0}},onScrollCell:function(t,e,n,r,i,o){var a,l=this.that;l.options.bootstrap;if(t||(a=l.getEditCell())&&a.$cell){var s=t||a.$td;s.attr("title",e);var c="tooltip";try{s[c]("destroy")}catch(t){}s[c]({trigger:"manual",position:{my:"left center+5",at:"right center"},content:function(){return(""==n?"":"<span class='ui-icon "+n+" pq-tooltip-icon'></span>")+e},open:function(t,e){var n=e.tooltip;if(r&&n.addClass(r),o){var a=n.attr("style");n.attr("style",a+";"+o)}i&&n.tooltip.css(i)}})[c]("open")}},isValidCell:function(e){var n=this,r=n.that,i=e.rowData,o=e.rowIndx,a=e.value,l=e.valueDef,s=e.column,c=e.focusInvalid,d=r.options,u=e.allowInvalid,h=s.dataIndx,f=d.validation,p=d.warning,g=d.editModel,m=g.invalidClass,v=g.warnClass,w=document.activeElement;if(e.checkEditable&&0==r.isEditable({rowIndx:o,rowData:i,column:s,dataIndx:h}))return{valid:!0};var x=this._isValidCell({column:s,value:a,rowData:i}),y=x.valid,b=x.warn,C=x.msg;if(y)r.data({rowData:i,dataIndx:h,data:"pq_valid"})&&(r.removeClass({rowData:i,rowIndx:o,dataIndx:h,cls:v+" "+m}),r.removeData({rowData:i,dataIndx:h,data:"pq_valid"}));else var q=t.extend({},b?p:f,x.validation),I=q.css,_=q.cls,R=q.icon,D=q.style;if(u||b)return y?{valid:!0}:(r.addClass({rowData:i,rowIndx:o,dataIndx:h,cls:b?v:m}),r.data({rowData:i,dataIndx:h,data:{pq_valid:{css:I,icon:R,style:D,msg:C,cls:_}}}),x);if(!y){if(null==o){var M=r.getRowIndx({rowData:i,dataUF:!0});if(null==(o=M.rowIndx)||M.uf)return x.uf=M.uf,x}if(c){var S;if(l){if(t(w).hasClass("pq-editor-focus")){var T=d.editModel.indices;if(T){var F=T.rowIndx,k=T.dataIndx;if(null!=o&&o!=F)throw"incorrect usage of isValid rowIndx: "+o;if(h!=k)throw"incorrect usage of isValid dataIndx: "+h;r.editCell({rowIndx:F,dataIndx:h})}}}else{r.goToPage({rowIndx:o});var E={rowIndx:o,dataIndx:h};E=r.normalize(E);S=r.getCell(E),r.scrollCell(E,function(){n.onScrollCell(S,C,R,_,I,D),r.focus(E)})}this.onScrollCell(S,C,R,_,I,D)}return x}if(l){var P=r.getEditCell();if(P&&P.$cell){var $=P.$td;$.removeAttr("title");try{$.tooltip("destroy")}catch(t){}}}return{valid:!0}},isValid:function(t){t=t||{};var e=this.that,n=t.allowInvalid,r=t.focusInvalid,i=t.checkEditable;n=null!=n&&n;if(null!=(f=t.dataIndx)){var o=e.columns[f],a=t.rowData||e.getRowData(t),l=t.hasOwnProperty("value"),s=l?t.value:a[f];return(p=this.isValidCell({rowData:a,checkEditable:i,rowIndx:t.rowIndx,value:s,valueDef:l,column:o,allowInvalid:n,focusInvalid:r})).valid||p.warn?{valid:!0}:p}if(null!=t.rowIndx||null!=t.rowIndxPage||null!=t.rowData){a=t.rowData||e.getRowData(t);for(var c=e.colModel,d=[],u=0,h=c.length;u<h;u++){if(!(o=c[u]).hidden){var f,p;s=a[f=o.dataIndx];if(!(p=this.isValidCell({rowData:a,value:s,column:o,rowIndx:t.rowIndx,checkEditable:i,allowInvalid:n,focusInvalid:r})).valid&&!p.warn){if(!n)return p;d.push({rowData:a,dataIndx:f,column:o})}}}return n&&d.length?{cells:d,valid:!1}:{valid:!0}}var g=t.data?t.data:e.options.dataModel.data;d=[];if(!g)return null;for(u=0,h=g.length;u<h;u++){a=g[u];var m=this.isValid({rowData:a,rowIndx:undefined,checkEditable:i,allowInvalid:n,focusInvalid:r}),v=m.cells;if(!1===n){if(!m.valid)return m}else v&&v.length&&(d=d.concat(v))}return n&&d.length?{cells:d,valid:!1}:{valid:!0}}}}(jQuery),function(t){var e={options:{curPage:0,totalPages:0,totalRecords:0,msg:"",rPPOptions:[10,20,30,40,50,100],rPP:20,layout:["first","prev","|","strPage","|","next","last","|","strRpp","|","refresh","|","strDisplay"]},_create:function(){var t=this,e=t.options,n=e.rtl,r=t.element,i={first:t.initButton(e.strFirstPage,"seek-"+(n?"end":"first"),"first"),"|":"<td><span class='pq-separator'></span></td>",next:t.initButton(e.strNextPage,"seek-"+(n?"prev":"next"),"next"),prev:t.initButton(e.strPrevPage,"seek-"+(n?"next":"prev"),"prev"),last:t.initButton(e.strLastPage,"seek-"+(n?"first":"end"),"last"),strPage:t.getPageOf(),strRpp:t.getRppOptions(),refresh:t.initButton(e.strRefresh,"refresh","refresh"),strDisplay:"<td><span class='pq-page-display'>"+t.getDisplay()+"</span></td>"},o=e.layout.map(function(t){return i[t]}).join("");t.listeners={},r.html("<table style='border-collapse:collapse;'><tr>"+o+"</tr></table>"),r.addClass("pq-pager"),t.$first=r.find(".pq-page-first"),t.bindButton(t.$first,function(n){e.curPage>1&&t.onChange(n,1)}),t.$prev=r.find(".pq-page-prev"),t.bindButton(t.$prev,function(n){if(e.curPage>1){var r=e.curPage-1;t.onChange(n,r)}}),t.$next=r.find(".pq-page-next"),t.bindButton(t.$next,function(n){if(e.curPage<e.totalPages){var r=e.curPage+1;t.onChange(n,r)}}),t.$last=r.find(".pq-page-last"),t.bindButton(t.$last,function(n){if(e.curPage!==e.totalPages){var r=e.totalPages;t.onChange(n,r)}}),t.$refresh=r.find(".pq-page-refresh"),t.bindButton(t.$refresh,function(e){if(!1===t._trigger("beforeRefresh",e))return!1;t._trigger("refresh",e)}),t.$display=r.find(".pq-page-display"),t.$select=r.find(".pq-page-select").val(e.rPP).on("change",t.onChangeSelect.bind(t)),t.$totalPages=r.find(".pq-page-total"),t.$curPage=r.find(".pq-page-current"),t.bindCurPage(t.$curPage)},_destroy:function(){this.element.empty().removeClass("pq-pager").enableSelection(),this._trigger("destroy")},_setOption:function(t,e){"curPage"!=t&&"totalPages"!=t||(e*=1),this._super(t,e)},_setOptions:function(e){var n,r=!1,i=this.options;for(n in e){var o=e[n],a=typeof o;"string"==a||"number"==a?o!=i[n]&&(this._setOption(n,o),r=!0):pq.isFn(o.splice)||t.isPlainObject(o)?JSON.stringify(o)!=JSON.stringify(i[n])&&(this._setOption(n,o),r=!0):o!=i[n]&&(this._setOption(n,o),r=!0)}return r&&this._refresh(),this}};t.widget("paramquery.pqPager",e),pq.pager=function(e,n){var r=t(e).pqPager(n);return r.data("paramqueryPqPager")||r.data("paramquery-pqPager")};var n=t.paramquery,r=n.pqPager;r.regional={},r.defaults=r.prototype.options,t.extend(r.prototype,{bindButton:function(t,e){t.button().click(e)},bindCurPage:function(e){var n=this,r=this.options;e.on("keydown",function(e){e.keyCode===t.ui.keyCode.ENTER&&t(this).trigger("change")}).on("change",function(e){var i=t(this),o=i.val();return isNaN(o)||o<1||(o=parseInt(o))!==r.curPage&&(o>r.totalPages||!1===n.onChange(e,o))?(i.val(r.curPage),!1):void 0})},initButton:function(t,e,n){return"<td>"+pq.createUIButton(e,t,"pq-page-"+n)+"</td>"},onChange:function(t,e){var n={curPage:e};if(!1===this._trigger("beforeChange",t,n))return!1;this._trigger("change",t,n)},onChangeSelect:function(e){var n=t(e.target),r=this,i=1*n.val(),o={rPP:i};if(!1===r._trigger("beforeChange",e,o))return n.val(r.options.rPP),!1;r.options.rPP=i,r._trigger("change",e,o)},refresh:function(){this._destroy(),this._create()},format:function(t){var e=t.format;return function(t){return e?pq.formatNumber(t,e):t}},_refresh:function(){var t=this,e=t.options,n=e.curPage,r=e.totalPages,i=e.strPage.replace("{0}",n).replace("{1}",r),o=e.strRpp.replace("{0}",e.rPP),a=n>=r;t.setDisable(t.$next,a),t.setDisable(t.$last,a),a=n<=1,t.setDisable(t.$first,a),t.setDisable(t.$prev,a),t.$totalPages.text(t.format(e)(r)),t.$curPage.attr("aria-label",i).val(n),t.$select.attr("aria-label",o).val(e.rPP),t.$display.html(this.getDisplay()),t._trigger("refreshView")},getDisplay:function(){var t=this.options,e=this.format(t);if(t.totalRecords>0){var n=t.rPP,r=t.strDisplay||"",i=t.curPage,o=t.totalRecords,a=(i-1)*n,l=i*n;l>o&&(l=o),r=(r=(r=r.replace("{0}",e(a+1))).replace("{1}",e(l))).replace("{2}",e(o))}else r="";return r},getPageOf:function(){var t=this.options,e=t.curPage,n=t.totalPages;return"<td><span>"+(t.strPage||"").replace("{0}","<input type='text' value='"+e+"' tabindex='0' class='pq-page-current ui-corner-all' />").replace("{1}","<span class='pq-page-total'>"+this.format(t)(n)+"</span>")+"</span></td>"},getRppOptions:function(){var t,e,n,r,i,o=this.options,a=o.rPPOptions,l=0,s=a.length,c=this.format(o),d=o.strRpp||"";if(d&&-1!=d.indexOf("{0}")){for(i=["<select class='ui-corner-all pq-page-select' >"];l<s;l++)e=1*(n=a[l])==n?c(t=n):n[t=Object.keys(n)[0]],i.push('<option value="',t,'">',e,"</option>");i.push("</select>"),r=i.join(""),d=d.replace("{0}",r)+"</span>"}return"<td><span class='pq-page-rppoptions'>"+d+"</span></td>"},_trigger:n._trigger,on:n.on,one:n.one,off:n.off,setDisable:function(t,e){t.button(e?"disable":"enable")}})}(jQuery),function(){var t;Object.assign(pq,{colors:{black:"000000",color1:"000000",color29:"800080",white:"FFFFFF",color2:"FFFFFF",color30:"800000",red:"FF0000",color3:"FF0000",color31:"008080",green:"00FF00",color4:"00FF00",color32:"0000FF",blue:"0000FF",color5:"0000FF",color33:"00CCFF",yellow:"FFFF00",color6:"FFFF00",color34:"CCFFFF",magenta:"FF00FF",color7:"FF00FF",color35:"CCFFCC",cyan:"00FFFF",color8:"00FFFF",color36:"FFFF99",color9:"800000",color37:"99CCFF",color10:"008000",color38:"FF99CC",color11:"000080",color39:"CC99FF",color12:"808000",color40:"FFCC99",color13:"800080",color41:"3366FF",color14:"008080",color42:"33CCCC",color15:"C0C0C0",color43:"99CC00",color16:"808080",color44:"FFCC00",color17:"9999FF",color45:"FF9900",color18:"993366",color46:"FF6600",color19:"FFFFCC",color47:"666699",color20:"CCFFFF",color48:"969696",color21:"660066",color49:"003366",color22:"FF8080",color50:"339966",color23:"0066CC",color51:"003300",color24:"CCCCFF",color52:"333300",color25:"000080",color53:"993300",color26:"FF00FF",color54:"993366",color27:"FFFF00",color55:"333399",color28:"00FFFF",color56:"333333"},splitByQuotes:t=>{for(var e,n=[],r=!0,i="",o=0;o<t.length;o++)'"'!==(e=t[o])||"\\"==t[o-1]?"\\"==e&&r||(i+=e):(r=!r,n.push(i),i="");return n.push(i),n},parseFormat(t){for(var e,n,r,i,o=!1,a=!1,l=!1,s="",c="",d="",u="",h=0,f=t.length,p=t=>{i?u+=t:d+=t};h<f;h++){i=s.length;var g=t[h];if(l)p(g),l=!1;else if("\\"!==g)if('"'!==g||l)if(a)p(g);else if("["!==g)o?("]"===g&&(o=!1),c+=g):" "!=g&&/[mdyhs#0\.\,\/\?%@\.]/i.test(g)?(u&&(s+=u,u=""),i||(n=/[mdyhs]/i.test(g),r="@"==g),s+=g):p(g);else{if("$"==t[h+1]){e=g;do{e+=g=t[++h]}while("]"!=g);p(e=e.replace(/\[\$([^-]*)(\-.*)?\]/,function(t,e,n){return e||""}));continue}o=!0,c+=g}else a=!a,(n||r)&&(u+=g);else l=!0,(n||r)&&(u+=g)}return d.endsWith("General")&&(d=d.replace("General",""),s="General"),u&&(n||r)&&(u=pq.splitByQuotes(u).join("")),[c,d,s,u,n?"d":r?"@":0]},splitByChar:function(t,e){for(var n,r,i=[],o="",a=0;a<t.length;a++){if('"'===(r=t[a])&&"\\"!=t[a-1])n=!n;else if(r===e&&!n){i.push(o),o="";continue}o+=r}return i.push(o),i},decimalToFraction(t,e){for(var n=Math.pow(10,e),r=1,i=1,o=Math.abs(t-r/i),a=1;a<=n;a++){var l=Math.round(t*a),s=Math.abs(t-l/a);s<o&&(r=l,i=a,o=s)}return i.toString().length>e&&(r=Math.round(3*t),i=3),[r,i]},_compileText(t,e,n){var r=pq.splitByQuotes(t);return t=>{for(var i="",o=0;o<r.length;o++)i+=o%2==0?r[o].replace(/@/g,t):r[o];return e+i+n}},_compilePhone:(t,e,n)=>r=>{var i=r+"",o=t.split(/[^\#0]+/),a=""==o[0],l=t.split(/[\#0]+/),s=o.toReversed().map(t=>{var e=t.length,n=i.length-e,r=i.substring(n);return i=n>0?i.slice(0,n):"",pq.formatNumber(r,t)}).toReversed(),c=l.map((t,e)=>{var n=s[e];return n??="",a?n+t:t+n});return e+i+c.join("")+n},_compileFraction(t,e,n){var r=t.match(/([\#0]*)\s*\?+\/(\?+)/),i=r[1]||"",o=r[2].length;return t=>{var r=((t*=1)+"").split("."),a=t<0,l=r[0],s=r[1],c="",d=l,u=1;if(s){var[d,u]=pq.decimalToFraction("."+s,o);i||(d+=l*u)}i&&l&&(c=pq.formatNumber(l,i)),a&&(c="-"+c);var h=i&&!s?"":d+"/"+u;return e+c+(c&&h?" ":"")+h+n}},_compileExp(t,e,n){if(/E[\+\-]/.test(t)){var r=t.match(/(\.[0\#]*)?E(\+|\-)([0\#]+)/),i=r[1],o=i?i.length-1:0,a=r[2],l=r[3];return t=>{var r=parseFloat(t).toExponential(o)+"";return r=r.replace(/e([\+\-])(\d+)/i,(t,e,n)=>"E"+("-"==a&&"+"==e?"":e)+pq.formatNumber(n,l)),e+("NaN"==r?t:r)+n}}},_compileGeneral(t,e,n,r,i){var o=(e,n)=>(t.match(e)||[])[n||0]||"",a=o(/,+$/).length,l=1e3**a,s=o(/\s*%$/),c=s.length,d=0;t.split("").find(t=>{if("0"==t)d++;else if("."==t)return!0}),t=(t=t.slice(0,t.length-a)).slice(0,t.length-c);var u=o(/\.([#0]+)/,1),h=o(/\.(0+)/,1),f=t.indexOf(",")>=0,p=new Intl.NumberFormat(i,{useGrouping:f,minimumFractionDigits:h.length,maximumFractionDigits:u.length,minimumIntegerDigits:d||void 0});return i=>{var o=i;if("General"==t)a=Math.abs(o);else{o*=s?100:1,o/=l;var a=p.format(Math.abs(o));0==d&&"0"==a[0]&&(a=a.slice(1)),s&&(a=a+" ".repeat(c-1)+"%")}return isNaN(o)?i:(e&&o<0?"-":"")+n+a+r}},cacheDateFmt:{},_compileDate:function(t){var e=pq.cacheDateFmt;if(e[t])return e[t];for(var n,r,i=pq.splitByQuotes(t),o=0,a=[],l={hour12:!1},s=t=>(e,n)=>{var i=e.length,o=t+i;return"M"==t&&null!=r&&n>r&&i<=2&&(o="Z"+i),l[o]=1,`{${o}}`};o<i.length;o++)if(n=i[o]){if(n.match(/([#0@]|\?\/\?)|General/))return[{},[]];o%2==0&&(r=(/h{1,2}/.exec(n)||{}).index,(/s{1,2}/.exec(n)||{}).index,n=(n=(n=(n=(n=(n=(n=(n=n.replace(/y{2,4}/gi,s("Y"))).replace(/(^|[^ap])(m{1,5})/gi,(t,e,n,r)=>e+s("M")(n,r+e.length))).replace(/d{3,4}/gi,s("W"))).replace(/d{1,2}/gi,s("D"))).replace(/h{1,2}/gi,s("H"))).replace(/s{1,2}/gi,s("S"))).replace(/AM\/PM/gi,t=>(l.hour12=!0,"{AM}"))).replace(/\\"/g,'"')),a.push(n)}return e[t]=[l,a]},_compile:function(){pq.phoneRE='^([^#0?E,%."]*[#0]+[^#0?E,%.]+[#0]+[^#0?E,%."]*)+$';var t,e,n={},r=new RegExp(pq.phoneRE),i=(t,n)=>{if(n<2){var r=(t||"").match(/\[([><]=?\-?\d+)\]/);if(r&&r[1])return e++,new Function("x","return x "+r[1]+";")}return e&&2==n?t=>1*t==t:[t=>t>0,t=>t<0,t=>0==t,t=>isNaN(1*t)][n]},o=t=>{var e=t.match(/\[([A-Z]+|color\s*\d+)\]/i);if(e&&e[1])return"#"+pq.colors[e[1].toLowerCase()]},a=(e,n,i,o,a)=>{if(e){if("d"==a){var[l,s]=pq._compileDate(e);return[l,s,i,o]}return"@"==a?pq._compileText(e,i,o):r.test(e)?pq._compilePhone(e,i,o):e.indexOf("?/?")>=0?pq._compileFraction(e,i,o):pq._compileExp(e,i,o)||pq._compileGeneral(e,n,i,o,t)}return t=>i+o};return(r,l)=>{var s=(l||"")+";"+r;if(n[s])return n[s];e=0,t=l,r=r.replace(/(_.|\*.)/g,"");for(var c,d,u=pq.splitByChar(r,";"),h=0,f=[];h<4;h++){var p=!h;if(null!=(r=u[h])){var[g,m,v,w,x]=pq.parseFormat(r);c=a(v,p,m,w,x),d=o(g)}f.push({cond:i(g,h),cb:c,color:d})}return n[s]=f}}(),formatNumber:function(t,e,n,r){var i,o;e?(n=n||void 0,pq._compile(e,n).find(e=>Array.isArray(e.cb)?(i=pq._formatDate(t,e.cb,n),!0):e.cond(t)?(i=e.cb(t),o=e.color,!0):void 0)):i=t;return i??="",r?[i,o]:i},deFormatNumber:function(t,e,n){if(!t)return t;let r=t+"";n=n||void 0,"."!=r[0]&&","!=r[0]||(r="0"+r);let i,o=r.at(-1),a=(r.match(/((\(|\-)\D*)?[0-9]+[0-9.,]*(E(\+|\-)?[0-9.,-]+)?(\D*(%|\)))?/gi)||[])[0]||"",l=new Intl.NumberFormat(n).format(12345.67),s=/\./g,c=a.startsWith("(")&&a.endsWith(")");l.indexOf(",")<l.indexOf(".")&&(s=/,/g);var d=a.replace(/[^0-9\-,\.%E]/g,"").replace(s,"").replace(",",".");return"%"==o?d=""+parseFloat(d)/100:"M"==o?d*=1e6:"K"==o&&(d*=1e3),i=c?-1*d:1*d,e&&pq.formatNumber(i,e,n)!=t?"#VALUE!":i},isDateFormat(t){if(t){var e=(pq._compile(t)[0]||{}).cb;return Array.isArray(e)}},isValidDate:t=>t instanceof Date&&!isNaN(t),_formatDate:function(t,e,n){var r=t;if(!pq.isValidDate(t)){if(1*t==t){var i=pq.formulas.varToDate(t);i&&i.constructor==Date&&i.setMinutes(i.getMinutes()+i.getTimezoneOffset()),t=i}else"string"==typeof t&&(t.length<10&&(t=pq.parseDate(t)),10==t.length&&(t+=" 00:00:00")),t=new Date(t);if(!pq.isValidDate(t))return r}var o=(e,r)=>new Intl.DateTimeFormat(r||n,e).format(t),a={},l={1:"numeric",2:"2-digit",3:"short",4:"long",5:"narrow"},s=(t,e)=>2==e&&1==t.length?"0"+t:t,c=0,d=[],[u,h,f,p]=e;for(var g in u){var m=g[0],v="",w=g[1];if("Y"==m)v=o({year:w>2?"numeric":"2-digit"},"en");else if("M"==m)v=o({month:l[w]},w<=2?"en":"");else if("Z"==m)v=s(v=o({minute:l[w]}),w);else if("D"==m)v=o({day:l[w]},w<=2?"en":"");else if("W"==m)v=o({weekday:l[w]});else if("H"==m){var x=(v=o({hour:l[w],hour12:u.hour12})).split(" ");v=x[0].replace(/\D/g,""),1==w&&(v*=1),u.hour12&&(a.AM=x[x.length-1].toUpperCase())}else"S"==m&&(v=s(v=o({second:l[w]}),w));a[g]=v}for(;c<h.length;c++){var y=h[c];y&&(c%2==0&&(y=y.replace(/\{(.{2})\}/g,function(t,e){return a[e]})),d.push(y))}return f+d.join("")+p},getMonthNames:(t={},(e,n)=>{var r=e+"_"+(n||""),i=t[r];if(!i){i={};var o=new Intl.DateTimeFormat(n,{month:e});Array.from({length:12},(t,e)=>new Date(0,e)).map((t,e)=>{i[o.format(t)]=e+1}),t[r]=i}return i}),findMonth(t,e){var n,r=r=>(n=r,pq.getMonthNames(r,e)[t]);return[r("long")||r("short"),n]},getDateFormatRegex:function(){var t={};return function(e){var n=e,r=t[n];if(r)return r;if(n.endsWith(" "))n=n.trim();else var i=!0;return n=(n=(n=n.replace(/dd|d/,t=>"(0?[1-9]|[12]\\d|3[01])")).replace(/(.)(hh)(.)(mm)/,(t,e,n,r,i)=>"("+e+"\\d{1,2})?("+r+"\\d{1,2})?")).replace(/mmmm|mmm|mm|m|yyyy|yy|hh|(.)(ss)|AM\/PM/g,(t,e,n)=>"ss"==n?"("+e+"\\d{1,2})?":"yyyy"==t?"[12]\\d{3}":"mmmm"==t||"mmm"==t?"[\\p{L}]{3,}":"mm"==t||"m"==t?"(0?[1-9]|1[012])":"yy"==t||"hh"==t?"\\d{2}":"AM/PM"==t?"(AM|PM)":t).replace(/\./g,"\\."),i&&(n+="$"),r=t[e]=new RegExp("^"+n,"u")}}(),testFmtDate:(t,e)=>!!(e=Array.isArray(e)?e:[e]).find(e=>pq.getDateFormatRegex(e).test(t)),parseDateFromFmt(t,e,n){var r,i,[o,a]=pq._compileDate(e),l=t=>1==(t+"").length?"0"+t:t,s=0,c={D:"01"},d=t=>1*t==t,u=t.match(/[\p{L}0-9]+/gu);if(a.forEach(e=>{e.replace(/{([A-Z])(\d)}/g,function(e,a,l){var h=u[s]||"",f=h.length;o.hour12&&"H"==a&&(t.endsWith("PM")&&1*h>12&&(h-=12),t.endsWith("AM")&&12==h&&(h="00")),d(h)&&l!=h.length&&("Y"==a||f>2)&&(i=!0),"M"==a?(r=h,d(h)||(r=pq.findMonth(r,n)[0])||(i=!0)):c[a]=h,s++})}),[c.Y,r,c.D,c.H,c.Z,c.S].map(t=>{t&&!d(t)&&(i=!0)}),i)h="#VALUE!";else{var h=pq.padYear(c.Y)+"-"+l(r)+"-"+l(c.D),f=(t,e,n)=>{c[t]&&(h+=e+l(c[t])+(n||""))};f("H"," ",":"),f("Z",""),f("S",":")}return h},padYear(t){var e=((new Date).getFullYear()+"").slice(2,4);return 2==(t=t+"").length&&(t=1*t<=1*e?"20"+t:"19"+t),t},parseDate(t,e,n,r){if(!t||"string"!=typeof t||""==t.trim())return"";if(n=n||void 0,e&&"string"==typeof e)return pq.parseDateFromFmt(t,e,n);var i,o,a,l,s,c=t=>t.split(/[\s\-\/,T]+(?!(?:AM$|PM$))/),d=c(t),u=d[0],h=d[1],f=d[2],p=t=>t[t.length-1],g=p(d),m=t=>1==(t+"").length?"0"+t:t,v=(new Date).getFullYear(),w=new Date("2000-01-31T13:45:15"),x=31==c((l={dateStyle:"short"},s=w,new Intl.DateTimeFormat(n,l).format(s)))[0],y=t=>1*t==t,b=t=>4==t.length&&y(t);if(g.match(/(:|\sAM$|\sPM$)/)){d.pop();var C=g.split(/[:\s]/),q=C[0],I=y(C[1])?C[1]:"00",_=y(C[2])?C[2]:"00",R=p(C),D="AM"==R||"PM"==R?R:"";"PM"==D?q<12&&(q+=12):"AM"==D&&12==q&&(q="00")}if(2==d.length?(i=v,a=1,b(u)?(i=u,o=h):b(h)?(i=h,o=u):y(u)?y(h)?y(u)&&y(h)&&(x?h<=12?(o=h,a=u):(i=h,o=u):u<=12?(o=u,a=h):(i=u,o=h)):(a=u,o=h):(o=u,i=h)):3==d.length&&(b(u)?(i=u,o=h,a=f):b(f)&&(i=f,y(u)&&(u>12||x)?(a=u,o=h):(a=h,o=u))),!y(o)&&!(o=pq.findMonth(o,n)[0]))return"#VALUE!";i=pq.padYear(i);var M=new Date(i,o-1,a);if(i=M.getFullYear(),a=M.getDate(),o=M.getMonth()+1,r)return[i,o,a,q,I,_];var S=pq.padYear(i)+"-"+m(o)+"-"+m(a),T="";return q&&(T="T"+[q,I,_].join(":")),S+T}}),pq.parseNumber=pq.deFormatNumber,pq.formatDate=pq.formatNumber}();class ClearInput extends HTMLInputElement{constructor(){super(),this.init()}init(){var t=this.oldParent=this.parentNode;if(t){var e=this.clearIcon=document.createElement("span");e.innerHTML="",e.className="pq-clear-icon",e.setAttribute("title",this.getAttribute("ctitle")||""),t.insertBefore(e,this.nextSibling),e.addEventListener("mousedown",t=>{t.preventDefault()}),e.addEventListener("click",t=>{this.value="",this.focus(),this.fireEvent("change"),this.fireEvent("input")}),this.setIconStyle(),this.setupObserver(),this.setEmptyCls(),this.detectValue()}}setupObserver(){var t=this.observer=new MutationObserver(t=>{this.setIconStyle(),this.setEmptyCls(),this.oldParent!=this.parentNode&&(this.clearIcon.remove(),this.observer.disconnect(),this.init())});t.observe(this.parentNode,{childList:!0,subtree:!0}),t.observe(this,{attributes:!0,attributeFilter:["style","value"]})}detectValue(){if(!Object.getOwnPropertyDescriptor(this,"value")){["input","change"].forEach(t=>{this.addEventListener(t,t=>this.setEmptyCls())});var t=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value");Object.defineProperty(this,"value",{get(){return t.get.call(this)},set(e){t.set.call(this,e),this.setEmptyCls()}})}}setEmptyCls(){this.classList[this.value?"remove":"add"]("pq-empty")}setIconStyle(){var t=getComputedStyle(this),e="none"!=t.display&&"hidden"!=t.visibility;this.clearIcon.style.display=e?"":"none"}fireEvent(t){t=new Event(t,{bubbles:!0});this.dispatchEvent(t)}disconnectedCallback(){var t=this.clearIcon;t&&t.remove()}}customElements.define("clear-text",ClearInput,{extends:"input"}),function(t){var e=function(){};e.prototype={belongs:function(t){if(t.target==this.that.element[0])return!0},setTimer:function(t,e){clearTimeout(this._timeID),this._timeID=setTimeout(function(){t()},e)}};var n=t.paramquery;n.cClass=e;var r={widgetEventPrefix:"pqgrid",_createWidget:function(e,n){return this.origOptions=e,t(document).triggerHandler("pq:ready"),t.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){var e,r,i=this,o=i.options,a=i.element,l=i.eventNamespace,s=o.bootstrap,c=s.on,d=o.roundCorners&&!c,u=o.summaryOnTop,h="<div class='pq-summary-outer' ></div>",f=o.ui;i.RenderCells=[],t(document).triggerHandler("pqGrid:bootup",{instance:this}),i.BS_on=c,o.collapsible||(o.collapsible={on:!1,collapsed:!1}),o.flexHeight&&(o.height="flex"),o.flexWidth&&(o.width="flex"),i.iRefresh=new n.cRefresh(i),i.iValid=new n.cValid(i),i.tables=[],i.$tbl=null,i.iCols=new n.cColModel(i),i.iSort=new n.cSort(i),a.on("scroll"+l,function(){this.scrollLeft=0,this.scrollTop=0}).on("mousedown"+l,i._mouseDown.bind(i));var p=c?s.grid:f.grid,g=c?"":f.header_o,m=c?"":f.bottom,v=c?s.top:f.top,w=i.uuid,x=i.grid_id="pq-grid-"+w;a.empty().attr({dir:o.rtl?"rtl":"ltr",role:"region","aria-labelledby":"pq-grid-title-"+w}).addClass("pq-grid pq-theme "+p+" "+(d?" ui-corner-all":"")).html(["<div class='pq-grid-top ",v," ",d?" ui-corner-top":"","'>",`<div id='pq-grid-title-${w}' class='pq-grid-title${d?" ui-corner-top":""}'><span class="pq-gtitle-inner">&nbsp;</span></div>`,"<div class='pq-grid-pbar' style='background:red;height:2px;width:0%;display:none;'>&nbsp;</div>","</div>","<div class='pq-grid-center-o'>",`<div class="pq-focus-mgr ui-widget-content" id="${w}"><textarea aria-label="Grid focus"></textarea></div>`,`<div aria-live="polite" style="position:absolute; left:-9999px;" id="sr-announcer-${w}"></div>`,"<div class='pq-tool-panel' style='display:",o.toolPanel.show?"":"none",";'></div>",`<div class='pq-grid-center' id="${x}" >`,"<div class='pq-header-outer ",g,"' ></div>",u?h:"","<div class='pq-body-outer' ></div>",u?"":h,"</div>","<div style='clear:both;'></div>","</div>","<div class='pq-grid-bottom ",m," ",d?" ui-corner-bottom":"","'>","<div class='pq-grid-footer'></div>","</div>"].join("")),i.setLocale(),i.$focusMgr=t(".pq-focus-mgr",a),i.$focusMgr_o=i.$focusMgr.parent(),i.$bottom=t(".pq-grid-bottom",a),i.$summary=t(".pq-summary-outer",a),i.$toolPanel=a.find(".pq-tool-panel"),i.$top=t(".pq-grid-top",a),o.showTop||i.$top.css("display","none"),i.$title=t(".pq-grid-title",a),i.$title_inner=i.$title.find(".pq-gtitle-inner"),o.showTitle||i.$title.css("display","none");var y=i.$grid_center=t(".pq-grid-center",a).on("scroll",function(){this.scrollTop=0}),b=i.getScale(),C=b[0],q=b[1];i.$grid_role=y.attr("role",o.treeModel.dataIndx||o.groupModel.on?"treegrid":"grid"),e=i.$header=t(".pq-header-outer",y).on("scroll",function(){this.scrollTop=0,this.scrollLeft=0}),!o.noStickyHeader&&C>.999&&C<1.001&&q>.999&&q<1.001&&e.css("position","sticky"),i.$footer=t(".pq-grid-footer",a),r=i.$cont=t(".pq-body-outer",y),y.on("mousedown",i._onGCMouseDown.bind(i)),i.iRenderB=new pq.cRenderBody(i,{$center:y,$b:r,$sum:i.$summary,header:!0,$h:i.$header}),i._trigger("render",null,{dataModel:i.options.dataModel,colModel:i.colModel}),i.iKeyNav=new n.cKeyNav(i),"ontouchend"in document&&i.contextIOS(a),a.on("contextmenu"+l,i.onContext.bind(i)),r.on("click",".pq-grid-cell,.pq-grid-number-cell",function(e){var n,r,o=e.target;if(!0!==t.data(o,i.widgetName+".preventClickEvent"))return i.evtBelongs(e)?(n=t(o)).is("label")&&(r=n.find('input[type="checkbox"]')).length?(e.preventDefault(),void r.trigger("click")):i._onClickCell(e):void 0}).on("dblclick",".pq-grid-cell",function(t){if(i.evtBelongs(t))return i._onDblClickCell(t)}),r.on("mousedown",i._onMouseDown.bind(i)).on("change",i._onChange(i)).on("mouseenter",".pq-grid-cell,.pq-grid-number-cell",i._onCellMouseEnter(i)).on("mouseenter",".pq-grid-row",i._onRowMouseEnter(i)).on("mouseleave",".pq-grid-cell,.pq-grid-number-cell",i._onCellMouseLeave(i)).on("mouseleave",".pq-grid-row",i._onRowMouseLeave(i)).on("keyup",i._onKeyUp(i)),o.selectionModel.native||this.disableSelection(),y.on("keydown.pq-grid",i._onKeyDown(i)),this._refreshTitle(),i.iRows=new n.cRows(i),i.generateLoading(),i._initPager(),i._refreshResizable(),i._refreshDraggable(),i.iResizeColumns=new n.cResizeColumns(i),this._mouseInit()},contextIOS:function(e){var n,r,i,o="contextmenu";e.on("touchstart",function(a){n=1,setTimeout(function(){if(n&&1==(i=a.originalEvent.touches).length){var e=i[0],l=t.Event(o,e);t(a.target).trigger(l),r=1}},600),e.one(o,function(){n=0})}).on("touchmove touchend",function(t){n=0,r&&(r=0,t.preventDefault())})},addTouch:function(){var e,n,r=this.$grid_center[0];r.addEventListener("touchstart",function(t){var r=t.target,i=t.changedTouches[0];if(e){if(r&&r==e.target){var o=e.x-i.pageX,a=e.y-i.pageY;Math.sqrt(o*o+a*a)<=12&&(n=e,setTimeout(function(){n=null},500))}}else e={x:i.pageX,y:i.pageY,target:r},setTimeout(function(){e=null},400)},!0),r.addEventListener("touchend",function(e){var r=e.target;n&&r==n.target&&t(r).trigger("dblclick",e)})},_mouseDown:function(e){var n=this;if(t(e.target).closest(".pq-editor-focus").length)return this._blurEditMode=!0,void window.setTimeout(function(){n._blurEditMode=!1},0)},destroy:function(){this._trigger("destroy"),this._super(),this.element=void 0},setLocale:function(){var e=this.options,r=e.locale;e.strLocal!=r&&(t.extend(!0,e,n.pqGrid.regional[r]),t.extend(e.pageModel,n.pqPager.regional[r]))},_setOption:function(t,e){var r,i=this,o=i.options,a=i.pageI,l=function(){o[t]=e},s=i.iRenderB,c=i.iRenderSum,d=i.iRenderHead,u=function(t){return t?"addClass":"removeClass"},h=o.dataModel;if(!i.$title)return l(),i;if("height"===t)l(),i._refreshResizable();else if("locale"==t||"pageModel"==t)l(),"locale"==t&&i.setLocale(),a&&a.destroy();else if("width"===t)l(),i._refreshResizable();else if("title"==t)l(),i._refreshTitle();else if("roundCorners"==t){l();var f=u(e);i.element[f]("ui-corner-all"),i.$top[f]("ui-corner-top"),i.$bottom[f]("ui-corner-bottom")}else if("freezeCols"==t)e=parseInt(e),!isNaN(e)&&e>=0&&e<=i.colModel.length-2&&l();else if("freezeRows"==t)e=parseInt(e),!isNaN(e)&&e>=0&&l();else if("resizable"==t)l(),i._refreshResizable();else if("draggable"==t)l(),i._refreshDraggable();else if("dataModel"==t)e.data!==h.data&&h.dataUF&&(h.dataUF.length=0),"lazy"==e.location&&"lazy"!=o[t].location&&(i.iLazy=new n.Lazy(i,o)),l();else{if("groupModel"==t)throw"use Group().option() method to set groupModel options.";if("treeModel"==t)throw"use Tree().option() method to set treeModel options.";if("colModel"===t||"columnTemplate"==t)l(),i.iCols.init();else if("disabled"===t)i._super(t,e),!0===e?i._disable():i._enable();else if("strLoading"===t)l(),i._refreshLoadingString();else if("showTop"===t)l(),i.$top.css("display",e?"":"none");else if("showTitle"===t)l(),i.$title.css("display",e?"":"none");else if("showToolbar"===t){l(),i._toolbar.widget().css("display",e?"":"none")}else"collapsible"===t?(l(),i.refreshCollapse()):"showBottom"===t?(l(),i.$bottom.css("display",e?"":"none")):"wrap"==t||"hwrap"==t?(l(),("wrap"==t?s.$tbl.add(c.$tbl):d.$tbl)[u(!e)]("pq-no-wrap")):"rowBorders"===t?(l(),f=u(e),r="pq-td-border-top",s.$tbl[f](r),c.$tbl[f](r)):"columnBorders"===t?(l(),f=u(e),r="pq-td-border-right",s.$tbl[f](r),c.$tbl[f](r)):"strNoRows"===t?(l(),i.$cont.find(".pq-grid-norows").text(e)):l()}return i}};r.options={cancel:"input,textarea,button,select,option,.pq-no-capture,.ui-resizable-handle",trigger:!1,bootstrap:{on:!1,thead:"table table-striped table-condensed table-bordered",tbody:"table table-condensed",grid:"panel panel-default",top:"",btn:"btn btn-default",header_active:"active"},ui:{on:!0,grid:"ui-widget ui-widget-content",top:"ui-widget-header",bottom:"",header_o:"ui-widget-header",header:"ui-state-default",header_active:""},format:function(t,e,n,r){var i="format";return n[i]??(r[i]||e[i])},cellDatatype:function(t,e){return e.dataType},collapsible:{on:!0,toggle:!0,refreshAfterExpand:!0,css:{zIndex:1e3},cssCollapse:{height:"2.3em",width:"15em"}},colModel:null,columnBorders:!0,dataModel:{beforeSend:function(){},getData:function(t){return t},data:[],dataUF:[],cache:!1,dataType:"JSON",location:"local",sorting:"local",sortDir:"up",method:"GET"},direction:"",draggable:!1,editable:!0,editModel:{pressToEdit:!0,charsAllow:["0123456789.-=eE+","0123456789-=eE+"],clicksToEdit:2,filterKeys:!0,reInt:/^([-]?[1-9][0-9]*|[-]?[0-9]?)(e[-+]?)?[0-9]*$/i,reFloat:/^[-]?[0-9]*\.?[0-9]*(e[-+]?)?[0-9]*$/i,onBlur:"validate",saveKey:t.ui.keyCode.ENTER,onSave:"nextFocus",onTab:"nextFocus",allowInvalid:!1,invalidClass:"pq-cell-red-tr pq-has-tooltip",warnClass:"pq-cell-blue-tr pq-has-tooltip",validate:!0},editor:{select:!1,type:"contenteditable"},summaryOptions:{number:"avg,max,min,stdev,stdevp,sum",date:"count,max,min",string:"count"},summaryTitle:{avg:"Avg: {0}",count:"Count: {0}",max:"Max: {0}",min:"Min: {0}",stdev:"Stdev: {0}",stdevp:"Stdevp: {0}",sum:"Sum: {0}"},validation:{icon:"ui-icon-alert",cls:"ui-state-error",style:"padding:3px 10px;"},warning:{icon:"ui-icon-info",cls:"",style:"padding:3px 10px;"},freezeCols:0,freezeRows:0,freezeBorders:!0,height:400,hoverMode:"null",locale:"en",maxColWidth:2e3,minColWidth:50,minWidth:100,menuUI:{tabs:["hideCols","filter","export"],buttons:["clear","ok"],gridOptions:{autoRow:!1,copyModel:{render:!0},editable:function(t){return!t.rowData.pq_disabled},fillHandle:"",filterModel:{header:!0,on:!0},hoverMode:"row",hwrap:!1,wrap:!1,rowBorders:!1,hideVScroll:!0,scrollModel:{autoFit:!0},showTop:!1,height:300}},mergeCells:[],numberCell:{width:"auto",minWidth:23,maxWidth:150,title:"",resizable:!0,show:!0,menuUI:{tabs:["hideCols","export"]}},pageModel:{curPage:1,totalPages:0,rPP:10,rPPOptions:[10,20,50,100]},refreshCompareBy:"value",resizable:!1,rowBorders:!0,rowResize:!0,autoRow:!0,rowHt:2,rowHtHead:2.1,rowHtSum:2,scrollModel:{},selectionModel:{column:!0,type:"cell",row:!0,mode:"block"},focusModel:{focusable:!0,onTab:"nextFocus"},showBottom:!0,showHeader:!0,showTitle:!0,showToolbar:!0,showTop:!0,sortable:!0,sql:!1,stringify:!0,stripeRows:!0,title:"&nbsp;",toolPanelRules:{},treeModel:null,width:"auto",wrap:!0,hwrap:!1},t.widget("paramquery._pqGrid",t.ui.mouse,r);var i=n._pqGrid.prototype;i.getEM=function(e){if(e<10){let n,r=this.widget();if(!r[0].isConnected){let e=t(".pq-grid")[0]||document.body;r=t(e)}n=parseFloat(r.css("font-size")),e*=n}return e},i.setData=function(t){var e=this,n=e.options,r=n.groupModel.pivot,i=n.reactive,o=e.Group();r&&o.option({pivot:!1}),e.option("dataModel.data",t),i||e.refreshDataAndView(),r&&o.option({pivot:!0})},i.refreshCM=function(t,e){t&&(this.options.colModel=t),this.iCols.init(e)},i.evtBelongs=function(e){var n=this.element[0];return n&&t(e.target).closest(".pq-grid")[0]==n},i.readCell=function(t,e,n,r,i){if(!n||!1!==n.isRootCell(r,i,"o"))return t[e.dataIndx]},i._destroyResizable=function(){var t=this.element,e=t.data();(e.resizable||e.uiResizable||e["ui-resizable"])&&t.resizable("destroy")},i._disable=function(){null==this.$disable&&(this.$disable=t("<div class='pq-grid-disable'></div>").css("opacity",.2).appendTo(this.element))},i._enable=function(){this.$disable&&(this.element[0].removeChild(this.$disable[0]),this.$disable=null)},i._destroy=function(){var e=this.element,n=this.eventNamespace;this._destroyResizable(),this._destroyDraggable(),e.off(n),t(window).off(n),t(document).off(n),e.empty().css("height","").css("width","").removeClass("pq-grid ui-widget ui-widget-content ui-corner-all").removeData()},i._onKeyUp=function(t){return function(e){t.evtBelongs(e)&&t._trigger("keyUp",e,null)}},i.onKeyDown=function(e){var n=this;return t(e.target).closest(".pq-header-outer").length?n._trigger("headerKeyDown",e,null):t(e.target).closest(".pq-summary-outer").length?n._trigger("sumKeyDown",e,null):void(!1!==n.iKeyNav.bodyKeyDown(e)&&n._trigger("keyDown",e,null))},i._onKeyDown=function(t){return function(e){t.evtBelongs(e)&&t.onKeyDown(e,t)}},i.collapse=function(t={}){if(!this.isFullScreen()){var e=this,n=e.element,r=e.options,i=r.collapsible,o=i.$collapse.children("span"),a=i.cssCollapse,l=function(){n.css("overflow","hidden"),o.addClass("ui-icon-circle-triangle-s").removeClass("ui-icon-circle-triangle-n"),n.hasClass("ui-resizable")&&n.resizable("destroy"),e._toolbar&&e._toolbar.disable(),i.collapsed=i._collapsed=!0,i.animating=!1,i.$toggle?.hide(),pq.setTitle(i.$collapse,r.strExpand),e._trigger("collapse")};if(i._collapsed)return!1;i.htCapture=n.height(),i.wdCapture=n.width(),!1===t.animate?(n.css(a),l()):(i.animating=!0,e.disable(),n.animate(a,function(){l()}))}},i.expand=function(t={}){var e=this,n=e.element,r=e.options,i=r.collapsible,o=i.htCapture,a=i.wdCapture,l=i.$collapse.children("span"),s=function(){n.css("overflow",""),i._collapsed=i.collapsed=!1,e._refreshResizable(),i.refreshAfterExpand&&e.refresh(),l.addClass("ui-icon-circle-triangle-n").removeClass("ui-icon-circle-triangle-s"),e._toolbar&&e._toolbar.enable(),e.enable(),i.animating=!1,i.$toggle?.show(),pq.setTitle(i.$collapse,r.strCollapse),e._trigger("expand")};if(!1===i._collapsed)return!1;!1===t.animate?(n.height(o),s()):(i.animating=!0,n.animate({height:o,width:a},function(){s()}))},i.getPics=async function(){var t=this.iPic.pics,e=[],n=this.Charts().fcharts,r=0;for(t.forEach(t=>{e.push({width:t.cx,height:t.cy,image:t.src})});r<n.length;r++){var i=n[r],[o,a,l]=await i.getCanvas();e.push({width:a,height:l,image:o.toDataURL(),type:"chart"})}return e},i.refreshCollapse=function(){var e=this,n=e.$title,r=e.options,i=e.isCollapsed(),o=e.isFullScreen(),a=r.collapsible,l=a.collapsed,s=a.toggled;if(!a.$stripe){var c=t(["<div class='pq-slider-icon pq-no-capture'  >","</div>"].join("")).appendTo(n);a.$stripe=c}if(a.on){let n=a.collapsed?r.strExpand:r.strCollapse;a.$collapse?pq.setTitle(a.$collapse,n):a.$collapse=t(pq.createUIButton("circle-triangle-n",n,"pq-collapse")).appendTo(a.$stripe).click(t=>{e.isCollapsed()?e.expand():e.collapse()})}else a.$collapse&&(a.$collapse.remove(),delete a.$collapse);if(l&&!i?e.collapse({animate:!1}):!l&&i&&e.expand({animate:!1}),a.toggle){let n=a.toggled?r.strExitFullScreen:r.strFullScreen;a.$toggle?pq.setTitle(a.$toggle,n):a.$toggle=t(pq.createUIButton("arrow-4-diag",n,"pq-fullscreen")).prependTo(a.$stripe).click(t=>{e.toggle()})}else a.$toggle&&(a.$toggle.remove(),delete a.$toggle);s&&a.$collapse?.hide(),(s&&!o||!s&&o)&&this.toggle()},i.isFullScreen=function(){return!!this.options.collapsible.fsState},i.isCollapsed=function(){return this.options.collapsible._collapsed},i.toggle=function(e={}){if(!this.isCollapsed()){var n=this.options,r=n.collapsible,i=this.element,o=r.fsState,a=!o,l=a?"max":"min",s=t(window),c=t(document.body),d=this.getScale(),u=r.$collapse,h=d[0],f=d[1];if(!1===this._trigger("beforeToggle",null,{state:l}))return!1;if(a){if(1!=h||1!=f){var p=r.scaleParents=[];i.parents().each(function(e,n){var r=t(n),i=r.css("scale"),o=r.css("transform"),a="none"!=i,l="none"!=o,s={node:n};if(a||l)return p.push(s),a&&(s.scale=i,r.css("scale","none")),l&&(s.transform=o,r.css("transform","none")),!0})}g={height:n.height,width:n.width,cssText:i[0].style.cssText,maxHeight:n.maxHeight,maxWidth:n.maxWidth},this.option({height:"100%",width:"100%",maxHeight:null,maxWidth:null}),i.css(t.extend({position:"fixed",left:0,top:0,margin:0},r.css)),m={scrollLeft:s.scrollLeft(),scrollTop:s.scrollTop(),cssText:c[0].style.cssText},c.css({height:0,width:0,overflow:"hidden",position:"static"}),window.scrollTo(0,0),r.fsState={grid:g,doc:m},u?.hide()}else{var g=o.grid,m=o.doc;this.option({height:g.height,width:g.width,maxHeight:g.maxHeight,maxWidth:g.maxWidth}),i[0].style.cssText=g.cssText,c[0].style.cssText=m.cssText,window.scrollTo(m.scrollLeft,m.scrollTop),r.fsState=null,(p=r.scaleParents)&&(p.forEach(function(e){var n={};e.scale&&(n.scale=e.scale),e.transform&&(n.transform=e.transform),t(e.node).css(n)}),p.length=0),u?.show(),pq.setTitle(this.$top.find(".pq-fullscreen"),n.strFullScreen)}pq.setTitle(this.$top.find(".pq-fullscreen"),a?n.strExitFullScreen:n.strFullScreen),r.toggled=a,e.refresh||(this._refreshResizable(),this.refresh(),this._trigger("toggle",null,{state:l}),s.trigger("resize",{$grid:i,state:l}))}},i._onDblClickCell=function(e){var n=this,r=t(e.currentTarget),i=n.getCellIndices({$td:r});i.$td=r,0!=n._trigger("cellDblClick",e,i)&&(n.options.editModel.clicksToEdit>1&&n.isEditable(i)&&n.editCell(i),i.$tr=r.closest(".pq-grid-row"),n._trigger("rowDblClick",e,i))},i.getValueFromDataType=function(e,n,r){if("="==(e+"")[0])return e;var i;if("date"==n)return i=Date.parse(e),isNaN(i)?void 0:r?i:e;if("integer"==n)i=parseInt(e);else{if("float"!=n){if("bool"==n)return null==e||!0===e||!1===e?e:0==(i=t.trim(e).toLowerCase()).length?null:"true"==i||"yes"==i||"1"==i||"false"!=i&&"no"!=i&&"0"!=i&&Boolean(i);if("object"==n)return e;{let t=typeof e;return"string"==t?e.trim():"number"==t?e+"":e}}i=parseFloat(e)}return isNaN(i)||null==i?null==e?e:null:i},i.isValid=function(t){return this.iValid.isValid(t)},i.isValidChange=function(t){t=t||{};var e=this.getChanges(),n=e.addList,r=e.updateList.concat(n);return t.data=r,this.isValid(t)},i.isEditableCell=function(t){var e,n,r,i=t.normalized?t:this.normalize(t),o=i.rowData;return o&&(r=o.pq_cellprop)&&(n=(r[i.dataIndx]||{}).edit),null==n&&null!=(e=i.column.editable)&&(n="function"==typeof e?e.call(this,i):e),n},i.isEditableRow=function(t){var e=this.options.editable,n=t.rowData,r=n&&(n.pq_rowprop||{}).edit;return null==r&&(r="function"==typeof e?e.call(this,t.normalized?t:this.normalize(t)):e),r},i.isEditable=function(t){var e=this.isEditableCell(t);return null==e?this.isEditableRow(t):e},i._onMouseDownCont=function(e,n){t(e.target).is(".pq-cont-inner")&&(this.focus({evt:e,body:!0}),e.preventDefault())},i._onGCMouseDown=function(){var e=this;e._mousePQUpDelegate=function(n){t(document).off("mouseup"+e.eventNamespace,e._mousePQUpDelegate),e._trigger("mousePQUp",n,null)},t(document).on("mouseup"+e.eventNamespace,e._mousePQUpDelegate)},i._onMouseDown=function(e){var n=this;if(n.evtBelongs(e)){var r,i=t(e.target),o=i.closest(".pq-grid-cell,.pq-grid-number-cell")[0];if(i.is("a"))return;if(o&&(e.currentTarget=o,n._onMouseDownCell(e)),e.isPropagationStopped())return;if((r=i.closest(".pq-grid-row")[0])&&(e.currentTarget=r,n._onMouseDownRow(e)),e.isPropagationStopped())return;n._onMouseDownCont(e,o)}},i._onMouseDownCell=function(e){var n,r=t(e.currentTarget),i=this.getCellIndices({$td:r});null!=i.rowIndx&&((n=this.iMerge.getRootCellO(i.rowIndx,i.colIndx,!0)).$td=r,this._trigger("cellMouseDown",e,n))},i._onMouseDownRow=function(e){var n=t(e.currentTarget),r=this.getRowIndx({$tr:n});r.$tr=n,this._trigger("rowMouseDown",e,r)},i._onCellMouseEnter=e=>function(n){if(e.evtBelongs(n)){var r=t(this),i=e.options,o=e.getCellIndices({$td:r});if(null==o.rowIndx||null==o.colIndx)return;if(!1===e._trigger("cellMouseEnter",n,o))return;return"cell"==i.hoverMode&&e.highlightCell(r),!0}},i._onChange=function(e){var n,r,i;function o(){if(n&&r&&r.target==n.target){var t;for(t in{ctrlKey:0,metaKey:0,shiftKey:0,altKey:0})r[t]=n[t];e._trigger("valChange",r,i),r=n=void 0}}return e.on("cellClickDone",function(t){n=t.originalEvent,o()}),function(n){if(e.evtBelongs(n)){var a=t(n.target),l=a.closest(".pq-grid-cell");l.length&&(i=e.getCellIndices({$td:l}),(i=e.normalize(i)).input=a[0],r=n,o())}}},i._onRowMouseEnter=e=>function(n){if(e.evtBelongs(n)){var r=t(this),i=e.options,o=e.getRowIndx({$tr:r}),a=o.rowIndxPage;if(!1===e._trigger("rowMouseEnter",n,o))return;return"row"==i.hoverMode&&e.highlightRow(a),!0}},i._onCellMouseLeave=e=>function(n){if(e.evtBelongs(n)){var r=t(this);"cell"==e.options.hoverMode&&e.unHighlightCell(r)}},i._onRowMouseLeave=e=>function(n){if(e.evtBelongs(n)){var r=t(this),i=e.getRowIndx({$tr:r}),o=i.rowIndxPage;if(!1===e._trigger("rowMouseLeave",n,{$tr:r,rowIndx:i.rowIndx,rowIndxPage:o}))return;"row"==e.options.hoverMode&&e.unHighlightRow(o)}},i.enableSelection=function(){this.element.removeClass("pq-disable-select").off("selectstart"+this.eventNamespace)},i.disableSelection=function(){this.element.addClass("pq-disable-select").on("selectstart"+this.eventNamespace,function(e){var n=e.target,r=t(n);if(n){if(r.is("input,textarea,select,[contenteditable=true]"))return!0;if(r.closest(".pq-native-select").length)return!0;e.preventDefault()}})},i._onClickCell=function(e){var n=this,r=n.options.editModel,i=t(e.currentTarget),o=n.getCellIndices({$td:i}),a=n.normalize(o),l=a.colIndx;a.$td=i,a.evt=e,0!=n._trigger("beforeCellClick",e,a)&&(n._trigger("cellClick",e,a),n._trigger("cellClickE",e,a),null==l||l<0||(1==r.clicksToEdit&&n.isEditable(a)&&n.editCell(a),a.$tr=i.closest(".pq-grid-row"),n._trigger("rowClick",e,a)))},i._getHeadIndices=function(t,e){var n=this.headerCells;return{ri:t=t??n.length-1,colIndx:e,column:(n[t]||n[t-1])[e],filterRow:!n[t]}},i.getHeadIndices=function(t){var e=this.iRenderB.getCellIndx(t);return this._getHeadIndices(e[0],e[1])},i.onContext=function(e){var n,r,i,o,a=this,l=e.target,s=function(t){a._trigger(t,e,o)};if(a.evtBelongs(e)){r=l;do{if(i=t(r),o={ele:r},i.is(".pq-grid")){o={},s("context");break}if(i.is(".pq-cont-inner")?(o.type="body",n=1):i.is("img")?(o.type="img",n=1):i.is(".pq-grid-cell,.pq-grid-number-cell")?(o=a.getCellIndices({$td:i})).rowData&&(o.type=o.column?"cell":"num",o.$td=i,n=1,s("cellRightClick")):i.is(".pq-tab-item")?(o.id=a.iTab.getId(i),o.type="tab",n=1):i.is(".pq-grid-col")&&((o=a.getHeadIndices(r)).type="head",o.$th=i,n=1,s("headRightClick")),n){s("context");break}}while(r=r.parentNode)}},i.highlightCell=function(t){t.addClass("pq-grid-cell-hover ui-state-hover")},i.unHighlightCell=function(t){t.removeClass("pq-grid-cell-hover ui-state-hover")},i.highlightRow=function(t){if(isNaN(t));else{var e=this.getRow({rowIndxPage:t});e&&e.addClass("pq-grid-row-hover ui-state-hover")}},i.unHighlightRow=function(t){if(isNaN(t));else{var e=this.getRow({rowIndxPage:t});e&&e.removeClass("pq-grid-row-hover ui-state-hover")}},i._getCreateEventData=function(){return{dataModel:this.options.dataModel,data:this.pdata,colModel:this.options.colModel}},i._initPager=function(){var e=this,n=e.options,r=n.pageModel;if(r.type){var i={bootstrap:n.bootstrap,change:function(t,n){e.blurEditor({force:!0});var r=e.options.pageModel;null!=n.curPage&&(r.prevPage=r.curPage,r.curPage=n.curPage),null!=n.rPP&&(r.rPP=n.rPP),"remote"==r.type?e.remoteRequest({callback:function(){e._onDataAvailable({apply:!0,header:!1})}}):e.refreshView({header:!1,source:"pager"})},refresh:function(){e.refreshDataAndView()}};(i=t.extend(i,r)).rtl=n.rtl,e.pageI=pq.pager(r.appendTo?r.appendTo:this.$footer,i).on("destroy",function(){delete e.pageI})}},i.generateLoading=function(){this.$loading&&this.$loading.remove(),this.$loading=t("<div class='pq-loading'></div>").appendTo(this.$cont),t(`<div class='pq-loading-bg'></div>\n<div class='pq-loading-mask ui-state-highlight'>\n<div class='pq-spinner'></div>\n ${this.options.strLoading}...\n</div>`).appendTo(this.$loading)},i._refreshLoadingString=function(){this.$loading.find("div.pq-loading-mask").children("div").html(this.options.strLoading)},i.showLoading=function(){this.$loading[0].style.display="block"},i.hideLoading=function(){this.$loading.hide()},i.getTotalRows=function(){var t=this.options,e=t.dataModel,n=e.data||[],r=e.dataUF||[],i=t.pageModel;return"remote"==i.location?i.totalRecords:n.length+r.length},i.refreshDataFromDataModel=function(t){t=t||{};var e,n,r,i,o,a,l,s=this,c=s.options,d=c.dataModel,u=c.pageModel,h=d.data,f=u.type,p=s._queueATriggers;if(s._trigger("beforeRefreshData",null,{}),"local"==f?(a=u.totalRecords=h.length,u.totalPages=o=Math.ceil(a/u.rPP),u.curPage>o&&(u.curPage=o),o&&!u.curPage&&(u.curPage=1),r=(r=(u.curPage-1)*u.rPP)>=0?r:0,(i=u.curPage*u.rPP)>h.length&&(i=h.length),s.pdata=h.slice(r,i),l=r):"remote"==f?(u.totalPages=o=Math.ceil(u.totalRecords/u.rPP),u.curPage>o&&(u.curPage=o),o&&!u.curPage&&(u.curPage=1),(i=u.rPP)>h.length&&(i=h.length),s.pdata=h.slice(0,i),l=u.rPP*(u.curPage-1)):c.backwardCompat?s.pdata=h.slice(0):s.pdata=h,s.riOffset=l>=0?l:0,s._trigger("dataReady",null,t),s._trigger("dataReadyAfter",null,t),0!=t.triggerQueue)for(e in p)n=p[e],delete p[e],s._trigger(e,n.evt,n.ui)},i.getQueryString=function(e){e=e||{};var n,r,i=this,o="",a="",l=i.options,s=l.dataModel,c=l.sortModel,d=l.filterModel,u=l.pageModel,h={},f={},p={};if(pq.isFn(s.getUrl)){var g={colModel:i.colModel,dataModel:s,sortModel:c,groupModel:l.groupModel,pageModel:u,filterModel:d},m=s.getUrl.call(i,g);m&&m.url&&(o=m.url),m&&m.data&&(a=m.data)}else pq.isStr(s.url)&&(o=s.url,"remote"==c.type&&(e.initBySort||i.sort({initByRemote:!0}),(r=i.iSort.getQueryStringSort())&&(h={pq_sort:r})),"remote"==u.type&&(p={pq_curpage:u.curPage,pq_rpp:u.rPP}),"local"!=d.type&&(n=i.iFilterData.getQueryStringFilter())&&(i._queueATriggers.filter={ui:{}},f={pq_filter:n}),a=t.extend({pq_datatype:s.dataType},f,p,h,i.postData(s),s.postDataOnce));return{url:o,dataURL:a}},i.postData=function(t){var e=t.postData;return pq.isFn(e)&&(e=e.call(this,{colModel:this.colModel,dataModel:t})),e},i.callXHR=function(e,n,r){var i=this,o=i.options.dataModel;i.xhr=t.ajax(Object.assign({},o.ajaxOptions,{url:e,dataType:o.dataType,async:o.async,cache:o.cache,contentType:o.contentType,type:o.method,data:n,beforeSend:o.beforeSend.bind(i),success:function(t,e,n){t=o.getData.call(i,t,e,n),r(t,e,n)},error:function(t,e,n){if(i.hideLoading(),pq.isFn(o.error))o.error.call(i,t,e,n);else if("abort"!=n)throw"Error : "+n}}))},i.remoteRequest=function(t){t=t||{};var e=this,n=e.getQueryString(t),r=n.url,i=n.dataURL;e.xhr&&e.xhr.abort(),r&&(e.showLoading(),e.callXHR(r,i,function(n,r,i){e.onRemoteSuccess(n,r,i,t)}))},i.onRemoteSuccess=function(t,e,n,r){if(this.element){var i=this,o=i.options,a=i.colModel,l=o.pageModel,s=o.dataModel;s.data=t.data,"remote"==l.type&&(null!=t.curPage&&(l.curPage=t.curPage),null!=t.totalRecords&&(l.totalRecords=t.totalRecords)),i.hideLoading(),i._trigger("load",null,{dataModel:s,colModel:a}),r.callback&&r.callback()}},i._refreshTitle=function(){this.$title_inner.html(this.options.title)},i._destroyDraggable=function(){var t=this.element,e=t.parent(".pq-wrapper");e.length&&e.data("draggable")&&(e.draggable("destroy"),this.$title.removeClass("pq-draggable pq-no-capture"),t.unwrap(".pq-wrapper"))},i._refreshDraggable=function(){var t=this.options,e=this.element,n=this.$title;t.draggable?(n.addClass("pq-draggable pq-no-capture"),e.parent(".pq-wrapper").length||e.wrap("<div class='pq-wrapper' />"),e.parent(".pq-wrapper").draggable({handle:n})):this._destroyDraggable()},i.formatCol=function(t,e,n){var r=t.format,i=this.options.localeFmt;if(r&&null!=e){if(pq.isFn(r))return r(e);e=pq.formatNumber(e,r,i)}return e},i.format=function(t,e,n){if(null!=t){var r,i=this.options,o="fmtDate"+e,a=pq.getDataTypeFromVal(t),l=i.localeFmt;if(null!=a&&((r=n[o="fmt"+a+e]||i[o])||"Filter"!=e||(r=n.format),r||l)){if(pq.isFn(r))return r(t);t=pq["format"+a](t,r,l)}}return t},i.deformatCondition=function(t,e,n){var r=pq.getDataType(e);if(!n||pq.filter.conditions[n][r])try{pq.isFn(e.format)?t=e.deFormat(t):"number"!=r&&"date"!=r||(t=this.deformat(t,"Filter",e))}catch(e){t=null}return t},i.deformat=function(t,e,n){if(null!=t){var r,i=this.options,o=t=>n[t]||i[t],a=o("fmtDate"+e),l=o("fmtNumber"+e),s=i.localeFmt;if(a)r=pq.parseDate(t,a,s);else if(l)r=pq.parseNumber(t,a,s);else if(pq.isFn(n.format))return n.deFormat(t);if(null!=r&&"#VALUE!"!=r)return r}return t},i._refreshResizable=function(){var e,n,r,i,o,a,l=this,s=this.element,c=s[0],d=this.options,u=document.body,h=(d.width+"").indexOf("%")>-1,f=(d.height+"").indexOf("%")>-1,p="auto"==d.width,g="flex"==d.width,m="flex"==d.height;if(!d.resizable||(m||f)&&(g||h||p))this._destroyResizable();else{var v="e,s,se";m||f?v="e":(g||h||p)&&(v="s");var w,x,y,b,C,q=!0;if(s.hasClass("ui-resizable"))v==s.resizable("option","handles")?q=!1:this._destroyResizable();if(q)s.resizable({helper:"ui-state-default pq-border-0",handles:v,minWidth:d.minWidth,minHeight:d.minHeight||100,start:function(s,d){w=s.pageX,x=s.pageY,e=l.getScale(),n=e[0],r=e[1],i=pq.getScale(u),o=i[0],a=i[1];var h=c.getClientRects()[0];y={left:(h.left+window.scrollX)/o,top:(h.top+window.scrollY)/a},b={height:c.offsetHeight,width:c.offsetWidth},C={top:c.style.top,left:c.style.left},t(d.helper).css({opacity:.5,background:"#ccc"})},resize:function(e,i){var l="e-resize"==t(u).css("cursor"),s=i.size,c=l?e.pageX-w:0,d=l?0:e.pageY-x,h=i.position;h.left=y.left,h.top=y.top,s.height=b.height*r/a+d/a,s.width=b.width*n/o+c/o},stop:function(e,i){var s,u=d.width,h=d.height,f=(u+"").indexOf("%")>-1,p=(h+"").indexOf("%")>-1,g="auto"==u,m="flex"==u,v="flex"==h,w=i.size,x=c.style;if(x.top=C.top,x.left=C.left,p||v||(s=!0,d.height=w.height*a/r),!f&&!g&&!m){s=!0;let t=w.width*o/n;t|=0,d.width=t%2?t:t+1}l.refresh({soft:!0}),s&&t(window).trigger("resize")}})}},i.refresh=function(t){this.element&&this.iRefresh.refresh(t)},i.refreshView=function(t){var e=this;null!=e.options.editModel.indices&&e.blurEditor({force:!0}),e.refreshDataFromDataModel(t),e.refresh(t)},i._refreshPager=function(){var t=this,e=t.options,n=e.pageModel,r=!!n.type,i=n.rPP,o=n.totalRecords;r?(t.pageI||t._initPager(),t.pageI.option(n),o>i?t.$bottom.css("display",""):e.showBottom||t.$bottom.css("display","none")):(t.pageI&&t.pageI.destroy(),e.showBottom?t.$bottom.css("display",""):t.$bottom.css("display","none"))},i.getXHR=function(){return this.xhr},i.refreshDataAndView=function(e){e=e||{};var n=this,r=n.options.dataModel.location,i="lazy"==r;0!=n._trigger("beforeNewData",null,e)&&(n.pdata=n.pdata||[],"remote"==r?n.remoteRequest({callback:function(){n._onDataAvailable(e)}}):(n._onDataAvailable(i?t.extend({},e,{sort:!1,filter:!1,group:!1,trigger:!1}):e),i&&n.iLazy.init(e)))},i.getColIndx=function(t){var e,n=t.dataIndx,r=t.column,i=this.colModel,o=i.length,a=0;if(r){for(;a<o;a++)if(i[a]==r)return a}else{if(null==n)throw"dataIndx / column NA";if(null!=(e=this.colIndxs[n]))return e}return-1},i.getColumn=function(t){var e=t.dataIndx;if(null==e)throw"dataIndx N/A";return this.columns[e]||this.iGroup.getColsPrimary()[e]},i._removeEditOutline=function(){var e,n=this,r=n.$div_focus;if(r){if(function(t){t.hasClass("hasDatepicker")&&t.datepicker("hide").datepicker("destroy")}(e=r.find(".pq-editor-focus")),e[0]==document.activeElement){var i=n._blurEditMode;n._blurEditMode=!0,e.blur(),n._blurEditMode=i}r.removeAttr("title").empty(),r.parent()[0]==n.element[0]&&r.remove(),delete n.$div_focus;var o=n.options.editModel,a=t.extend({},o.indices);o.indices=null,a.rowData=void 0,n.refreshCell(a)}},i.scrollX=function(t,e){var n=this;return n.iRenderB.scrollX(t,function(){e&&e.call(n)})},i.scrollY=function(t,e){var n=this;return n.iRenderB.scrollY(t,function(){e&&e.call(n)})},i.scrollXY=function(t,e,n){var r=this;return r.iRenderB.scrollXY(t,e,function(){n&&n.call(r)})},i.scrollRow=function(t,e){var n=this;n.iRenderB.scrollRow(n.normalize(t).rowIndxPage,function(){e&&e.call(n)})},i.scrollColumn=function(t,e){var n=this;n.iRenderB.scrollColumn(n.normalize(t).colIndx,function(){e&&e.call(n)})},i.scrollCell=function(t,e){var n=this,r=n.normalize(t);n.iRenderB.scrollCell(r.rowIndxPage,r.colIndx,function(){e&&e.call(n),n._trigger("scrollCell")})},i.blurEditor=function(t){if(this.$div_focus){var e=this.$div_focus.find(".pq-editor-focus");if(!t||!t.blurIfFocus)return e.triggerHandler("blur",t);document.activeElement==e[0]&&e.blur()}},i.Selection=function(){return this.iSelection},i.goToPage=function(t){var e=this.options.pageModel;if("local"==e.type||"remote"==e.type){var n=t.rowIndx,r=e.rPP,i=null==t.page?Math.ceil((n+1)/r):t.page;i!=e.curPage&&(e.curPage=i,"local"==e.type?this.refreshView():this.refreshDataAndView())}},i.setSelection=function(t,e){if(null==t)return this.iSelection.removeAll(),this.iRows.removeAll({all:!0}),!0;var n=this,r=n.pdata,i=function(){null!=a&&!1!==t.focus&&n.focus({rowIndxPage:a,colIndx:l??n.getFirstVisibleCI()}),e&&e.call(n)};r&&r.length||i();var o=(t=this.normalize(t)).rowIndx,a=t.rowIndxPage,l=t.colIndx;(null==o||o<0||l<0||l>=this.colModel.length)&&i(),this.goToPage(t),a=o-this.riOffset,n.scrollRow({rowIndxPage:a},function(){null==l?(n.iRows.add({rowIndx:o}),i()):n.scrollColumn({colIndx:l},function(){n.Range({r1:o,c1:l}).select(),i()})})},i.getColModel=function(){return this.colModel},i.getCMPrimary=function(){return this.iGroup.getCMPrimary()},i.getOCMPrimary=function(){return this.iGroup.getOCMPrimary()},i.saveEditCell=function(e){var n=this.options,r=n.editModel;if(!r.indices)return null;var i,o=t.extend({},r.indices),a=e?e.evt:null,l=this.riOffset,s=o.colIndx,c=o.rowIndxPage,d=c+l,u=this.colModel[s],h=u.dataIndx,f=this.pdata[c],p=n.dataModel,g=f?.[h];if(null==f)return null;if(null!=c){if(i=g&&g.getEditorVal?g.getEditorVal(this.$div_focus[0]):this.getEditCellData(),t.isPlainObject(i))for(var m in g={},i)g[m]=f[m];else g=this.readCell(f,u);"<br>"==i&&(i=""),null==g&&""===i&&(i=null);var v={rowIndx:d,rowIndxPage:c,dataIndx:h,column:u,newVal:i,value:i,oldVal:g,rowData:f,dataModel:p};if(!1===this._trigger("cellBeforeSave",a,v))return!1;var w={};return t.isPlainObject(i)?i.prop?.inst?(w[h]=i.val,(w.pq_cellprop={})[h]=i.prop):w=i:w[h]=i,!1!==this.updateRow({newRow:w,rowIndx:d,silent:!0,source:"edit",checkEditable:!1})&&(this._trigger("cellSave",a,v),!0)}},i._digestRow=function(t,e,n,r,i,o,a,l,s){var c,d,u,h=this,f=pq.getROFn("change"),p=h.getValueFromDataType,g=h.columns,m=h.colIndxs;for(c in t)if(d=g[c],u=m[c],d){if(o&&!1===h.isEditable({rowIndx:n,rowData:r,colIndx:u,column:d,rowIndxPage:n-h.riOffset,dataIndx:c,normalized:!0})){delete t[c],e&&delete e[c];continue}var v=d.dataType,w=p(t[c],v),x=e?e[c]:void 0;if(x=void 0!==x?p(x,v):void 0,t[c]=f(w)||w,a&&d.validations)if("edit"==s&&!1===l){var y=this.isValid({focusInvalid:!0,dataIndx:c,rowIndx:n,value:w});if(0==y.valid&&!y.warn)return!1}else{var b="add"==i?t:r;!1===(y=this.iValid.isValidCell({column:d,rowData:b,allowInvalid:l,value:w})).valid&&(!1!==l||y.warn||delete t[c])}if("update"==i&&w===x){delete t[c],delete e[c];continue}}return"update"!=i||(!pq.isEmpty(t)||void 0)},i._digestData=function(t){if(t.rowList)throw"not supported";if(E=t.addList=t.addList||[],t.updateList=t.updateList||[],t.deleteList=t.deleteList||[],E.length&&E[0].rowData)throw"rd in addList";if(!1===this._trigger("beforeValidate",null,t))return!1;var e,n,r,i,o,a,l,s=this,c=s.options,d=c.editModel,u=c.dataModel,h=u.data||[],f=u.dataUF||[],p=c.colModel,g=c.pageModel,m=c.historyModel,v=c.refreshCompareBy,w=s.iRenderB,x=p.map(function(t){return t.dataIndx}),y=t.validate??d.validate,b="remote"==g.type,C=t.allowInvalid??d.allowInvalid,q=c.trackModel,I=t.track,_=null==t.history?m.on:t.history,R=this.iHistory,D=this.iUCData,M=null==t.checkEditable||t.checkEditable,S=null==t.checkEditableAdd?M:t.checkEditableAdd,T=t.source,F=s.iRefresh,k=this.riOffset,E=t.addList,P=t.updateList,$=t.deleteList,A=[],H=[];for(I=null==I?null==c.track?q.on:c.track:I,a=0,l=P.length;a<l;a++){var O=P[a];if(O){var L,N=O.newRow,V=O.rowData,j=O.checkEditable,B=O.rowIndx,z=O.oldRow;if(null==j&&(j=M),!z)throw"oldRow required while update";if(!1===(L=this._digestRow(N,z,B,V,"update",j,y,C,T)))return!1;L&&H.push(O)}}for(a=0,l=E.length;a<l;a++){if(O=E[a],N=O.newRow,j=O.checkEditable,B=O.rowIndx,null==j&&(j=S),x.forEach(function(t){N[t]=N[t]}),!1===(L=this._digestRow(N,z,B,V,"add",j,y,C,T)))return!1;L&&A.push(O)}return E=t.addList=A,o=(P=t.updateList=H).length,r=E.length,i=$.length,r||o||i?(_&&(R.increment(),R.push(t)),o&&(!v||r||i||(e=w.saveValues(v)),s._digestUpdate(P,D,I)),i&&(s._digestDelete($,D,I,h,f,g,b,k),F.addRowIndx()),r&&(s._digestAdd(E,D,I,h,g,b,k),F.addRT(E.map(function(t){return t.newRow})),F.addRowIndx()),s._trigger("change",null,t),e&&(n=w.dirtyCells(e,v)),n||!0):"edit"==T&&null},i._digestUpdate=function(e,n,r){for(var i,o,a,l=0,s=e.length,c=this.columns;l<s;l++){var d=e[l],u=d.newRow,h=d.rowData;for(a in r&&n.update({rowData:h,row:u,refresh:!1}),u)if(i=c[a],o=u[a],i)h[a]=o;else if(a.startsWith("pq_cell"))if(o)if(t.isEmptyObject(o))h[a]={};else{let t,e,n=h[a]||={};for(t in o)e=o[t],null==e||0==Object.keys(e).length?delete n[t]:n[t]=e}else delete h[a];else o?h[a]=o:delete h[a]}},i._digestAdd=function(t,e,n,r,i,o,a){var l,s=0,c=t.length;for(t.sort(function(t,e){return t.rowIndx-e.rowIndx});s<c;s++){var d=t[s],u=d.newRow,h=d.rowIndx;n&&e.add({rowData:u}),null==h?r.push(u):(l=o?h-a:h,r.splice(l,0,u)),d.rowData=u,o&&i.totalRecords++}},i._digestDelete=function(t,e,n,r,i,o,a,l){for(var s,c,d=0,u=t.length;d<u;d++){var h=t[d],f=h.rowData,p=!1,g=r.indexOf(f);-1==g?(g=i.indexOf(f))>=0&&(p=!0):h.rowIndx=a?g+l:g,h.uf=p,h.indx=g}for(t.sort(function(t,e){return e.rowIndx-t.rowIndx}),d=0;d<u;d++)f=(h=t[d]).rowData,p=h.uf,c=h.rowIndx,g=h.indx,n&&e.delete({rowIndx:c,rowData:f}),p?i.splice(g,1):(s=r.splice(g,1))&&s.length&&a&&o.totalRecords--},i.refreshColumn=function(t){var e=this,n=e.normalize(t),r=e.iRenderB;n.skip=!0,r.eachV(function(t,r){n.rowIndxPage=r,e.refreshCell(n)}),e._trigger("refreshColumn",null,n)},i.refreshCell=function(t){var e=this,n=e.normalize(t),r=n.rowIndxPage,i=n.colIndx;e.iRenderB.refreshCell(r,i,n.rowData,n.column)&&(n.skip||(e.refresh({soft:!0}),e._trigger("refreshCell",null,n)))},i.refreshHeaderCell=function(t){var e=this.normalize(t),n=this.headerCells,r=n.length-1,i=n[r];this.iRenderHead.refreshCell(r,e.colIndx,i,e.column)},i.refreshRow=function(t){if(this.pdata){var e=this,n=e.normalize(t),r=n.rowIndx,i=n.rowIndxPage,o=n.rowData;return o?(e.iRenderB.refreshRow(i),e.refresh({soft:!0}),e._trigger("refreshRow",null,{rowData:o,rowIndx:r,rowIndxPage:i}),!0):null}},i.quitEditMode=function(t){if(!this._quitEditMode){var e=!1,n=!1,r=!1,i=this.options.editModel,o=i.indices,a=void 0;this._quitEditMode=!0,t&&(e=t.old,n=t.silent,r=t.fireOnly,a=t.evt),o&&(n||e||this._trigger("editorEnd",a,o),r||(this._removeEditOutline(t),i.indices=null)),this._quitEditMode=null}},i.getViewPortRowsIndx=function(){return{beginIndx:this.initV,endIndx:this.finalV}},i.getViewPortIndx=function(){var t=this.iRenderB;return{initV:t.initV,finalV:t.finalV,initH:t.initH,finalH:t.finalH}},i.getRIOffset=function(){return this.riOffset},i.getEditCell=function(){var t=this.options.editModel;if(t.indices){var e=this.getCell(t.indices),n=this.$div_focus,r=n.find(".pq-editor-focus");return{$td:e,$cell:n,$editor:r}}return{}},i.editCell=function(t){var e,n,r=this,i=r.normalize(t),o=r.iMerge,a=i.rowIndx,l=i.colIndx;if(o.ismergedCell(a,l)&&((e=o.getRootCellO(a,l)).rowIndx!=i.rowIndx||e.colIndx!=i.colIndx))return!1;r.scrollCell(i,function(){if((n=r.getCell(i))&&n.length)return r._editCell(i)})},i.getFirstEditableColIndx=function(t){if(null==t.rowIndx)throw"rowIndx NA";for(var e=this.colModel,n=0;n<e.length;n++)if(!e[n].hidden&&(t.colIndx=n,this.isEditable(t)))return n;return-1},i.editFirstCellInRow=function(t){var e=this.normalize(t).rowIndx,n=this.getFirstEditableColIndx({rowIndx:e});-1!=n&&this.editCell({rowIndx:e,colIndx:n})},i.getEditor=function(e,n){var r=this,i=r.normalize(e),o=t=>pq.isFn(t)?t.call(r,i):t,a=t=>{var e=o(t);return 0==e?{type:!1}:e},l=a(r.options.editor),s=a(i.column.editor),c=(i.cellData,(i.rowData?.pq_cellprop?.[i.dataIndx]||{}).inst),d=c&&pq.RichObjs[c].editor,u=d?a(d):{},h=t.extend(!0,{},l,s,u);return(n||["attr","cls","style","type","options"]).forEach(function(t){h[t]=o(h[t])||""}),h},i._editCell=function(e){var r=this,i=r.normalize(e),o=i.editByPress,a=i.evt,l=i.rowIndxPage,s=i.colIndx,c=r.iKeyNav,d=r.pdata;if(!d||l>=d.length)return!1;var u=r.options,h=u.editModel,f=d[l],p=i.rowIndx,g=r.colModel[s],m=g.dataIndx,v=r.readCell(f,g),w={rowIndx:p,rowIndxPage:l,cellData:v,rowData:f,dataIndx:m,colIndx:s,column:g},x=r.getEditor(w),y=x.type,b="contenteditable"==y;if(0!=y){if(h.indices){var C=h.indices;if(C.rowIndxPage==l&&C.colIndx==s){var q=r.$div_focus.find(".pq-editor-focus");return document.activeElement!=q[0]&&(q.focus(),window.setTimeout(function(){q.focus()},0)),!1}if(!1===r.blurEditor({evt:a}))return!1;r.quitEditMode({evt:a})}o||r.focus(i),h.indices={rowIndxPage:l,rowIndx:p,colIndx:s,column:g,dataIndx:m};var I,_=t(document.activeElement);"grid"==x.appendTo?(I=t("<div></div>").appendTo(r.element)).append(_):I=_.parent(),r.$div_focus=I,I.addClass("pq-editor-outer"),I.addClass("pq-align-"+(g.align||"left")),w.$cell=I;var R,D=null==i.select?x.select:i.select,M=x.valueIndx,S=x.dataMap,T=x.mapIndices||{},F="pq-editor-focus "+x.cls,k=F+" pq-cell-editor ",E=x.attr,P=x.style,$=P?"style='"+P+"'":"",A=$,H=$;w.cls=F,w.attr=E,c.ignoreBlur(function(){if("checkbox"==y){var e=x.subtype;R="<input "+(v?"checked='checked'":"")+" class='"+k+"' "+E+" "+H+" type=checkbox name='"+m+"' />",I.html(R);var i=I.children("input");"triple"==e&&(i.pqval({val:v}),I.click(function(){t(this).children("input").pqval({incr:!0})}))}else if("select"==y){var a=x.options||[],l=[E," class='",k,"' ",A," name='",m,"'"].join("");R=n.select({options:a,attr:l,prepend:x.prepend,labelIndx:x.labelIndx,valueIndx:M,groupIndx:x.groupIndx,dataMap:S}),I.empty(),t(R).appendTo(I).val(null!=M&&(T[M]||r.columns[M])?T[M]?f[T[M]]:f[M]:v)}else if("textarea"==y||"textbox"==y||b){_.addClass(k),_.attr(t.extend({name:m},b?{contentEditable:!0}:{readonly:!1}));var s=r.format(v,"Edit",g);o||_.val(s)}else y&&I.html("<"+y+" class='"+k+"' tabindex=0 "+E+" "+A+">")}),w.$editor=q=I.children(".pq-editor-focus");var O=h.filterKeys,L=r.getCell(h.indices),N=g.editModel;N&&void 0!==N.filterKeys&&(O=N.filterKeys),"textarea"!=y&&"contenteditable"!=y&&L.empty(),q.removeAttr("aria-activedescendant").attr("aria-labelledby",L[0].id);var V={$cell:I,cellData:v,$editor:q,$td:L,dataIndx:m,column:g,colIndx:s,rowIndx:p,rowIndxPage:l,rowData:f,grid:r,prop:f.pq_cellprop?.[m],editor:x};L.trigger("focusout"),r._trigger("editorBegin",a,V),h.indices=V,(q=I.children(".pq-editor-focus")).data({FK:O}).on("click",function(){r._trigger("editorClick",null,V)}).on("keydown",c.keyDownInEdit.bind(c)).on("keypress",function(t){return c.keyPressInEdit(t,{FK:O})}).on("keyup",function(t){return c.keyUpInEdit(t,{FK:O})}).on("blur",function(e,n){var i=u.editModel,o=(V.column.editModel||{}).onBlur??i.onBlur,a="save"==o,l=document.activeElement,s=t(e.target),c="validate"==o,d=i.cancelBlurCls,h=!!n&&n.force;if(!r._quitEditMode&&!r._blurEditMode&&i.indices){if(!h){if(!1===r._trigger("editorBlur",e,V))return;if(!o)return;if(s[0]==l)return;if(d&&s.hasClass(d))return;if(s.hasClass("pq-autocomplete-text")){if(t("."+s.data("id")).is(":visible"))return}else if(s.hasClass("hasDatepicker")){if(s.datepicker("widget").is(":visible"))return!1}else if(s.hasClass("ui-autocomplete-input")){if(s.autocomplete("widget").is(":visible"))return}else if(s.hasClass("ui-multiselect")){if(t(".ui-multiselect-menu").is(":visible")||t(l).closest(".ui-multiselect-menu").length)return}else if(s.hasClass("pq-select-button")){if(t(".pq-select-menu").is(":visible")||t(l).closest(".pq-select-menu").length)return}else if(x.preventClose&&x.preventClose.call(r,V))return}r._blurEditMode=!0;var f=h||a||!c;if(!r.saveEditCell({evt:e,silent:f})&&!h&&c)return r._deleteBlurEditMode(),!1;r.quitEditMode({evt:e}),r._deleteBlurEditMode()}}).on("focus",function(t){r._trigger("editorFocus",t,V)}),q.focus(),window.setTimeout(function(){!1===t(document.activeElement).hasClass("pq-editor-focus")&&(r.element?r.element.find(".pq-editor-focus"):t()).focus()}),!o&&D&&q.select()}},i._deleteBlurEditMode=function(t){var e=this;t=t||{},e._blurEditMode&&(t.timer?window.setTimeout(function(){delete e._blurEditMode},0):delete e._blurEditMode)},i.getRow=function(t){var e=this.normalize(t).rowIndxPage;return this.iRenderB.get$Row(e)},i.getScale=function(){return pq.getScale(this.element[0])},i.getCell=function(e){if(e){e.vci>=0&&(e.colIndx=this.iCols.getci(e.vci));var n=this.normalize(e),r=n.rowIndxPage,i=n.colIndx,o=this.iRenderB.getCell(r,i)}return t(o)},i.getCellHeader=function(e,n){e.vci>=0&&(e.colIndx=this.iCols.getci(e.vci));var r=this.normalize(e),i=r.colIndx,o=(o=r.ri)??this.headerCells.length-(n?0:1),a=this.iRenderHead.getCell(o,i);return t(a)},i.getCellSum=function(e){return t(this.iRenderSum.getCell(e.ri,e.colIndx))},i.getCellFilter=function(t){return t.ri=null,this.getCellHeader(t,!0)},i.getEditorIndices=function(){var e=this.options.editModel.indices;return e?t.extend({},e):null},i.getEditCellData=function(){var e=this.options.editModel.indices;if(!e)return null;var n,r=e.colIndx,i=this.colModel[r],o=this.getEditor(e),a=o.valueIndx,l=o.labelIndx,s=o.mapIndices||{},c=i.dataIndx,d=this.$div_focus,u=o.getData,h=(e.rowData.pq_cellprop||{})[c]||{},f=h.inst;if(f&&(f=pq.RichObjs[f])&&f.getEditorVal&&(n=f.getEditorVal(d[0])))return n.prop=t.extend({},h,n.prop),n;if(u)n=this.callFn(u,e);else{var p=o.type;if("checkbox"==p){var g=d.children();n="triple"==o.subtype?g.pqval():!!g.is(":checked")}else{var m;if((m=d.find('*[name="'+c+'"]'))&&m.length)if("select"==p&&null!=a)if(s[a]||this.columns[a]){(n={})[s[a]?s[a]:a]=m.val(),n[s[l]?s[l]:l]=m.find("option:selected").text();var v=o.dataMap;if(v){var w=m.find("option:selected").data("map");if(w)for(var x=0;x<v.length;x++){var y=v[x];n[s[y]?s[y]:y]=w[y]}}}else n=m.val();else n=m.val();else(m=d.find(".pq-editor-focus"))&&m.length&&(n=m.val())}n=this.deformat(n,"Edit",i)}return n},i.getCellIndices=function(t){var e,n,r=t.$td,i={};return r&&r.length&&r.closest(".pq-body-outer")[0]==this.$cont[0]&&(e=this.iRenderB.getCellIndx(r[0]))&&(n=e[0]+this.riOffset,i=this.iMerge.getRootCellO(n,e[1],!0)),i},i.getRowsByClass=function(t){var e=this.options,n=e.dataModel,r="remote"==e.pageModel.type,i=this.riOffset,o=n.data,a=[];if(null==o)return a;for(var l=0,s=o.length;l<s;l++){var c=o[l];if(c.pq_rowcls&&(t.rowData=c,this.hasClass(t))){var d={rowData:c},u=r?l+i:l,h=u-i;d.rowIndx=u,d.rowIndxPage=h,a.push(d)}}return a},i.getCellsByClass=function(t){var e=this.options,n=e.dataModel,r="remote"==e.pageModel.type,i=this.riOffset,o=n.data,a=[];if(null==o)return a;for(var l=0,s=o.length;l<s;l++){var c=o[l],d=r?l+i:l,u=c.pq_cellcls;if(u)for(var h in u){var f={rowData:c,rowIndx:d,dataIndx:h,cls:t.cls};if(this.hasClass(f)){var p=this.normalize(f);a.push(p)}}}return a},i.data=function(e){var n=this.normalize(e),r=n.dataIndx,i=n.data,o=!(null!=i&&!pq.isStr(i)),a=n.rowData;if(!a)return{data:null};if(null==r){var l,s=a.pq_rowdata;if(o)return null!=s&&(l=null==i?s:s[i]),{data:l};var c=t.extend(!0,a.pq_rowdata,i);a.pq_rowdata=c}else{var d=a.pq_celldata;if(o){if(null!=d){var u=d[r];l=null==i||null==u?u:u[i]}return{data:l}}d||(a.pq_celldata={}),c=t.extend(!0,a.pq_celldata[r],i),a.pq_celldata[r]=c}},i.attr=function(e){var n,r,i=e.rowIndx,o=e.colIndx,a=null!=o?this.colModel[o].dataIndx:e.dataIndx,l=e.attr,s=!(null!=l&&!pq.isStr(l)),c=e.refresh,d=e.rowData||this.getRowData(e);if(!d)return{attr:null};if(s||!1===c||null!=i||(i=this.getRowIndx({rowData:d}).rowIndx),null==a){var u=d.pq_rowattr;if(s)return null!=u&&(r=null==l?u:u[l]),{attr:r};n=t.extend(!0,d.pq_rowattr,l),d.pq_rowattr=n,!1!==c&&null!=i&&this.refreshRow({rowIndx:i})}else{var h=d.pq_cellattr;if(s){if(null!=h){var f=h[a];r=null==l||null==f?f:f[l]}return{attr:r}}h||(d.pq_cellattr={}),n=t.extend(!0,d.pq_cellattr[a],l),d.pq_cellattr[a]=n,!1!==c&&null!=i&&this.refreshCell({rowIndx:i,dataIndx:a})}},i.processAttr=function(t,e){var n,r,i="";if(pq.isStr(t))i=t;else if(t)for(n in t)if(r=t[n]){if("title"==n)r=r.replace(/"/g,"&quot;");else{if("style"==n){e&&pq.styleObj(r,e);continue}"object"==typeof r&&(r=JSON.stringify(r))}i+=n+'="'+r+'"'}return i},i.removeData=function(e){var n,r=e.colIndx,i=null!=r?this.colModel[r].dataIndx:e.dataIndx,o="string"==typeof(n=null==(n=e.data)?[]:n)?n.split(" "):n,a=o.length,l=e.rowData||this.getRowData(e);if(l)if(null==i){var s=l.pq_rowdata;if(s){if(a)for(var c=0;c<a;c++){delete s[o[c]]}a&&!t.isEmptyObject(s)||delete l.pq_rowdata}}else{var d=l.pq_celldata;if(d&&d[i]){var u=d[i];if(a)for(c=0;c<a;c++){delete u[o[c]]}a&&!t.isEmptyObject(u)||delete d[i]}}},i.removeAttr=function(e){var n,r=e.rowIndx,i=e.dataIndx,o=e.colIndx,a=(i=null!=o?this.colModel[o].dataIndx:i,"string"==typeof(n=null==(n=e.attr)?[]:n)?n.split(" "):n),l=a.length,s=r-this.riOffset,c=e.refresh,d=e.rowData||this.getRowData(e);if(d)if(!1!==c&&null==r&&(r=this.getRowIndx({rowData:d}).rowIndx),null==i){var u=d.pq_rowattr;if(u){if(l)for(var h=0;h<l;h++){var f=a[h];delete u[f]}else for(f in u)a.push(f);l&&!t.isEmptyObject(u)||delete d.pq_rowattr}if(!1!==c&&null!=r&&a.length){n=a.join(" ");var p=this.getRow({rowIndxPage:s});p&&p.removeAttr(n)}}else{var g=d.pq_cellattr;if(g&&g[i]){var m=g[i];if(l)for(h=0;h<l;h++)delete m[f=a[h]];else for(f in m)a.push(f);l&&!t.isEmptyObject(m)||delete g[i]}if(!1!==c&&null!=r&&a.length){n=a.join(" ");var v=this.getCell({rowIndxPage:s,dataIndx:i});v&&v.removeAttr(n)}}},i.normalize=function(t,e){var n,r,i=Object.assign({},t),o=i.rowIndx,a=i.rowIndxPage,l=i.dataIndx,s=i.colIndx;return null==a&&null==o||(n=this.riOffset,o??=1*a+n,a??=1*o-n,i.rowIndx=o,i.rowIndxPage=a,i.rowData=i.rowData||e&&e[o]||this.getRowData(i)),null==s&&null==l||(r=this.colModel,l??=r[s]?.dataIndx,s??=this.colIndxs[l],i.column=r[s],i.colIndx=s,i.dataIndx=l),i},i.normalizeList=function(t){var e=this,n=e.get_p_data();return t.map(function(t){return e.normalize(t,n)})},i.isSortable=function(t){if(t)return null!=t.dataIndx&&this.options.sortModel.on&&0!=t.sortable},i.addClassHead=function(t){var e=this.getCellHeader(t),n=this._getHeadIndices(t.ri,t.colIndx),r=n.column||{},i=n.filterRow?"clsFilter":"clsHead",o=r[i],a=(o?o+" ":"")+t.cls;a=pq.arrayUnique(a.split(/\s+/)).join(" "),r[i]=a,e.addClass(t.cls)},i.addClassSum=function(t){this.getCellSum(t).addClass(t.cls)},i.removeClassSum=function(t){this.getCellSum(t).removeClass(t.cls)},i.removeClassHead=function(t){if(t.cls){var e=this.getCellHeader(t),n=this._getHeadIndices(t.ri,t.colIndx),r=n.column||{},i=n.filterRow?"clsFilter":"clsHead",o=r[i]||"",a=t.cls.split(/\s+/),l=o.split(/\s+/).filter(function(t){return t&&-1==a.indexOf(t)});r[i]=l.join(" "),e.removeClass(t.cls)}},i.addClass=function(t){var e,n=this.normalize(t),r=n.rowIndxPage,i=n.dataIndx,o=pq.arrayUnique,a=n.cls,l=n.refresh,s=n.rowData;if(s)if(!1!==l&&null==r&&(r=this.getRowIndx({rowData:s}).rowIndxPage),null==i){var c=s.pq_rowcls;if(e=o((e=c?c+" "+a:a).split(/\s+/)).join(" "),s.pq_rowcls=e,!1!==l&&null!=r&&this.SelectRow().inViewRow(r)){var d=this.getRow({rowIndxPage:r});d&&d.addClass(a)}}else{var u=[];"function"!=typeof i.push?u.push(i):u=i;var h=s.pq_cellcls;h||(h=s.pq_cellcls={});for(var f=0,p=u.length;f<p;f++){var g=h[i=u[f]];if(e=o((e=g?g+" "+a:a).split(/\s+/)).join(" "),h[i]=e,!1!==l&&null!=r&&this.SelectRow().inViewRow(r)){var m=this.getCell({rowIndxPage:r,dataIndx:i});m&&m.addClass(a)}}}},i.removeClass=function(e){var n=this.normalize(e),r=n.rowIndx,i=n.rowData,o=n.dataIndx,a=n.cls,l=n.refresh;function s(t,e){if(t&&e){for(var n=t.split(/\s+/),r=e.split(/\s+/),i=[],o=0,a=n.length;o<a;o++){for(var l=n[o],s=!1,c=0,d=r.length;c<d;c++){if(l===r[c]){s=!0;break}}s||i.push(l)}return i.length>1?i.join(" "):1===i.length?i[0]:null}}if(i){var c=i.pq_cellcls,d=i.pq_rowcls;if(!1!==l&&null==r&&(r=this.getRowIndx({rowData:i}).rowIndx),null==o){if(d&&(i.pq_rowcls=s(d,a),null!=r&&!1!==l)){var u=this.getRow({rowIndx:r});u&&u.removeClass(a)}}else if(c){var h=[];"function"!=typeof o.push?h.push(o):h=o;for(var f=0,p=h.length;f<p;f++){var g=c[o=h[f]];if(g){let e=s(g,a);if(e?c[o]=e:delete c[o],t.isEmptyObject(c)&&delete i.pq_cellcls,null!=r&&!1!==l){var m=this.getCell({rowIndx:r,dataIndx:o});m&&m.removeClass(a)}}}}}},i.hasClass=function(t){var e,n=t.dataIndx,r=t.cls,i=this.getRowData(t),o=new RegExp("\\b"+r+"\\b");if(i){if(null==n)return!(!(e=i.pq_rowcls)||!o.test(e));var a=i.pq_cellcls;return!!(a&&a[n]&&o.test(a[n]))}return null},i.getRowIndx=function(t){var e,n,r=t.$tr,i=t.rowData,o=this.riOffset;if(i){if(null!=(n=i.pq_ri))return{rowData:i,rowIndx:n,rowIndxPage:n-o};var a=this.get_p_data(),l=!1,s=t.dataUF?this.options.dataModel.dataUF:null,c=!1;if(a)for(var d=0,u=a.length;d<u;d++)if(a[d]==i){c=!0;break}if(!c&&s)for(l=!0,d=0,u=s.length;d<u;d++)if(s[d]==i){c=!0;break}return c?(e=d-o,{rowIndxPage:l?void 0:e,uf:l,rowIndx:d,rowData:i}):{}}return null==r||0==r.length||null==(e=this.iRenderB.getRowIndx(r[0])[0])?{}:{rowIndxPage:e,rowIndx:e+o}},i.search=function(t){for(var e=this.options,n=t.row,r=t.first,i=e.dataModel,o=e.pageModel.type,a=[],l=this.riOffset,s="remote"==o,c=i.data,d=0,u=c.length;d<u;d++){var h=c[d],f=!0;for(var p in n)n[p]!==h[p]&&(f=!1);if(f){var g=s?d+l:d,m=this.normalize({rowIndx:g});if(a.push(m),r)break}}return a},i._getFirstRC=function(t,e,n,r,i){e=this[e];for(var o=0,a=this.options[n],l=t?this.iRenderB[r]:a,s=e.length;o<s;o++)if(o==a&&o<l&&(o=l),!e[o][i])return o},i.getFirstVisibleRIP=function(t){return this._getFirstRC(t,"pdata","freezeRows","initV","pq_hidden")},i.getFirstVisibleCI=function(t){return this._getFirstRC(t,"colModel","freezeCols","initH","hidden")},i.getLastVisibleRIP=function(){for(var t,e=this.pdata,n=e.length-1;n>=0;n--)if((t=e[n])&&!t.pq_hidden)return n},i.getLastVisibleCI=function(){return this.iCols.getLastVisibleCI()},i.getNextVisibleCI=function(t){return this.iCols.getNextVisibleCI(t)},i.getPrevVisibleCI=function(t){return this.iCols.getPrevVisibleCI(t)},i.getPrevVisibleRIP=function(t){return this.iKeyNav.getPrevVisibleRIP(t)},i.getNextVisibleRIP=function(t){return this.iKeyNav.getNextVisibleRIP(t)},i.KeyNav=function(){return this.iKeyNav},i.calcWidthCols=function(t,e){var n,r=0,i=this.options.numberCell,o=this.colModel;-1==t&&(r+=i.outerWidth,t=0);for(var a=t;a<e;a++)(n=o[a])&&!n.hidden&&(r+=n._width);return r}}(jQuery),function(t){(t.paramquery.cKeyNav=function(t){var e,n,r=this,i=t.$focusMgr;r.that=t,t.$focusMgr.on("focusin",r.onFocus.bind(r)).on("focusout",r.onBlur.bind(r)),t.on("sort filter",t=>{r.feHead||i.children().blur()}),t.on("headerKeyDown",r.headKeyDown.bind(r)),t.on("sumKeyDown",r.sumKeyDown.bind(r)),i.on("keydown",function(t){pq.isCtrl(t)&&(r.ctrlKeyDown=!0)}).on("keyup",function(t){r.ctrlKeyDown=!1}),t.options.editModel.pressToEdit&&i.on("input",r.onInput.bind(r)),Object.defineProperties(r,{fe:{get:function(){return e},set:function(t){e=t}},feHead:{get:function(){return n},set:function(t){n=t}}})}).prototype={onFocus:function(t){var e,n=this,r=n.that;if(r.$focusMgr.parent().is(".pq-grid-center-o")){let i=r.getFirstVisibleRIP(),o=r.getFirstVisibleCI();null!=i?(e=n.fe||{rowIndxPage:i,colIndx:o},n.focus(e),n.cSelect(e.rowIndxPage,e.colIndx)):n.focus({evt:t,body:!0})}},cSelect:function(t,e){var n=this.that,r=n.riOffset;"cell"==n.options.selectionModel.type&&n.Range({r1:t+r,c1:e}).select()},onBlur:function(e){var n,r,i=this,o=e.target,a="",l=i.fe,s=i.that;(n=i.feHead)?(l=n,a="Head"):(n=i.feSum)&&(l=n,a="Sum"),r=i["_ignoreBlur"+a],document.activeElement==o||r||t(e.currentTarget).is(".pq-editor-outer")||(l&&i.removeFocusClass(l,a),i._ignoreBlur||i._ignoreBlurHead||i._ignoreBlurSum||i.revertFocusMgr(),s._trigger("blur"+a,e,l))},revertFocusMgr(){let t=this.that,e=t.$focusMgr,n=t.$focusMgr_o;e.parent()[0]!=n[0]&&(e.css({left:0,top:0}),e.prependTo(n))},focusHead:function(t){this.focus(t,!0)},focusSum:function(t={rowIndx:0,ri:0,ci:0,colIndx:0}){this.focus(t,"",!0)},resetFocusMgr:function(t,e,n,r){e=e||{};var i=t.children(),o={textbox:"input",textarea:"textarea",contenteditable:"div[contentEditable]"}[e.type]||"textarea",a=e.attr||"";return(t=>!("div[contentEditable]"!=o||!t.is("div")||!t.prop("contentEditable"))||t.is(o))(i)&&1==i.length&&!a||(t.html({input:"<input "+a+(a.includes("type")?"":" type='text'")+"/>",textarea:"<textarea "+a+"></textarea>","div[contentEditable]":"<div contenteditable='true' tabindex='0' "+a+"></div>"}[o]),i=t.children()),n&&!("ontouchstart"in window)||i.attr(i.is("div")?{contenteditable:!1}:{readonly:!0}),t[0].className="pq-focus-mgr ui-widget-content",i},ignoreBlur:function(t,e){this["_ignoreBlur"+(e=e||"")]=!0,t(),this["_ignoreBlur"+e]=!1},slotFocusMgr(t,e){let n=this.that,r=e?e.closest(".pq-grid-cont"):null;r&&r.length||(r=n.$cont.children(".pq-grid-cont")),t.prependTo(r)},focus:function(t,e,n){t=t||{};var r,i,o,a,l,s,c,d,u,h=this,f=h.that,p=!e&&!n,g=p?"":e?"Head":"Sum",m=f["iRender"+(g||"B")].data,v=f.$focusMgr,w=v[0],x="fe"+g,y=f.iMerge,b=t.evt,C=t.body,q=f.$cont,I=t.noscroll,_=h[x];if(f.$div_focus){if(!f.saveEditCell())return;f.quitEditMode()}if(C||(p?(null==(a=t.rowIndxPage)&&(a=t.rowIndxPage=f.getFirstVisibleRIP(!0)),null!=a&&(o=a+f.riOffset)):null==(o=t.ri)&&e&&(o=t.ri=m.length-1),null!=(l=t.colIndx)&&-1!=l||(l=t.colIndx=f.getFirstVisibleCI(!0))),o>=0&&l>=0){function R(){h.removeFocusClass(_,g),t.cls="pq-focus"+(f.options.noBorderFocus?" pq-no-border":""),f["addClass"+g](t),h.ignoreBlur(function(){r=f[p?"getCell":e?"getCellHeader":"getCellSum"](t),(i=r[0])&&(h.slotFocusMgr(v,r),c=pq.offset(i,w.parentNode),v.css({left:c.left,top:c.top}),I||h.scrollIntoView(w,i.getBoundingClientRect())),(_=h[x]=t).cell=i;let n=h.resetFocusMgr(v,p?f.getEditor(t,["type","attr"]):{},p?f.isEditable(t):"",e);n.attr({"aria-label":"Editor",role:"textbox"}),i&&n.attr("aria-activedescendant",i.id),document.activeElement!=n[0]&&n.focus()},g),i&&r.trigger("focusin"),f._trigger("focus"+g,null,_)}p&&y.ismergedCell(o,l)&&(s=y.getRootCellO(o,l),a=t.rowIndxPage=s.rowIndxPage,l=t.colIndx=s.colIndx),I?R():p?f.scrollCell({rowIndxPage:a,colIndx:l},R):f.scrollColumn({colIndx:l},R)}else h.removeFocusClass(_,g),d=b.offsetX,u=b.offsetY,d&&u&&v.css({left:Math.max(0,d-20),top:Math.max(0,u-20)}),h.ignoreBlur(function(){h.slotFocusMgr(v);let t=h.resetFocusMgr(v);document.activeElement!=t[0]&&t.focus()}),q.addClass("pq-focus"),_=h[x]=t,f._trigger("focus"+g,null,_)},removeFocusClass:function(t,e){var n=this.that;t&&(t.body?n.$cont.removeClass("pq-focus"):(n["removeClass"+e](t),e||n.getCell(t).trigger("focusout"),n._trigger("blurCell"+e,null,t)))},scrollIntoView:function(t,e){var n,r={behavior:"smooth"};e.top<0||e.bottom>window.innerHeight?(n=1,r.block="center"):(e.left<0||e.right>window.innerWidth)&&(n=1,r.block="nearest",r.inline="center"),n&&t.scrollIntoView(r)},isLastFocusableCell:function(t){var e=this.that;return e.getLastVisibleRIP()==t.rowIndxPage&&e.getLastVisibleCI()==t.colIndx},getFocusHead:function(){return this.feHead},getFocus:function(){return this.fe},headKeyDown:function(e,n){var r=this,i=e.keyCode,o=r.that,a=o.options.focusModel.onTab,l=o.iRenderHead.data,s=l.length,c=r.feHead;if(c){var d,u,h,f,p,g,m=c.ri??s-1,v=c.colIndx,w=l[m],x=w?.[v],y=t.ui.keyCode,b=i==y.UP,C=i==y.DOWN,q=i==y.LEFT,I=i==y.RIGHT,_=o.options.rtl,R=q&&!_||I&&_,D=q&&_||I&&!_,M=i==y.TAB,S=e.shiftKey,T=e.altKey,F=o.getCellHeader({ri:m,colIndx:v}),k=o.Columns(),E=(t=0)=>{null!=(f=o.getFirstVisibleRIP())&&(o.focus({rowIndxPage:f,colIndx:t}),r.removeFocusClass(c,"Head"),r.cSelect(f,t))};if(0!=o._trigger("beforeHeadKeyDown",e,c)){if(i==y.ENTER)pq.isCtrl(e)?(h=F.find(".pq-icon-menu,.pq-icon-filter")).length&&h.click():(h=F.find(".pq-icon-detail")).length?h.click():o.isSortable(x)?((p=t.Event("click")).shiftKey=e.shiftKey,F.find(".pq-title-span").trigger(p)):x&&(u=x.collapsible)?(u.on=!u.on,o.refreshCM(),o.refresh(),P()):(g=F.find("input,select,textarea")).length&&g[0].focus();else if(i==y.SPACE)F.find("input").click(),d=!0;else if(T&&(R||D))k.resize(v,5*(R?-1:1),e),d=!0;else if(a&&M&&S||R)for(;;){if(w[v=k.getPrevVisibleCI(v-1,w)],null!=v){P(),d=!0;break}if(!(m>0&&M))break;m--,v=l[m].length}else if(a&&M||D)for(;;){if(v=k.getNextVisibleCI(v+1,w),null!=v){P(),d=!0;break}if(!(M&&m<s-1)){M&&(E(),d=!0);break}m++,v=-1}else if(C||b)for(;;){if(C?m++:m--,!l[m]){C&&E(v);break}if(l[m][v]!=x){P();break}}d&&e.preventDefault()}}function P(){r.focusHead({ri:m,colIndx:v})}},sumKeyDown:function(e,n){var r=this,i=e.keyCode,o=r.that,a=o.options.focusModel.onTab,l=o.iRenderSum.data,s=l.length,c=r.feSum;if(c){var d,u,h,f=c.ri??s-1,p=c.colIndx,g=l[f]?l[f][p]:null,m=t.ui.keyCode,v=i==m.UP,w=i==m.DOWN,x=i==m.LEFT,y=i==m.RIGHT,b=o.options.rtl,C=x&&!b||y&&b,q=x&&b||y&&!b,I=i==m.TAB,_=e.shiftKey,R=(t=0)=>{null!=(h=o.getLastVisibleRIP())&&(o.focus({rowIndxPage:h,colIndx:t}),r.cSelect(h,t),r.removeFocusClass(c,"Sum"),u=!0)};if(0!=o._trigger("beforeSumKeyDown",e,c)){if(a&&I&&_||C){for(;;)if(p=o.getPrevVisibleCI(p-1),d=l[f][p],null==p){if(!(f>0&&I)){R();break}f--,p=l[f].length}else if(!d||d!=g){D(),u=!0;break}}else if(a&&I||q){for(;;)if(p=o.getNextVisibleCI(p+1),d=l[f]?l[f][p]:null,null==p){if(!(I&&f<s-1))break;f++,p=-1}else if(!d||d!=g){D(),u=!0;break}}else(w||v)&&(w?f++:f--,l[f]?D():v&&R(p));u&&e.preventDefault()}}function D(){r.focusSum({ri:f,colIndx:p})}},onInput:function(e){var n=this,r=n.that,i=n.fe;if(!n.ctrlKeyDown&&i&&null!=i.rowIndxPage&&null!=i.colIndx&&!t(e.currentTarget).hasClass("pq-editor-outer")){var o=r.getEditor(i,["type"]).type,a="select"==o;r.isEditable(i)&&o&&!a&&r.editCell(t.extend({editByPress:!0},i))}},bodyKeyDown:function(e){var n=this,r=n.that,i=r.riOffset,o=r.options,a=o.rtl,l=r.iMerge,s=t(e.target),c=n.fe,d=r.colModel,u=o.selectionModel,h=o.focusModel,f=o.editModel,p=r.$cont[0],g=s[0]==p,m=pq.isCtrl(e),v=t.ui.keyCode,w=v.LEFT,x=v.RIGHT,y=v.TAB,b=e.keyCode,C=t=>b==t,q=t=>r.getFirstVisibleCI(),I=t=>r.getLastVisibleCI(),_=t=>r.getFirstVisibleRIP(),R=t=>r.getLastVisibleRIP(),D=t=>{r.Selection().removeAll(),n.removeFocusClass(c,"")},M=C(w),S=C(x),T=C(v.HOME),F=C(v.END),k=C(y),E=C(v.SPACE),P=C(v.PAGE_UP),$=C(v.PAGE_DOWN),A=e.shiftKey,H=C(v.ENTER),O=k&&A,L=k&&!A,N=C(v.UP),V=C(v.DOWN);if(f.indices)r.$div_focus.find(".pq-cell-focus").focus();else if(c&&!s.hasClass("pq-cell-editor")&&!s.parent().parent(".pq-grid-cell").length){if(E&&g)return!1;if(!s.is("select,input")||s.parent().is(".pq-focus-mgr")){var j,B,z,U,W,G=r.normalize(c),K=G.rowIndxPage,X=G.rowIndx,Q=G.colIndx,Y=r.pdata,Z=G.rowData,J=G,tt=(t=q())=>{if(o.summaryData&&!o.summaryOnTop)return n.focusSum({ri:0,colIndx:t}),W=!0,D(),n.fe=null,U=null,!0},et=(t=q())=>{n.focusHead({colIndx:t}),D(),U=null};if(c.body||null!=Q&&null!=Z){if(l.ismergedCell(X,Q)&&(K=(G=J=l.getRootCellO(X,Q)).rowIndxPage,X=G.rowIndx,Q=G.colIndx,(P||$||T||F)&&(B=l.getData(X,Q,"proxy_cell"))&&(Y[z=B.rowIndx-i].pq_hidden||(X=(K=z)+i)),d[Q].hidden&&(Q=r.getNextVisibleCI(Q))),0==r._trigger("beforeCellKeyDown",e,J))return!1;if(r._trigger("cellKeyDown",e,J),H&&r._trigger("cellClickE",e,J),c.body){if(N)return et();if(V)return tt();(L||O)&&(it=pq.getFocusEle(O))}else if(T||m&&M)m&&T&&(X=_()+i),Q=a?I():q(),n.select(X,Q,e),W=!0;else if(F||m&&S)m&&F&&(X=R()+i),Q=a?q():I(),n.select(X,Q,e),W=!0;else if(M||S||N||V||h.onTab&&k){if((M&&!a||S&&a)&&Q!=q()||O)U=n.incrIndx(K,Q,!1);else if((S&&!a||M&&a)&&(Q!=I()||o.autoAddCol)||L){if(!k&&o.autoAddCol&&Q==I()&&r.Columns().add([{}]),L&&Q==I()&&(Z.pq_detail||{}).show)pq.focusEle(null,Z.pq_detail.child)&&(D(),W=!0);else if(!(U=n.incrIndx(K,Q,!0))&&k){var nt,rt=r.parent(),it=pq.getFocusEle();rt&&rt.widget()[0].contains(it)&&(nt=rt.Detail().getRip(r.widget().closest(".pq-detail")[0]),(U=rt.KeyNav().incrIndx(nt,rt.getLastVisibleCI(),!0))&&(rt.focus(U),rt.KeyNav().cSelect(U.rowIndxPage,U.colIndx),U=null,W=!0))}}else N?(U=m?{rowIndxPage:_(),colIndx:Q}:n.incrRowIndx(K,Q,!1)).rowIndxPage==K&&et(Q):V&&(m?U={rowIndxPage:R(),colIndx:Q}:(o.autoAddRow&&K==R()&&r.addNodes([{}]),(U=n.incrRowIndx(K,Q,!0)).rowIndxPage==K&&tt(Q)));U?(X=U.rowIndxPage+i,n.select(X,U.colIndx,e)):null==W&&k&&(D(),W=!1),null==W&&(W=!0)}else if($||P)r.iRenderB[P?"pageUp":"pageDown"](K,function(t){X=t+i,n.select(X,Q,e)}),W=!0;else if(b==v.ENTER){if((j=r.getCell(J))&&j[0])if(r.isEditable(J))r.editCell(J);else{var ot=j.find("button,input[type='radio']");ot[0]&&t(ot[0]).click()}W=!0}else if(m&&"65"==b){var at=r.iSelection;"row"==u.type&&"single"!=u.mode?r.iRows.toggleAll({all:u.all}):"cell"==u.type&&"single"!=u.mode&&at.selectAll({type:"cell",all:u.all}),W=!0}else m?W=!1:f.pressToEdit&&this.isEditKey(b)&&!m&&("select"==r.getEditor(J,["type"]).type&&(K=J.rowIndxPage,Q=J.colIndx,(j=r.getCell(J))&&j[0]&&r.isEditable(J)&&r.editCell({rowIndxPage:K,colIndx:Q,select:!0})),W=!1);W?e.preventDefault():it&&(it.focus(),e.preventDefault())}}}},getPrevVisibleRIP:function(t){for(var e=this.that.pdata,n=t-1;n>=0;n--)if(e[n]&&!e[n].pq_hidden)return n;return t},setDataMergeCell:function(t,e){var n,r=this.that.iMerge;r.ismergedCell(t,e)&&(n=r.getRootCellO(t,e),r.setData(n.rowIndx,n.colIndx,{proxy_cell:{rowIndx:t,colIndx:e}}))},getValText:function(e){var n=e[0].nodeName.toLowerCase(),r="text";return-1!=t.inArray(n,["input","textarea","select"])&&(r="val"),r},getNextVisibleRIP:function(t){for(var e=this.that.pdata,n=t+1,r=e.length;n<r;n++)if(e[n]&&!e[n].pq_hidden)return n;return t},incrEditIndx:function(t,e,n){var r,i=this.that,o=i.colModel,a=o.length,l=i.iMerge,s=i.riOffset,c=i[n?"getLastVisibleRIP":"getFirstVisibleRIP"]();do{var d,u=t+s;if(l.ismergedCell(u,e)){d=l.getRootCell(u,e);var h=l.getData(u,e,"proxy_edit_cell");h&&(t=(u=h.rowIndx)-s),e=n?e+d.o_cc:e-1}else e=n?e+1:e-1;if(n&&e>=a||!n&&e<0){if(t==c)return null;t=this[n?"getNextVisibleRIP":"getPrevVisibleRIP"](t),e=n?0:a-1}u=t+s,l.ismergedCell(u,e)&&(d=l.getRootCellO(u,e),l.setData(d.rowIndx,d.colIndx,{proxy_edit_cell:{rowIndx:u,colIndx:e}}),u=d.rowIndx,e=d.colIndx),r=o[e];var f=i.isEditable({rowIndx:u,colIndx:e}),p="function"==typeof(p=r.editor)?p.call(i,i.normalize({rowIndx:u,colIndx:e})):p;t=u-s}while(r&&(r.hidden||0==f||!1===p));return{rowIndxPage:t,colIndx:e}},incrIndx:function(t,e,n){var r,i,o,a,l,s,c=this.that,d=c.options.skipFocus,u=c.iMerge,h=t,f=e,p=c.pdata,g=c.riOffset,m="get"+(n?"Last":"First")+"Visible",v=c[m+"RIP"](),w=c[m+"CI"](),x=c.colModel,y=x.length;if(null==f)h!=v&&(s={rowIndxPage:h=this[n?"getNextVisibleRIP":"getPrevVisibleRIP"](h)});else if(f==w)(s=this.incrRowIndx(h,f,n)).rowIndxPage!=h&&(s.colIndx=c["get"+(n?"First":"Last")+"VisibleCI"]());else{do{if(o=h+g,u.ismergedCell(o,f)&&(r=u.getRootCell(o,f),!l&&(i=u.getData(r.o_ri,r.o_ci,"proxy_cell"))&&(p[a=i.rowIndx-g].pq_hidden||(h=a)),p[h].pq_hidden&&(h=u.getRootCellV(o,f).rowIndxPage),!l&&n&&(f=r.o_ci+(r.o_cc?r.o_cc-1:0))),n){if(!(f<y-1)){f=e;break}f++}else{if(!(f>0)){f=e;break}f--}l=x[f]}while(l&&(l.hidden||l.skipFocus||d&&d.call(c,o,f)));s={rowIndxPage:h,colIndx:f}}if(s.rowIndxPage!=t||s.colIndx!=e)return s},incrRowIndx:function(t,e,n){var r,i,o=this.that,a=o.riOffset,l=t+a,s=o.iMerge;return s.ismergedCell(l,e)&&(r=s.getRootCell(l,e),i=s.getData(r.o_ri,r.o_ci,"proxy_cell"),n&&(t=r.o_ri-a+r.o_rc-1),e=i?i.colIndx:r.v_ci),{rowIndxPage:t=this["get"+(n?"Next":"Prev")+"VisibleRIP"](t),colIndx:e}},isEditKey:function(t){return t>=32&&t<=127||189==t||190==t||187==t},keyDownInEdit:function(e){var n=this.that,r=n.options,i=r.editModel.indices;if(i){var o,a=t(e.target),l=t.ui.keyCode,s=r.editModel,c=t.extend({},i),d=c.rowIndxPage,u=c.colIndx,h=c.column.editModel,f=h?t.extend({},s,h):s,p=this.getValText(a);if(a.data("oldVal",a[p]()),0==n._trigger("editorKeyDown",e,c))return!1;if((o=e.keyCode)==l.TAB||o==f.saveKey&&!e.altKey){var g=o==l.TAB?f.onTab:f.onSave;return"downFocus"==g?(r.autoAddRow&&d==n.getLastVisibleRIP()&&n.addNodes([{}]),c=this.incrRowIndx(d,u,!e.shiftKey)):c={rowIndxPage:d,colIndx:u,incr:!!g,edit:"nextEdit"==g},this.saveAndMove(c,e)}return o==l.ESCAPE?(n.quitEditMode({evt:e}),n.focus({rowIndxPage:d,colIndx:u}),e.preventDefault(),!1):o==l.PAGE_UP||o==l.PAGE_DOWN?(e.preventDefault(),!1):!f.keyUpDown||e.altKey||o!=l.DOWN&&o!=l.UP?void 0:(c=this.incrRowIndx(d,u,o==l.DOWN),this.saveAndMove(c,e))}},keyPressInEdit:function(e,n){var r=this.that,i=r.options.editModel,o=i.indices,a=(n||{}).FK,l=o.column,s=t.ui.keyCode,c=["BACKSPACE","LEFT","RIGHT","UP","DOWN","DELETE","HOME","END"].map(function(t){return s[t]}),d=l.dataType;if(t.inArray(e.keyCode,c)>=0)return!0;if(!1===r._trigger("editorKeyPress",e,t.extend({},o)))return!1;if(a&&("float"==d||"integer"==d)){var u=o.$editor.val(),h=i.charsAllow["float"==d?0:1],f=e.charCode||e.keyCode,p=String.fromCharCode(f);if("="!==u[0]&&p&&-1==h.indexOf(p))return!1}return!0},keyUpInEdit:function(e,n){var r=this.that,i=r.options,o=(n||{}).FK,a=i.editModel,l=a.indices;r._trigger("editorKeyUp",e,t.extend({},l));var s=l.column.dataType;if(o&&("float"==s||"integer"==s)){var c=t(e.target),d="integer"==s?a.reInt:a.reFloat,u=this.getValText(c),h=c.data("oldVal"),f=c[u]();if(0==d.test(f)&&"="!==f[0])if(d.test(h))c[u](h);else{var p="float"==s?parseFloat(h):parseInt(h);isNaN(p)?c[u](0):c[u](p)}}},saveAndMove:function(t,e){if(null==t)return e.preventDefault(),!1;var n,r,i=this,o=i.that,a=t.rowIndxPage,l=t.colIndx;return o._blurEditMode=!0,!1!==o.saveEditCell({evt:e})&&o.pdata?(o.quitEditMode(e),t.incr&&(r=i[t.edit?"incrEditIndx":"incrIndx"](a,l,!e.shiftKey),a=r?r.rowIndxPage:a,l=r?r.colIndx:l),o.scrollCell({rowIndxPage:a,colIndx:l},function(){n=a+o.riOffset,i.select(n,l,e),t.edit&&o._editCell({rowIndxPage:a,colIndx:l})}),o._deleteBlurEditMode({timer:!0,msg:"saveAndMove"}),e.preventDefault(),!1):(o.pdata||o.quitEditMode(e),o._deleteBlurEditMode({timer:!0,msg:"saveAndMove saveEditCell"}),e.preventDefault(),!1)},select:function(e,n,r){var i=this.that,o=e-i.riOffset,a=(this.setDataMergeCell(e,n),i.options),l=i.iSelection,s=a.selectionModel,c=s.type,d="row"==c,u="cell"==c;i.scrollCell({rowIndx:e,colIndx:n},function(){var a=l.address();if(r.shiftKey&&r.keyCode!==t.ui.keyCode.TAB&&s.type&&"single"!=s.mode&&(a.length||d))if(d)i.iRows.extend({rowIndx:e,evt:r});else{var c=a[a.length-1],h=c.firstR,f=c.firstC,p=c.type;"column"==p?(c.c1=f,c.c2=n,c.r1=c.r2=c.type=c.cc=c.rc=void 0,i.Range(a,!1).select()):"row"==p?l.resizeOrReplace({r1:h,r2:e,firstR:h,firstC:f}):null!=h&&null!=f&&l.resizeOrReplace({r1:h,c1:f,r2:e,c2:n,firstR:h,firstC:f})}else d||u&&i.Range({r1:e,c1:n,firstR:e,firstC:n}).select();i.focus({rowIndxPage:o,colIndx:n})})}}}(jQuery),function(t){(t.paramquery.cGenerateView=function(){}).prototype={canAutoFit(){var t,e=this.that,n=e.colModel,r=e.options.numberCell.outerWidth;for(t of n)t.hidden||(r+=t._percent||t._resized?t._width:t._minWidth);return this.getWdCont()>=r},getWdCont(){return this.dims.wdCenter-this.getSBWd()},autoFitCols:function(){var t,e=this.that,n=e.colModel,r=n.length,i=e.calcWidthCols(-1,r)-this.getWdCont(),o=[];if(i){for(var a=0;a<r;a++){var l,s=(u=n[a])._percent,c=u._resized;if(!u.hidden&&!s&&!c)i<0?(l=u._maxWidth-u._width)&&o.push({availWd:-1*l,colIndx:a}):(l=u._width-u._minWidth)&&o.push({availWd:l,colIndx:a});c&&(t=u,delete u._resized)}o.sort(function(t,e){return t.availWd>e.availWd?1:t.availWd<e.availWd?-1:0});a=0;for(var d=o.length;a<d;a++){var u,{availWd:l,colIndx:h}=o[a],f=Math.round(i/(d-a)),p=(u=n[h])._width;Math.abs(l)>Math.abs(f)?(g=p-f,i-=f):(g=p-l,i-=l),u.width=u._width=g}var g;if(0!=i&&t)(g=t._width-i)>t._maxWidth?g=t._maxWidth:g<t._minWidth&&(g=t._minWidth),t.width=t._width=g}},numericVal:function(t,e){var n;return n=(t+"").indexOf("%")>-1?parseInt(t)*e/100:parseInt(t),Math.round(n)},getNumCellWidth(e){var n=this.rows,r=e.dragModel,i=r.on&&-1==r.diDrag,o=t("<div style='position:absolute;' class='pq-grid-number-cell'>"+pq.formatNumber(n,e.numberCell.format)+"</div>").appendTo(this.that.$cont),a=o[0].offsetWidth+2+(i?20:0);return o.remove(),a},refreshColumnWidths:function(t={}){var e=this.that,n=e.options,r=n.numberCell,i="flex"===n.width,o=e.colModel,a=this.autoFit,l=this.dims.wdCenter,s=o.length,c=n.minColWidth,d=n.maxColWidth,u=0;r.show?("auto"==(u=r.width)&&(u=this.getNumCellWidth(n)),u=Math.max(u,r.minWidth),u=Math.min(u,r.maxWidth),r.outerWidth=u):r.outerWidth=0;var h=i?null:l-0-u,f=(c=Math.floor(this.numericVal(c,h)),d=Math.ceil(this.numericVal(d,h)),0);if(!i&&h<5||isNaN(h)){if(n.debug)throw"availWidth N/A"}else{delete e.percentColumn;for(var p=0;p<s;p++){var g=o[p];if(!g.hidden){var m=g.width,v=(m+"").indexOf("%")>-1||null,w=g.minWidth,x=g.maxWidth;w=w?this.numericVal(w,h):c;if((x=x?this.numericVal(x,h):d)<w&&(x=w),null!=m){var y,b=0;!i&&v?(e.percentColumn=!0,g.resizable=!1,g._percent=!0,(f+=(y=this.numericVal(m,h)-0)-(b=Math.floor(y)))>=1&&(b+=1,f-=1)):m&&(b=1*m),b<w?b=w:b>x&&(b=x),g._width=b}else g._width=w;v||(g.width=g._width),g._minWidth=w,g._maxWidth=i?1e3:x}}!1===i&&!1!==t.refreshWidth&&a&&this.autoFitCols()}},formatCell:function(t,e,n){var r,i;return null==t?r=t:pq.isFn(e)?r=e(t):[r,i]=pq.formatNumber(t,e,n,!0),[r,i]},renderCell:function(t){var e,n,r,i,o,a,l,s,c,d,u,h,f,p=this.that,g=pq.styleStr,m=pq.styleObj,v=t.attr||[],w=m((w=t.style||[]).join(""))||{},x=t.Export,y=p.options,b=t.cls||[],C=t.rowData,q=t.rowIndxPage,I=t.column,_=I.dataIndx,R=C.pq_celldt?.[_]||I.dataType,D="pic"==R,M=t.colIndx,S=p.processAttr,T=I.style,F=C.pq_fn||{},k=this.rowStyle,E=C.pq_cellprop?.[_]||{},P=C.pq_rowprop||{},$=y.freezeCols,A=y.columnBorders;if(C){h=C[_],x||(T&&m(T,w),k[q]&&m(k[q],w),l=C.pq_cellstyle?.[_],l&&m(l,w),M==$-1&&A&&b.push("pq-last-frozen-col"),I.cls&&b.push(I.cls),y.editModel.addDisableCls&&!1===p.isEditable(t)&&b.push("pq-cell-disable"),pq.isStr(h)&&"html"!=R&&(h=pq.escapeHtml(h)));var H,O=pq.getDataTypeFromVal(h),L=y.format.call(p,C,I,E,P)||y["fmt"+O],[N,V]=L?this.formatCell(h,L,y.localeFmt):[h,""];return O&&(w["text-align"]="right"),V&&(w.color=V),F=(F[_]||{}).fn,t.dataIndx=_,t.cellData=h,t.formatVal=N,(u=I.render)?(H=p.callFn(u,t))&&"string"!=typeof H&&((n=H.attr)&&v.push(S(n)),o=H.prop,(i=H.cls)&&b.push(i),(r=H.style)&&m(r,w),H=H.text):F&&0==F.indexOf("HYPERLINK")&&(H="<a href='"+(e=F.substring(11,F.indexOf('"',11)))+"' target='_blank'>"+(h||e)+"</a>"),null==H&&(u=I._renderG||I._render)&&(H=u.call(p,t)),null==H&&(d=E.inst)&&(t.prop=E,H=pq.RichObjs[d].render.call(p,t)),H&&"string"!=typeof H&&((n=H.attr)&&v.push(n),(i=H.cls)&&b.push(i),(r=H.style)&&m(r,w),f=H.outer,H=H.text),null==H&&(H=N??h),x?[H,r,o,(n||{}).title]:(o||={},a=E.align,(a=o.align||(null!=a?a:P.align||I.align))&&b.push("pq-align-"+a),a=E.valign,(a=o.valign||(null!=a?a:P.valign||I.valign))&&b.push("pq-valign-"+a),(c=(C.pq_cellcls||{})[_])&&b.push(c),(s=(C.pq_cellattr||{})[_])&&v.push(S(s,w)),w=(w=g(w))?" style='"+w+"' ":"",null==(H=pq.newLine(H))?H="":pq.isLink(H)&&b.push("pq-has-link"),["<div class='",b.join(" "),"' ",v.join(" "),w," >",D?H:"<div>"+H+"</div>",f||"","</div>"].join(""))}}}}(jQuery),function(t){var e,n=t.paramquery,r=n._pqGrid.prototype;r.getHeadCell=function(t){var e,n,r,i=this.iRenderHead.getCellIndx(t[0]),o=i[0],a=i[1];return null!=a&&null!=o&&(n=(this.headerCells[o]||[])[a])&&(r=n.colModel),r&&r.length&&(e=!0),{col:n||this.colModel[a],ci:a,ri:o,isParent:e}},r.flex=function(t){var e=this.colIndxs;t&&t.dataIndx&&(t.colIndx=t.dataIndx.map(function(t){return e[t]})),this.iResizeColumns.flex(t)},r.flexAsync=function(t){var n=this;cancelAnimationFrame(e),e=requestAnimationFrame(function(){n.flex(t)})},n.mixHeader={colCollapse:function(t,e){var n=this.that,r={column:t},i=t.collapsible;!1!==n._trigger("beforeColumnCollapse",e,r)&&(i.on=!i.on,!1!==n._trigger("columnCollapse",e,r)&&n.refresh({colModel:!0}))},onHeaderClick:function(e){var n,r,i,o,a=this,l=a.that,s=l.iDragColumns;if(l._trigger("headerClick",e),!s||"stop"==s.status){if((o=t(e.target)).is("input,label"))return!0;if((n=o.closest(".pq-grid-col,.pq-grid-number-cell")).length)if(r=(i=l.getHeadCell(n)).col,o.hasClass("pq-col-collapse"))a.colCollapse(r,e);else if(!i.isParent)return a.onHeaderCellClick(r,i.ci,e)}},getTitle:function(t,e){var n=t.title;return pq.isFn(n)?n.call(this.that,{column:t,colIndx:e,dataIndx:t.dataIndx}):n},createHeaderCell:function(t){var e,n,r=this,i=r.that,o=i.options,a=t.cls,l=t.style,s=t.attr,c=t.column,d=t.colIndx,u=r.getSortSpaceSpans(o.sortModel),h=c.collapsible,f=pq.styleStr,p=c.halign||c.align,g=c.hvalign,m=c.cls,v=(c.type,c.colModel),w=r.hasMenuH(o,c),x=null!=(x=r.getTitle(c,d))?x:c.dataIndx;return p&&a.push("pq-align-"+p),g&&a.push("pq-valign-"+g),(n=c.styleHead)&&l.push(f(n)),(n=c.attrHead)&&s.push(i.processAttr(n)),m&&a.push(m),a.push(c.clsHead),w&&a.push("pq-has-menu"),v&&v.length?h&&(a.push("pq-collapsible-th"),e=["<span class='pq-col-collapse pq-icon-hover ui-icon ui-icon-",h.on?"plus":"minus","'></span>"].join("")):c.empty||a.push("pq-grid-col-leaf"),s.push("pq-row-indx="+t.rowIndx+" pq-col-indx="+t.colIndx),c.pq_title=x,["<div ",s.join(" ")," "," class='",a.join(" "),"' style='",l.join(""),"' >","<div class='pq-td-div'>",e,"<span class='pq-title-span'>",x,"</span>",u,"</div>",w?"<span class='pq-icon-menu'></span>":"","</div>"].join("")},getSortSpaceSpans:function(t){if(t.on){var e=t.space?" pq-space":"";return["<span class='pq-icon-col-sort",e,"'></span>",t.number?"<span class='pq-col-sort-count"+e+"'></span>":""].join("")}return""},hasMenuH:function(t,e){var n=e.colModel;if(e.empty||n&&n.length)return!1;var r=t.menuIcon,i=e.menuIcon;return r&&!1!==i||!1!==r&&i},onHeaderCellClick:function(e,n,r){e=e||{};var i=this.that,o=i.options,a=o.sortModel,l=o.selectionModel,s=t(r.target),c=e.dataIndx;if(!1!==i._trigger("headerCellClick",r,{column:e,colIndx:n,dataIndx:c})&&-1!=n&&!s.closest(".pq-grid-header-search-row")[0])if(l.column&&l.type&&!s.hasClass("pq-title-span")&&!s.hasClass("ui-icon")){var d=i.getFirstVisibleRIP(),u={c1:n,firstC:n,firstR:d},h=i.iSelection,f=h.address(),p=f.length;if(pq.isCtrl(r))h.add(u);else{if(r.shiftKey){if(p&&"column"==f[p-1].type){var g=f[p-1];g.c1=g.firstC,g.c2=n,g.r1=g.r2=g.type=g.cc=void 0}u=f}i.Range(u,!1).select()}null!=(d=i.getFirstVisibleRIP(!0))&&(i.focus({rowIndxPage:d,colIndx:n}),i._trigger("mousePQUp"))}else(a.wholeCell||s.hasClass("pq-title-span"))&&i.isSortable(e)&&i.sort({sorter:[{dataIndx:c,sortIndx:e.sortIndx}],addon:!0,skipCustomSort:pq.isCtrl(r),tempMultiple:a.multiKey&&r[a.multiKey],evt:r})},setSortIcons:function(){var e=this.that,n=e.options.ui,r=e.headerCells.length-1;if(e.$head_i){var i=e.iSort.getSorter(),o=i.length,a=!1;e.options.sortModel.number&&o>1&&(a=!0);for(var l=0;l<o;l++){var s=i[l],c=s.dataIndx,d=e.getColIndx({dataIndx:c}),u="up"==s.dir;if(d>=0){var h=n.header_active+" pq-col-sort-"+(u?"asc":"desc"),f="ui-icon ui-icon-triangle-1-"+(u?"n":"s"),p=t(e.iRenderHead.getCell(r,d));p.addClass(h),p.attr("aria-sort",u?"ascending":"descending"),p.find(".pq-icon-col-sort").addClass(f),a&&p.find(".pq-col-sort-count").html(l+1)}}}}},n.cResizeColumns=function(e){var n=this;n.that=e,e.$head_i.on({mousedown:function(e){if(!e.pq_composed){var r=t(e.target);n.setDraggables(e),e.pq_composed=!0;var i=t.Event("mousedown",e);r.trigger(i)}},dblclick:function(t){n.doubleClick(t)}},".pq-grid-col-resize-handle");var r=e.options,i=r.flex;n.rtl=r.rtl?"right":"left",i.on&&i.one&&e.one("ready",function(){n.flex()})},n.cResizeColumns.prototype={doubleClick:function(e){var n=this.that.options,r=n.flex,i=t(e.target),o=parseInt(i.attr("pq-col-indx"));isNaN(o)||r.on&&this.flex(r.all&&!n.scrollModel.autoFit?{}:{colIndx:[o]})},flex:function(t){this.that.iRenderB.flex(t)},setDraggables:function(e){var n,r,i,o=t(e.target),a=this.that,l=this,s=l.rtl;o.draggable({axis:"x",helper:function(e,n){var r=t(e.target),i=parseInt(r.attr("pq-col-indx"));return l._setDragLimits(i),l._getDragHelper(e,n),r},start:function(t,e){r=t.clientX,i=parseInt(l.$cl[0].style[s]),n=a.getScale()[0]},drag:function(t,e){var o=(t.clientX-r)/n;"right"==l.rtl&&(o*=-1),l.$cl[0].style[s]=i+o+"px"},stop:function(t,e){return l.resizeStop(t,e,r)}})},_getDragHelper:function(e){var n=this.that,r=1*n.options.freezeCols,i=t(e.target),o=n.$grid_center,a=n.iRenderHead,l=1*i.attr("pq-col-indx"),s=l<r?0:a.scrollX(),c=o.outerHeight(),d=a.getLeft(l)-s,u=a.getLeft(l+1)-s,h="style='height:"+c+"px;"+this.rtl+":";this.$clleft=t("<div class='pq-grid-drag-bar' "+h+d+"px;'></div>").appendTo(o),this.$cl=t("<div class='pq-grid-drag-bar' "+h+u+"px;'></div>").appendTo(o)},_setDragLimits:function(e){if(!(e<0)){var n=this.that,r=n.iRenderHead,i=n.colModel[e],o=r.getLeft(e)+i._minWidth,a=o+i._maxWidth-i._minWidth,l=t(r._resizeDiv(e));l.draggable("instance")&&l.draggable("option","containment",[o,0,a,0])}},resizeStop:function(e,n,r){var i=this;i.$clleft.remove(),i.$cl.remove();var o=e.clientX-r,a=1*t(n.helper).attr("pq-col-indx");i.that.Columns().resize(a,o,e)}}}(jQuery),function(t){var e=t.paramquery;e.cDragColumns=function(e){var n,r,i=this,o=e.options,a=o.dragColumns||{},l=function(n,r){return t("<div class='pq-arrow-"+n+" ui-icon "+r+"'></div>").appendTo(e.$grid_center)};i.that=e,i.rtl=o.rtl,i.status="stop",i.$arrowTop=l("down",a.topIcon),i.$arrowBottom=l("up",a.bottomIcon),i.hideArrows(),a.enabled&&e.$head_i.draggable({distance:5,cursorAt:{top:-10,left:-10},cancel:".pq-grid-header-search-row,input,textarea,button,select,option,.pq-grid-number-cell",zIndex:"1000",appendTo:"body",revert:i.revert.bind(i),helper:function(r,o){var a=r.target.closest(".pq-grid-col");if(a){var l,s=i.colIndicesDrag=e.getHeadIndices(a),c=i.columnDrag=s.column,d=c.parent,u=e.options.dragColumns.rejectIcon,h=e.getScale();return n=pq.getScale(document.body),!c||c.nodrag||c._nodrag||d&&1==d.colSpan||c.empty||!1===e._trigger("columnDrag",r,{column:c})?"<span/>":(e.$head_i.find(".pq-grid-col-resize-handle").hide(),(l=i.$helper=t("<div class='pq-col-drag-helper pq-theme pq-grid-cell' ><div><span class='pq-drag-icon ui-icon "+u+"'></span>"+c.pq_title+"</div></div>")).data("di",c.dataIndx).css({scale:h[0]/n[0]+" "+h[1]/n[1]}),l[0])}return t("<div></div>")},start:function(){},drag:function(o,a){if(i.$helper){i.status="drag";var l,s=a.position,c=o.originalEvent,d=(c&&c.target!=document?c.target:o.target).closest(".pq-grid-col"),u=i.colIndicesDrag,h=u.ri,f=u.column,p=f.leftPos,g=p+f.o_colspan;if(s.left=s.left/n[0],s.top=s.top/n[1],d&&!d.closest(".pq-grid-header-search-row")&&e.evtBelongs(c)){var m=e.getHeadIndices(d),v=m.column,w=m.ri,x=m.colIndx;if(!(v.empty||v==f||v.nodrop||v._nodrop||h<w&&x>=p&&x<g))return r=d,i.colIndicesDrop=m,void i.onDrag(o,d);r!=d&&i.updateDragHelper(!1),r=d}else i.hideArrows(),l=t(".ui-droppable-hover",e.$top),i.updateDragHelper(!!l[0]);i.colIndicesDrop=null}},stop:function(t){if(i.status="stop",i.$helper){i.hideArrows();var n=i.colIndicesDrop;e.$head_i.find(".pq-grid-col-resize-handle").show(),n&&i.onDrop(i.colIndicesDrag,n,t)}}})},e.cDragColumns.prototype={revert:function(){(this.$helper||t()).hide("explode",function(){t(this).remove()})},getRowIndx:function(t,e,n){for(;n&&t[n][e]==t[n-1][e];)n--;return n},hideArrows:function(){this.$arrowTop.hide(),this.$arrowBottom.hide()},moveColumn:function(t,e,n,r,i){var o=this,a=o.that,l="colModel",s=a.options[l],c=a.headerCells,d=a.depth-1;r??=o.getRowIndx(c,t,d),i??=o.getRowIndx(c,e,d);var u=c[r][t],h=c[i][e],f=u.parent,p=h.parent,g=f?f[l]:s,m=p?p[l]:s,v=g.indexOf(u),w=n?0:1,x=m.indexOf(h);return a.iCols.move(1,v,x+w,f,p,"dnd")[0]},onDrop:function(t,e,n){var r,i=this,o=i.that,a=t.colIndx,l=t.ri,s=e.colIndx,c=e.ri,d=i.leftDrop;i.rtl&&(d=!d),!1!==o._trigger("beforeColumnOrder",null,{colIndxDrag:a,colIndxDrop:s,left:d})&&(r=i.moveColumn(a,s,d,l,c))&&o._trigger("columnOrder",null,{dataIndx:r.dataIndx,column:r,oldcolIndx:a,colIndx:o.getColIndx({column:r})})},onDrag:function(t,e){var n,r=this,i=e.offsetWidth,o=t.originalEvent.target;r.updateDragHelper(!0),n=t.offsetX+pq.offset(o,e).left<i/2,r.leftDrop=n,r.showFeedback(e,n)},showFeedback:function(t,e){var n=this.that,r=pq.offset(t,n.element[0]).left+(e?0:t.offsetWidth)-8,i=t.offsetTop-16,o=n.$header[0].offsetHeight;this.$arrowTop.css({left:r,top:i,display:""}),this.$arrowBottom.css({left:r,top:o,display:""})},updateDragHelper:function(t){var e=this.that.options.dragColumns,n="removeClass",r="addClass",i=e.acceptIcon,o=e.rejectIcon,a=this.$helper;a&&a[t?n:r]("ui-state-error").find(".pq-drag-icon")[t?r:n](i)[t?n:r](o)}}}(jQuery),function(t){t.paramquery.mixHeaderFilter={_input:function(t,e,n,r,i,o){var a=this.that,l=a.options,s=!l.filterModel.hideClearIcon;return e=a.format(e,"Filter",t),s&&(i+=` is="clear-text" ctitle='${l.strClear}'`),`<input type="text" value="${e}" name=${t.dataIndx} style="${r}" class="${n}" ${i} />`},_onKeyDown:function(e,n,r){var i,o=this,a=this.that;if(e.keyCode===t.ui.keyCode.TAB){var l,s,c=o.getCellIndx(r.closest(".pq-grid-col")[0])[1],d=a.colModel,u=e.shiftKey;if("textbox2"==((h=d[c]).filterUI||{}).type&&(a.scrollColumn({colIndx:c}),(i=o.getCellEd(c)[1])[0]==r[0]?u||(l=i[1]):u&&(l=i[0]),l))return l.focus(),e.preventDefault(),!1;for(;;){if(u?c--:c++,c<0||c>=d.length)break;var h,f=(h=d[c]).filter;if(!h.hidden&&f){s=!0,a.scrollColumn({colIndx:c},function(){var e=o.getCellEd(c)[1];"textbox2"==(h.filterUI||{}).type&&(e=t(u?e[1]:e[0])),e&&e.focus()});break}}return s||a[u?"focusHead":"focus"](),e.preventDefault(),!1}},_textarea:function(t,e,n,r,i){return["<textarea name='",t,"' style='"+r+"' class='"+n+"' "+i+" >",e,"</textarea>"].join("")},bindListener:function(e,n,r){var i=this.that,o=i.options,a=r.filter,l=pq.filter.getVal(a),s=l[0],c=l[1];for(var d in n){var u=n[d];pq.fakeEvent(e,d,o.filterModel.timeout),e.off(d).on(d,function(n){var o,a,l=r.filterUI,d=l.type,h=l.condition;"checkbox"==d?o=e.pqval({incr:!0}):"textbox2"==d?(o=t(e[0]).val(),a=t(e[1]).val()):o=e.val();var f=t=>""===t?void 0:i.deformatCondition(t,r,h);if(o=f(o),a=f(a),s!==o||c!==a)return s=o,c=a,(u=pq.getFn(u)).call(i,n,{column:r,dataIndx:r.dataIndx,value:o,value2:a})})}},betweenTmpl:function(t,e){return["<div class='pq-from-div'>",t,"</div>","<span class='pq-from-to-center'>-</span>","<div class='pq-to-div'>",e,"</div>"].join("")},createListener:function(t){var e={},n=this.that;return t.split(" ").forEach(t=>{e[t]=function(t,e){var r=e.column;n.filter({rules:[{dataIndx:r.filterIndx||e.dataIndx,condition:r.filter.condition,value:e.value,value2:e.value2}]})}}),e},getCellEd:function(e){var n=this.data.length-1,r=t(this.getCell(n,e)),i=r.find(".pq-grid-hd-search-field");return[r,i]},onCreateHeader:function(){var t=this;t.that.options.filterModel.header&&t.eachH(function(e){e.filter&&t.postRenderCell(e)})},onHeaderKeyDown:function(e,n){var r=t(e.originalEvent.target);return!r.hasClass("pq-grid-hd-search-field")||this._onKeyDown(e,n,r)},postRenderCell:function(e){var n=e.dataIndx,r=e.filterUI||{},i=e.filter,o=this,a=o.that,l=a.colIndxs[n],s=this.getCellEd(l),c=s[0],d=s[1];if(0!=d.length){var u=r.type,h="timeout change",f={button:"click",select:"change",checkbox:"change",textbox:h,textbox2:h},p=pq.filter.getVal(i)[0];"checkbox"==u?d.pqval({val:p}):"select"==u&&(p=p||[],t.isArray(p)||(p=[p]),p=i.title?i.title.call(a,p,e):(p=p.slice(0,25).map(function(t){return a.format(t,"Filter",e)})).join(", "),d.val(p)),d.on("keydown",function(e){e.keyCode==t.ui.keyCode.ESCAPE&&(a.focusHead({colIndx:l}),e.preventDefault())});var g=r.init,m=i.listener,v=i.listeners||[m||f[u]];for(var w of(g&&g.find(function(t){return a.callFn(t,{dataIndx:n,column:e,indx:0,filter:i,filterUI:r,$cell:c,$editor:d.filter(":visible")})}),v)){var x=typeof w,y={};"string"==x?w=o.createListener(w):"function"==x&&(y[f[u]]=w,w=y),o.bindListener(d,w,e)}}},getControlStr:function(t,e,n){var r=this.that,i=t.dataIndx,o=t.filter,a=" ui-corner-all",l=pq.filter.getVal(o),s=l[0],c=l[1],d=l[2],u={column:t,dataIndx:i,condition:d,indx:0},h=t.filterUI=pq.filter.getFilterUI(u,r),f=h.type,p="";"textbox2"==f&&(c=null!=c?c:"");var g="pq-grid-hd-search-field "+(h.cls||""),m=h.style||"",v="aria-labelledby="+this.getCellId(e-1,n),w=(h.attr||"")+" tabindex=-1 "+v;if(f&&f.indexOf("textbox")>=0)s=null!=s?s:"",g=g+" pq-search-txt"+a,p="textbox2"==f?this.betweenTmpl(this._input(t,s,g+" pq-from",m,w,d),this._input(t,c,g+" pq-to",m,w,d)):this._input(t,s,g,m,w,d);else if("select"===f){p="<input type='text' "+["name='",i,"' class='",g+=a,"' style='",m,"' ",w].join("")+" ><span class='ui-icon pq-dd-icon ui-icon-caret-1-s'></span>"}else if("checkbox"==f){p=["<input ",null==s||0==s?"":"checked=checked"," name='",i,"' type=checkbox class='"+g+"' style='"+m+"' "+w+" />"].join("")}else pq.isStr(f)&&(p=f);return p},renderFilterCell:function(t,e,n,r){var i,o,a=this,l=a.that.options,s=l.filterModel,c=t.cls,d=t.halign||t.align;return d&&r.push("pq-align-"+d),c&&r.push(c),r.push(t.clsFilter),t.filter?(o=a.getControlStr(t,e,n))&&r.push("pq-col-"+n):l.showHeader||"detail"!=t.type||(o=a.getTitle(t,n)),(i=a.hasMenu(s,t))&&r.push("pq-has-menu"),["<div class='pq-td-div' style='overflow:hidden;'>","",o,"</div>",i?"<span class='pq-icon-filter'></span>":""].join("")},hasMenu:function(t,e){var n=t.menuIcon,r=(e.filter||{}).menuIcon;return n&&!1!==r||!1!==n&&r}}}(jQuery),function(t){var e=t.paramquery.cRefresh=function(e){var n=this,r=e.eventNamespace;n.vrows=[],n.that=e,e.on("dataReadyDone",function(){n.addRowIndx(!0)}),t(window).on("resize"+r+" orientationchange"+r,n.onWindowResize.bind(n))};t.extend(e,{Z:function(){return(window.outerWidth-8)/window.innerWidth},cssZ:function(){return document.body.style.zoom},isFullScreen:function(){return document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||window.innerHeight==screen.height},isSB:function(){return t(document).height()>t(window).height()}}),t(document).one("pq:ready",function(){var n=e.Z,r=e.cssZ,i=n(),o=r();e.isZoom=function(){var t=n(),e=r();if(i!=t||o!=e)return i=t,o=e,!0};var a=e.isSB,l=a();pq.onResize(document.body,function(){var e=a();e!=l&&(l=e,t(window).trigger("resize",{SB:!0}))})}),t(window).on("resize",function(){e.isZoom&&(e.ISZOOM=e.isZoom())}),e.prototype={addRT:function(t){var e=this.that.options,n=e.dataModel,r=e.rowTemplate;if(r)for(var i,o=t||n.data,a=o.length;a--;)(i=o[a])&&pq.extendT(i,r)},addRowIndx:function(t){for(var e,n=this.that,r=n.options.dataModel.dataUF,i=n.get_p_data(),o=i.length;o--;)(e=i[o])&&(e.pq_ri=o);if(t&&r)for(o=r.length;o--;)delete r[o].pq_ri},move:function(){},setGridAndCenterHeightForFlex:function(){var t=this.that,e=t.element;e.height(""),t.$grid_center.height(""),t.dims.htGrid=e[0].offsetHeight-2},setGridWidthForFlex:function(){var t=this.that,e=t.options,n=this.maxWidthPixel,r=t.element,i=t.$toolPanel[0].offsetWidth+t.iRenderB.getFlexWidth();e.maxWidth&&i>=this.maxWidthPixel&&(i=n),t._trigger("contWd"),r.width(i+"px"),t.dims.wdGrid=i},_calcOffset:function(t){var e=/(-|\+)([0-9]+)/.exec(t);return e&&3===e.length?parseInt(e[1]+e[2]):0},setMax:function(t){var e=this.that,n=e.element,r=e.options[t];r?(r==parseInt(r)&&(r+="px"),n.css(t,r)):n.css(t,"")},refreshGridWidthAndHeight:function(){var e,n,r,i,o,a,l=this,s=l.that,c=s.options,d=s.dims,u=(c.width+"").indexOf("%")>-1,h=(c.height+"").indexOf("%")>-1,f=(c.maxHeight+"").indexOf("%")>-1,p="flex"==c.height,g=c.dimsRelativeTo,m=f&&p,v=(c.maxWidth+"").indexOf("%")>-1,w="flex"==c.width,x=v&&w,y=s.element,b=s.getScale(),C=b[0],q=b[1],I="fixed"==y.css("position");if(l.isReactiveDims()){if(!(a=(o=g?pq.isFn(g)?g.call(s):t(g):y.parent())[0]))return;s._parent2!=a&&(s._parent2=a,pq.onResize(a,l.onWindowResize.bind(l))),a==document.body||I?(r=t(window).width(),i=window.innerHeight||t(window).height(),I&&(r/=C,i/=q)):(r=pq.width(o),i=pq.height(o));var _=this._calcOffset,R=u?_(c.width):0,D=h?_(c.height):0;x?e=parseInt(c.maxWidth)*r/100:u&&(e=parseInt(c.width)*r/100+R),m?n=parseInt(c.maxHeight)*i/100:h&&(n=parseInt(c.height)*i/100+D)}e||(w&&c.maxWidth?v||(e=c.maxWidth):u||(e=c.width)),c.maxWidth&&(this.maxWidthPixel=e),n||(p&&c.maxHeight?f||(n=c.maxHeight):h||(n=c.height)),parseFloat(e)==e?(e=e<c.minWidth?c.minWidth:e,y.css("width",e)):"auto"===e&&y.width(e),parseFloat(n)==n&&(n=n<c.minHeight?c.minHeight:n,y.css("height",n)),d.wdGrid=pq.width(y),d.htGrid=pq.height(y)},isReactiveDims:function(){var t=this.that.options,e=t.width,n=t.height,r=t.maxWidth,i=t.maxHeight,o=function(t){return-1!=(t+"").indexOf("%")},a=o(e),l="auto"===e,s=o(n),c=o(r),d=o(i);return a||l||s||c||d},getParentDims:function(){var e,n,r=this.that,i=r.element,o=r._parent2,a=t(o);return o?(o==document.body||"fixed"==i.css("position")?(n=window.innerHeight||t(window).height(),e=t(window).width()):(n=a.height(),e=a.width()),[e,n]):[]},onWindowResize:function(n,r){var i,o,a,l,s,c=this,d=c.that,u=d.dims||{},h=u.htParent,f=u.wdParent,p=d.options,g=d.element;if(p&&!e.isFullScreen()&&!p.disabled&&!(t.support.touch&&p.editModel.indices&&t(document.activeElement).is(".pq-editor-focus")||r&&(s=r.$grid)&&(s==g||0==g.closest(s).length))){if(l=c.isReactiveDims(),e.ISZOOM)return c.setResizeTimer(function(){c.refresh({soft:!0})});l&&c.setResizeTimer(function(){if(a=c.getParentDims(),o=a[0],(i=a[1])==h&&o==f){if(parseInt(pq.width(g))==parseInt(u.wdGrid))return}else u.htParent=i,u.wdParent=o;c.refresh({soft:!0})})}},setResizeTimer:function(t){var e=this,n=e.that;clearTimeout(e._autoResizeTimeout),e._autoResizeTimeout=window.setTimeout(function(){n.element&&(t?t():e.refreshAfterResize())},n.options.autoSizeInterval||100)},refresh:function(t){t=t||{};var e,n,r=this,i=r.that,o=t.pager,a=!t.soft,l=i.element,s=i.$toolPanel,c=i.dims=i.dims||{htCenter:0,htHead:0,htSum:0,htBody:0,wdCenter:0,htTblSum:0};if(t.colModel&&i.refreshCM(),l[0].offsetWidth&&!i.isCollapsed()){s.css("height","1px"),t.toolbar&&i.refreshToolbar(),(e=i.options).collapsible._collapsed=!1,r.setMax("maxHeight"),r.setMax("maxWidth"),r.refreshGridWidthAndHeight(),a&&!1!==o&&i._refreshPager(),c.htCenter=r.setCenterHeight(),n=s[0].offsetWidth,c.wdCenter=c.wdGrid-n,i.$grid_center.css("margin"+(e.rtl||"left"==(e.sideBar||{}).align?"Left":"Right"),n),i.iRenderB.init(Object.assign({header:!0},t)),"flex"==e.height&&r.setGridAndCenterHeightForFlex(),"flex"==e.width&&r.setGridWidthForFlex();var d=this.getParentDims();c.wdParent=d[0],c.htParent=d[1],e.dataModel.postDataOnce=void 0,i._trigger("refreshFull")}else l.addClass("pq-pending-refresh")},setCenterHeight:function(){var t,e=this.that,n=e.$top,r=e.options;return("flex"!==r.height||r.maxHeight)&&(t=(t=e.dims.htGrid-(r.showTop?n[0].offsetHeight+parseInt(n.css("marginTop")):0)-e.$bottom[0].offsetHeight)>=0?t:"",e.$grid_center.height(t)),t}}}(jQuery),function(t){(t.paramquery.cCheckBoxColumn=function(e,n){var r,i,o=this;o.that=e,o.fns={},o.options=e.options,i=o.colUI=n;var a=(r=n.cbId?o.colCB=e.columns[n.cbId]:o.colCB=n).cb=t.extend({},{all:!1,header:!1,select:!1,check:!0,uncheck:!1},r.cb),l=r.dataIndx;i._render=o.cellRender(r,i),o.on("dataAvailable",function(){e.one("dataReady",o.oneDataReady.bind(o))}).on("dataReady",o.onDataReady.bind(o)).on("valChange",o.onCheckBoxChange(o)).on("cellKeyDown",o.onCellKeyDown.bind(o)).on("refreshHeader",o.onRefreshHeader.bind(o)).on("change",o.onChange.bind(o)),a.select&&o.on("rowSelect",o.onRowSelect(o,e)).on("beforeRowSelectDone",o.onBeforeRowSelect(o,e,l,a.check,a.uncheck)),o.on("beforeCheck",o.onBeforeCheck.bind(o))}).prototype=t.extend({cellRender:function(t,e){var n=this;return function(r){var i,o,a,l=r.rowData,s=t.dataIndx,c=t.cb,d=e.renderLabel,u=e.useLabel;if(!(l.pq_gtitle||l.pq_gsummary||r.Export))return i=c.check===l[s]?"checked":"",o=n.isEditable(l,t,r.rowIndx,this.colIndxs[s],s,r.rowIndxPage)?"":"disabled",d&&(a=d.call(this,r)),a??=t==e?"":r.formatVal||r.cellData,{text:[u?" <label>":"",`<input type='checkbox' tabindex='-1' aria-label="${i?"checked":"unchecked"}" `,i," ",o," />",a,u?"</label>":""].join("")}}},checkAll:function(t,e){t=null==t||t;var n=this.that,r=this.colCB.cb.all?n.options.dataModel.data:n.pdata;return this.checkNodes(r,t,e)},checkNodes:function(t,e,n){if(t.length){null==e&&(e=!0);for(var r,i,o=this,a=o.that,l=o.colUI.dataIndx,s=o.colCB,c=s.cb,d=c.select,u=c.header,h=d||u,f=c.history,p=c.useTxn,g=e?c.check:c.uncheck,m=s.dataIndx,v=a.colIndxs[m],w=a.riOffset,x=t[0],y=x.pq_ri,b=function(){return a.refreshCell({rowIndx:y,dataIndx:l}),!1},C=0,q=t.length,I=[];C<q;C++)(r=t[C])&&r[m]!=g&&o.isEditable(r,s,i=r.pq_ri,v,m,i-w)&&I.push({rowData:r,rowIndx:i});var _={rowIndx:y,rowData:x,dataIndx:l,check:e,rows:I,source:"checkbox"};if(!1===a._trigger("beforeCheck",n,_))return b();if(I=_.rows,p||0!=p&&!h){var R={source:"checkbox",updateList:I.map(function(t){var e={},n={},r=t.rowData;return e[m]=r[m],n[m]=g,{rowIndx:t.rowIndx,rowData:r,oldRow:e,newRow:n}})};if(R.history=R.track=f??(!h&&null),!1===a._digestData(R))return b()}else{for(C=0,q=I.length;C<q;C++)(r=I[C].rowData)[m]=g,d&&(r.pq_rowselect=e);q&&(d&&(_[e?"addList":"deleteList"]=I,a._trigger("rowSelect",n,_)),o.setValCBox(),a._trigger("check",n,_))}c.maxCheck||1!=I.length?a.refresh({header:!1,skipIndx:!0}):a.refreshRow(I[0])}},isEditable:function(t,e,n,r,i,o){return this.that.isEditable({rowIndx:n,rowData:t,column:e,colIndx:r,dataIndx:i,rowIndxPage:o,normalized:!0})},onBeforeRowSelect:function(t,e,n,r,i){return function(o,a){if("checkbox"!=a.source){var l=function(o){for(var a,l,s,c=e.riOffset,d=o.length,u=e.columns[n],h=e.colIndxs[n];d--;)a=(s=o[d]).rowIndx,l=s.rowData,t.isEditable(l,u,a,h,n,a-c)?l[n]=l.pq_rowselect?i:r:o.splice(d,1)};l(a.addList),l(a.deleteList)}}},onChange:function(t,e){var n=this,r=n.colCB,i=r.cb,o=n.that,a=[],l=[],s=n.colUI.dataIndx,c=r.dataIndx,d=i.check,u=function(e,n){e.length&&o._trigger("check",t,{rows:e,dataIndx:s,rowIndx:e[0].rowIndx,rowData:e[0].rowData,check:n})};n.setValCBox(),e.updateList.forEach(function(t){var e=t.newRow,n=t.oldRow;e.hasOwnProperty(c)&&(e[c]===d?a.push(t):n&&n[c]===d&&l.push(t))}),i.select&&o.SelectRow().update({addList:a,deleteList:l,source:"checkbox"}),u(a,!0),u(l,!1)},onCheckBoxChange:function(t){return function(e,n){if(n.dataIndx==t.colUI.dataIndx)return t.checkNodes([n.rowData],n.input.checked,e)}},onDataReady:function(){this.setValCBox()},off:function(){var t,e=this.fns,n=this.that;for(t in e)n.off(t,e[t]);this.fns={}},on:function(t,e){var n=this;return n.fns[t]=e,n.that.on(t,e),n},destroy:function(){for(var t in this.off(),this)delete this[t]},oneDataReady:function(){var t,e=this.that.get_p_data(),n=0,r=e.length,i=this.colCB,o=i.cb,a=i.dataIndx;if(null!=a&&e&&o.select)for(;n<r;n++)(t=e[n])&&(t[a]===o.check?t.pq_rowselect=!0:t.pq_rowselect&&(t[a]=o.check))},onRowSelect:function(t,e){return function(n,r){"checkbox"!=r.source&&(r.addList.length||r.deleteList.length)&&(t.setValCBox(),e.refresh({header:!1,skipIndx:!0}))}}},pq.mixin.ChkGrpTree)}(jQuery),function(t){var e=t.paramquery,n={options:{initSSFn:!0,stateColKeys:{width:1,filter:["crules","mode"],hidden:1},stateKeys:{height:1,width:1,freezeRows:1,freezeCols:1,groupModel:["dataIndx","collapsed","grandSummary"],pageModel:["curPage","rPP"],sortModel:["sorter"]},detailModel:{cache:!0,offset:100,expandIcon:"ui-icon-triangle-1-se",collapseIcon:"ui-icon-triangle-1-e",height:"auto"},dragColumns:{enabled:!0,acceptIcon:"ui-icon-check",rejectIcon:"ui-icon-closethick",topIcon:"ui-icon-circle-arrow-s",bottomIcon:"ui-icon-circle-arrow-n"},flex:{on:!0,one:!1,all:!0},track:null,mergeModel:{flex:!1},realFocus:!0,sortModel:{on:!0,type:"local",multiKey:"shiftKey",number:!0,single:!0,cancel:!0,sorter:[],useCache:!0,ignoreCase:!1},filterModel:{on:!0,newDI:[],type:"local",mode:"AND",header:!1,timeout:400,appendTo:function(){var t,e;return(t=this.widget().closest(".ui-dialog")[0])&&(e=t),e}}},_create:function(){var t,n=this,r=n.options;null==r.rtl&&(r.rtl="rtl"==n.element.css("direction")),n.listeners={},n._queueATriggers={},n.iHistory=new e.cHistory(n),n.iGroup=new e.cGroup(n),n.iMerge=new e.cMerge(n),n.iFilterData=new e.cFilterData(n),n.iSelection=new pq.Selection(n),n.iUCData=new e.cUCData(n),n.iMouseSelection=new e.cMouseSelection(n),n._super(),new e.cFormula(n),n.iDragColumns=new e.cDragColumns(n),n.refreshToolbar(),"remote"===r.dataModel.location&&n.refresh(),n.on("dataAvailable",function(){n.one("refreshDone",function(){n._trigger("ready"),clearTimeout(t),t=setTimeout(function(){n.element&&n._trigger("complete")},0)})}),n.refreshDataAndView({header:!0}),n.refreshCollapse()}};t.widget("paramquery.pqGrid",e._pqGrid,n),t.widget.extend=function(){var e,n,r=Array.prototype.shift,i=t.isPlainObject,o=t.isArray,a=t.widget.extend,l=r.apply(arguments);"boolean"==typeof l&&(e=l,l=r.apply(arguments));var s,c,d,u,h,f=arguments,p=0,g=f.length;for(null==e&&(e=g>1);p<g;p++)for(u in s=f[p])(c=(d=Object.getOwnPropertyDescriptor(s,u)).get)&&"reactiveGetter"!=c.name||d.set?Object.defineProperty(l,u,d):void 0!==(h=s[u])&&(n=!(p>0),i(h)?h.byRef?l[u]=h:(l[u]=l[u]||{},a(n,l[u],h)):o(h)?l[u]=e&&n?h.slice():h:l[u]=h);return l},pq.grid=function(e,n){var r=t(e).pqGrid(n);return r.data("paramqueryPqGrid")||r.data("paramquery-pqGrid")},e.pqGrid.regional={};var r=e.pqGrid.prototype;function i(t,e,n){for(var r=0,i=t.length;r<i;r++){for(var o,a=t[r],l={},s=0,c=e.length;s<c;s++)l[o=e[s]]=a[o];n.push(l)}}e.pqGrid.defaults=r.options,r.focusT=function(t){var e=this;setTimeout(function(){e.focus(t)})},r.focus=function(t){this.iKeyNav.focus(t)},r.focusHead=function(t){this.iKeyNav.focusHead(t)},r.focusSum=function(t){this.iKeyNav.focusSum(t)},r.getFocus=function(){return this.iKeyNav.getFocus()},r.callFn=function(t,e){return pq.getFn(t).call(this,e)},r.rowExpand=function(t){this.iHierarchy.rowExpand(t)},r.rowInvalidate=function(t){this.iHierarchy.rowInvalidate(t)},r.rowCollapse=function(t){this.iHierarchy.rowCollapse(t)},r.Detail=function(){return this.iHierarchy},r.isFrozenPane=function(){var t=this.options;return t.freezeRows||t.freezeCols},r.unfreezePanes=function(){var t=this.options;t.freezeRows=0,t.freezeCols=0,this.refresh()},r.freezeTopRow=function(){this.options.freezeRows=this.getFirstVisibleRIP()+1,this.refresh()},r.freezeFirstCol=function(){this.options.freezeCols=this.getFirstVisibleCI()+1,this.refresh()},r._saveState=function(e,n,r){var i,o,a,l,s=this;for(i in r)(o=r[i])&&(a=e[i],t.isArray(o)?null!=a&&(l=n[i]=t.isPlainObject(n[i])?n[i]:{},o.forEach(function(t){l[t]=a[t]})):a&&"colModel"==i?(n[i]=[],a.forEach(t=>{var e={};n[i].push(e),s._saveState(t,e,r)})):n[i]=a)},r.saveState=function(e){e=e||{};var n,r,i,o,a=this,l=a.element,s=a.options,c=t.extend({},s.stateColKeys,{colModel:1,dataIndx:1,title:1}),d=s.stateKeys,u=s.colModel,h=[],f=l[0].id;for(r of u)i={},a._saveState(r,i,c),h.push(i);return o={colModel:h,datestamp:Date.now()},a._saveState(s,o,d),(n=e.extra)&&(o=t.extend(!0,o,n)),!1!==e.stringify&&(o=JSON.stringify(o),!1!==e.save&&"undefined"!=typeof Storage&&localStorage.setItem("pq-grid"+(f||""),o)),o},r.getState=function(){if("undefined"!=typeof Storage)return localStorage.getItem("pq-grid"+(this.element[0].id||""))},r.loadState=function(e){e=e||{};var n,r=this,i=t.widget.extend,o=e.state||r.getState();if(!o)return!1;pq.isStr(o)&&(o=JSON.parse(o));var a=o.colModel,l="pid"+Math.random(),s={},c={},d={},u=r.options,h=t=>t.dataIndx||t.title,f=u.stateColKeys,p=u.colModel,g=(t,e,n,r)=>{var i=n[e]={};t.forEach((t,o)=>{var a=h(t);t.parentId=e,r[a]=t,i[a]=o,t.colModel&&g(t.colModel,a,n,r)})};for(var m in g(a,l,c,s),d[l]={colModel:p},g(p,l,{},d),d){var v=s[m],w=d[m];if(v){if(w.parentId!=v.parentId){var x=d[w.parentId],y=d[v.parentId];y&&(x.colModel.splice(x.colModel.indexOf(w),1),y.colModel.push(w))}r._saveState(v,w,f)}}return function t(e,n){var r=c[n];r&&e.sort(function(t,e){return r[h(t)]-r[h(e)]}),e.forEach(e=>{delete e.parentId;var n=e.colModel||[];n.length&&t(n,h(e))})}(p,l),r.iCols.init(),i(u.sortModel,o.sortModel),i(u.pageModel,o.pageModel),r.Group().option(o.groupModel,!1),r.Tree().option(o.treeModel,!1),n={freezeRows:o.freezeRows,freezeCols:o.freezeCols},isNaN(1*u.height)||isNaN(1*o.height)||(n.height=o.height),isNaN(1*u.width)||isNaN(1*o.width)||(n.width=o.width),r.option(n),!1!==e.refresh&&r.refreshDataAndView(),!0},r.refreshToolbar=function(){var e,n=this,r=n.options,i=r.toolbar;if(n._toolbar&&(e=n._toolbar).destroy(),i){var o=i.cls||"",a=i.style||"",l=`role="toolbar" aria-controls="${n.grid_id}" `+(i.attr||""),s=i.items,c=t("<div class='"+o+"' style='"+a+"' "+l+" ></div>");e?e.widget().replaceWith(c):n.$top.append(c),e=pq.toolbar(c,{items:s,gridInstance:n,bootstrap:r.bootstrap}),r.showToolbar||c.css("display","none"),n._toolbar=e}},r.filter=function(t){return this.iFilterData.filter(t)},r.Checkbox=function(t){return this.iCheckBox[t]},r.refreshHeader=function(){this.iRenderHead.refreshHS()},r.refreshSummary=function(){this.iRenderSum.refreshHS()},r.refreshHeaderFilter=function(t){var e=this.normalize(t),n=e.colIndx,r=e.column,i=this.iRenderHead,o=i.rows-1;this.options.filterModel.header&&(i.refreshCell(o,n,{},r),i.postRenderCell(r,n,o))},r.pageData=function(){return this.pdata},r.getData=function(t){var e=(t=t||{}).dataIndx,n=e?e.length:0,r=t.data,o=!n,a=this.columns,l=this.options.dataModel,s=l.dataPrimary||l.data||[],c=l.dataUF||[],d=[];if(!n)return c.length?s.concat(c):s;r?i(r,e,d):(i(s,e,d),i(c,e,d));for(var u=[],h=e.reduce(function(t,e){var n=a[e];return n&&t.push({dataIndx:e,dir:"up",dataType:n.dataType,sortType:n.sortType}),t},[]),f={},p=0,g=d.length;p<g;p++){var m=d[p],v=JSON.stringify(m);f[v]||(u.push(m),f[v]=1)}return u=this.iSort._sortLocalData(h,u,o)},r.getPlainOptions=function(e,n){var r=e[0];if(t.isPlainObject(r)){var i=Object.keys(r);i[0]!=n&&1==i.length&&(e=e.map(function(t){var e,r={};for(e in t)r[n]=e,r.pq_label=t[e];return r}))}else e=e.map(function(t){var e={};return e[n]=t,e});return e},r.getDataCascade=function(t,e,n){var r,i,o=this,a=o.options.filterModel,l=a.newDI.slice(),s=e?[e,t]:[t],c=l.indexOf(t);return"AND"==a.mode&&l.length&&"remote"!=a.type&&(c>=0&&l.splice(c,l.length),l.length&&(r=l.map(function(t){var e=o.getColumn({dataIndx:t}).filter;return{dataIndx:t,crules:e.crules||[e],mode:e.mode}}),i=o.filter({data:o.getData(),mode:"AND",rules:r}))),s=s.concat(n||[]),o.getData({data:i,dataIndx:s})},r.removeNullOptions=function(t,e,n){var r;return null==n?t.filter(function(t){var n=t[e];return null!=n&&""!==n||(r?void 0:(r=!0,t[e]="",!0))}):t.filter(function(t){var n=t[e];return null!=n&&""!==n})},r.get_p_data=function(){var t,e,n,r,i=this.options,o=i.pageModel,a=o.type,l=i.dataModel.data,s=this.pdata,c=[];return a?(e=o.rPP,n=this.riOffset||0,!s.length&&l.length&&(s=l.slice(n,n+e)),c=(t="remote"==a)?new Array(n):l.slice(0,n),r=t?[]:l.slice(n+e),c.concat(s,r)):s.length?s:l},r._onDataAvailable=function(t){t=t||{};var e=this,n=e.options,r=!t.data,i=t.source,o=t.sort,a=[],l=n.filterModel,s=n.dataModel,c=n.sortModel;if(e.iRefresh.addRT(t.data),!1!==r&&(e.pdata=[],!1!==t.trigger&&e._trigger("dataAvailable",t.evt,{source:i})),a=l&&l.on&&"local"==l.type&&0!=t.filter?e.iFilterData.filterLocalData(t).data:s.data,e.$grid_role.attr({"aria-rowcount":a.length+e.headerCells.length,"aria-colcount":e.colModel.length}),"local"==c.type&&!1!==o&&(r?e.sort({refresh:!1}):a=e.iSort.sortLocalData(a,!0)),!1===r)return a;e.refreshView(t)},r.reset=function(e){var n,r,i=this,o=(e=e||{}).sort,a=i.options,l=!1!==e.refresh,s=t.extend,c=e.filter,d=e.group;(o||c||d)&&(o&&(n=!0===o?{sorter:[]}:o,s(a.sortModel,n)),c&&!l&&this.iFilterData.clearFilters(i.colModel),d&&(r=!0===d?{dataIndx:[]}:d,i.groupOption(r,!1)),l&&(c?(i.filter({oper:"replace",rules:[]}),i.refreshHeader()):o?i.sort():i.refreshView()))},r._trigger=e._trigger,r.on=e.on,r.one=e.one,r.off=e.off,r.pager=function(){var t;return this.pageI=this.pageI||((t=this.widget().find(".pq-pager")).length?t.pqPager("instance"):null),this.pageI},r.toolbar=function(t){var e=(this._toolbar||{}).element;return t?e.find(t):e},r.Columns=function(){return this.iCols}}(jQuery),function(t){var e=t.paramquery;e.cColModel=function(t){this.that=t,this.vciArr,this.ciArr,this.init()},e.cColModel.prototype={add:function(t,e,n,r){var i,o,a=this,l=a.that,s=(n=n||l.options.colModel,e=null==e?n.length:e,{args:arguments}),c=t.length,d=[e,0].concat(t);!1!==l._trigger("beforeColAdd",null,s)&&("undo"==r||"redo"==r||l.iHistory.push({callback:function(n){o=(i||{}).colModel,n?a.add(t,e,o,"redo"):a.remove(c,e,o,"undo")}}),n.splice.apply(n,d),l.refreshCM(),i=n[0].parent,l._trigger("colAdd",null,s),l.refresh())},resize:function(t,e,n){var r,i=this.that,o=i.colModel,a=i.options,l=a.numberCell;if(a.rtl&&(e*=-1),-1==t){r=null;var s=(c=l.outerWidth)+e;l.width=s}else{r=o[t];var c;s=(c=parseInt(r.width))+e;r.width=r._width=s,r._resized=!0}i.refresh({soft:!0}),i._trigger("columnResize",n,{colIndx:t,column:r,dataIndx:r?.dataIndx,oldWidth:c,newWidth:r?r.width:l.width})},move:function(t,e,n,r,i,o){var a,l=this,s={args:arguments},c=l.that,d=c.options,u=[],h=d.colModel,f=r?.colModel||h,p=i?.colModel||h;return!1!==c._trigger("beforeColMove",null,s)&&(d.historyModel.skipColMove||"undo"==o||"redo"==o||c.iHistory.push({callback:function(o){o?l.move(t,e,n,r,i,"redo"):l.move(t,a,f==p&&e>a?e+t:e,i,r,"undo")}}),u=f.splice(e,t),a=f==p&&n>e+t?n-t:n,p.splice.apply(p,[a,0].concat(u)),c.refreshCM(),c._trigger("colMove",null,s),c.refresh({skipIndx:!0})),u},remove:function(t,e,n,r){var i,o,a=this,l={args:arguments},s=a.that,c=(s.iCheckBox,(n=n||s.options.colModel)[0].parent);!1!==s._trigger("beforeColRemove",null,l)&&("undo"==r||"redo"==r||s.iHistory.push({callback:function(n){o=(c||{}).colModel,n?a.remove(t,e,o,"redo"):a.add(i,e,o,"undo")}}),i=n.splice(e,t),s.refreshCM(),s._trigger("colRemove",null,l),s.refresh())},alter:function(t){var e=this.that;t.call(e),e.refreshCM(),e.refresh()},setRowSpan:function(t){for(var e,n,r,i,o=t[0].length,a=t.length,l=0;l<o;l++)for(n=0;n<a;n++)if(e=t[n][l],!(l>0&&e==t[n][l-1]||n>0&&e==t[n-1][l])){for(i=1,r=n+1;r<a;r++)e==t[r][l]&&i++;e.rowSpan=i}return t},noRowSpan:function(t){for(var e,n,r,i=t[0].length,o=t.length,a=0;a<i;a++)for(r=0;r<o;r++)(e=t[r][a])==(n=(t[r+1]||{})[a])?t[r][a]={hidden:n.hidden,empty:!0}:e.rowSpan=1;return t},autoGenColumns:function(){var e=this.that.options,n=e.columnTemplate||{},r=n.dataType,i=n.title,o=n.width,a=e.dataModel.data,l=pq.valid,s=[];if(a&&a.length){var c=a[0];t.each(c,function(t,e){var n="string";l.isInt(e)?n=e+"".indexOf(".")>-1?"float":"integer":l.isDate(e)?n="date":l.isFloat(e)&&(n="float"),s.push({dataType:r||n,dataIndx:t,title:i||t,width:o||100})})}e.colModel=s},cacheIndices:function(){for(var t,e=this,n=e.that,r="JSON"==e.getDataType(),i={},o={},a={},l=n.colModel,s=0,c=l.length,d=0,u=e.vciArr=[],h=e.ciArr=[];s<c;s++){var f=l[s],p=f.dataIndx;null==p&&("pq_detail"==(p="detail"==f.type?"pq_detail":r?"dataIndx_"+s:s)&&(f.dataType="object"),f.dataIndx=p),i[p]=f,o[p]=s,f.validations&&(a[p]=a),f.hidden||(h[d]=s,u[s]=d,d++),f.align||!(t=f.dataType)||"integer"!=t&&"float"!=t||(f.align="right")}n.columns=i,n.colIndxs=o,n.validations=a},collapse:function(t){var e,n,r,i=t.collapsible,o=i.on||!1,a=t.colModel||[],l=a.length,s=l,c=0,d=i.last,u=d?l-1:0;if(l){for(;s--;)e=a[s],null===d?(r=e.showifOpen===o)&&c++:r=u!==s&&o,e.hidden=r,r||!(n=e.colModel)||e.collapsible||this.each(function(t){t.hidden=r},n);c==l&&this.each(function(t){t.hidden=!1},[a[0]])}},each:function(t,e,n){var r=this.that,i=n||0;(e||r.options.colModel).forEach(function(e,n){t.call(r,e,n,i),e.colModel&&this.each(t,e.colModel,i+1)},this)},extend:function(t,e){for(var n=t.length;n--;){var r=t[n];e&&pq.extendT(r,e)}},find:function(t,e){for(var n,r,i=this.that,o=e||i.options.colModel,a=0,l=o.length;a<l;a++){if(n=o[a],t.call(i,n))return n;if(n.colModel&&(r=this.find(t,n.colModel)))return r}},getHeaderCells:function(t){for(var e,n,r,i,o=this,a=o.that.options,l=o.nestedCols(t),s=l.depth,c=l.colModel,d=c.length,u=[],h=0;h<s;h++){u[h]=[];var f=0,p=0;for(n=0;n<d;n++){if(0==h)r=t[f];else{var g=u[h-1][n],m=g.colModel;if(m&&0!=m.length){var v=n-g.leftPos,w=0,x=0;for(i=0;i<m.length;i++)if(v<(w+=m[i].childCount>0?m[i].childCount:1)){x=i;break}r=m[x]}else r=g}e=r.childCount||1,n==p?(r.leftPos=n,u[h][n]=r,p+=e,t[f+1]&&f++):u[h][n]=u[h][n-1]}}return o[a.rowSpanHead?"setRowSpan":"noRowSpan"](u),[u,c]},getDataType:function(){var t=this.colModel;if(t&&t[0]){var e=t[0].dataIndx;return pq.isStr(e)?"JSON":"ARRAY"}},getci:function(t){return this.ciArr[t]},getvci:function(t){return this.vciArr[t]},getNextVisibleCI:function(t,e){for(var n=this.vciArr,r=e?.[t-1],i=this.that.colModel.length;t<i;t++)if(null!=n[t]&&(!r||e[t]!=r))return t},getPrevVisibleCI:function(t,e){for(var n=this.vciArr,r=e?.[t+1];t>=0;t--)if(null!=n[t]&&(!r||e[t]!=r))return t},getLastVisibleCI:function(){var t=this.ciArr;return t[t.length-1]},getVisibleTotal:function(){return this.ciArr.length},hide:function(t){var e=this.that,n=e.columns;t.diShow=t.diShow||[],t.diHide=t.diHide||[],!1!==e._trigger("beforeHideCols",null,t)&&(t.diShow=t.diShow.filter(function(t){var e=n[t];if(e.hidden)return delete e.hidden,!0}),t.diHide=t.diHide.filter(function(t){var e=n[t];if(!e.hidden)return e.hidden=!0,!0}),e._trigger("hideCols",null,t),e.refresh({colModel:!0}))},init:function(t){var e,n,r,i=this,o=i.that,a=o.options,l=a.columnTemplate,s=a.colModel;s||(i.autoGenColumns(),s=a.colModel),n=i.getHeaderCells(s),e=o.headerCells=n[0],o.depth=e.length,r=o.colModel=n[1],l&&i.extend(r,l),i.cacheIndices(),i.initTypeColumns(),o._trigger("CMInit",null,t)},initTypeColumns:function(){var t,n=this.that,r=n.colModel,i=0,o=r.length,a=n.columns,l=n.iCheckBox=n.iCheckBox||{};for(t in l)l[t].colUI!=a[t]&&(l[t].destroy(),delete l[t]);for(;i<o;i++){var s=r[i],c=s.type;c&&("checkbox"==c||"checkBoxSelection"==c?(t=s.dataIndx,s.type="checkbox",l[t]=l[t]||new e.cCheckBoxColumn(n,s)):"detail"!=c||n.iHierarchy||(s.dataIndx="pq_detail",n.iHierarchy=new e.cHierarchy(n,s)))}},nestedCols:function(t,e,n,r){for(var i=t.length,o=[],a="skipExport",l=0,s=e=e||1,c=0,d=0,u=0;l<i;l++){var h,f=t[l],p=f.colModel;f.parent=r,!0===n&&(f.hidden=n),r&&r[a]&&null==f[a]&&(f[a]=!0),p&&p.length?(f.collapsible&&this.collapse(f),h=this.nestedCols(p,e+1,f.hidden,f),o=o.concat(h.colModel),h.colSpan>0?(h.depth>s&&(s=h.depth),f.colSpan=h.colSpan,c+=h.colSpan):f.colSpan=0,u+=h.o_colspan,f.o_colspan=h.o_colspan,f.childCount=h.childCount,d+=h.childCount):(f.hidden?f.colSpan=0:(f.colSpan=1,c++),u++,f.o_colspan=1,f.childCount=0,d++,o.push(f))}return{depth:s,colModel:o,colSpan:c,width:0,childCount:d,o_colspan:u}},reduce:function(t,e){var n=this.that,r=[];return(e||n.options.colModel).forEach(function(e,i){var o,a,l=t.call(n,e,i);l&&((a=l.colModel)&&a.length?(o=this.reduce(t,a)).length&&(l.colModel=o,r.push(l)):r.push(l))},this),r},reverse:function(t){var e,n=this,r=n.that;(t||r.options.colModel).reverse().forEach(function(t){(e=t.colModel)&&n.reverse(e)}),t||r.refreshCM()}}}(jQuery),function(t){function e(t,e){var n,r=this,i=t.options.detailModel;r.that=t,r.type="detail",r.refreshComplete=!0,r.rowHtDetail="auto"==(n=i.height)?1:n,t.on("cellClick headerCellClick cellKeyDown",r.onClick.bind(r)).on("beforeViewEmpty",r.onBeforeViewEmpty.bind(r)).on("autoRowHeight",r.onAutoRowHeight.bind(r)).one("render",function(){t.iRenderB.removeView=r.removeView(r,t),t.iRenderB.renderView=r.renderView(r,t)}).one("destroy",r.onDestroy.bind(r)).on("columnResize",r.onColumnResize.bind(r)),e._render=r.renderCell.bind(r),i.header&&(e.title=function(){return"<div class='pq-icon-detail ui-icon "+(i.expandAll?i.expandIcon:i.collapseIcon)+"'></div>"})}t.extend(t.paramquery.pqGrid.prototype,{parent:function(){return this._parent},child:function(t){return((this.normalize(t).rowData||{}).pq_detail||{}).child}}),t.paramquery.cHierarchy=e,e.prototype={detachCells:function(t){t.children().detach(),t.remove()},onColumnResize:function(){var e=this,n=e.getPadding();e.that.iRenderB.eachV(function(r,i){t("#"+e.getId(i)).css(n)})},getCls:function(){return"pq-detail-cont-"+this.that.uuid},getId:function(t){return"pq-detail-"+t+"-"+this.that.uuid},getRip:function(t){return 1*t.id.split("-")[2]},onAutoRowHeight:function(){var e=this,n=this.that.iRenderB;n.$ele.find("."+e.getCls()).each(function(r,i){var o=e.getRip(i),a=n.getHeightCell(o);t(i).css("top",a)})},onBeforeViewEmpty:function(t,e){var n=e.rowIndxPage,r=this.that.iRenderB,i=e.region,o=n>=0?"#"+this.getId(n):"."+this.getCls(),a=n>=0?r.$ele.find(o):r["$c"+i].find(o);this.detachCells(a)},onDestroy:function(){(this.that.getData()||[]).forEach(function(t){t.child&&t.child.remove()})},onResize:function(t,e){var n,r=[];pq.onResize(e[0],function(){var i=t.that.widget();i&&!i.is(":hidden")&&(r.push(e[0]),clearTimeout(n),n=setTimeout(function(){var e=t.that.pdata,n=[];r.forEach(function(r){if(document.body.contains(r)){var i=t.getRip(r),o=r.offsetHeight,a=e[i],l=a.pq_detail.height||t.rowHtDetail;l!=o&&(a.pq_detail.height=o,n.push([i,o-l]))}}),r=[],n.length&&(t.that._trigger("onResizeHierarchy"),t.softRefresh(n))},150))})},removeView:function(e,n){var r=n.iRenderB.removeView;return function(n,i,o){var a,l,s,c=r.apply(this,arguments),d=e.getCls(),u=this.getCellRegion(n,o);for(a=n;a<=i;a++)(l=this.getRow(a,u))&&1==l.children.length&&1==(s=t(l).children("."+d)).length&&(e.detachCells(s),l.parentNode.removeChild(l));return c}},getPadding:function(){var t=this.that,e=t.options,n={},r=t.dims.wdContLeft+5;return n["padding"+(e.rtl?"Right":"Left")]=r,n},renderView:function(e,n){var r=n.iRenderB.renderView;return function(i,o,a,l){var s,c,d=r.apply(this,arguments),u=n.iRenderB,h=e.getCls()+" pq-detail",f=n.options,p=e.getPadding(),g=f.freezeRows,m=f.detailModel,v=m.init,w=this.data;if(e.refreshComplete){for(e.refreshComplete=!1,s=i;s<=o;s++)if((c=w[s])&&!c.pq_hidden){var x=c.pq_detail=c.pq_detail||{},y=x.show,b=x.child;if(!y)continue;b||pq.isFn(v)&&(b=v.call(n,{rowData:c}),x.child=b);var C=b.parent(),q=u.getHeightCell(s),I="position:absolute;left:0;top:"+q+"px;padding:5px;width:100%;overflow:hidden;";if(C.length){if(!document.body.contains(C[0]))throw"incorrectly detached detail";C.css({top:q})}else C=t("<div role='gridcell' id='"+e.getId(s)+"' class='"+h+"' style='"+I+"'></div>").append(b),t(u.getRow(s,s<g?"tr":"right")).append(C),"auto"==m.height&&e.onResize(e,C);C.css(p);for(var _,R,D=C.find(".pq-grid"),M=0,S=D.length;M<S;M++)(R=(_=t(D[M])).pqGrid("instance"))._parent=n,_.hasClass("pq-pending-refresh")&&_.is(":visible")&&(_.removeClass("pq-pending-refresh"),R.refresh())}return e.refreshComplete=!0,d}}},renderCell:function(t){var e=this.that,n=e.options.detailModel,r=n.hasChild,i=t.cellData,o="",a=t.rowData;return a.pq_gsummary||a.pq_gtitle||r&&!r.call(e,a)||(o="<div class='pq-icon-detail ui-icon "+(i&&i.show?n.expandIcon:n.collapseIcon)+"'></div>"),o},rowInvalidate:function(t){var e=this.that.getRowData(t),n="pq_detail",r=e[n],i=r?r.child:null;i&&(i.remove(),e[n].child=null)},rowExpand:function(t){var e,n=this.that,r=n.normalize(t),i=n.options,o=r.rowData,a=r.rowIndxPage,l=i.detailModel,s="pq_detail";if(o){if(!1===n._trigger("beforeRowExpand",null,r))return;(e=o[s]=o[s]||{}).show=!0,l.cache||this.rowInvalidate(r),this.softRefresh([[a,e.height||this.rowHtDetail]],r)}},rowCollapse:function(t){var e=this.that,n=e.options,r=e.normalize(t),i=r.rowData,o=r.rowIndxPage,a=n.detailModel,l=i?i.pq_detail:null;if(l&&l.show){if(r.close=!0,!1===e._trigger("beforeRowExpand",null,r))return;a.cache||this.rowInvalidate(r),l.show=!1,this.softRefresh([[o,-(l.height||this.rowHtDetail)]],r)}},softRefresh:function(t,e){var n=this.that,r=n.iRenderB;r.initRowHtArrDetailSuper(t),r.setPanes(),r.setCellDims(!0),e&&n.refreshRow(e),r.refresh()},onClick:function(e,n){var r=n.column,i=e.originalEvent,o=e.keyCode,a=t.ui.keyCode,l=i.type;r&&r.type==this.type&&("click"==l&&t(i.target).hasClass("ui-icon")||o==a.ENTER||o==a.SPACE)&&this[n.rowData?"toggle":"toggleAll"](n,e)},toggle:function(t,e){var n=t.rowData,r=t.rowIndx;n.pq_gtitle||n.pq_gsummary||this[(n.pq_detail||{}).show?"rowCollapse":"rowExpand"]({rowIndx:r})},toggleAll:function(){var t,e=this,n=e.that,r=n.options.detailModel,i=r.hasChild,o=!r.expandAll,a=[];n.pdata.forEach(function(r,l){if(!i||i.call(n,r,l)){var s=r.pq_detail=r.pq_detail||{};s.show!=o&&(s.show=o,t=s.height||e.rowHtDetail,a.push([l,o?t:-1*t]))}}),r.expandAll=o,e.softRefresh(a),n.refresh()}}}(jQuery),function(t){var e=function(t){var e=this;e.that=t,e.class="pq-grid-overlay",e.rtl=t.options.rtl?"right":"left",e.ranges=[],e.borders=[],e.clsDotBorder="dotted-border",t.on("setTblDims",e.onRefresh(e,t))};t.paramquery.cCells=e,e.prototype={addBlock:function(t){t&&this.addUnique(this.ranges,t)&&this._addBlock(t)},_addBlock:function(t,e){var n=this.that,r=n.options,i=t.r1,o=t.c1,a=t.r2,l=t.c2,s=(e?"":"ui-state-highlight ")+this.serialize(i,o,a,l),c=s,d=s+" pq-number-overlay",u=s+" pq-head-overlay",h=n.iRenderB,f=function(t,e){return h.getCellCont(t,e)},p=this.shiftRC(i,o,a,l);if(p){t.cls&&(c+=" "+t.cls),i=p[0],o=p[1],a=p[2],l=p[3];var g,m,v,w,x,y,b,C,q,I,_,R=f(i,o),D=f(a,l);y=(p=h.getCellXY(i,o))[0],b=p[1],C=(p=h.getCellCoords(a,l))[2],I=(q=p[3])-b,_=C-y,_--,I--;var M=t.style||"",S=t=>"border-"+t+":0;"+M,T=S("top"),F=S("right"),k=S("bottom"),E=S("left");if(R==D?this.addLayer(y,b,I,_,c,R,(_?"":E+F)+(I?"":T+k)+M):(g=f(i,l),m=f(a,o),v=R[0].offsetWidth,x=R[0].offsetHeight+2,w=v+2,m==R?(this.addLayer(y,b,I,w,c,R,F),this.addLayer(0,b,I,C,c,D,E)):R==g?(this.addLayer(y,b,x,_,c,R,k),this.addLayer(y,0,q,_,c,D,T)):(this.addLayer(y,b,x,w,c,R,F+k),this.addLayer(0,b,x,C,c,g,k+E),this.addLayer(y,0,q,w,c,m,T+F),this.addLayer(0,0,q,C,c,D,E+T))),!e&&(_=r.numberCell.outerWidth||0,this.addLayer(0,b,I,_,d,h.$clt,""),this.addLayer(0,b,I,_,d,h.$cleft,""),0!=r.showHeader)){y=(p=(h=n.iRenderHead).getCellXY(0,o))[0],b=p[1],C=(p=h.getCellCoords(n.headerCells.length-1,l))[2],I=(q=p[3])-b,_=C-y;var P=h.$cright;this.addLayer(y,b,I,_,u,P,""),P=h.$cleft,this.addLayer(y,b,I,_,u,P,"")}}},addLayer:function(e,n,r,i,o,a,l){var s=this.rtl+":"+e+"px;top:"+n+"px;height:"+r+"px;width:"+i+"px;"+(l||"");t(`<svg class="${this.class} ${o}" style="${s}"></svg>`).appendTo(a)},addUnique:function(t,e){if(!t.filter(function(t){return e.r1==t.r1&&e.c1==t.c1&&e.r2==t.r2&&e.c2==t.c2})[0])return t.push(e),!0},addBorder(t){var e,n=this.borders,r=(t,e)=>`linear-gradient(${t} ${e} 50%, transparent 50%)`;t.forEach(t=>{if(this.addUnique(n,t)){if(t.cls=(t.cls||"")+" "+this.clsDotBorder,e=t.color){var i=r("90deg,",e),o=r("",e),a=`background-image:${i},${i},${o},${o};`;t.style=a}this._addBlock(t,!0)}})},removeBorders(){this.borders.slice().forEach(t=>{this.removeBlock(t,!0)})},getLastVisibleFrozenCI:function(){for(var t=this.that,e=t.colModel,n=t.options.freezeCols-1;n>=0;n--)if(!e[n].hidden)return n},getLastVisibleFrozenRIP:function(){for(var t=this.that,e=t.get_p_data(),n=t.riOffset,r=t.options.freezeRows+n-1;r>=n;r--)if(!e[r].pq_hidden)return r-n},getSelection:function(){var t=this.that,e=t.get_p_data(),n=t.colModel,r=[];return this.ranges.forEach(function(t){var i,o,a,l=t.r1,s=t.r2,c=t.c1,d=t.c2;for(o=l;o<=s;o++)for(i=e[o],a=c;a<=d;a++)r.push({dataIndx:n[a].dataIndx,colIndx:a,rowIndx:o,rowData:i})}),r},isSelected:function(t){var e=this.that.normalize(t),n=e.rowIndx,r=e.colIndx;return null==r||null==n?null:!!this.ranges.find(function(t){var e=t.r1,i=t.r2,o=t.c1,a=t.c2;if(n>=e&&n<=i&&r>=o&&r<=a)return!0})},onRefresh(t,e){var n;return r=>{clearTimeout(n),n=setTimeout(n=>{e.element&&(t.removeAll(!0),e.Selection().address().forEach(e=>t.addBlock(e)),t.borders.forEach(e=>t._addBlock(e,!0)))},50)}},removeAll:function(t){var e=this.that,n=e.$cont,r="svg"+(t?"":`:not(.${this.clsDotBorder})`);n&&(n.find(".pq-cont-inner").children(r).remove(),e.$head_i.children().children("svg").remove()),this.ranges=[]},removeBlock:function(t,e){if(t){var n,r=t.r1,i=t.c1,o=t.r2,a=t.c2,l=this,s=l.that,c=l.clsDotBorder,d=e?l.borders:l.ranges,u=d.findIndex(function(t){return r==t.r1&&i==t.c1&&o==t.r2&&a==t.c2});u>=0&&(d.splice(u,1),n="."+l.class+"."+l.serialize(r,i,o,a),n+=e?"."+c:`:not(.${c})`,s.$cont.find(n).remove(),s.$head_i.find(n).remove())}},serialize:function(t,e,n,r){return"r1"+t+"c1"+e+"r2"+n+"c2"+r},shiftRC:function(t,e,n,r){var i=this.that,o=(i.iMerge,i.options),a=i.pdata.length,l=o.freezeRows,s=i.riOffset;if(n-=s,!((t=(t-=s)<l?Math.max(t,Math.min(0,n)):t)>=a||n<0))return n=Math.min(n,a-1),t+=s,n+=s,t-=s,n-=s,[t=Math.max(t,0),e,n=Math.min(n,a-1),r=Math.min(r,i.colModel.length-1)]}}}(jQuery),function(t){t.paramquery.pqGrid.prototype.Range=function(t,e){return new pq.Range(this,t,"range",e)};var e=pq.Range=function(t,n,r,i){if(this instanceof e==0)return new e(t,n,r,i);t.iSelection&&(this.iCells=t.iSelection.iCells),this.that=t,this._areas=[],this._type=r||"range",this.init(n,i)};function n(t){t.shiftKey&&"pqGrid:mousePQUp"!=t.type||(this._trigger("selectEnd",null,{selection:this.Selection()}),this.off("mousePQUp",n),this.off("keyUp",n))}e.history=function(e){let n={style:{},prop:{},attr:{}},r={style:{},prop:{},attr:{}},i={style:{},prop:{},attr:{}},o={style:{},prop:{},attr:{}},a={style:{},prop:{},attr:{}},l={style:{},prop:{},attr:{}},s=["prop","style","attr"],c={},d={},u={},h=function(h){function f(e,n,r,i){for(let o in e){let a,l,s=e[o][i],c=h?n[o]:r[o];c&&s&&(a=Object.keys(s).concat(Object.keys(c)),c=t.extend(!0,{},c),a.forEach(t=>{l=c[t],s[t]=l}))}}s.forEach(t=>{f(c,r[t],n[t],"pq_cell"+t),f(u,l[t],a[t],t),f(d,o[t],i[t],"pq_row"+t)}),e.refresh()};return{add:function(e,r,o,l){function s(e,n,r,i,o){let a=e[n];r[a]||(i[a]=e,r[a]=t.extend(!0,{},e[o]))}l?s(r,"pq_ri",n[e],c,"pq_cell"+e):o?s(o,"dataIndx",a[e],u,e):s(r,"pq_ri",i[e],d,"pq_row"+e)},end:function(){let f=t=>Object.keys(t).length;if(f(c)||f(u)||f(d)){function p(e,n,r){for(let i in e)n[i]=t.extend(!0,{},e[i][r])}s.forEach(t=>{n[t]&&p(c,r[t],"pq_cell"+t),a[t]&&p(u,l[t],t),i[t]&&p(d,o[t],"pq_row"+t)}),e.iHistory.push({callback:h})}}}},e.setCellAPS=function(t,e,n,r){for(let i in n){let o,a,l="pq_cell"+i,s=n[i];for(o in s)if(a=s[o],null!=a||t[l]){let n=t[l]||={};n=n[e]||={},n[o]!=a&&(r.add(i,t,"",!0),n[o]=a,null==a&&delete n[o],"link"==o&&null==t[e]&&(t[e]=""))}}},Object.assign(e.prototype,{add:function(t){this.init(t)},address:function(t){return t?this._areas.map(t=>Object.assign({},t)):this._areas},addressLast:function(){var t=this.address();return t[t.length-1]},history:function(e){var n={},r={},i={},o={},a={},l={},s={},c={},d={},u=this.that,h="pq_cell"+e,f="pq_row"+e,p=function(p){var g=function(e,n,r,i){for(var o in e){var a,l=e[o][i],s=p?n[o]:r[o];for(a in s=t.extend(!0,{},s),l)l[a]=s[a];for(a in s)l[a]=s[a]}};g(a,r,n,h),g(d,c,s,e),g(l,o,i,f),u.refresh()};return{add:function(r,o,c){function u(e,n,r,i,o){var a=e[n];r[a]||(i[a]=e,r[a]=t.extend(!0,{},e[o]))}c?u(r,"pq_ri",n,a,h):o?u(o,"dataIndx",s,d,e):u(r,"pq_ri",i,l,f)},push:function(){function n(t){return Object.keys(t).length}function i(e,n,r){for(var i in e)n[i]=t.extend(!0,{},e[i][r])}(n(a)||n(d)||n(l))&&(i(a,r,h),i(d,c,e),i(l,o,f),u.iHistory.push({callback:p}))}}},refreshStop:function(){this._stop=!0},refresh:function(){this.that.refresh(),this._stop=!1},setAPSTrack(e,n){let r,i=this,o=[],a=[],l=[],s="attr"==n,c="pq_cell"+n,d=i.that;i.each(function(t,e,n,i){return"column"!=i&&"row"!=i||(r=!0),!1}),i.each(function(t,n,r,s,d,u,h,f,p,g){let m,v,w=e=>pq.mergeDeep({},(t[c]||{})[n]),x={[n]:w()},y=w(),b={[n]:y};for(let n in e){let r=e[n];n.startsWith("border")?i.setAPSBorder(n,r,d,u,h,f,p,g).forEach(t=>{y[t]=r,""===r&&delete y[t]}):(y[n]=r,""===r&&delete y[n]),(m=a[d])?(pq.mergeDeep(m[c],b),pq.mergeDeep(l[d][c],x)):(m={[c]:b},v={[c]:x},o.push({rowData:t,rowIndx:d,newRow:m,oldRow:v}),a[d]=m,l[d]=v)}},s||r),d._digestData({updateList:o,source:"cellstyle",undoAreas:t.extend([],this._areas)}),d.refresh({header:!1})},setAPS:function(t,n,r){var i=this,o=i.that,a="object"==typeof t?t:{[t]:n};if(o.options.trackModel.on)return i.setAPSTrack(a,r);var l,s,c="pq_row"+r,d="attr"==r,u=o.iHistory.rangeHistory,h=u||pq.Range.history(o);i.each(function(t,n,u,f,p,g,m,v,w,x){let y,b,C;if(l="row"==f,!(s="column"==f)&&!l||d){let o,l;for(o in a){l=a[o];let s=i=>e.setCellAPS(t,n,{[r]:{[i]:l}},h);o.startsWith("border")?i.setAPSBorder(o,l,p,g,m,v,w,x).forEach(t=>{s(t)}):s(o)}}else for(b in s?(i.addProp(u),y=u[r]||={}):y=t[c]||={},a)C=a[b],y[b]!=C&&(s?h.add(r,"",u):h.add(r,t),y[b]=C),o.Range(s?{c1:g,c2:g}:{r1:p,r2:p},!1).each(function(t,n){var i;s&&null!=(t[c]||{})[b]&&(i=C),e.setCellAPS(t,n,{[r]:{[b]:i}},h)},!0)},d),u||h.end(),i._stop||i.refresh()},setAPSBorder:function(t,e,n,r,i,o,a,l){var s=[],c=this.metaVal,d="inner"==c,u=n==i,h=n==a,f=r==o,p=r==l,g="border-",m=g+"left",v=g+"right",w=g+"top",x=g+"bottom",y=[w,x,m,v,"border"];return"border"==t?"outer"==c?u||h?(s=[u?w:x],(f||p)&&(s[1]=f?m:v)):(f||p)&&(s=[f?m:v]):d?(p||(s=[v]),h||s.push(x)):e?(s=[v,x],f&&s.push(m),u&&s.push(w)):s=y:t==m?f&&(s=[m]):t==v?(d&&!p||!d&&p)&&(s=[v]):t==w?u&&(s=[w]):t==x&&(d&&!h||!d&&h)&&(s=[x]),s},border:function(t,e,n){var r={all:"",outer:"",inner:"",none:"",vertical:"right",horizontal:"bottom"}[t],i={vertical:"inner",horizontal:"inner",outer:"outer",inner:"inner",all:"all"}[t];r??=t,this.style("border"+(r?"-"+r:""),"none"==t?"":e+" "+n,i)},addProp:function(t){t.prop=t.prop||{get align(){return t.align},set align(e){t.align=e},get format(){return t.format},set format(e){t.format=e},get valign(){return t.valign},set valign(e){t.valign=e},get edit(){return t.editable},set edit(e){t.editable=e}}},setAttr:function(t,e){return this.setAPS(t,e,"attr"),this},setStyle:function(t,e){return this.setAPS(t,e,"style"),this},setProp:function(t,e){return this.setAPS(t,e,"prop"),this},clear:function(){return this.copy({copy:!1,cut:!0,source:"clear"})},clearOther:function(t){var e,n=this._normal(t,!0),r=this.address();for(e=r.length-1;e>=0;e--){var i=r[e];i.r1==n.r1&&i.c1==n.c1&&i.r2==n.r2&&i.c2==n.c2||r.splice(e,1)}},clone:function(){return this.that.Range(this._areas)},_cellAttr:function(t,e){var n=t.pq_cellattr=t.pq_cellattr||{};return n[e]=n[e]||{}},comment:function(t){return this.attr("title",t)},link(t,e,n){if(!t)return this.each((t,e)=>{let n=t.pq_cellprop?.[e];return o="Link"==n?.inst?{val:t[e],prop:n,toString:t=>n.link}:"",!1}),o;var r=this.that,i=[],o=r=>({val:e||r||t,prop:{link:t,inst:"Link",target:n}});this.each((t,e,n,r,a)=>(i.push({rowIndx:a,newRow:{[e]:o(t[e])}}),!1)),r.updateRow({rowList:i})},async picCell(t,e,n){return new Promise(r=>{var i=t=>{let i,o={};this.each((r,a,l,s,c)=>(o[a]={val:t,prop:{name:n,width:e,inst:"Pic"}},i=c,!1)),this.that.updateRow({newRow:o,rowIndx:i}),r()};"string"==typeof t?i(t):pq.fileToBase(t,t=>{i(t)})})},pic:function(t,e,n){var r=this.that.Pic(),i=0,o=0;this.each(function(t,e,n,r,a,l){return i=a,o=l,!1}),pq.fileToBase(t,function(a){r.add(r.name(t.name),a,[o,e||0,i,n||0])})},_copyCell(t,e,n){let r=this.that,i=r.readCell,o=this.getRenderVal,a=r.iRenderB,l=r.iMerge;return async(r,s,c,d,u,h,f,p,g)=>{let m,v={},w={},x=c?.inst;if(t&&x){var[y,b,C]=await pq.RichObjs[x].copy(r,c,n,e);m=C,v.val=y,w.val=b}else{let s=i(u,h,l,f,p);s===r&&t&&(n&&(g.colIndx=p,g.column=h,s=o(g,e,a)[0]),"string"==typeof s&&/(\r|\n)/.test(s)&&(s=this.newLine(s))),v.val=w.val=s}return n&&t||(d&&(m=!0,v.style=d),c&&(m=!0,t?(v.format=c.format,(v.style||={})["text-align"]=c.align):v.prop=c),s&&(m=!0,v.attr=s)),[v,w,m]}},_copyArea:async function(t,e,n,r,i,o,a,l,s,c,d,u,h,f,p,g,m,v){var w,x,y,b,C,q,I=this.that,_=0,R=this._copyCell(g,u,m),D=[],M=[],S=[],T=I.riOffset,F=(t,e,n)=>{let r=e.slice();v&&t[n]?t[n]=t[n].concat(r):t.push(r)};for(b=n;b<=r;b++)if(q=i[b],!1!==(D[b]=q.copy)){if(h&&g){let t={val:this.getTitle(q,b)};M.push(t),S.push(t)}}else p.push(b);for(h&&g&&(o.push(M.slice()),a.push(S.slice())),y=t;y<=e;y++){var k=s[y];if(k){if(!1===k.pq_copy){f.push(y);continue}var E={},P={},$=k.pq_cellprop||{},A=k.pq_cellstyle||{},H=k.pq_cellattr||{},O={rowIndx:y,rowIndxPage:y-T,rowData:k,Export:!0,exportClip:!0};for(M=[],S=[],b=n;b<=r;b++){let t=$[C=(q=i[b]).dataIndx],e=A[C],n=H[C];if(!1!==D[b]){if(x=k[C],d){O.dataIndx=C;let[r,i,o]=await R(x,n,t,e,k,q,y,b,O);w||=o,S.push(i),m||M.push(r)}c&&(void 0!==x||e||t||n)&&(E[C]={val:void 0,style:void 0,prop:void 0,attr:void 0},P[C]={val:x,attr:n,style:e,prop:t})}}c&&l.push({rowIndx:y,rowData:k,oldRow:P,newRow:E}),F(a,S,_),m||F(o,M,_)}_++}return w},isSameRowAreas(t){let e;for(let[n,r]of t.entries())if(n>0){let i=t[n-1],o=r.r1,a=r.rc;if(o!=i.r1||a!=i.rc)return!1;e=!0}return e},copy:async function(e={}){let n,r,i=this,o=i.that,a=e.dest,l=!!e.cut,s=e.copy??!0,c=s&&!a,d=e.source||(l?"cut":"copy"),u=e.history??!0,h=e.allowInvalid??!0,f=[],p=[],g=[],m=[],v=[],w=o.get_p_data(),x=o.colModel,y=o.options.copyModel,b=e.render??y.render,C=e.header??y.header,q=!!c&&(e.plainFmt??y.plainFmt),I=navigator.clipboard,_=this.address(!0),R={areas:_,cut:l,dest:a,header:C,source:d},D=i.iCells,M="pq-cut",S="pq-paste paste",T=t(document.body),F=t=>{D.removeBorders()},k=t=>{o.updateRow({rowList:f,source:d,history:u,allowInvalid:h,undoAreas:_})};if(i.cancelEdit=t=>{f.length=0,F(),T.off(S)},!_.length)return;if(!1===o._trigger("beforeCopy",null,R))return;T.trigger(M).one(M,t=>{this.cancelEdit()});let E=i.isSameRowAreas(_);for(let t of _){let e=t.type,n=t.r1,o=t.c1,a="cell"===e?n:t.r2,d="cell"===e?o:t.c2,u=await i._copyArea(n,a,o,d,x,p,g,f,w,l,s,b,C,m,v,c,q,E);r||=u}if(c){let t="text/plain",e={};if(n=g.map(t=>t.map(t=>t.val).join("\t")||" ").join("\n"),e[t]=new Blob([n],{type:t}),r){n="<table>"+p.map(t=>"<tr>"+t.map(t=>{let e=t.style||{},n=t.format;return n&&(n=n.replaceAll('"',"\\0022"),e["mso-number-format"]='"'+n+'"'),e=`style='${pq.styleStr(e)}'`,`<td ${e} >${t.val??""}</td>`}).join("")+"</tr>").join("")+"</table>",t="text/html",e[t]=new Blob([n],{type:t})}await I.write([new ClipboardItem(e)]),o._setGlobalClip(n),P="cut"==d?"pq-cut":"",$=_.map(t=>Object.assign({cls:P},t)),D.addBorder($)}var P,$;let A=r?p:g;return T.one(S,i.onPasteBody(i,F,A,k,f,_)),R.data=A,R.skippedRIs=m,R.skippedCIs=v,o._trigger("copy",null,R),a?o.paste({rows:A,dest:a,history:u,allowInvalid:h}):l&&"cut"!=d&&k(),n},are2DArraysEqual(t,e){let n,r,i=t=>t&&"object"==typeof t;if(t.length!==e.length)return!1;for(n=0;n<t.length;n++){var o=t[n],a=e[n];if(o.length!=a.length)return!1;for(r=0;r<o.length;r++){let t=o[r],e=a[r],n=i(t),l=i(e),s=n?t.val:t,c=l?e.val:e,d=l&&e.prop?.inst;if(d){if(!0!==pq.RichObjs[d].isEqual?.(s,e))return!1}else if(s!=c)return!1}}return!0},onPasteBody(t,e,n,r,i,o){var a=t.that;return(l,s)=>{if("paste"==l.type||!i.length)return t.cancelEdit();var c=s.grid,d=s.dui,u=s.rows;if(!t.are2DArraysEqual(n,u))return t.cancelEdit();i.length&&(c==a?(d.updateList.forEach(t=>{var e=t.rowIndx,n=i.find(t=>t.rowIndx==e);n?pq.mergeDeep(n.newRow,t.newRow):i.push(t)}),d.updateList=a.flattenRowList(i),d.undoAreas.push(...o)):r()),e()}},addBorder(){this.iCells.addBorder(this._areas)},_countArea:function(t){var e=t,n=t.type,r=e.r1,i=e.c1,o=e.r2,a=e.c2;return"cell"===n?1:(o-r+1)*(a-i+1)},count:function(){for(var t="range"===this._type,e=this.address(),n=0,r=e.length,i=0;i<r;i++)n+=t?this._countArea(e[i]):1;return n},cut:function(t){return(t=t||{}).cut=!0,this.copy(t)},_eachRC:function(t,e,n,r,i){var o=this.that,a={r1:"getFirstVisibleRIP",c1:"getFirstVisibleCI"},l={r1:"getLastVisibleRIP",c1:"getLastVisibleCI"};this.address().forEach(function(s){var c=s[n],d=s[r];for(d==c&&i&&(o[a[n]]()==c&&(c=0),o[l[n]]()==d&&(d=e.length-1));c<=d;c++)t(e[c],c)})},eachCol:function(t,e){this._eachRC(t,this.that.colModel,"c1","c2",e)},eachRow:function(t,e){this._eachRC(t,this.that.pdata,"r1","r2",e)},_hsCols:function(t,e){var n=[],r={};this.eachCol(function(t){n.push(t.dataIndx)},e),r[t]=n,this.that.Columns().hide(r)},hideCols:function(){this._hsCols("diHide")},showCols:function(){this._hsCols("diShow",!0)},hideRows:function(t,e){this.eachRow(function(e){e.pq_hidden=!t},e),this.that.refreshView()},showRows:function(){this.hideRows(!0,!0)},each:function(t,e){for(var n=this.that,r=n.colModel,i=this.address(),o=0,a=n.get_p_data();o<i.length;o++)for(var l,s,c,d,u=i[o],h=u.r1,f=u.r2,p=u.c2,g=u.type,m="column"==g,v="row"==g,w=h;w<=f;w++){if(l=a[w])for(s=(s=c=u.c1)<0?0:s;s<=p;s++){if((d=r[s])&&!1===t(l,d.dataIndx,d,g,w,s,h,c,f,p))return;if(v&&!e)break}if(m&&!e)break}},enable:function(t){return(t=this.prop("edit",t))??!0},getAPS:function(t,e){var n,r,i,o,a=this;return a.each(function(l,s,c){return a.addProp(c),i=((i=(l["pq_cell"+e]||{})[s])||{})[t],o=(l["pq_row"+e]||{})[t],n=(c[e]||{})[t],r=i??o??n,!1}),r},getAttr:function(t){return this.getAPS(t,"attr")},getProp:function(t){return this.getAPS(t,"prop")},getStyle:function(t){return this.getAPS(t,"style")},getIndx:function(t){return t??this._areas.length-1},getValue:function(){var t,e,n,r,i,o,a,l,s,c,d=this.address(),u=d.length,h=[],f=this.that,p=0;if(u)for(c=f.get_p_data();p<u;p++)for(r=(t=d[p]).r1,i=t.c1,o=t.r2,a=t.c2,l=r;l<=o;l++)for(e=c[l],s=i;s<=a;s++)n=e[f.colModel[s].dataIndx],h.push(n);return h},indexOf:function(t){for(var e,n=(t=this._normal(t)).r1,r=t.c1,i=t.r2,o=t.c2,a=this.address(),l=0,s=a.length;l<s;l++)if(n>=(e=a[l]).r1&&i<=e.r2&&r>=e.c1&&o<=e.c2)return l;return-1},index:function(t){for(var e,n=(t=this._normal(t)).type,r=t.r1,i=t.c1,o=t.r2,a=t.c2,l=this.address(),s=0,c=l.length;s<c;s++)if(n===(e=l[s]).type&&r===e.r1&&o===e.r2&&i===e.c1&&a===e.c2)return s;return-1},init:function(t,e){var n=this;if(e=!1!==e,t)if(pq.isFn(t.push))for(var r=0,i=t.length;r<i;r++)this.init(t[r],e);else if(pq.isStr(t))t.split(",").forEach(function(t){n.init(pq.getAddress(t),e)});else{var o=this._normal(t,e),a=this._areas=this._areas||[];o&&a.push(o)}},isValid:function(){return!!this._areas.length},freezePanes:function(){var t=this._areas[0];if(t){var e=t.c1,n=t.r1,r=this.that,i=r.options;return i.freezeRows=n,i.freezeCols=e,r.refresh(),!0}},format:function(t){return this.prop("format",t)},addCol:function(e,n){for(var r=this._areas[0],i=r.c1,o=r.c2,a=[],l=i;l<=o;l++)a.push(t.extend({dataIndx:Math.random(),width:100},n));this.that.Columns().add(a,e?o+1:i,null,"addCols")},deleteCol:function(){var t=this._areas[0],e=t.c1,n=t.c2;this.that.Columns().remove(n-e+1,e)},addRow:function(e,n){for(var r=this._areas[0],i=r.r1,o=r.r2,a=[],l=i;l<=o;l++)a.push(t.extend({},n));this.that.addNodes(a,e?o+1:i,null,"addRows")},deleteRow:function(){var t=this._areas[0],e=this.that,n=t.r1,r=e.pageData().slice(n,t.r2+1);e.deleteNodes(r)},merge:function(t){t=t||{};var e,n,r=this.that,i=r.options.mergeCells,o=this._areas[0];o&&(e=o.r2-o.r1+1,n=o.c2-o.c1+1,(e>1||n>1)&&(o.rc=e,o.cc=n,i.push(o),!1!==t.refresh&&r.refreshView()))},newLine:function(t){return'"'+t.replace(/"/g,'""')+'"'},replace:function(t,e){var n=this._normal(t),r=this._areas,i=this.getIndx(e);r.splice(i,1,n)},remove:function(t){var e=this._areas,n=this.indexOf(t);n>=0&&e.splice(n,1)},resize:function(t,e){var n=this._normal(t),r=this._areas[this.getIndx(e)];return["r1","c1","r2","c2","rc","cc","type"].forEach(function(t){r[t]=n[t]}),this},_RC1:function(t){return Math.min(...this._areas.map(e=>e[t]))},R1:function(){return this._RC1("r1")},C1:function(){return this._RC1("c1")},rows:function(t){var e=this.that,n=[],r=this.addressLast();if(r)for(var i=r.r1,o=r.c1,a=r.r2,l=r.c2,s=r.type,c=null==t?a:i+t,d=null==t?i:i+t;d<=c;d++)n.push({r1:d,c1:o,r2:d,c2:l,type:s});return pq.Range(e,n,"row")},cols:function(t){var e=this.that,n=[],r=this._areas[0];if(r)for(var i=r.r1,o=r.c1,a=r.r2,l=r.c2,s=o;s<=l;s++)n.push({r1:i,c1:s,r2:a,c2:s});return pq.Range(e,n,"column")},cells:function(){var t=this.that,e=[];return this._areas.forEach(t=>{for(var n=t.r1,r=t.c1,i=t.r2,o=t.c2,a=n;a<=i;a++)for(var l=r;l<=o;l++)e.push({r1:a,c1:l,r2:a,c2:l})}),pq.Range(t,e,"cell")},_normal:function(t,e){if(t.type)return t;var n;if(pq.isFn(t.push)){n=[];for(var r=0,i=t.length;r<i;r++){var o=this._normal(t[r],e);o&&n.push(o)}return n}var a,l,s=this.that,c=s.get_p_data().length-1,d=s.colModel.length-1,u=(u=t.r1)>c?c:u,h=(h=t.c1)>d?d:h,f=t.rc,p=t.cc,g=t.r2,m=t.c2;return d<0||c<0?null:null!=u||null!=h?(u>g&&(a=u,u=g,g=a),h>m&&(a=h,h=m,m=a),null==u?(u=0,g=c,m??=h,l="column"):null==h?(t._type,h=0,g=g??u,m=d,l=t._type||"row"):null==g&&null==f||u==g&&h==m?(l="cell",g=u,m=h):l="block",g=(g=f?u+f-1:g)>c?c:g,m=(m=p?h+p-1:m)>d?d:m,!e||"block"!=l&&"cell"!=l||(u=(n=s.iMerge.inflateRange(u,h,g,m))[0],h=n[1],g=n[2],m=n[3]),f=g-u+1,p=m-h+1,t.r1=u,t.c1=h,t.r2=g,t.c2=m,t.rc=f,t.cc=p,t.type=t.type||l,t):void 0},select:function(){var t=this.that.iSelection,e=this._areas;return e.length&&(t.removeAll({trigger:!1}),e.forEach(function(e){t.add(e,!1)}),t.trigger()),this},style:function(t,e,n){return this.metaVal=n,this._prop(t,e,"Style")},_prop:function(t,e,n){return this[(null!=e||"object"==typeof t?"set":"get")+n](t,e)},attr:function(t,e){return this._prop(t,e,"Attr")},prop:function(t,e){return this._prop(t,e,"Prop")},toggleStyle:function(t,e){var n=this.getStyle(t),r=n&&n!=e[1]?e[1]:e[0];this.style(t,r)},unmerge:function(t){t=t||{};var e=this.that,n=e.options.mergeCells,r=this._areas[0];if(r){for(var i=0;i<n.length;i++){var o=n[i];if(o.r1===r.r1&&o.c1===r.c1){n.splice(i,1);break}}!1!==t.refresh&&e.refreshView()}},align:function(t){return this.prop("align",t)},valign:function(t){return this.prop("valign",t)},value:function(t){var e,n,r,i,o,a=0,l=this.that,s=l.colModel,c=[],d=this.address();if(void 0===t)return this.getValue();for(var u=0;u<d.length;u++){n=(e=d[u]).r1,r=e.c1,i=e.r2,o=e.c2;for(var h=n;h<=i;h++){for(var f=l.normalize({rowIndx:h}),p=f.rowData,g=f.rowIndx,m={},v={},w=r;w<=o;w++){var x=s[w].dataIndx;pq.fillNewRow(v,m,t[a++],p,x)}c.push({rowData:p,rowIndx:g,newRow:v,oldRow:m})}}return c.length&&(l._digestData({updateList:c,source:"range"}),l.refresh({header:!1})),this},val2D:function(){var t,e=[],n=this.that,r={};for(t in this._areas.forEach(function(t){for(var e,i=t.c1,o=t.c2,a=t.r1;a<=t.r2;a++)e=n.Range({r1:a,rc:1,c1:i,c2:o}).value(),r[a]=r[a]?r[a].concat(e):e}),r)e.push(r[t]);return e},toString:function(){var t,e=pq.toLetter;return this._areas.map(n=>(t=e(n.c1)+(n.r1+1),"cell"==n.type?t:t+":"+e(n.c2)+(n.r2+1))).join(",")}},pq.mixin.render),pq.Selection=class extends e{constructor(e){super(e),this.iCells=new t.paramquery.cCells(e),e.on("dataReady columnOrder addColumn deleteColumn change cellKeyDown",(t,e)=>{"Escape"!=t.key&&null!=t.key||this.cancelEdit&&this.cancelEdit()})}add(t,e){var n=this._normal(t,!0),r=this.iCells;this.indexOf(n)>=0||(r.addBlock(n),super.add(n),!1!==e&&this.trigger())}clearOther(t,e){var n=this.iCells,r=this._normal(t,!0);this.address().forEach(function(t){t.r1==r.r1&&t.c1==r.c1&&t.r2==r.r2&&t.c2==r.c2||n.removeBlock(t)}),super.clearOther(r),e||this.trigger()}getSelection(){return this.iCells.getSelection()}isSelected(t){return this.iCells.isSelected(t)}removeAll(t){t=t||{},this._areas.length&&(this.iCells.removeAll(),this._areas=[],!1!==t.trigger&&this.trigger())}resizeOrReplace(t,e){this.resize(t,e)||this.replace(t,e)}replace(t,e){var n=this.iCells,r=this._normal(t),i=this._areas,o=this.getIndx(e),a=i[o];n.removeBlock(a),n.addBlock(r),super.replace(r,o),this.trigger()}resize(t,e){var n=this._normal(t,!0),r=n.r1,i=n.c1,o=n.r2,a=n.c2,l=this._areas||[];if(!l.length)return!1;var s=l[this.getIndx(e)],c=s.r1,d=s.c1,u=s.r2,h=s.c2;return!(c!==r||d!==i||c!==r||h!==a||u!==o||d!==i||(u!==o||h!==a))||void 0}selectAll(t){var e,n=(t=t||{}).type,r=this.that,i=r.colModel,o=t.all,a=o?0:r.riOffset,l=o?r.get_p_data().length:r.pdata.length,s=i.length-1,c=a+l-1;return e="row"===n?{r1:a,r2:c}:{c1:0,c2:s,_type:"column",r1:0,r2:c},r.Range(e).select(),this}trigger(){var t=this.that;t._trigger("selectChange",null,{selection:this}),t.off("mousePQUp",n),t.off("keyUp",n),t.on("mousePQUp",n),t.on("keyUp",n)}}}(jQuery),function(t){var e=t.paramquery;t.widget("paramquery.pqToolbar",{options:{items:[],gridInstance:null,events:{button:"click",select:"change",checkbox:"change",textbox:"change",color:"change",textarea:"change",file:"change"}},items:{align:{type2:"select",attr:"strAlignH",cls:"align",options:["","left","center","right"],listener:"this.Selection().align($(evt.target).val())"},valign:{type2:"select",attr:"strAlignV",cls:"valign",options:[{"":"",top:"top",center:"middle",bottom:"bottom"}],listener:"this.Selection().valign($(evt.target).val())"},bgColor:e=>({attr:"strFillColor",cls:"bgColor",label:'<span class="pq-icon pq-icon-bucket bgColor-icon" ></span>',listener:"this.Selection().style('background-color',evt.target.clear?\"\":evt.target.value)",type2:"color",init:n=>t(n).find("input").pqColorPick({title:e.strFillColor})}),bold:{attr:"strBold",cls:"bold",label:"<b>B</b>",listener:'this.Selection().toggleStyle("font-weight", ["bold", ""])'},border:{icon:"bi-border-all",attr:"strBorder",listener:1,init:e=>t(e).pqBorder()},cut:{icon:"ui-icon-scissors",attr:"strCut",listener:"this.cut()"},copy:{icon:"ui-icon-copy",attr:"strCopy",listener:"this.copy()"},fontFamily:{attr:"strFontFamily",cls:"font-family",type2:"select",labelIndx:"value",valueIndx:"value",options:["","Arial","Calibri","Courier New","Georgia","Helvetica","Impact","monospace","sans-serif","Tahoma","Verdana"].map(t=>({style:`font-family:${t};`,value:t})),listener:"this.Selection().style('font-family', $(evt.target).val())"},fontSize:{attr:"strFontSize",cls:"font-size",type2:"select",options:["",10,11,12,13,14,15,16,18,20,22,24,26,28,30,32],listener:"this.Selection().style('font-size', $(evt.target).val() + \"pt\")"},fgColor:e=>({attr:"strTextColor",cls:"fgColor",label:'<span class="fgColor-text" style="" >A</span>',listener:"this.Selection().style('color',evt.target.clear?\"\":evt.target.value)",type2:"color",init:n=>t(n).find("input").pqColorPick({title:e.strTextColor})}),import:{type2:"file",attr:"strImport",attrFile:"accept='.xlsx,.csv'",icon:"ui-icon-folder-open",listener:"let g = this, file = evt.target.files[0];\n if (file) {\n g.showLoading();\n pq.excel.importXl({file},workbook=>{\n if(g.Tab)g = g.Tab().main();\n g.importWb({workbook,extraRows:10,extraCols:10});\n g.hideLoading();\n })\n }"},fullscreen:{type:"button",attr:"strFullScreen",icon:"ui-icon-arrow-4-diag",cls:"pq-fullscreen",listener:"this.toggle()"},italic:{attr:"strItalic",cls:"italic",label:"<i>I</i>",listener:'this.Selection().toggleStyle("font-style", ["italic", ""])'},paste:{icon:"ui-icon-clipboard",attr:"strPaste",listener:"this.paste()"},redo:{cls:"redo",icon:"ui-icon-arrowrefresh-1-s",attr:"strRedo",options:{disabled:!0},listener:"this.History().redo()"},underline:{attr:"strUnderline",cls:"underline",label:"<u>U</u>",listener:'this.Selection().toggleStyle("text-decoration", ["underline", ""])'},undo:{cls:"undo",icon:"ui-icon-arrowreturn-1-s",attr:"strUndo",options:{disabled:!0},listener:"this.History().undo()"},wrap:{attr:"strWrap",cls:"wrap",icon:"bi-text-wrap",listener:'this.Selection().toggleStyle("white-space", ["normal", "nowrap"])'}},_create(){let e,n=this.options,r=n.items,i=n.gridInstance,o=t.paramquery.strings,a=(t,n)=>Object.assign(t,e,{type:n}),l=[];for(e of r){let t,n,r,i,s,c,d,u,h,f,p,g,m=e.type,v="button";if("picCell"==m||"pic"==m)v="file",c="ui-icon-image",i="strImportImage",s='accept=".jpg,.jpeg,.png,.gif"',g=`let file = evt.target.files[0];\n (file && this.Selection().${m}(file))`;else{let t=this.items[m];t&&(t="function"==typeof t?t(o):t,v=t.type2||v,i=t.attr||"",s=t.attrFile,c=t.icon,d=t.init,u=t.cls,h=t.label,f=t.options,p=t.styleCtrl,g=t.listener,n=t.labelIndx,r=t.valueIndx)}if(g){let e=o[i];t=a({attr:i?`title="${e}" aria-label="${e}"`:"",attrFile:s,title:e,cls:u,icon:c,label:h,options:f,listener:new Function("evt",g),init:d,labelIndx:n,valueIndx:r,styleCtrl:p},v)}else t=e;l.push(t)}i.on("selectEnd history",function(){let e=this.Selection(),n=this.toolbar(),r=this.History(),i=(t,e)=>{t[e?"addClass":"removeClass"]("ui-state-highlight")},o=(e,r)=>{let i=t(e,n);i[0]&&r(i)};o(".font-size",t=>t.val(parseInt(e.style("font-size")))),o(".font-family",t=>t.val(e.style("font-family"))),o(".valign",t=>t.val(e.valign())),o(".align",t=>t.val(e.align())),o(".bgColor",t=>t.val(e.style("background-color")||"#ffffff")),o(".fgColor",t=>t.val(e.style("color")||"#000000")),o(".comment",t=>i(t,e.comment())),o(".link",t=>i(t,e.link())),o(".bold",t=>i(t,"bold"==e.style("font-weight"))),o(".italic",t=>i(t,"italic"==e.style("font-style"))),o(".underline",t=>i(t,"underline"==e.style("text-decoration"))),o(".wrap",t=>i(t,"normal"==e.style("white-space"))),o(".format",t=>i(t,e.format())),o(".enable",t=>i(t,!e.enable())),o(".redo",t=>t.button("option","disabled",!r.canRedo())),o(".undo",t=>t.button("option","disabled",!r.canUndo()))}),this.createTB(l)},createTB:function(n){var r,i=this.options,o=i.gridInstance,a=i.events,l=i.bootstrap.on,s=o.colModel,c=o.options.filterModel.timeout,d=this.element;d.addClass("pq-toolbar");for(let i of n){var u,h,f,p,g=i.type,m=i.value,v=i.icon,w=i.options=i.options||{},x=i.label,y=i.init,b=(i.title,((u=i.listener)?[u]:i.listeners)||[function(){}]),C=i.cls,q=(q=C||"")?"class='"+q+"'":"",I=i.style,_=I?"style='"+I+"'":"",R=i.styleCtrl?"style='"+i.styleCtrl+"'":"",D=i.attr||"",M=x?"<label "+_+">"+x:"",S=x?"</label>":"",T=(T=x&&"button"!=g&&"file"!=g?[q,D,R]:[q,D,_||R]).join(" ");"textbox"==g||"color"==g?f=t([M,"<input type="+("color"==g?g:"text")+" "+T+">",S].join("")):"textarea"==g?f=t([M,"<textarea "+T+"></textarea>",S].join("")):"select"==g?(pq.isFn(w)&&(w=w.call(o,{colModel:s})),w=w||[],h=e.select({options:w,attr:T,prepend:i.prepend,groupIndx:i.groupIndx,valueIndx:i.valueIndx,labelIndx:i.labelIndx}),f=t([M,h,S].join(""))):"file"==g?f=t([`<label tabindex='0' class='ui-button ui-widget ui-state-default ui-corner-all ${q=v&&x?"ui-button-text-icon-primary":v?"ui-button-icon-only":"ui-button-text-only"}' ${D} ${_}>`,`<input type='file' style='display:none;' ${i.attrFile||""}>`,v?`<span class='ui-icon ${v}'></span>`:"",x||"&nbsp;","</label>"].join("")):"checkbox"==g?f=t([x?"<label "+_+">":"","<input type='checkbox' ",m?"checked='checked' ":"",T,">",x?x+"</label>":""].join("")):"separator"==g?f=t("<span class='pq-separator' "+[D,_].join(" ")+"></span>"):"button"==g?(f=t("<button type='button' "+T+">"+x+"</button>")).button(t.extend({label:x||"",showLabel:!!x,text:!!x,icon:v,icons:{primary:l?"":v}},w)):pq.isStr(g)?f=t(g):pq.isFn(g)&&(h=g.call(o,{colModel:s,cls:q}),f=t(h)),f.appendTo(d),y&&y.call(o,f[0]),p=this.getInner(f,x,g),"checkbox"!==g&&void 0!==m&&p.val(m);for(var F=0,k=b.length;F<k;F++){u=b[F];var E={};for(r in"function"==typeof u?E[a[g]]=u:E=u,E)pq.fakeEvent(p,r,c),p.on(r,this._onEvent(o,E[r],i))}}}}),t.extend(e.pqToolbar.prototype,{getInner:function(e,n,r){return"LABEL"==e[0].nodeName.toUpperCase()?t(e.children("input,select,textarea")):e},refresh:function(){this.element.empty(),this._create()},_onEvent:function(e,n,r){return function(i){var o=r.type;r.value="checkbox"==o?t(i.target).prop("checked"):t(i.target).val(),n.call(e,i),"file"==o&&t(this).val("")}},_destroy:function(){this.element.empty().removeClass("pq-toolbar").enableSelection()},_disable:function(){null==this.$disable&&(this.$disable=t("<div class='pq-grid-disable'></div>").css("opacity",.2).appendTo(this.element))},_enable:function(){this.$disable&&(this.element[0].removeChild(this.$disable[0]),this.$disable=null)},_setOption:function(t,e){"disabled"==t&&(1==e?this._disable():this._enable())}}),pq.toolbar=function(e,n){var r=t(e).pqToolbar(n);return r.data("paramqueryPqToolbar")||r.data("paramquery-pqToolbar")}}(jQuery),function(t){var e=t.paramquery,n=e.pqGrid.prototype;n.options.trackModel={on:!1,dirtyClass:"pq-cell-dirty"},e.cUCData=function(t){this.that=t,this.udata=[],this.ddata=[],this.adata=[],this.options=t.options,t.on("dataAvailable",this.onDA(this))},e.cUCData.prototype={add:function(t){for(var e=this.that,n=this.adata,r=this.ddata,i=t.rowData,o=this.options.trackModel.dirtyClass,a=e.getRecId({rowData:i}),l=0,s=n.length;l<s;l++){var c=n[l];if(null!=a&&c.recId==a)throw"primary key violation";if(c.rowData==i)throw"same data can't be added twice."}for(l=0,s=r.length;l<s;l++)if(i==r[l].rowData)return void r.splice(l,1);var d=[];for(var u in i)d.push(u);e.removeClass({rowData:i,dataIndx:d,cls:o});t={recId:a,rowData:i};n.push(t)},commit:function(t={}){var e=this.that,n=t.type;if(n){var r=t.history,i=[],o=e.options.dataModel.recIndx,a=t.rows;r=null!=r&&r,"add"==n?a?i=this.commitAdd(a,o):this.commitAddAll():"update"==n?a?this.commitUpdate(a,o):this.commitUpdateAll():"delete"==n&&(a?this.commitDelete(a,o):this.commitDeleteAll()),i.length&&(e._digestData({source:"commit",checkEditable:!1,track:!1,history:r,updateList:i}),e.refreshView({header:!1}))}else this.commitAddAll(),this.commitUpdateAll(),this.commitDeleteAll()},commitAdd:function(e,n){var r,i,o,a,l,s,c=this.that,d=c.colModel,u=d.length,h=this.adata,f=t.inArray,p=c.options.treeModel,g=null!=p.dataIndx,m=p.parentId,v=h.length,w=c.getValueFromDataType,x=[],y=e.length,b=[];for(i=0;i<y;i++)for(l=e[i],r=0;r<v;r++)if(s=!0,-1==f(a=h[r].rowData,b)){for(o=0;o<u;o++){var C=d[o],q=C.dataType,I=C.dataIndx;if(!("object"==q||C.hidden||I==n||g&&I==m))if(w(a[I],q)!=w(l[I],q)){s=!1;break}}if(s){var _={},R={},D=function(t){_[t]=l[t],R[t]=a[t]};D(n),g&&D(m),x.push({rowData:a,oldRow:R,newRow:_}),b.push(a);break}}var M=[];for(r=0;r<v;r++)-1==f(a=h[r].rowData,b)&&M.push(h[r]);return this.adata=M,x},commitDelete:function(t,e){for(var n,r,i,o,a=this.ddata,l=a.length,s=this.udata;l--&&(r=(n=a[l].rowData)[e],i=t.length);)for(;i--;)if(r==t[i][e]){for(t.splice(i,1),a.splice(l,1),o=s.length;o--;)s[o].rowData==n&&s.splice(o,1);break}},commitUpdate:function(e,n){var r,i,o=this.that,a=this.options.trackModel.dirtyClass,l=this.udata,s=l.length,c=e.length,d=[];for(r=0;r<s;r++){var u=l[r],h=u.rowData,f=u.oldRow;if(-1==t.inArray(h,d))for(i=0;i<c;i++){var p=e[i];if(h[n]==p[n])for(var g in d.push(h),f)o.removeClass({rowData:h,dataIndx:g,cls:a})}}var m=[];for(r=0;r<s;r++)h=l[r].rowData,-1==t.inArray(h,d)&&m.push(l[r]);this.udata=m},commitAddAll:function(){this.adata=[]},commitDeleteAll:function(){for(var t,e=this.ddata,n=this.udata,r=n.length,i=e.length,o=0;r>0&&o<i;o++){for(t=e[o].rowData;r--;)n[r].rowData==t&&n.splice(r,1);r=n.length}e.length=0},commitUpdateAll:function(){for(var t=this.that,e=this.options.trackModel.dirtyClass,n=this.udata,r=0,i=n.length;r<i;r++){var o=n[r],a=o.oldRow,l=o.rowData;for(var s in a)t.removeClass({rowData:l,dataIndx:s,cls:e})}this.udata=[]},delete:function(t){for(var e=this.that,n=t.rowIndx,r=t.rowIndxPage,i=e.riOffset,o=(n=null==n?r+i:n,r=null==r?n-i:r,"remote"==e.options.pageModel.type?r:n),a=this.adata,l=this.ddata,s=e.getRowData(t),c=0,d=a.length;c<d;c++)if(a[c].rowData==s)return void a.splice(c,1);l.push({indx:o,rowData:s,rowIndx:n})},getChangesValue:function(e){e=e||{};for(var n=this.that,r=e.all,i=this.udata,o=this.adata,a=this.ddata,l=[],s=[],c=[],d=[],u=["pq_cellattr","pq_cellstyle","pq_cellprop"],h=e=>e&&"object"==typeof e?t.isEmptyObject(e)?void 0:JSON.stringify(e):e,f=(t,e,n)=>{if(u.includes(t)||!t.startsWith("pq_")){let r=h(n[t]);void 0!==r&&(e[t]=r)}},p=[],g=[],m=0,v=a.length;m<v;m++){var w=(b=a[m]).rowData,x={};for(var y in p.push(w),w)0!=y.indexOf("pq_")&&(x[y]=w[y]);g.push(x)}for(m=0,v=i.length;m<v;m++){var b=i[m],C=n.options.dataModel.recIndx,q=b.oldRow,I={};w=b.rowData;if(!p.includes(w)&&!l.includes(w)){x={};if(r){for(y in w)f(y,x,w);for(y in q)I[y]=h(q[y])}else{for(y in q)f(y,x,w),I[y]=h(q[y]);x[C]=b.recId}l.push(w),s.push(x),c.push(I)}}for(m=0,v=o.length;m<v;m++){w=(b=o[m]).rowData,x={};for(y in w)void 0!==w[y]&&f(y,x,w);d.push(x)}return{updateList:s,addList:d,deleteList:g,oldList:c}},getChanges:function(){this.that;for(var e=this.udata,n=this.adata,r=this.ddata,i=t.inArray,o=[],a=[],l=[],s=[],c=0,d=r.length;c<d;c++){var u=(f=r[c]).rowData;s.push(u)}for(c=0,d=e.length;c<d;c++){var h=(f=e[c]).oldRow;-1==i(u=f.rowData,s)&&(-1==i(u,o)&&(o.push(u),a.push(h)))}for(c=0,d=n.length;c<d;c++){var f;u=(f=n[c]).rowData;l.push(u)}return{updateList:o,addList:l,deleteList:s,oldList:a}},getChangesRaw:function(){this.that;var t=this.udata,e=this.adata,n=this.ddata,r={updateList:[],addList:[],deleteList:[]};return r.updateList=t,r.addList=e,r.deleteList=n,r},isDirty:function(t){var e=this.that,n=this.udata,r=this.adata,i=this.ddata,o=!1,a=e.getRowData(t);if(a)for(var l=0;l<n.length;l++){if(a==n[l].rowData){o=!0;break}}else(n.length||r.length||i.length)&&(o=!0);return o},onDA:function(t){return function(e,n){"filter"!=n.source&&(t.udata=[],t.ddata=[],t.adata=[])}},rollbackAdd:function(t,e){for(var n=this.adata,r=[],i=0,o=n.length;i<o;i++){var a=n[i].rowData;r.push({type:"delete",rowData:a})}return r},rollbackDelete:function(t,e){for(var n=this.ddata,r=[],i=n.length-1;i>=0;i--){var o=n[i],a=(o.indx,o.rowIndx),l=o.rowData;r.push({type:"add",rowIndx:a,newRow:l})}return r},rollbackUpdate:function(t,e){this.that;for(var n=this.options.trackModel.dirtyClass,r=[],i=this.udata,o=[],a=0,l=i.length;a<l;a++){var s=i[a],c=s.recId,d=s.rowData,u={},h=s.oldRow;if(null!=c){var f=[];for(var p in h)u[p]=d[p],f.push(p);r.push({rowData:d,dataIndx:f,cls:n,refresh:!1}),o.push({type:"update",rowData:d,newRow:h,oldRow:u})}}return[o,r]},rollback:function(t={}){var e,n,r,i=this.that,o=i.options.dataModel,a=i.options.pageModel,l=t.refresh??!0,s=t.type,c=[],d=[],u=[],h=[],f=o.data;if(s&&"update"!=s||(n=!0,[d,u]=this.rollbackUpdate(a,f)),s&&"delete"!=s||(r=!0,c=this.rollbackDelete(a,f)),s&&"add"!=s||(e=!0,h=this.rollbackAdd(a,f)),!1===i._digestData({history:!1,allowInvalid:!0,checkEditable:!1,source:"rollback",track:!1,addList:c,updateList:d,deleteList:h}))return!1;u.forEach(function(t){i.removeClass(t)}),n&&(this.udata=[]),r&&(this.ddata=[]),e&&(this.adata=[]),l&&i.refreshView({header:!1})},isEqualX(t,e){const n=t=>null===t||"object"!=typeof t?[]:Object.keys(t).filter(e=>void 0!==t[e]),r=t=>{if(void 0===t)return!0;if(null!==t&&"object"==typeof t&&!Array.isArray(t)){const e=Object.keys(t);return 0===e.length||e.every(e=>r(t[e]))}return!1};if(r(t)&&r(e))return!0;if(t===e)return!0;if(null==t||null==e||"object"!=typeof t||"object"!=typeof e)return!1;const i=n(t),o=n(e);if(i.length!==o.length)return!1;for(let n of i)if(!o.includes(n)||!this.isEqualX(t[n],e[n]))return!1;return!0},update:function(e){var n=this.that,r=this.options.trackModel.dirtyClass,i=e.rowData||n.getRowData(e),o=n.getRecId({rowData:i}),a=e.dataIndx,l=e.refresh,s=n.columns,c=n.getValueFromDataType,d=e.row,u=this.udata,h=u.slice(0),f=!1;if(null!=o&&0!=(o+"").indexOf("pq_tmp_")){for(var p=0,g=u.length;p<g;p++){var m=u[p],v=m.oldRow;if(m.rowData==i){for(var a in f=!0,d){var w=s[a],x=v.hasOwnProperty(a),y=d[a],b=v[a];if(w){let t=w.dataType;if(y=c(y,t),b=c(b,t),x&&b===y){var C={rowData:i,dataIndx:a,refresh:l,cls:r};n.removeClass(C),delete v[a]}else{C={rowData:i,dataIndx:a,refresh:l,cls:r};n.addClass(C),x||(v[a]=i[a])}}else if(x){let e=t.extend(!0,{},i[a]);for(let t in y)e[t]=y[t];(null==y||this.isEqualX(b,e))&&delete v[a]}else b=pq.getOldCellX(i,d,a),v[a]=b}t.isEmptyObject(v)&&h.splice(p,1);break}}if(!f){v={};for(a in d)v[a]=pq.getOldCellX(i,d,a),s[a]&&n.addClass({rowData:i,dataIndx:a,refresh:l,cls:r});h.push({rowData:i,recId:o,oldRow:v})}this.udata=h}}},n.getChanges=function(t={}){this.blurEditor({force:!0});var e=t.format,n=this.iUCData;return"byVal"==e?n.getChangesValue(t):"raw"==e?n.getChangesRaw():n.getChanges()},n.rollback=function(t={}){if(this.blurEditor({force:!0}),!1===this.iUCData.rollback(t))return!1;t.type||this.iHistory.resetUndo()},n.isDirty=function(t){return this.iUCData.isDirty(t)},n.commit=function(t){this.iUCData.commit(t)},n.flattenRowList=function(t){let e=this.columns,n=[];return this.normalizeList(t).forEach(function(t){var r,i=t.newRow,o=t.rowData,a={},l=t.oldRow={};if(o){for(r in i){var s=i[r];if(e[r])if(s&&"object"==typeof s){let t,e=(t,e)=>{(a[t]||={})[r]=e,o[t]?(l[t]||={})[r]=o[t][r]:l[t]=void 0};for(let n in s){let i=s[n];"val"==n?(a[r]=i,l[r]=o[r]):["attr","prop","style"].includes(n)?e("pq_cell"+n,i):t=!0}t&&(a[r]=s,l[r]=o[r])}else a[r]=s,l[r]=o[r];else if(r.startsWith("pq_cell")){if(s&&"object"==typeof s)for(let t in s){let e=s[t];(a[r]||={})[t]=e,o[r]?(l[r]||={})[t]=o[r][t]:l[r]=void 0}}else a[r]=s,l[r]=o[r]}t.newRow=a,n.push(t)}}),n},n.updateRow=function(e){var n=this,r=e.rowList||[{rowIndx:e.rowIndx,newRow:e.newRow||e.row,rowData:e.rowData,rowIndxPage:e.rowIndxPage}],i=n.flattenRowList(r);if(i.length){var o={undoAreas:e.undoAreas,source:e.source||"update",history:e.history,checkEditable:e.checkEditable,track:e.track,allowInvalid:e.allowInvalid,updateList:i},a=n._digestData(o);if(!1===a)return!1;t.isArray(a)&&a.forEach(function(t){n.refreshCell({rowIndxPage:t[0],colIndx:t[1],skip:!0})})}},n.getRecId=function(t){var e=this.options.dataModel;t.dataIndx=e.recIndx;var n=this.getCellData(t);return null==n?null:n},n.getCellData=function(t){var e=t.rowData||this.getRowData(t),n=t.dataIndx;return e?e[n]:null},n.getRowData=function(t){if(!t)return null;var e,n=t.rowData;if(null!=n)return n;if(null==(e=t.recId)){var r=null!=(r=t.rowIndx)?r:t.rowIndxPage+this.riOffset;return c=this.get_p_data()[r]}for(var i=this.options.dataModel,o=i.recIndx,a=i.data,l=0,s=a.length;l<s;l++){var c;if((c=a[l])[o]==e)return c}return null},n.addNodes=function(t,e){e=null==e?this.options.dataModel.data.length:e,this._digestData({addList:t.map(function(t){return{rowIndx:e++,newRow:t}}),source:"addNodes",checkEditable:!1}),this.refreshView()},n.deleteNodes=function(t){this._digestData({deleteList:t.map(function(t){return{rowData:t}}),source:"deleteNodes"}),this.refreshView()},n.moveNodes=function(t,e,n){var r,i=this,o=arguments,a=!n,l=t[0].pq_ri,s=e<l,c=i.options,d=i.riOffset,u=c.dataModel.data,h=e??u.length;i._trigger("beforeMoveNode",null,{args:o}),t.forEach(function(t){a&&(null!=r&&t.pq_ri!=r+1?a=!1:r=t.pq_ri),h=pq.moveItem(t,u,u.indexOf(t),h)}),u!=i.pdata&&(i.pdata=u.slice(d,c.pageModel.rPP+d)),i.iRefresh.addRowIndx(),i.iMerge.init(),a&&i.iHistory.push({callback:function(n){i.moveNodes(t,n?e:l+(s?t.length:0),!0)}}),i._trigger("moveNode",null,{args:o}),i.refresh()},n.deleteRow=function(t){var e=this.normalizeList(t.rowList||[{rowIndx:t.rowIndx,rowIndxPage:t.rowIndxPage,rowData:t.rowData}]);if(!e.length)return!1;this._digestData({source:t.source||"delete",history:t.history,track:t.track,deleteList:e}),!1!==t.refresh&&this.refreshView({header:!1})},n.addRow=function(t){var e,n,r=this.riOffset,i=this.options.dataModel,o=i.data=i.data||[];return t.rowData&&(t.newRow=t.rowData),null!=t.rowIndxPage&&(t.rowIndx=t.rowIndxPage+r),!(!(n=t.rowList||[{rowIndx:t.rowIndx,newRow:t.newRow}]).length||!1===this._digestData({source:t.source||"add",history:t.history,track:t.track,checkEditable:t.checkEditable,addList:n}))&&(!1!==t.refresh&&this.refreshView({header:!1}),null==(e=n[0].rowIndx)?o.length-1:e)}}(jQuery),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){return setTimeout(t,10)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},function(t){var e=t.paramquery;function n(t){var e=this;e.that=t,t.on("cellClick",e.onCellClick.bind(e)).on("cellMouseDown",e.onCellMouseDown.bind(e)).on("cellMouseEnter",e.onCellMouseEnter.bind(e))}e.cMouseSelection=n,n.prototype=t.extend({onCellMouseDown:function(e,n){if(!e.isDefaultPrevented()){var r=this,i=r.that,o=n.rowIndx,a=i.iSelection,l=n.colIndx,s=i.options,c=s.selectionModel,d=s.focusModel,u=c.type,h=c.mode,f=!e.which||1==e.which,p=a.addressLast();if(!t(e.originalEvent.target).is("textarea,select,input:not([type='checkbox'])")){if("cell"==u){if(null==l)return;if(-1==l){if(!c.row)return;l=void 0}if(e.shiftKey&&"single"!==h&&p){var g=p.firstR,m=p.firstC;r.mousedown={r1:g,c1:m},a.resizeOrReplace({r1:g,c1:null==l?void 0:m,r2:o,c2:l,firstR:g,firstC:m})}else pq.isCtrl(e)&&"single"!==h?(r.mousedown={r1:o,c1:l},null==l?a.add({r1:o,firstR:o,firstC:i.getFirstVisibleCI()}):a.add({r1:o,c1:l,firstR:o,firstC:l})):f&&(r.mousedown={r1:o,c1:l},a.clearOther({r1:o,c1:l},!0),null==l?a.resizeOrReplace({r1:o,firstR:o,firstC:i.getFirstVisibleCI()}):a.resizeOrReplace({r1:o,c1:l,firstR:o,firstC:l}))}f&&d.focusable&&i.focus(n),c.native||"ontouchend"in document||e.preventDefault(),i.one("mousePQUp",r.onMousePQUp.bind(r))}}},onCellMouseEnter:function(t,e){var n=this.that,r=n.options.selectionModel,i=r.type,o=this.mousedown,a=r.mode;if(o&&"single"!==a){if("cell"===i){var l=o.r1,s=o.c1,c=e.rowIndx,d=e.colIndx,u=n.Selection();n.scrollCell({rowIndx:c,colIndx:d}),u.resizeOrReplace({r1:l,c1:s,r2:c,c2:d,firstR:l,firstC:s})}n.focusT(e)}},onCellClick:function(t,e){var n,r,i,o=this.that,a=o.options.selectionModel,l="single"==a.mode,s=a.toggle,c=o.iRows;if("row"==a.type){if(!a.row&&-1==e.colIndx)return;function d(){return null==i&&(r=c.getSelection(),i=r.length),i}n=c.isSelected(e),t.shiftKey&&!l&&d()?c.extend(e):s||pq.isCtrl(t)?n?c.remove(e):(e.isFirst=!0,c[!l&&d()?"add":"replace"](e)):n?c.removeAll():(e.isFirst=!0,c.replace(e))}},onMousePQUp:function(){this.mousedown=null}},new e.cClass)}(jQuery),function(t){var e=null,n=t.paramquery,r=n.pqGrid.prototype;t.extend(r.options,{copyModel:{on:!0,render:!1,zIndex:1e4},cutModel:{on:!0},pasteModel:{on:!0,compare:"byVal",select:!0,validate:!0,allowInvalid:!0,type:"replace"}}),t.extend(r,{_setGlobalClip(t){i.clip=t},_getGlobalClip:t=>i.clip,canPaste:function(){return!!n.cExcel.clip},clearPaste:function(){n.cExcel.clip=""},copy:function(t){var e=this.iSelection;if(e.address().length)return e.copy(t);this.iRows.toRange().copy(t)},cut:function(t){return this.iSelection.cut(t)},paste:async function(t){t=t||{};var n=this,r=navigator.clipboard,o=e=>!t.rows&&!t.text&&!t.pic;if(e=new i(n),o())if(r.read)try{var a,l,s,c=(await r.read())[0],d=c.types,u=async(t,e)=>{let n=await c.getType(t);return e?n:(await n.text()).trim()},h={"text/plain":"getRowsFromStr","text/html":"getRowsFromHtml"};for(s of["text/html","image/png","text/plain"])if(d.includes(s)){if("image/png"==s&&(a=await u(s,!0))){await new Promise(e=>{pq.fileToBase(a,n=>{t.rows=[[pq.RichObjs.Pic.toObject2(n)]],e()})});break}if((l=await u(s))&&h[s]&&(t.rows=pq[h[s]](l,n)))break}}catch(t){}else if(r.readText)try{t.text=await r.readText()}catch(t){}o()&&!(t.text=n._getGlobalClip())||(e.paste2(t),e=null)},clear:function(){var t=this.iSelection;t.address().length?t.clear():this.iRows.toRange().clear()}});var i=n.cExcel=function(t){this.that=t};i.clip="",i.prototype={initClip:function(t){var e=this,n=e.that,r=t[0];r.initCLip||n.iKeyNav.ignoreBlur(function(){var n=(n,i)=>{r.addEventListener(n,n=>{n.preventDefault(),e[i](n,t)})};n("copy","onCopy"),n("paste","onPaste"),n("cut","onCut"),r.initCLip=!0})},onCut(){this.that.cut()},onCopy(){this.that.copy()},async onPaste(t){var e=this,n=e.that,r=t.clipboardData,i=Array.from(r.items);i.sort((t,e)=>{var n="text/html",r="text/plain";return t.type==n?-1:e.type==n?1:t.type==r?-1:e.type==r?1:void 0});for(let a of i){let i,l=a.kind,s=a.type;if("file"===l&&s.startsWith("image/")){let n=a.getAsFile();await new Promise(r=>{pq.fileToBase(n,o=>{i=[[pq.RichObjs.Pic.toObject2(o,n.name)]],e.paste2({rows:i,event:t}),r()})});break}if("string"==l){var o=r.getData(s).trim();if(o&&"text/html"==s){if(i=pq.getRowsFromHtml(o,n)){e.paste2({rows:i,event:t});break}}else if(o&&"text/plain"==s&&(i=pq.getRowsFromStr(o,n))){e.paste2({rows:i,event:t});break}}}},paste2(e={}){var n=this.that,r=e.dest,i=e.text,o=e.pic,a=e.rows||(i?(t=>pq.getRowsFromHtml(t,n)||pq.getRowsFromStr(t,n))(i):o?[[o]]:[]),l=a.length,s=n.colModel,c=n.options,d=(n.readCell,c.pasteModel),u="row",h=!1,f=s.length,p=0;if(d.on&&l){var g,m,v,w,x,y,b=n.$cont.hasClass("pq-focus")?"append":d.type,C=(r?n.Range(r):n.Selection()).address(),q={rows:a,areas:[G=(C.length?C:n.iRows.toRange().address())[0]]};if(!1===n._trigger("beforePaste",null,q))return!1;G&&n.getRowData({rowIndx:G.r1})?(u="row"==G.type?"row":"cell",g=G.r1,v=G.r2,m=G.c1,w=G.c2):(u="cell",g=0,v=n.pageData().length-1,m=0,w=0),"replace"==b?(x=g,y=v-g+1<l?"extend":"repeat"):"append"==b?(x=v+1,y="extend"):"prepend"==b&&(x=g,y="extend");var I,_,R,D="extend"==y?l:v-g+1,M=0,S=0,T=[],F=[],k=0;for(p=0;p<D;p++){var E=a[M],P=p+x,$="replace"==b?n.getRowData({rowIndx:P}):null,A=$?{}:null,H={};if(void 0===E&&"repeat"===y&&(E=a[M=0]),$&&!1===$.pq_paste)D++,S++;else{M++;var O=E,L=O.length;if(!_)if("cell"==u){if(_="extend"==(I=w-m+1<L?"extend":"repeat")?L:w-m+1,isNaN(_))throw"lenH NaN. assert failed.";_+m>f&&(_=f-m)}else _=f,m=0;var N=0,V=0,j=0;for(R=_,V=0;V<R;V++){N>=L&&(N=0);var B=s[V+m],z=O[N],U=B.dataIndx;!1!==B.paste?(N++,pq.fillNewRow(H,A,z,$,U)):(j++,"extend"==I&&R+m<f&&R++)}0==t.isEmptyObject(H)&&(null==$?(h=!0,T.push({newRow:H,rowIndx:P})):F.push({newRow:H,rowIndx:P,rowData:$,oldRow:A}),k++)}}var W={addList:T,updateList:F,source:"paste",allowInvalid:d.allowInvalid,validate:d.validate},G={r1:x,c1:m,r2:x+k-1+S,c2:"extend"==I?m+_-1+j:w};W.undoAreas=[G],t(document.body).trigger("pq-paste",{dui:W,grid:n,rows:a}),n._digestData(W),n[h?"refreshView":"refresh"]({header:!1}),d.select&&n.Range(G).select(),n._trigger("paste",null,q)}}},t(document).off(".pqExcel").on("keydown.pqExcel",function(n){var r,o,a=t(document.activeElement),l=a.parent(),s=l.is(".pq-focus-mgr:not(.pq-editor-outer)"),c=s,d=n.key,u=n.keyCode,h=t.ui.keyCode,f=t=>{r=a.closest(".pq-grid"),o=r.pqGrid("instance")};if(!s||u!=h.UP&&u!=h.DOWN||n.preventDefault(),u==h.DELETE&&(f(),o?.clear()),pq.isCtrl(n)&&c&&(f(),e||a.length&&r.length)){if(!e)try{if(o.options.selectionModel.native)return!0;e=new i(o)}catch(t){return!0}a=e.initClip(a,l),"f"!=d&&"F"!=d||t(document).trigger("keyup.pqExcel")}}).on("keyup.pqExcel",function(t){if(!pq.isCtrl(t)&&e){e=null}}).on("click.pqExcel keydown.pqExcel",function(e){"click"!=e.type&&t.ui.keyCode.ENTER!=e.keyCode||t(e.target).trigger("pq:clickE")})}(jQuery),function(t){var e=t.paramquery,n=e.pqGrid.prototype.options;n.historyModel=n.historyModel||{on:!0,checkEditable:!0,checkEditableAdd:!1,allowInvalid:!0},(e.cHistory=function(t){var e=this;e.that=t,e.options=t.options,e.records=[],e.counter=0,e.id=0,t.on("keyDown",e.onKeyDown.bind(e)).on("dataAvailable",function(t,n){"filter"!=n.source&&e.reset()})}).prototype={begin(){return this.rangeHistory=pq.Range.history(this.that)},end(){this.rangeHistory.end(),this.rangeHistory=null},onKeyDown:function(t,e){var n=pq.isCtrl(t),r=t.key;return!n||"z"!=r&&"Z"!=r?!n||"y"!=r&&"Y"!=r?void 0:(this.redo(),!1):(this.undo(),!1)},resetUndo:function(){if(0==this.counter)return!1;this.counter=0,this.trigger("rollback")},reset:function(){if(0==this.counter&&0==this.records.length)return!1;this.records=[],this.counter=0,this.id=0,this.trigger("reset")},increment:function(){var t=this.records,e=t.length;if(e){var n=t[e-1].id;this.id=n+1}else this.id=0},push:function(e){var n=this.canRedo(),r=this.records,i=this.counter;r.length>i&&r.splice(i,r.length-i),r[i]=t.extend({id:this.id},e),this.counter++;this.that;this.counter,n&&(this.counter,r.length),this.trigger("add")},trigger(t){let e=this;e.that._trigger("history",null,{type:t,canUndo:e.canUndo(),canRedo:e.canRedo(),num_undo:e.counter,num_redo:e.records.length-e.counter})},canUndo:function(){return this.counter>0},canRedo:function(){return this.counter<this.records.length},undo:function(){var t=this.that,e=this.options.historyModel,n=this.records;if(!(this.counter>0))return!1;this.counter--;var r,i,o,a=n[this.counter],l=a.callback;a.id;if(l)l();else{if(r=a.updateList.map(function(e){return{rowIndx:t.getRowIndx({rowData:e.rowData}).rowIndx,rowData:e.rowData,oldRow:e.newRow,newRow:e.oldRow}}),o=a.addList.map(function(t){return{rowData:t.newRow}}),i=a.deleteList.map(function(t){return{newRow:t.rowData,rowIndx:t.rowIndx}}),!1===t._digestData({history:!1,source:"undo",checkEditable:e.checkEditable,checkEditableAdd:e.checkEditableAdd,allowInvalid:e.allowInvalid,addList:i,updateList:r,deleteList:o}))return!1;t[i.length||o.length?"refreshView":"refresh"]({source:"undo",header:!1}),this.select(r,a.undoAreas)}return this.trigger("undo"),!0},redo:function(){var t=this.that,e=this.options.historyModel,n=this.counter,r=this.records;if(n==r.length)return!1;var i,o,a,l=r[n],s=l.callback;l.id;if(s)s(!0);else{if(i=l.updateList.map(function(e){return{rowIndx:t.getRowIndx({rowData:e.rowData}).rowIndx,rowData:e.rowData,newRow:e.newRow,oldRow:e.oldRow}}),a=l.deleteList.map(function(t){return{rowData:t.rowData}}),o=l.addList.map(function(t){return{newRow:t.newRow,rowIndx:t.rowIndx}}),!1===t._digestData({history:!1,source:"redo",checkEditable:e.checkEditable,checkEditableAdd:e.checkEditableAdd,allowInvalid:e.allowInvalid,addList:o,updateList:i,deleteList:a}))return!1;t[o.length||a.length?"refreshView":"refresh"]({source:"redo",header:!1}),this.select(i,l.undoAreas)}return this.counter<r.length&&this.counter++,this.trigger("redo"),!0},select(t,e){var n=this.that,r=t=>{var e=t[0],r={rowIndxPage:e.r1,colIndx:e.c1};n.scrollCell(r,e=>{n.Range(t).select(),n.focus(r)})};if(e&&e.length)r(e);else if(t.length){var i,o=1/0,a=1/0,l=0,s=0,c=t[0].newRow;for(i in c){var d=n.getColIndx({dataIndx:i});if(-1==d)return;a=Math.min(a,d),s=Math.max(s,d)}t.forEach(t=>{o=Math.min(o,t.rowIndx),l=Math.max(l,t.rowIndx)}),r([{r1:o,c1:a,r2:l,c2:s}])}}};var r=e.pqGrid.prototype;r.history=function(t){var e=t.method;return this.iHistory[e](t)},r.History=function(){return this.iHistory}}(jQuery),function(t){var e=t.paramquery;pq.filter={dpBeforeShow:function(e,n,r){return function(){var i,o,a=e.getDataCascade(n);a.length&&(i=a.find(t=>!!t[n])[n],o=a[a.length-1][n]),t(this).datepicker("option","defaultDate",new Date(1==r?o:i))}},datepicker:function(e){var n=e.column,r=n.dataIndx,i=this,o=i.options,a=e.filterUI,l=e.$editor,s=n.dataType,c=n.fmtDateFilter||o.fmtDateFilter||n.format,d={dateFormat:pq.excelToJui(c||"yyyy-mm-dd"),changeYear:!0,changeMonth:!0};if("date"==s)return l.each(function(e,n){var o=t.extend({},d,1==e&&a.dpOptions2||a.dpOptions);o.defaultDate||(o.beforeShow=o.beforeShow||pq.filter.dpBeforeShow(i,r,e)),t(n).datepicker(o)}),!0},filterFnEq:function(e,n){var r=(e.column||{}).dataType;return"date"==r?this.filterFnTD(e,n):"bool"==r?{type:"checkbox"}:t.extend({maxCheck:1},this.filterFnSelect(e,n))},filterFnSelect:function(t,e){var n=t.column.dataIndx,r=t.indx;return{type:"select",style:"padding-"+(e&&e.options.rtl?"left":"right")+":16px;cursor:default;",attr:"readonly",valueIndx:n,labelIndx:n,options:this.options,init:0==r?this.rangeInit.bind(e):function(){}}},filterFnT:function(){return{type:"textbox",attr:`autocomplete='${Math.random()}'`}},filterFnTD:function(){return{type:"textbox",attr:`autocomplete='${Math.random()}'`,init:pq.filter.datepicker}},getVal:function(t){var e=(t.crules||[])[0]||{};return[e.value,e.value2,e.condition]},setVal:function(t,e){var n=t.crules=t.crules||[];return n[0]=n[0]||{},n[0].value=e,e}},t.extend(pq.filter,{conditions:{begin:{string:1,numberList:1,dateList:1,filterFn:pq.filter.filterFnT},between:{stringList:1,date:1,number:1,filter:{attr:`autocomplete='${Math.random()}'`,type:"textbox2",init:pq.filter.datepicker}},contain:{string:1,numberList:1,dateList:1,filterFn:pq.filter.filterFnT},equal:{string:1,bool:1,date:1,number:1,filterFn:pq.filter.filterFnEq},empty:{string:1,bool:1,date:1,number:1,nr:1},end:{string:1,numberList:1,dateList:1,filterFn:pq.filter.filterFnT},great:{stringList:1,number:1,date:1,filterFn:pq.filter.filterFnTD},gte:{stringList:1,number:1,date:1,filterFn:pq.filter.filterFnTD},less:{stringList:1,number:1,date:1,filterFn:pq.filter.filterFnTD},lte:{stringList:1,number:1,date:1,filterFn:pq.filter.filterFnTD},notbegin:{string:1,numberList:1,dateList:1,filterFn:pq.filter.filterFnT},notcontain:{string:1,numberList:1,dateList:1,filterFn:pq.filter.filterFnT},notequal:{string:1,date:1,number:1,bool:1,filterFn:pq.filter.filterFnEq},notempty:{string:1,bool:1,date:1,number:1,nr:1},notend:{string:1,numberList:1,dateList:1,filterFn:pq.filter.filterFnT},range:{cascade:1,string:1,number:1,date:1,bool:1,filterFn:pq.filter.filterFnSelect},regexp:{string:1,numberList:1,dateList:1,filterFn:pq.filter.filterFnT}},getConditionsCol:function(t,e){var n=e.conditionList||function(e){var n=e.getConditionsDT(pq.getDataType(t));return n.sort(),n}(this),r=e.conditionExclude,i={};return r&&(r.forEach(function(t){i[t]=1}),n=n.filter(function(t){return!i[t]})),n},getConditionsDT:function(t){var e,n,r,i=[],o=this.conditions;for(e in o)r=(n=o[e])[t+"List"],(n[t]&&0!==r||r)&&i.push(e);return i},getFilterUI:function(e,n){var r=e.column,i=r.filterFn,o=r.filter||{},a=this.conditions[e.condition]||{},l=a.filterFn,s=a.filter||{};delete o.type,i=i&&i.call(n,e)||{},l=l&&l.call(this,e,n)||{};var c=t.extend({},s,l,o,i);return c.condition=e.condition,c.init=[],c.options=[],[i,o,l,s].forEach(function(t){t.init&&c.init.push(t.init),t.options&&c.options.push(t.options)}),c},options:function(t){var e=t.column,n=t.filterUI,r=n.groupIndx,i=e.dataIndx;return this.getDataCascade(i,r,n.diExtra)},getOptions:function(t,e,n){for(var r,i,o=e.options,a=t.dataIndx,l={column:t,dataIndx:a,filterUI:e,condition:e.condition},s=0,c=o.length;s<c;s++)if((r=o[s])&&(i=pq.isFn(r)?r.call(n,l):r))return i=n.getPlainOptions(i,a),i=n.removeNullOptions(i,e.dataIndx||a,e.groupIndx);return[]},rangeInit:function(e){var n=this,r=n.options.filterModel.appendTo,i=e.column,o=n.uuid+"_"+i.dataIndx,a=e.$editor,l=e.headMenu,s=e.filterUI,c=e=>{t("#"+o).remove()};l||a.parent().off("click keydown").on("click keydown",function(e){var l=e.key,d=t("#"+o);function u(){pq.position(d,{my:"left top",at:"left bottom",of:a})}if(r="function"==typeof r?r.call(n):r,n.off("change",c).one("change",c),!l||"ArrowDown"==l||"Enter"==l){e.preventDefault(),d[0]&&(d.remove(),d=null);var h=new pq.cFilterMenu.select(n,i),f=d=n.$filterpopup=t("<div id='"+o+"' class='pq-theme pq-head-menu'><div></div></div>").appendTo("grid"==r?n.widget():r||document.body),p=f.children();pq.makePopup(f[0],a[0],{closeOnEle:!0}),u(),h.create(p,s),u(),pq.focusEle(null,d)}})},getType:function(t,e){var n=this.conditions[t]||{},r=n.filterFn;return(n.filter||{}).type||(r?r.call(this,{condition:t,column:e}):{}).type}});var n=function(t){var e=this;e.that=t,t.on("load",e.onLoad.bind(e)).on("filter clearFilter",e.onFilterChange.bind(e))};e.cFilterData=n;var r=n.conditions={equal:function(t,e){return t==e},notequal:function(){return!r.equal.apply(this,arguments)},contain:function(t,e){return-1!=(t+"").indexOf(e)},notcontain:function(){return!r.contain.apply(this,arguments)},empty:function(t){return 0==t.length},notempty:function(){return!r.empty.apply(this,arguments)},begin:function(t,e){return 0==(t+"").indexOf(e)},notbegin:function(){return!r.begin.apply(this,arguments)},end:function(t,e){var n=(t+="").lastIndexOf(e+="");if(-1!=n&&n+e.length==t.length)return!0},notend:function(){return!r.end.apply(this,arguments)},regexp:function(t,e){if(e.test(t))return e.lastIndex=0,!0},great:function(t,e){return t>e},gte:function(t,e){return t>=e},between:function(t,e,n){return t>=e&&t<=n},range:function(e,n){return-1!=t.inArray(e,n)},less:function(t,e){return t<e},lte:function(t,e){return t<=e}};n.convert=function(t,e){return null==t||""===t?"":("string"==e?t=(t+"").trim().toUpperCase():"date"==e?(10==t.length&&/^\d+-/.test(t)&&(t+="T00:00"),t=Date.parse(t)):"number"==e?1*t==t&&(t*=1):"bool"==e&&(t=String(t).toLowerCase()),t)},n.convertEx=function(t,e,n,r,i){var o=pq.getDataType({dataType:e}),a=pq.filter.conditions[n];return a[o]?this.convert(t,o):a.string?(r&&(t=i.formatCol(r,t)),"regexp"==n?t:this.convert(t,"string")):a.number?this.convert(t,"number"):void 0},n.prototype={addMissingConditions:function(t){var e=this.that;t.forEach(function(t){var n=e.getColumn({dataIndx:t.dataIndx}).filter||{};t.condition=void 0===t.condition?pq.filter.getVal(n)[2]:t.condition})},clearFilters:function(t){t.forEach(function(t){var e=t.filter,n=pq.filter.conditions;e&&(e.crules||[]).forEach(function(t){(n[t.condition]||{}).nr&&(t.condition=void 0),t.value=t.value2=void 0})})},compatibilityCheck:function(t){var e,n=t.data,r="Incorrect filter parameters. Please check upgrade guide";if(n)if(e=n[0]){if(e.hasOwnProperty("dataIndx")&&e.hasOwnProperty("value"))throw r}else if(!t.rules)throw r},copyRuleToColumn:function(t,e,n){var r=e.filter=e.filter||{},i=t.crules||[],o=i[0],a=o?o.condition:t.condition,l=o?o.value:t.value,s=o?o.value2:t.value2;"remove"==n?(r.on=!1,r.crules=a?[{condition:a,value:"range"==a?[]:void 0}]:void 0):(r.on=!0,r.mode=t.mode,r.crules=o?i:[{condition:a,value:l,value2:s}])},filter:function(t){t=t||{},this.compatibilityCheck(t);var e,n,r=this.that,i=r.options,o=!1,a=t.data,l=t.rules=t.rules||(t.rule?[t.rule]:[]),s=!a,c=i.dataModel.location,d=i.filterModel,u=d.type,h=t.mode||d.mode,f=t.oper,p="replace"==f,g=s?r.colModel:this.getCMFromRules(l),m=0,v=l.length;if("remove"!=f&&this.addMissingConditions(l),s){if(!1===r._trigger("beforeFilter",null,t))return;for(o=t.header??o,p&&this.clearFilters(g);m<v;m++)e=l[m],n=r.getColumn({dataIndx:e.dataIndx}),this.copyRuleToColumn(e,n,f)}else for(;m<v;m++)e=l[m],n=g[m],this.copyRuleToColumn(e,n);var w={header:o,CM:g,data:a,rules:l,mode:h};if("local"==c||"local"==u)return w.source="filter",w.trigger=!1,r._onDataAvailable(w);r.refreshDataAndView(w)},hideRows:function(t,e,n){for(var r,i=0,o=e.length;i<o;i++)r=e[i],t.length?r.pq_hidden=r.pq_filter=!this.isMatchRow(r,t,n):r.pq_filter&&(delete r.pq_filter,delete r.pq_hidden)},filterLocalData:function(t){t=t||{};var e,n=this,r=n.that,i=t.data,o=!i,a=o?r.colModel:t.CM,l=n.getRulesFromCM({CM:a,apply:o}),s=r.options,c=s.dataModel,d=r.iSort,u=i||c.data,h=c.dataUF=c.dataUF||[],f=[],p=[],g=s.filterModel,m=t.mode||g.mode,v={filters:l,mode:m,data:u};if(g.hideRows)v.hideRows=!0,!1!==r._trigger("customFilter",null,v)&&n.hideRows(l,u,m);else{if(o)if(h.length){e=!0;for(var w=0,x=h.length;w<x;w++)u.push(h[w]);h=c.dataUF=[]}else{if(!l.length)return{data:u,dataUF:h};d.saveOrder()}if(g.on&&m&&l&&l.length){if(u.length)if(!1===r._trigger("customFilter",null,v))f=v.dataTmp,p=v.dataUF;else for(w=0,x=u.length;w<x;w++){var y=u[w];n.isMatchRow(y,l,m)?f.push(y):p.push(y)}u=f,h=p,0==d.readSorter().length&&(u=d.sortLocalData(u)),o&&(c.data=u,c.dataUF=h)}else e&&o&&(0==d.readSorter().length&&(u=d.sortLocalData(u)),v={data:u},!1===r._trigger("clearFilter",null,v)&&(u=v.data),c.data=u,r._queueATriggers.filter={ui:{type:"local"}})}return o&&(r._queueATriggers.filter={ui:{type:"local",rules:l}}),{data:u,dataUF:h}},_getRulesFromCM:function(e,r,i,o,a,l,s){if("between"==i)""===o||null==o?o=s(a,l,i="lte"):""===a||null==a?o=s(o,l,i="gte"):(o=s(o,l,i),a=s(a,l,i));else if("regexp"==i){if("remote"==e)o=o.toString();else if(pq.isStr(o))try{var c=r.modifiers||"gi";o=new RegExp(o,c)}catch(t){o=/.*/}}else if("range"==i||t.isArray(o)){if(null==o)return;if(pq.isFn(o.push)){if(0===o.length)return;if("range"!=i)o=s(o[0],l,i);else for(var d=0,u=(o=o.slice()).length;d<u;d++)o[d]=s(o[d],l,i)}}else i&&(o=s(o,l,i),null!=a&&(a=s(a,l,i)));return[o,a,"remote"==e?"":((r.conditions||{})[i]||{}).compare||pq.filter.conditions[i].compare||n.conditions[i],i]},getRulesFromCM:function(t){var n=t.CM;if(!n)throw"CM N/A";for(var r=this,i=n.length,o=0,a=t.location,l="remote"===a,s=[],c=e.cFilterData,d=function(t,e,n){return l?(t=null==t?"":t).toString():c.convertEx(t,e,n)};o<i;o++){var u=n[o],h=u.filter;if(h){var f,p,g,m,v,w,x=u.dataIndx,y=u.dataType,b=h.crules||[h],C=[];y=!y||"stringi"==y||pq.isFn(y)?"string":y,b.forEach(function(t){m=t.condition,p=t.value,g=t.value2,m&&r.isCorrect(m,p,g)&&(w=r._getRulesFromCM(a,h,m,p,g,y,d))&&(p=w[0],g=w[1],v=w[2],C.push({condition:w[3],value:p,value2:g,cbFn:v}))}),C.length&&(f={dataIndx:x,dataType:y,format:u.formatRaw},l&&1==C.length?(f.value=C[0].value,f.value2=C[0].value2,f.condition=C[0].condition):(f.crules=C,f.mode=h.mode,l||(f.column=u)),s.push(f))}}return(t.apply||l)&&this.sortRulesAndFMIndx(s),s},getCMFromRules:function(t){var e=this.that;return t.map(function(t){var n=e.getColumn({dataIndx:t.dataIndx});return pq.copyObj({},n,["parent"])})},getQueryStringFilter:function(){var t,e=this.that,n=e.options,r=n.stringify,i=n.filterModel,o=i.mode,a=e.colModel,l=i.newDI||[],s=this.getRulesFromCM({CM:a,location:"remote"}),c="";if(i&&i.on&&s)if(s.length){var d=(t,e)=>{var n=t.format,r=t[e];t[e]=r&&n?pq.formatDate(r,n):r};s.forEach(t=>{"date"==t.dataType&&(d(t,"value"),d(t,"value2"))}),t={mode:o,data:s},c=r?JSON.stringify(t):t}else c="",l.length&&e._trigger("clearFilter");return c},isCorrect:function(t,e,n){var r=pq.filter.conditions[t];if(r)return!!(null!=e&&""!==e||null!=n&&""!==n||r.nr);throw"filter condition NA"},isMatchCell:function(t,e){for(var r,i,o,a,l,s,c=t.dataIndx,d=this.that,u=t.column,h=t.dataType,f=t.mode,p=[],g=t.crules,m=g.length,v=e[c],w=0;w<m;w++)o=(l=g[w]).condition,r=l.value,i=l.value2,a=l.cbFn,o&&("regexp"===o&&(s=null==v?"":v),s=n.convertEx(v,h,o,u,d),p.push(!!a.call(d,s,r,i,e,u)));if(m=p.length,"AND"===f){for(w=0;w<m;w++)if(!p[w])return!1;return!0}for(w=0;w<m;w++)if(p[w])return!0;return!1},isMatchRow:function(t,e,n){var r,i,o=0,a=e.length,l="AND"==n,s=!l;if(0==a)return!0;for(;o<a;o++){if(r=e[o],(i=this.isMatchCell(r,t))&&(r.found=!0),s&&i)return!0;if(l&&!i)return!1}return l},onFilterChange:function(){var t=this.that,e=t.options,n=e.filterModel,r="remote"==n.type,i=n.oldDI||[],o=!e.dataModel.data.length,a=t.headerCells,l=r||o,s=function(e,n){for(var r=t.getColIndx({dataIndx:n}),i=0;i<=1;i++)t[e]({ri:a.length-i,colIndx:r,cls:"pq-col-filtered"})},c=(n.rules||[]).reduce(function(t,e){return(e.found||l)&&t.push(e.dataIndx),t},[]);i.forEach(function(t){s("removeClassHead",t)}),c.forEach(function(t){s("addClassHead",t)}),n.oldDI=n.newDI=c},onLoad:function(){var t=this.that.options.dataModel.dataUF;t&&(t.length=0)},sortRulesAndFMIndx:function(t){var e=this.that.options.filterModel,n=e.newDI;t.sort(function(t,e){var r=t.dataIndx,i=e.dataIndx,o=n.indexOf(r),a=n.indexOf(i);return o>=0&&a>=0?o-a:o>=0?-1:a>=0?1:0}),e.rules=t}}}(jQuery),function(t){var e=t.paramquery,n=e.cSort=function(t){var e=this;e.that=t,e.sorters=[],e.tmpPrefix="pq_tmp_",e.cancel=!1};e.pqGrid.prototype.sort=function(t){if((t=t||{}).data)return this.iSort._sortLocalData(t.sorter,t.data);var e=this,n=e.options,r=n.dataModel,i=r.data,o=r.location,a=n.sortModel.type;if(i&&i.length||"local"!=a){var l,s=n.editModel,c=e.iSort,d=c.getSorter(),u=t.evt,h=t.single??c.readSingle(),f=c.readCancel();if(t.sorter?t.addon?(t.single=h,t.cancel=f,l=c.addon(t)):l=t.sorter:l=c.readSorter(),l.length||d.length){s.indices&&e.blurEditor({force:!0});var p={dataIndx:l.length?l[0].dataIndx:null,oldSorter:d,sorter:l,source:t.source,single:h};!1!==e._trigger("beforeSort",u,p)?(c.resumeSort(),"local"==a&&c.saveOrder(),c.setSorter(l),c.setSingle(h),c.writeSorter(l),c.writeSingle(h),"local"==a?(r.data=c.sortLocalData(i,!t.skipCustomSort,i[0]==e.pdata[0]?"pq_order":"pq_gorder"),e._queueATriggers.sort={evt:u,ui:p},!1!==t.refresh&&e.refreshView()):"remote"==a&&(e._queueATriggers.sort={evt:u,ui:p},t.initByRemote||!1!==e._trigger("customSort")&&("lazy"==o?e.iLazy.init({initBySort:!0}):e.remoteRequest({initBySort:!0,callback:function(){e._onDataAvailable()}})))):c.cancelSort()}}},n.prototype={addon:function(e){var n=(e=e||{}).sorter[0],r=n.dataIndx,i=n.dir,o=e.single,a=e.cancel,l=this.readSorter(),s=l[0];if(null==o)throw"sort single N/A";if(null!=r)if(o&&!e.tempMultiple)if((s=(l=l.length?[l[0]]:[])[0])&&s.dataIndx==n.dataIndx){var c=s.dir,d="up"===c?"down":a&&"down"===c?"":"up";""===d?l.length--:s.dir=d}else d=i||"up",l[0]=t.extend({},n,{dir:d});else{var u=this.inSorters(l,r);u>-1?"up"==(c=l[u].dir)?l[u].dir="down":a&&"down"==c?l.splice(u,1):1==l.length?l[u].dir="up":l.splice(u,1):l.push(t.extend({},n,{dir:"up"}))}return l},cancelSort:function(){this.cancel=!0},resumeSort:function(){this.cancel=!1},readSorter:function(){var t=this.that,e=t.columns,n=(t.options.sortModel.sorter||[]).filter(function(t){return!!e[t.dataIndx]});return n=pq.arrayUnique(n,"dataIndx")},setSingle:function(t){this.single=t},getSingle:function(){return this.single},readSingle:function(){return this.that.options.sortModel.single},setCancel:function(t){this.cancel=t},readCancel:function(){return this.that.options.sortModel.cancel},saveOrder:function(t){t=t||"pq_order";var e,n=this.that.get_p_data(),r=n.find(function(t){return t&&!t.pq_gtitle&&!t.pq_gsummary});if(r&&null==r[t]||!r)for(var i=0,o=(e=n).length;i<o;i++)(r=e[i])&&(r[t]=i)},getCancel:function(){return this.cancel},getQueryStringSort:function(){if(this.cancel)return"";var t=this.that,e=this.sorters,n=t.options.stringify;return e.length?n?JSON.stringify(e):e:""},getSorter:function(){return this.sorters},setSorter:function(t){this.sorters=t.slice(0)},inSorters:function(t,e){for(var n=0;n<t.length;n++)if(t[n].dataIndx==e)return n;return-1},sortLocalData:function(t,e,n){n=n||"pq_order";var r=this.sorters;return r.length||t.length&&null!=t[0][n]&&(r=[{dataIndx:n,dir:"up",dataType:"integer"}]),this._sortLocalData(r,t,e)},compileSorter:function(t,e){var n=this,i=n.that,o=i.columns,a=i.options,l=[],s=[],c=[],d=n.tmpPrefix,u=a.sortModel,h=u.useCache,f=u.ignoreCase,p=t.length;e=e||a.dataModel.data;for(var g=0;g<p;g++){var m=t[g],v=m.sortIndx||m.dataIndx,w=o[v]||{},x="up"==(m.dir=m.dir||"up")?1:-1,y=pq.getFn(w.sortType),b="string"==(b=w.dataType||m.dataType||"string")&&f?"stringi":b,C=h&&"date"==b,q=C?d+v:v;s[g]=q,c[g]=x,y?l[g]=function(t,e){return function(n,r,i,o){return e(n,r,i,o,t)}}(y,r.sort_sortType):"integer"==b||"float"==b?l[g]=r.sort_number:pq.isFn(b)?l[g]=function(t,e){return function(n,r,i,o){return e(n,r,i,o,t)}}(b,r.sort_dataType):l[g]="date"==b?r["sort_date"+(C?"_fast":"")]:"bool"==b?r.sort_bool:"stringi"==b?r.sort_locale:r.sort_string,C&&n.addCache(e,b,v,q)}return n._composite(l,s,c,p)},_composite:function(t,e,n,r){return function(i,o){for(var a=0,l=0;l<r&&0==(a=t[l](i,o,e[l],n[l]));l++);return a}},_sortLocalData:function(t,e,n){if(!e)return[];if(!e.length)return e;var r=this,i=r.that,o=i.options.sortModel,a=r.compileSorter(t,e),l={sort_composite:a,data:e,sorter:t};return t&&t.length?(n&&!1===i._trigger("customSort",null,l)?e=l.data:e.sort(a),o.useCache&&r.removeCache(t,e)()):i._trigger("cancelSort",null,l),e},addCache:function(t,e,n,i){for(var o=r["get_"+e],a=t.length;a--;){var l=t[a];l[i]=o(l[n])}},removeCache:function(t,e){var n=this.tmpPrefix;return function(){for(var r=t.length;r--;){var i=t[r],o=n+i.dataIndx,a=e.length;if(a&&e[0].hasOwnProperty(o))for(;a--;)delete e[a][o]}}},writeCancel:function(t){this.that.options.sortModel.cancel=t},writeSingle:function(t){this.that.options.sortModel.single=t},writeSorter:function(t){this.that.options.sortModel.sorter=t}};var r={get_date:function(t){var e;return t?isNaN(e=Date.parse(t))?0:e:0},sort_number:function(t,e,n,r){var i=t[n],o=e[n];return((i=i?1*i:0)-(o=o?1*o:0))*r},sort_date:function(t,e,n,r){var i=t[n],o=e[n];return((i=i?Date.parse(i):0)-(o=o?Date.parse(o):0))*r},sort_date_fast:function(t,e,n,r){return(t[n]-e[n])*r},sort_dataType:function(t,e,n,r,i){return i(t[n],e[n])*r},sort_sortType:function(t,e,n,r,i){return i(t,e,n)*r},sort_string:function(t,e,n,r){var i=t[n]||"",o=e[n]||"",a=0;return i>o?a=1:i<o&&(a=-1),a*r},sort_locale:function(t,e,n,r){var i=t[n]||"",o=e[n]||"";return i.localeCompare(o)*r},sort_bool:function(t,e,n,r){var i=t[n],o=e[n],a=0;return i&&!o||!1===i&&null==o?a=1:(o&&!i||!1===o&&null==i)&&(a=-1),a*r}};pq.sortObj=r}(jQuery),function(t){function e(t){var e=this;e.that=t,e.mc=null,t.on("dataReadyDone colMove groupShowHide hideCols",function(n,r){t.options.mergeCells&&"pager"!==r.source&&e.init()}),t.on("colAdd colRemove",e.alterColumn.bind(e)).on("change",e.onChange.bind(e)),t.Merge=function(){return e}}jQuery.paramquery.cMerge=e,e.prototype={auto:function(t,e){var n=this.that,r=n.pdata;return e=e||[],t.forEach(function(t){for(var i=1,o=n.colIndxs[t],a=r.length;a--;){var l=r[a][t],s=r[a-1]?r[a-1][t]:void 0;void 0!==s&&l==s?i++:i>1&&(e.push({r1:a,c1:o,rc:i,cc:1}),i=1)}}),e},calcVisibleColumns:function(t,e,n,r){var i=0,o=t.length;for(n=n>o?o:n;e<n;e++)r(t[e])||i++;return i},calcVisibleRows:function(t,e,n,r){var i=0,o=e,a=t.length;for(n=n>a?a:n;o<n;o++)r(t[o])||i++;return i},findNextVisibleColumn:function(t,e,n,r){for(var i,o=e;o<e+n;o++){if(!(i=t[o]))return-1;if(!r(i))return o}},findNextVisibleRow:function(t,e,n,r){for(var i,o=e;o<e+n;o++){if(!(i=t[o]))return-1;if(!r(i))return o}},getData:function(t,e,n){var r,i=this.mc;if(i[t]&&(r=i[t][e])){var o=r.data;return o?o[n]:null}},inflateRange:function(t,e,n,r){var i=this.that,o=!1,a=i.riOffset+i.pdata.length-1,l=i.colModel.length-1,s=this.mc2;if(!s)return[t,e,n,r];t:for(var c=0,d=s.length;c<d;c++){var u=s[c],h=u.r1,f=u.c1,p=(p=h+u.rc-1)>a?a:p,g=(g=f+u.cc-1)>l?l:g;if((h<t&&p>=t||h<=n&&p>n)&&g>=e&&f<=r||(f<e&&g>=e||f<=r&&g>r)&&p>=t&&h<=n){o=!0,t=h<t?h:t,e=f<e?f:e,n=p>n?p:n,r=g>r?g:r;break t}}return o?this.inflateRange(t,e,n,r):[t,e,n,r]},init:function(t,e){var n=this,r=n.that,i=r.colModel,o=r.options.mergeCells||[],a=r.get_p_data(),l=[],s=[];t=t||function(t){return t.hidden},e=e||function(t){return t.pq_hidden};for(var c=0,d=o.length;c<d;c++){var u,h,f=o[c],p=f.r1,g=p,m=a[p],v=f.c1,w=v,x=i[v],y=f.rc,b=f.cc;if(x&&m&&(t(x)&&(w=n.findNextVisibleColumn(i,v,b,t)),u=n.calcVisibleColumns(i,v,v+b,t),e(m)&&(g=n.findNextVisibleRow(a,p,y,e)),!((h=n.calcVisibleRows(a,p,p+y,e))<1||u<1))){l.push({r1:p,c1:v,rc:y,cc:b}),s[g]=s[g]||[],s[g][w]={show:!0,rowspan:h,colspan:u,o_rowspan:y,o_colspan:b,style:f.style,cls:f.cls,attr:f.attr,r1:p,c1:v,v_r1:g,v_c1:w};for(var C={show:!1,r1:p,c1:v,v_r1:g,v_c1:w},q=p;q<p+y;q++){s[q]=s[q]||[];for(var I=v;I<v+b;I++)q==g&&I==w||(s[q][I]=C)}}}r._mergeCells=s.length>0,n.mc=s,n.mc2=l},ismergedCell:function(t,e){var n,r=this.mc;if(r&&r[t]&&(n=r[t][e])){var i=n.v_r1,o=n.v_c1;return t!=i||e!=o||{o_ri:n.r1,o_ci:n.c1,v_rc:n.rowspan,v_cc:n.colspan,o_rc:n.o_rowspan,o_cc:n.o_colspan}}return!1},isRootCell:function(t,e,n){var r,i=this.mc;if(i&&i[t]&&(r=i[t][e])){if("o"==n)return t==r.r1&&e==r.c1;var o=r.v_r1,a=r.v_c1;if(o==t&&a==e){var l=i[o][a];return{rowspan:l.rowspan,colspan:l.colspan}}}},removeData:function(t,e,n){this.that;var r,i=this.mc;if(i&&i[t]&&(r=i[t][e])){var o=r.data;o&&(o[n]=null)}},getRootCell:function(t,e){var n,r,i,o=this.mc;if(o&&o[t]&&(i=o[t][e]))return n=i.v_r1,r=i.v_c1,{o_ri:(i=o[n][r]).r1,o_ci:i.c1,v_ri:n,v_ci:r,v_rc:i.rowspan,v_cc:i.colspan,o_rc:i.o_rowspan,o_cc:i.o_colspan}},getRootCellO:function(t,e,n,r){var i,o="o"==(r=r||"o"),a=this.getRootCell(t,e);return a?(i={rowIndx:a[o?"o_ri":"v_ri"],colIndx:a[o?"o_ci":"v_ci"]},this.that.normalize(i)):(n&&(i={rowIndx:t,colIndx:e}),i?this.that.normalize(i):null)},getRootCellV:function(t,e,n){return this.getRootCellO(t,e,n,"v")},getClsStyle:function(t,e){return this.mc[t][e]},getMergeCells:function(t,e){for(var n,r,i,o=this.that,a=this.mc2,l=o.riOffset,s=l+e,c=[],d=a?a.length:0,u=0;u<d;u++)r=(n=a[u]).r1,i=n.c1,(!t||r>=l&&r<s)&&(t&&(r-=l),c.push({r1:r,c1:i,r2:r+n.rc-1,c2:i+n.cc-1}));return c},alterColumn:function(t,e){for(var n=this.that.options,r=e.args,i=r[1],o="number"!=typeof(a=r[0]),a=o?a.length:a,l=n.mergeCells||[],s=0,c=l.length;s<c;s++){var d=l[s],u=d.c1,h=d.cc;o?u>=i?d.c1=u+a:u+h>i&&(d.cc=h+a):u>i?d.c1=u-a:u+h>i&&h-a>0&&(d.cc=h-a),d.c2=null}this.init()},onChange:function(t,e){for(var n,r=this.that.options,i=e.addList,o=e.deleteList,a=r.mergeCells||[],l=0,s=a.length;l<s;l++){for(var c=a[l],d=c.r1,u=c.rc,h=0,f=i.length;h<f;h++)d>=(n=i[h].rowIndx)?(d=c.r1=d+1,c.r2=null):d+u>n&&(u=c.rc=u+1,c.r2=null);for(h=0,f=o.length;h<f;h++)d>(n=o[h].rowIndx)?(d=c.r1=d-1,c.r2=null):d+u>n&&u>1&&(u=c.rc=u-1,c.r2=null)}this.init()},setData:function(t,e,n){var r,i=this.mc;i[t]&&(r=i[t][e])&&(r.data=n)}}}(),function(t){var e=t.paramquery,n=pq.mixin;e.pqGrid.defaults.groupModel={cascade:!0,cbId:"pq_group_cb",collapsed:[],dataIndx:[],fixCols:!0,groupCols:[],header:!0,headerMenu:!0,icon:["ui-icon-triangle-1-se","ui-icon-triangle-1-e"],id:"pq_gid",parentId:"parentId",childstr:"children",menuItems:["merge","fixCols","grandSummary"],on:!1,refreshOnChange:!0,pivotColsTotal:"after",separator:"_",source:"checkboxGroup",showSummary:[],summaryInTitleRow:"collapsed",summaryEdit:!0,title:[],titleDefault:"{0} ({1})"},pq.aggregate={sum:function(t){for(var e,n=0,r=t.length;r--;)null!=(e=t[r])&&(n+=e-0);return n},avg:function(t,e){try{var n=pq.formulas.AVERAGE(t)}catch(t){n=t}return isNaN(n)?null:n},flatten:function(t){return t.filter(function(t){return null!=t})},max:function(t,e){var n,r,i,o,a,l=pq.getDataType(e);if(n=(t=this.flatten(t)).length){if("number"==l)for(r=1*t[0];n--;)r=(i=t[n])>r||isNaN(r)?i:r;else if("date"==l){for(r=Date.parse(t[0]),o=t[0];n--;)((a=Date.parse(t[n]))>r||isNaN(r))&&(r=a,o=t[n]);r=o}else t.sort(),r=t[n-1];return r}},min:function(t,e){var n,r,i,o,a=pq.getDataType(e);if(o=(t=this.flatten(t)).length){if("number"==a)for(n=1*t[0];o--;)n=(r=1*t[o])<n||isNaN(n)?r:n;else if("date"==a){for(n=Date.parse(t[0]),i=t[0];o--;)((r=Date.parse(t[o]))<n||isNaN(n))&&(n=r,i=t[o]);n=i}else t.sort(),n=t[0];return n}},count:function(t){return this.flatten(t).length},stdev:function(t){try{var e=pq.formulas.STDEV(t)}catch(t){e=t}return isNaN(e)?null:e},stdevp:function(t){try{var e=pq.formulas.STDEVP(t)}catch(t){e=t}return isNaN(e)?null:e}};var r=e.cGroup=function(t){var e=this,n=t.options,r=e.Model=n.groupModel;e.cbId=r.cbId,e.childstr=r.childstr,e.id=r.id,e.parentId=r.parentId,e.isGroup=!0,e.cache={},e.oldEditor=n.editor,e.prop="pq_group_prop",e.that=t,Object.defineProperty(r,"nodeClose",{get:function(){return e.fillState({})},set:function(t){e.nodeClose=t}}),t.one("CMInit",function(){e.addAggGetter(r)}),r.on&&e.init()};function i(t,e,n,r){t.push("<li data-option='",n,"' class='pq-menu-item'>","<label>","<input type='checkbox' ",e[n]?"checked":"","/>",r["strGroup_"+n],"</label></li>")}r.beforeTrigger=function(t,e){return function(n){return!1===e._trigger("beforeGroupExpand",t,n)}},r.onGroupItemClick=function(e){return function(n){var r=t(n.target),i=t(this).data("indx");r.hasClass("pq-group-remove")?e.removeGroup(i):e.toggleLevel(i,n)}},r.prototype=t.extend({},n.ChkGrpTree,n.GrpTree,{addAggGetter:function(t){var e=t.agg,n=this;Object.defineProperty(t,"agg",{get:function(){var t,e={};return n.getCMPrimary().forEach(function(n){(t=n.summary)&&t.type&&(e[n.dataIndx]=t.type)}),e},set:function(t){n.getCMPrimary().forEach(function(e){var n,r=e.dataIndx,i=t[r];i?(e.summary=e.summary||{}).type=i:(n=e.summary)&&delete n.type})}}),e&&(t.agg=e)},addGroup:function(t,e){var n=this,r=n.that.options.groupModel.dataIndx||[],i=pq.objectify(r),o=r.slice();null==t||i[t]||(null==e?o.push(t):o.splice(e,0,t),n.option({dataIndx:o},"","",function(){n.triggerChange()}))},createHeader:function(){for(var e=this,n=e.that,i=e.$header,o=n.options,a=n.columns,l=o.groupModel,s=l.dataIndx,c=s.length;c--;)null==a[s[c]]&&s.splice(c,1);if(c=s.length,l.header&&l.on){if(i?i.empty():(i=e.$header=t("<div class='pq-group-header ui-helper-clearfix' ></div>").appendTo(n.$top)).on("click",".pq-group-item",r.onGroupItemClick(e)),c){for(var d=[],u=0;u<c;u++){var h=s[u],f=a[h],p=l.collapsed,g=pq.rtlIcons(l.icon,o.rtl),m=p[u]?g[1]:g[0];d.push(`<div tabindex='0' class='pq-group-item' data-indx="${h}" >`,"<span class='",e.toggleIcon,m,"' ></span>",f.pq_title||("string"==typeof f.title?f.title:h),"<span class='",e.groupRemoveIcon,"' ></span></div>")}i[0].innerHTML=d.join("")}e.initHeader(o,l)}else i&&(i.remove(),e.$header=null)},collapse:function(t){this.expand(t,!0)},collapseAll:function(t){this.expandAll(t,!0)},collapseTo:function(t){this.expandTo(t,!0)},concat:function(){var t=this.parentId,e=this.id,n=this.childstr;return function(r,i,o){var a=o[e];return i.forEach(function(e){e[t]=a,r.push(e)}),o[n]=i,r}},editorSummary:function(e,n){var r=this,i=r.oldEditor;return function(e){var o=e.rowData;if(o.pq_gsummary||o.pq_gtitle){var a,l=pq.aggregate,s=e.column,c=s.summary,d=c?c.edit:null,u=t.inArray,h=s.dataType,f=[""];if(u(e.dataIndx,n.dataIndx)>-1)return!1;if(!n.summaryEdit&&!d||!1===d)return!1;for(var p in a=r.getAggOptions(h),l)u(p,a)>-1&&f.push(p);return 1!=f.length&&{type:"select",prepend:n.prepend,options:n.options||f,valueIndx:n.valueIndx,labelIndx:n.labelIndx,init:n.init||r.editorInit,getData:n.getData||r.editorGetData}}return"function"==typeof i?i.call(r.that,e):i}},editorInit:function(t){var e,n=t.column.summary,r=this.options.groupModel.dataIndx;n||(n=t.column.summary={}),e=n[r[t.rowData.pq_level]]||n.type,t.$cell.find("select").val(e)},editorGetData:function(t){var e=t.column,n=this.options.groupModel.dataIndx[t.rowData.pq_level],r=e.dataType,i=e.summary,o=t.$cell.find("select").val();return i[i[n]?n:"type"]=o,this.one("beforeValidate",function(t,n){n.allowInvalid=!0,n.track=!1,n.history=!1,e.dataType="string",this.one(!0,"change",function(t,n){e.dataType=r})}),o},expandTo:function(t,e){for(var n,r=this.that,i=!!e,o=t.split(","),a=o.length,l=this.childstr,s=this.getRoots(r.pdata),c=0;c<a&&(n=s[o[c]]);)i||(n.pq_close=i),s=n[l],c++;n&&(n.pq_close=i,!1!==r._trigger("group",null,{node:n,close:i})&&this.softRefresh())},expandAll:function(t,e){t=t||0,e=!!e,!1!==this.trigger({all:!0,close:e,level:t})&&(this.that.pdata.forEach(function(n){n.pq_level>=t&&(n.pq_close=e)}),this.createHeader(),this.softRefresh())},expand:function(t,e){t=t||0,!1!==this.trigger({close:!!e,level:t})&&(this.that.pdata.forEach(function(n){n.pq_level==t&&(n.pq_close=e)}),this.createHeader(),this.softRefresh())},flattenG:function(t,e,n,r){var i=this,o=n.dataIndx,a=i.id,l=i.parentId,s=i.childstr,c=n.separator,d=n.titleIndx,u=i.concat(),h=o.length,f=[];return function r(i,p,g,m){if(!h)return i;var v=p||0,w=(g=g||{})[s],x=o[v],y=n.collapsed[v];return e(i,x,t[x]).forEach(function(t){var e,n=t[1],i=t[0],o=(m?m+c:"")+i,p=n.length;(e={pq_gtitle:!0,pq_level:v,pq_close:y,pq_items:p})[a]=o,e[l]=g[a],e[s]=[],e[x]=i,d&&(e[d]=i),f.push(e),w&&w.push(e),v+1<h?r(n,v+1,e,o):f=u(f,n,e)}),f}},getAggOptions:function(t){return"integer"==t||"float"==t?t="number":"date"!==t&&(t="string"),this.that.options.summaryOptions[t].split(",")},getVal:function(e){var n=t.trim;return function(t,r,i){var o=t[r],a=i.groupChange;return a?(a=pq.getFn(a))(o):(o=n(o),e?o.toUpperCase():o)}},getSumCols:function(){return this._sumCols},getSumDIs:function(){return this._sumDIs},group:function(t){return function(e,n,r){var i={},o=[];return e.forEach(function(e){e.pq_hidden=void 0;var a=t(e,n,r),l=i[a];null==l&&(i[a]=l=o.length,o[l]=[a,[]]),o[l][1].push(e)}),o}},groupData:function(t){var e=this,n=e.that,r=n.options.groupModel,i=e.getVal(r.ignoreCase),o=r.dataIndx,a=n.pdata,l=n.columns;e.setSumCols(o);n.pdata=e.flattenG(l,e.group(i),r,function(){})(a),n._trigger("before"+(t?"Pivot":"Group")+"Summary"),e.summaryT(t)},hideRows:function(t,e,n,r){for(var i,o=!0,a=this.that.pdata,l=t,s=a.length;l<s;l++)if((i=a[l]).pq_gsummary)n||r?i.pq_level>=e&&(i.pq_hidden=o):i.pq_level>e&&(i.pq_hidden=o);else if(i.pq_gtitle){if(i.pq_level<=e)break;i.pq_hidden=o}else i.pq_hidden=o},init:function(){var t,e,n=this;n.onCMInit(),n._init||(n.mc=[],n.summaryData=[],t=(e=n.that).options.groupModel,n.groupRemoveIcon="pq-group-remove ui-icon ui-icon-close",n.toggleIcon="pq-group-toggle ui-icon ",e.on("cellClick",n.onCellClick(n)).on("cellKeyDown",n.onCellKeyDown2(n,t)).on(!0,"cellMouseDown",n.onCellMouseDown()).on("change",n.onChange(n,t)).on("dataReady",n.onDataReady.bind(n)).on("beforeFilterDone",function(){n.saveState()}).on("columnDragDone",n.onColumnDrag(n)).on("colMove",n.onColMove.bind(n)).on("customSort cancelSort",n.onCustomSort.bind(n)).on("valChange",n.onCheckbox(n,t)).on("refresh refreshRow",n.onRefresh(n,t)).on("refreshHeader",n.onRefreshHeader.bind(n)),(t.titleIndx||t.titleInFirstCol)&&e.on("CMInit",n.onCMInit.bind(n)),e.on("beforeCheck",n.onBeforeCheck.bind(n)),n.setCascadeInit(!0),n._init=!0)},initHeadSortable:function(){var t=this,e=t.that,n=t.$header,r=e.options;n.sortable({axis:"x",distance:3,tolerance:"pointer",cancel:".pq-group-menu",stop:t.onSortable(t,r)})},initHeadDroppable:function(){var t=this,e=t.that,n=t.$header;n&&(n.droppable({accept:function(n){if(e.$head_i[0]==n[0]){var r=e.options.groupModel.dataIndx,i=e.iDragColumns.columnDrag.dataIndx;if(-1==r.indexOf(i))return t.acceptDrop}},tolerance:"pointer",drop:t.onDrop(e,t)}),t.acceptDrop=!0)},initHeader:function(t,e){var n=this;if(n.$header){var r=n.$header,i=r.find(".pq-group-item");r.data("uiSortable")||n.initHeadSortable(),i.length||r.append("<span class='pq-group-placeholder'>"+t.strGroup_header+"</span>"),e.headerMenu&&n.initHeaderMenu()}},initHeaderMenu:function(){for(var e,n=this,r=n.that.options,o=n.$header,a=["<ul class='pq-group-menu'><li>","<div><span>&nbsp;</span></div>","<ul>"],l=r.groupModel,s=l.menuItems,c=0,d=s.length;c<d;c++)i(a,l,s[c],r);a.push("</ul></li></ul>"),(e=t(a.join("")).appendTo(o)).menu({icons:{submenu:"ui-icon-gear"},position:{my:"right top",at:"left top"}}),e.change(function(e){if("INPUT"==e.target.nodeName){var i=t(e.target).closest("li").data("option"),o={};o[i]=!r.groupModel[i],n.option(o)}})},isOn:function(){var t=this.that.options.groupModel;return t.on&&(t.dataIndx||[]).length},getRC:function(t){var e=1,n=this;return(t[n.childstr]||[]).forEach(function(t){e+=n.getRC(t)}),e+(t.pq_child_sum?1:0)},initmerge:function(){var t,e=this,n=e.that,r=n.options,i=r.groupModel,o=i.merge,a=i.summaryInTitleRow,l=i.titleIndx,s=n.colModel.length,c=[],d=i.dataIndx,u=(d.length,n.pdata||[]);i.on&&(o?d.forEach(function(n,r){u.forEach(function(n){n.pq_gtitle&&r==n.pq_level&&(t=e.getRC(n),c.push({r1:n.pq_ri,rc:t,c1:r,cc:1}))})}):d.length&&u.forEach(function(t){t.pq_gtitle&&(a&&(t.pq_close||"collapsed"!==a)||c.push({r1:t.pq_ri,rc:1,c1:l?n.colIndxs[l]:t.pq_level,cc:s}))})),c.length?(e.mc=r.mergeCells=c,n.iMerge.init()):e.mc.length&&(e.mc.length=0,n.iMerge.init())},initcollapsed:function(){var t,e,n,r,i,o=this,a=o.that,l=a.options.groupModel,s=l.merge,c=l.summaryInTitleRow,d=o.nodeClose,u=a.pdata,h=o.id;if(u){for(var f=0,p=u.length;f<p;f++)(n=u[f]).pq_gtitle&&(r=n.pq_level,i=null,d&&null!=(e=d[t=n[h]])&&(delete d[t],i=n.pq_close=e),null==i&&(i=n.pq_close),i?o.hideRows(f+1,r,s,c):s&&(n.pq_hidden=!0));a._trigger("groupHideRows")}},updateItems:function(t){var e,n,r=this,i=0,o=r.childstr;return(t||r.that.pdata).forEach(function(t){t.pq_gtitle&&(e=t[o],(n=e.length)&&e[0][o]?t.pq_items=r.updateItems(e):t.pq_items=n,i+=t.pq_items)}),i},removeEmptyParent:function(t){var e=this,n=e.that.pdata,r=e.childstr;if(!t[r].length){var i=e.getParent(t),o=i?i[r]:n,a=o.indexOf(t);o.splice(a,1),i&&e.removeEmptyParent(i)}},addNodes:function(t,e,n){this.moveNodes(t,e,n,!0)},deleteNodes:function(t){this.moveNodes(t,null,null,null,!0)},moveNodes:function(t,e,n,r,i){var o,a,l,s,c,d=this,u=d.that,h=d.childstr,f="pq_hidden",p=u.options,g=p.groupModel,m=g.dataIndx,v=d.getRoots(),w=e?e[h]:v,x=[],y=d.parentId,b=d.getUniqueNodes(t),C=0,q=w[0],I=w.length;if(n=null==n||n>=I?I:n,s=b.length){for(u._trigger("beforeMoveNode");C<s;C++)c=b[C],r?w.splice(n++,0,c):(l=(a=(o=d.getParent(c))?o[h]:v).indexOf(c),i?a.splice(l,1):a==w?n=pq.moveItem(c,w,l,n):(w.splice(n++,0,c),a.splice(l,1))),e&&a!=w&&(m.slice(0,e.pq_level+1).forEach(function(t){d.isFolder(c)?d.getChildrenAll(c).forEach(function(n){n[t]=e[t]}):c[t]=q[t]}),c[y]=q[y],c[f]=q[f]);w==v&&(u.pdata=w),u.iRefresh.addRT(b),d.updateItems(),d.summaryT(),u.pageData().forEach(function(t){t.pq_gtitle||t.pq_gsummary||x.push(t)}),p.dataModel.data=x,d.isCascade(g)&&(d.cascadeInit(),d.setValCBox()),u.iRefresh.addRowIndx(),d.initmerge(),u._trigger((r?"add":i?"delete":"move")+"Node",null,{args:arguments}),u.refresh({header:!1})}},onCellClick:function(e){return function(n,r){if(r.rowData.pq_gtitle&&t(n.originalEvent.target).hasClass("pq-group-icon"))if(pq.isCtrl(n)){var i=r.rowData;e[i.pq_close?"expand":"collapse"](i.pq_level)}else e.toggleRow(r.rowIndxPage,n)}},onCellMouseDown:function(){return function(e,n){n.rowData.pq_gtitle&&t(e.originalEvent.target).hasClass("pq-group-icon")&&e.preventDefault()}},onCellKeyDown2:function(e,n){return function(r,i){return 0!=e.onCellKeyDown(r,i)&&(i.rowData.pq_gtitle&&t.inArray(i.dataIndx,n.dataIndx)>=0&&r.keyCode==t.ui.keyCode.ENTER?(e.toggleRow(i.rowIndxPage,r),!1):void 0)}},onChange:function(t,e){return function(n,r){e.source==r.source||"checkbox"==r.source||(t.summaryT(),t.that.refresh())}},onColumnDrag:function(t){return function(e,n){var r=n.column,i=r.colModel;i&&i.length||!1===r.groupable||r.denyGroup?t.acceptDrop=!1:t.initHeadDroppable()}},onCustomSort:function(t,e){var n=this,r=n.that,i=r.options,o=[],a=i.groupModel,l=a.dataIndx,s=e.sorter||[],c=s.map(function(t){return t.dataIndx}),d=c[0],u=r.columns[d],h=l.indexOf(d);if("remote"!=i.sortModel.type&&a.on&&l.length){if(h>=0&&u.groupChange)return;if("pq_order"==d||"pq_gorder"==d||0==s.length||(u.summary||{}).type)return n._delaySort(e);var f=l.map(function(t){var e=c.indexOf(t);return{dataIndx:t,dir:e>=0?s[e].dir:s[0].dir}}).concat(s);return f=pq.arrayUnique(f,"dataIndx"),n._delaySort(e,function(t){function n(){o.length&&e.sort_composite.push(r.iSort.compileSorter(o,t)),o=[]}e.sort_composite=[],a.titleIndx==d?(f.forEach(function(i){-1==l.indexOf(i.dataIndx)?o.push(i):(n(),e.sort_composite.push(r.iSort.compileSorter([i],t)))}),n()):(f.forEach(function(i){var a=c.indexOf(i.dataIndx)>=0,s=l.indexOf(i.dataIndx)>=0;a?s?(n(),e.sort_composite.push(r.iSort.compileSorter([i],t))):o.push(i):(n(),e.sort_composite.push(void 0))}),n())})}},_delaySort:function(t,e){var n=this,r=n.that,i=r.pdata;if(i&&i.length)return r.one("isSkipGroup",function(){return e&&e(i),t.data=i,n.onCustomSortTree({},t),r.pdata=t.data,n.summaryRestore(),!1}),!1},summaryRestore:function(){var t,e=this,n=e.childstr;e.that.pdata=function e(r,i){var o=[];return r.forEach(function(t){o.push(t),e(t[n]||[],t).forEach(function(t){o.push(t)})}),i&&(t=i.pq_child_sum)&&!t.pq_ghidden&&o.push(t),o}(e.getRoots())},onDrop:function(t,e){return function(t,n){var r=n.helper.data("di");e.addGroup(r),e.acceptDrop=!1}},onSortable:function(e,n){return function(){var r,i,o,a=[],l=n.groupModel.dataIndx;t(this).find(".pq-group-item").each(function(e,n){i=t(n),o=i.data("indx"),l[e]!==o&&(r=!0),a.push(o)}),r&&e.option({dataIndx:a},"","",function(){e.triggerChange()})}},onDataReady:function(t,e){var n=this,r=n.that,i=r.iSort,o=r.options.groupModel,a=o.dataIndx.length;0!=e.group&&(o.on&&(a||o.grandSummary?(!1!==r._trigger("isSkipGroup")&&(i.saveOrder(),n.groupData(),i.saveOrder("pq_gorder"),n.buildCache()),r.iRefresh.addRowIndx(),n.refreshColumns(),a&&(n.initcollapsed(),n.initmerge(),n.isCascade(o)&&n.cascadeInit())):n.refreshColumns(),n.setValCBox()),n.createHeader())},onColMove:function(){var t=this,e=t.that.options.groupModel;if(e.titleInFirstCol)return t.that.refreshView(),!1;e.titleIndx||t.initmerge()},option:function(e,n,r,i){var o=e.dataIndx,a=this,l=a.that,s=o?o.length:0,c=l.options.groupModel,d={source:r,oldGM:t.extend({},c),ui:e},u=c.dataIndx;0!=l._trigger("beforeGroupOption",null,d)&&(e.agg&&a.updateAgg(e.agg,c.agg),c.on&&u.length&&(!1===e.on||0===s)&&a.showRows(),t.extend(c,e),i&&i(),a.init(),a.setOption(),l._trigger("groupOption",null,d),!1!==n&&(l.refreshView({refresh:!1}),l.sort({header:!1})))},showRows:function(){this.that.options.dataModel.data.forEach(function(t){t.pq_hidden&&(t.pq_hidden=void 0)})},renderBodyCell:function(t,e,n){var r,i=this,o=e.checkbox,a=e.titleIndx,l=a?e.indent:0,s=i.indentUnit(l),c=l*n,d="";return n&&(c+=l),function(t){var n,l,u=t.rowData,h=t.column,f=h.renderLabel;return t.Export?void 0:(n=(n=f&&f.call(i.that,t))||t.formatVal||t.cellData,o&&a&&(r=i.renderCB(o,u,e.cbId))&&(d=r[0]),{cls:"pq-group-title-cell",text:((l=d&&(h.useLabel||e.useLabel))?"<label>":"")+d+(null==n?"":`<span>${n}</span>`)+(l?"</label>":""),style:"padding-left:"+c+s+";"})}},renderCell:function(t,e){var n=this,r=n.renderTitle(t,e),i=t.rtl?"right":"left",o=e.dataIndx.length-(n.isPivot()?1:0),a=n.renderBodyCell(t,e,o),l=n.renderSummary(t);return function(t,s,c){t._renderG=function(t){var d,u,h,f=t.rowData,p=f.pq_gtitle;return s&&p?d=r(t):p||f.pq_gsummary?d=l(t):e.titleIndx==t.dataIndx&&(u=!0,d=a(t)),c&&(h=n.getLines(p,f,u?o:f.pq_level,e.indent,i),d?null!=d.text?d.outer=h:d={outer:h,text:d}:d={outer:h}),d}}},renderSummary:function(t){var e=this.that,n=t.groupModel.dataIndx;return function(r){var i,o,a,l,s=r.rowData,c=r.column,d=c.summary,u=s.pq_level;if(d&&(o=d[n[u]]||d.type))return"function"==typeof(a=t.summaryTitle[o])?l=a.call(e,r):(null==(i=r.formatVal)&&(i=r.cellData??""),"number"!=typeof i||c.format||parseInt(i)===i||(i=i.toFixed(2)),l=a?a.replace("{0}",i):i),l}},updateformatVal:function(t,e,n){var r=t.dataIndx[n],i=this.that,o=i.columns[r];o&&o.format&&o!=e.column&&(e.formatVal=i.formatCol(o,e.cellData))},renderTitle:function(t,e){var n,r,i=this,o=i.that,a=t.rtl,l=e.checkbox,s=["pq-group-title-cell"],c=e.titleIndx,d=e.indent,u=i.indentUnit(d),h=pq.rtlIcons(e.icon,a),f=["ui-icon "+h[0],"ui-icon "+h[1]];return function(t){var h,p,g,m,v=t.rowData,w=t.column,x=w.useLabel;if(null!=t.cellData)return h=v.pq_close,p=v.pq_level,g=e.title,i.updateformatVal(e,t,p),g=(g="function"==typeof(g=w.renderLabel||g[p]||e.titleDefault)?g.call(o,t):g.replace("{0}",t.formatVal||t.cellData).replace("{1}",v.pq_items))??(t.formatVal||t.cellData),m="pq-group-icon "+f[h?1:0],t.Export?g:(l&&c&&i.isCascade(e)&&(n=i.renderCB(l,v,e.cbId))&&(r=n[0],n[1]&&s.push(n[1])),{text:[(x=r&&(null!=x?x:e.useLabel))?"<label>":"","<span class='",m,"'></span>",r,null==g?"":`<span>${g}</span>`,x?"</label>":""].join(""),cls:s.join(" "),style:"text-align:"+(a?"right":"left")+";padding-left:"+d*p+u+";"})}},triggerChange:function(){this.that._trigger("groupChange")},removeGroup:function(t){var e=this;e.option({dataIndx:e.that.options.groupModel.dataIndx.filter(function(e){return e!=t})},"","",function(){e.triggerChange()})},refreshColumns:function(){for(var t,e,n,r=this.that,i=r.options,o=i.groupModel,a=o.on,l=o.fixCols,s=this.renderCell(i,o),c=r.columns,d=o.dataIndx,u=d.length,h=r.colModel,f=h.length;f--;)(t=h[f])._renderG&&delete t._renderG,t._nodrag&&(delete t._nodrag,delete t._nodrop),a&&(e=t.summary)&&e.type&&s(t);if(i.editor=a?this.editorSummary(i,o):this.oldEditor,a)if(o.titleIndx)s(t=c[o.titleIndx],!0,!o.hideLines);else{for(f=u-1;f>=0;f--)s(t=c[d[f]],!0);if(l&&!o.titleInFirstCol)for(f=0;f<u;f++)(t=h[n=r.getColIndx({dataIndx:d[f]})])._nodrag=t._nodrop=!0,n!=f&&(r.iDragColumns.moveColumn(n,f,!0),r.refreshCM(null,{group:!0}))}},saveState:function(){var t=this,e=t.nodeClose=t.nodeClose||{};t.fillState(e)},isCollapsed:t=>t.pq_close,setSumCols:function(t){var e=[],n=[];return t=pq.objectify(t),this.that.colModel.forEach(function(r){var i,o=r.summary;o&&o.type&&(i=r.dataIndx,t[i]||(e.push(r),n.push(i)))}),this._sumCols=e,this._sumDIs=n,[e,n]},setOption:function(){var t=this;t._init&&(t.refreshColumns(),t.summaryData.length=0,t.initmerge())},softRefresh:function(){var t=this,e=t.that;t.pdata=null,e.pdata.forEach(function(t){delete t.pq_hidden}),t.initcollapsed(),t.initmerge(),e.refresh({header:!1})},toggleLevel:function(e,n){var r=this.that.options.groupModel,i=r.collapsed,o=t.inArray(e,r.dataIndx),a=pq.isCtrl(n)?"All":"";this[(i[o]?"expand":"collapse")+a](o)},trigger:function(t){var e,n,i,o=t.evt,a=t.rd,l=t.level,s=t.all,c=t.close,d=this.that,u=d.options.groupModel,h=u.dataIndx,f=u.collapsed,p=r.beforeTrigger(o,d),g={};if(a){if(n=a[h[e=a.pq_level]],p(g={level:e,close:c=!a.pq_close,group:n}))return!1;a.pq_close=c}else if(s){if(p(g={all:!0,close:c,level:l}))return!1;for(i=l;i<h.length;i++)f[i]=c}else if(null!=l){if(p(g={level:l,close:c}))return!1;f[l]=c}return d._trigger("group",null,g)},toggleRow:function(t,e){var n=this.that.pdata[t];!1!==this.trigger({evt:e,rd:n})&&this.softRefresh()}}),e.pqGrid.prototype.Group=function(t){var e=this.iGroup;if(null==t)return e;e.expandTo(t.indx)}}(jQuery),function(t){var e=t.paramquery,n=e.pqGrid.prototype,r=n.options;t(document).on("pqGrid:bootup",function(t,e){var n=e.instance;n.iDrag=new i(n)});var i=e.cDrag=function(t){var e=this,n=t.options,r=e.rtl=n.rtl,i=n.dragModel;i.on&&(e.that=t,n.postRenderInterval=n.postRenderInterval||-1,e.model=i,e.ns=".pq-drag",i.tmplDragN=e.rtlfy(r,i.tmplDragN),i.tmplDrag=e.rtlfy(r,i.tmplDrag),t.on("CMInit",e.onCMInit.bind(e)).on("create",e.onCreate.bind(e)))};n.Drag=function(){return this.iDrag},r.dragModel={afterDrop:function(){},beforeDrop:function(t,e){var n=this.Drag(),r=n.getUI().nodes,i=this,o=this.Tree(),a=this.Group();o.isOn()?i=o:a.isOn()&&(i=a),n.clean(),i.deleteNodes(r)},diDrag:-1,dragNodes:function(t){return[t]},contentHelper:function(t,e){var n=e[0],r=e.length;return t.map(function(t){return n[t]}).join(", ")+(r>1?" ( "+r+" )":"")},clsHandle:"pq-drag-handle",clsDnD:"pq-dnd",clsNode:"pq-dnd-drag",iconAccept:"ui-icon ui-icon-check",iconReject:"ui-icon ui-icon-cancel",tmplDragN:"<span class='ui-icon ui-icon-grip-dotted-vertical pq-drag-handle' style='cursor:move;'></span>",tmplDrag:"<span class='ui-icon ui-icon-grip-dotted-vertical pq-drag-handle' style='cursor:move;touch-action:none;vertical-align:baseline;'></span>",cssHelper:{opacity:.7,position:"absolute",height:25,width:200,overflow:"hidden",background:"#fff",border:"1px solid",boxShadow:"4px 4px 2px #aaaaaa",zIndex:1001},tmplHelper:"<div class='pq-border-0 pq-grid-cell' style='pointer-events: none;'><span class='ui-icon' style='vertical-align:text-top;margin:2px 5px;'></span><span></span></div>"},i.prototype={addIcon:function(t){var e="ui-icon";this.$helper.find("."+e).attr("class","").addClass(e+" "+t)},addAcceptIcon:function(){this.addIcon(this.model.iconAccept)},addRejectIcon:function(){this.addIcon(this.model.iconReject)},getHelper:function(e){var n=this,r=n.that,i=n.model,o=i.clsNode,a=t(e.target).closest(".pq-grid-cell,.pq-grid-number-cell"),l=n.cellObj=r.getCellIndices({$td:a}),s=i.diHelper||[i.diDrag],c=l.rowData,d=l.nodes=i.dragNodes.call(r,c,e),u=i.contentHelper.call(r,s,d),h=n.$helper=t(i.tmplHelper),f=r.getScale(),p=pq.getScale(document.body);return h.find("span:eq(1)").text(u),d.forEach(function(t){r.addClass({rowData:t,cls:o})}),n.addRejectIcon(),h.addClass("pq-theme pq-drag-helper").css(i.cssHelper).data("Drag",n),h.css({scale:f[0]/p[0]+" "+f[1]/p[1],"transform-origin":"0 0"}),h[0]},getUI:function(){return this.cellObj},grid:function(){return this.that},isSingle:function(){return 1==this.getData().length},findLastLeaf:function(t){return function t(e){const n=e.lastChild;return n&&n.children?.length?t(n):n}(t)},onCMInit:function(){var e=this,n=e.that,r=e.model,i=r.isDraggable,o=n.columns[r.diDrag],a=o?r.tmplDrag:r.tmplDragN;(o||n.options.numberCell).postRender=function(r){i&&!i.call(n,r)||t(a).insertBefore(e.findLastLeaf(o?r.cell.firstChild:r.cell))}},onCreate:function(){var e,n=this,r=n.model,i={top:20},o=-1==r.diDrag;n.that.on(!0,"cellMouseDown",n.onCellMouseDown.bind(n)),i[n.rtl?"right":"left"]=2,n.ele=n.that.$cont.children(":first").addClass(r.clsDnD+(o?" pq-drag-number":"")).draggable(t.extend({cursorAt:i,containment:"document",appendTo:"body"},r.options,{handle:"."+r.clsHandle,helper:n.getHelper.bind(n),start:function(){e=pq.getScale(document.body)},drag:function(t,n){var r=n.position;r.left=r.left/e[0],r.top=r.top/e[1]},revert:n.revert.bind(n)}))},onDrop:function(t,e,n){this.model[t].call(this.that,e,n)},clean:function(){var t=this;t.getUI().nodes.forEach(function(e){t.that.removeClass({rowData:e,cls:t.model.clsNode})})},revert:function(e){this.clean(),e||this.$helper.hide("explode",function(){t(this).remove()})},rtlfy:function(t,e){var n={left:"right",right:"left"};return t?e.replace(/left|right/g,function(t){return n[t]}):e},onCellMouseDown:function(e){var n=this.model;t(e.originalEvent.target).closest("."+n.clsHandle).length&&e.preventDefault()},over:function(t,e){this.addAcceptIcon()},out:function(t,e){this.addRejectIcon()}}}(jQuery),function(t){var e=t.paramquery,n=e.pqGrid.prototype,r=n.options;t(document).on("pqGrid:bootup",function(t,e){var n=e.instance;n.iDrop=new i(n)}),n.Drop=function(){return this.iDrop},r.dropModel={accept:".pq-dnd",clsParent:"pq-dnd-parent",drop:function(t,e){var n=e.helper.data("Drag"),r=this,i=r.Group(),o=r.Tree(),a=e.rowData,l=e.ratioY()<=.5,s=null==(s=e.rowIndx)?s:s+(l?0:1),c=function(t,e){if(a||e){var n,i=r.iDrop.parent,o=t.getChildren(i),s=o.length;s&&(n=a?a==i?l?null:0:o.indexOf(a)+(l?0:1):s),u?t.moveNodes(h,i,n):t.addNodes(h,i,n)}};if(n){var d=n.getUI(),u=n.grid()==r,h=d.nodes;i.isOn()?c(i):o.isOn()?c(o,!0):u?r.moveNodes(h,s):r.addNodes(h,s)}},getParent:function(t,e){var n,r,i,o=this,a=e.rowData,l=o.options,s=o.Drop().$divider,c=o.Group(),d=c.isOn(),u=o.Tree(),h=l.rtl?"right":"left",f=u.isOn();if(a)return f?s?(o.element[0],i=e.helper[0],n=s[0].getClientRects()[0][h],r=i.getClientRects()[0][h]>n?a:u.getParent(a)):r=u.getParent(a):d&&(r=c.getParent(a)),r}};var i=e.cDrop=function(t){var e=this,n=t.options,r=n.dropModel;e.model=r,r.on&&(e.that=t,e.rtl=n.rtl,e.ns=".pq-drop",t.on("create",e.onCreate.bind(e)))};i.prototype={addUI:function(e,n,r){var i=this;e.$cell=r,e.ratioY=function(){return i.ratioY(n,r[0])},t.extend(e,i.that.getCellIndices({$td:r}))},callFn:function(t,e,n){var r=this.model[t];if(r)return r.call(this.that,e,n)},feedback:function(t,e){if(e.length){var n=this,r=n.that,i=e[0],o=r.$cont,a=n.getCellY(i,o[0]),l=a[0],s=a[1],c=n.ratioY(t,i);n.$feedback=n.$feedback||n.newF().appendTo(o),n.$feedback.css({top:c<=.5?l-1:s-1,left:0,width:o[0].clientWidth,zIndex:1e4}),o.css("cursor","copy")}},getCell:function(t){return t.closest(".pq-grid-cell,.pq-grid-number-cell")},getCellY:function(t,e){var n=pq.offset(t,e).top;return[n,n+t.offsetHeight]},ratioY:function(t,e){if(e){var n=e.getClientRects()[0],r=n.top+window.scrollY,i=r+n.height;return(t.pageY-r)/(i-r)}},getDrag:function(t){return t.helper.data("Drag")},isOn:function(){return this.model.on},isOver:function(){},newF:function(){return t("<svg class='pq-border-0' style='box-sizing:border-box;position:absolute;border-width:1.5px;border-style:dashed;pointer-events:none;height:0;'></svg>")},onCreate:function(){var e=this,n=e.that,r=n.$cont;r.droppable(t.extend({tolerance:"pointer"},e.model.options,{accept:e.model.accept,over:e.onOver.bind(e),out:e.onOut.bind(e),drop:e.onDrop.bind(e)})),r.on("dropactivate",function(){var t=n.getScale();e.scaleX=t[0],e.scaleY=t[1]})},onOver:function(e,n){var r=this,i=r.model.divider,o=r.Drag=r.getDrag(n);n.draggable.on("drag.pq",r.onDrag.bind(r)),i&&(r.$divider=t("<svg class='pq-border-0' style='position:absolute;width:0;height:100%;"+(r.rtl?"right:":"left:")+i+"px;top:0;border-style:dashed;border-width:1.5px;pointer-events:none;'></svg>").appendTo(r.that.$cont)),o&&o.over(e,n),r.isOver=function(){return!0},r.callFn("over",e,n)},onOut:function(t,e){e.draggable.off("drag.pq"),this.removeFeedback();var n=this.getDrag(e),r=this.$divider;r&&r.remove(),n&&n.out(t,e),this.isOver=function(){},this.callFn("out",t,e)},setParent:function(t){var e=this.that,n=this.model.clsParent,r=this.parent;r!=t&&(r&&e.removeClass({rowData:r,cls:n}),t&&e.addClass({rowData:t,cls:n})),this.parent=t},setDeny:function(t,e,n){var r=this,i=r.Drag;r.denyDrop=!1===r.callFn("isDroppable",t,e),r.denyDrop?(i&&i.out(),r.removeFeedback()):(i&&i.over(),r.feedback(t,n),r.setParent(r.callFn("getParent",t,e)))},onDrag:function(t,e){var n=this,r=pq.elementFromXY(t),i=n.getCell(r);(i.length||n.that.$cont[0].contains(r[0]))&&(n.addUI(e,t,i),n.setDeny(t,e,i))},onDropX:function(t,e){var n=this,r=n.that,i=e.draggable,o=e.helper.data("Drag"),a=function(n){if(o&&o.grid()!=r)o.onDrop(n,t,e);else try{i.draggable("instance").options[n].call(i[0],t,e)}catch(t){}};a("beforeDrop"),n.callFn("drop",t,e),n.setParent(),a("afterDrop")},onDrop:function(t,e){var n,r=this,i=pq.elementFromXY(t);r.onOut(t,e),r.denyDrop||((n=r.getCell(i)).length||r.that.$cont[0].contains(i[0]))&&(r.addUI(e,t,n),r.onDropX(t,e))},onMouseout:function(){this.removeFeedback()},onMouseup:function(){var e=this;e.removeFeedback(),t(document).off(e.ns),e.that.$cont.off(e.ns)},removeFeedback:function(){var t=this;t.$feedback&&(t.$feedback.remove(),t.$feedback=null),t.that.$cont.css("cursor",""),requestAnimationFrame(function(){t.setParent()})}}}(jQuery),function(t){var e=t.paramquery;e.pqGrid.defaults.contextMenu={preInit:function(t){if(pq.isCtrl(t))return!1},init:function(t,e){if(e.$td){var n={r1:e.rowIndx,c1:e.colIndx,rc:1,cc:1},r=this.Selection();this.options.selectionModel.native||-1!=r.indexOf(n)||(r.removeAll(),this.Range(n).select(),this.focus(e))}}},t(document).on("pqGrid:bootup",function(t,e){var r=e.instance;r.iContext=new n(r),r.Context=function(){return r.iContext}});var n=e.cContext=function(t){var e=this,n=t.options;e.model=n.contextMenu,e.that=t,e.ns=".pq-cmenu",e.rtl=n.rtl,t.on("context",e.onContext.bind(e)).on("destroy",e.removeMenu.bind(e))};n.prototype={createMenu:function(e){e=e.filter(function(t){return null!=t});var n,r=this,i="";return e.forEach(function(t,e){i+=r.getItemHtml(t,e)}),(n=t("<div dir='"+(r.rtl?"rtl":"ltr")+"' class='pq-cmenu pq-theme pq-popup'><table>"+i+"</table></div>").appendTo(document.body)).find(".pq-cmenu-item").each(function(n,r){t(r).data("item",e[n])}),n.on("mouseover",r.onMouseOver.bind(r)).on("remove",r.onRemove(r)).on("mousedown",function(t){t.preventDefault()}),n},get$Item:function(e){return t(e.target).closest(".pq-cmenu-item")},getItem:function(t){return this.get$Item(t).data("item")},getItemHtml:function(t,e){if("separator"==t)return"<tr class='pq-cmenu-item'><td colspan=4 class='pq-bg-2' style='height:1px;padding:0;'></td></td>";var n=t.style,r=t.tooltip,i=n?'style="'+n+'"':"",o=r?'title="'+r+'"':"";return"<tr class='pq-cmenu-item "+(t.disabled?"pq_disabled":"")+" "+(t.cls||"")+"' indx="+e+"><td><span class='"+(t.icon||"")+"' /></td><td "+i+" "+o+">"+t.name+"</td><td>"+(t.shortcut||"")+"</td><td><span class='"+(t.subItems?"pq-submenu ui-icon ui-icon-triangle-1-"+(this.rtl?"w":"e"):"")+"' /></td></tr>"},onContext:function(t,e){if(this.model.on)return this.showMenu(t,e)},onRemove:function(e){return function(){t(this).find(".pq-cmenu-item").each(e.removeSubMenu)}},onMouseDown:function(t){this.getItem(t)||this.removeMenu()},onclickDoc:function(t){var e,n=this.getItem(t);n&&(n.disabled||(e=n.action)&&!1!==e.call(this.that,t,this.ui,n)&&this.removeMenu())},onMouseOver:function(t){var e,n=this,r=n.rtl,i=n.getItem(t),o="subMenu",a=n.get$Item(t),l=(i||{}).subItems;a.siblings().each(n.removeSubMenu),l&&l.length&&!a[0][o]&&(e=n.createMenu(l),n.addScale(a[0],e),pq.position(e,{my:r?"right top":"left top",at:r?"left top":"right top",of:a}),a[0][o]=e)},removeMenu:function(){this.$menu&&(this.$menu.remove(),delete this.$menu,t(document.body).off(this.ns))},removeSubMenu:function(t,e){var n="subMenu";e[n]&&(e[n].remove(),delete e[n])},addScale:function(t,e){var n=pq.getScale(t),r=pq.getScale(e.parent()[0]);e.css({scale:n[0]/r[0]+" "+n[1]/r[1],"transform-origin":"0 0"})},showMenu:function(e,n){var r=this,i=r.rtl,o=r.model,a=r.ns,l=r.that,s=r.$menu,c=n.type,d=o[c+"Items"]||(c?o.items:o.miscItems);d=pq.isFn(d)?d.call(l,e,n):d;if(s&&r.removeMenu(),d&&d.length&&!1!==o.preInit.call(l,e,n)){o.init.call(l,e,n),r.ui=n,s=r.$menu=r.createMenu(d);var u=(e.originalEvent||e).target||e[0]||e;return r.addScale(u,s),pq.position(s,{my:n.my||(i?"right":"left")+" top",at:n.at,of:e,collision:"fit"}),t(document.body).on("click"+a,r.onclickDoc.bind(r)).on("mousedown"+a+" touchstart"+a,r.onMouseDown.bind(r)),!1}}}}(jQuery),function(t){t(document).on("pqGrid:bootup",function(t,e){var r=e.instance;r.iAnim=new n(r)});var e=t.paramquery,n=e.cAnim=function(t){var e=this,n=e.model=t.options.animModel;e.grid=t,e.nodes=[],n.on&&t.on(n.events,e.onBefore.bind(e))},r=e.pqGrid.prototype,i=r.options;r.Anim=function(){return this.iAnim},i.animModel={duration:290,events:"beforeSortDone beforeFilterDone beforeRowExpandDone beforeGroupExpandDone beforeMoveNode beforeAutoRowHeight beforeValidateDone beforeTreeExpandDone onResizeHierarchy",eventsH:"beforeColAddDone beforeColRemoveDone beforeHideColsDone beforeColumnCollapseDone beforeColMoveDone beforeFlex columnResize"},e.mixAnim={cleanUp:function(){(this.data||[]).forEach(function(t){t.pq_top=t.pq_hideOld=void 0}),this.data=this.render=null},stop:function(){this.nodes.forEach(function(t){t.stop()}),this.nodes=[]}},n.prototype=t.extend({isActive:function(){return this._active},onBefore:function(t,e){if(!t.isDefaultPrevented()&&!this.data){var n,r=this,i=r.grid,o=i.iRenderB,a=r.data=o.data,l=r.render=[];try{r.htTbl=o.dims.htTbl,o.eachV(function(t,e){n=o.get$Row(e),t.pq_render=1,l.push([t,n.clone(),n.map(function(t,e){return e.parentNode})])}),a.forEach(function(t,e){t.pq_top=o.getTop(e),t.pq_hideOld=t.pq_hidden}),i.one("refresh",r.oneRefresh.bind(r)),setTimeout(function(){r.cleanUp()})}catch(t){r.data=null}}},oneRefresh:function(){if(this.data){var e,n=this,r=n.grid.iRenderB,i=n.model.duration,o=t([r.$tbl_left[0],r.$tbl_right[0]]),a=n.htTbl,l=r.dims.htTbl;n.stop(),n._active=!0,a>l&&o.css("height",a),setTimeout(function(){o.css("height",r.dims.htTbl),n._active=!1},i),r.eachV(function(t,o){delete t.pq_render;var a,l,s=r.getTop(o),c=t.pq_top;(c!=s||t.pq_hideOld)&&(e=r.get$Row(o),null==c||t.pq_hideOld?(a={opacity:0},l={opacity:1}):(a={top:c},l={top:s}),e.css(a).animate(l,i),n.nodes.push(e))}),n.render.forEach(n.removeRows.bind(n)),n.cleanUp()}},removeRows:function(e){var n,r=this,i=e[0],o=i.pq_ri,a=r.model.duration,l={opacity:1,top:i.pq_top};if(i.pq_render){if(delete i.pq_render,(n=e[1].each(function(n,r){t(r).removeAttr("id").appendTo(e[2][n]).children().removeAttr("id")})).css(l),null==o||i.pq_hidden)l={opacity:0};else try{l={top:r.grid.iRenderB.getTop(o)}}catch(t){l={opacity:0}}n.animate(l,a,function(){this.parentNode&&this.parentNode.removeChild(this)}),r.nodes.push(n)}}},e.mixAnim)}(jQuery),function(t){t(document).on("pqGrid:bootup",function(t,e){var r=e.instance;r.iAnimH=new n(r)});var e=t.paramquery,n=e.cAnimH=function(t){var e=this,n=t.options,r=e.model=n.animModel;e.grid=t,e.rtl=n.rtl?"right":"left",e.nodes=[],r.on&&t.on(r.eventsH,e.onBeforeCol.bind(e))};e.pqGrid.prototype.AnimH=function(){return this.iAnimH},n.prototype=t.extend({get$Col:function(){var t=this.grid,e=t.iRenderB,n=t.iRenderHead,r=t.iRenderSum,i=e.getAllCells(),o=n.getAllCells(),a=r.getAllCells();return function(t){return e.get$Col(t,i).add(n.get$Col(t,o)).add(r.get$Col(t,a))}},onBeforeCol:function(t){if(!t.isDefaultPrevented()&&!this.data){var e,n=this,r=n.grid,i=n.data=r.getColModel(),o=n.get$Col(),a=r.iRenderB,l=n.render=[];try{i.forEach(function(t,e){t.pq_hideOld=t.hidden,t.pq_top=a.getLeft(e)})}catch(t){return void n.cleanUp()}a.eachH(function(t,n){e=o(n),t.pq_render=1,l.push([t,e.clone(),e.map(function(t,e){return e.parentNode.id})])}),r.one("softRefresh refresh",n.oneRefreshCol.bind(n))}},oneRefreshCol:function(){if(this.data){var t,e=this,n=e.grid.iRenderB,r=e.model.duration,i=e.get$Col();e.stop(),n.eachH(function(o,a){delete o.pq_render;var l=n.getLeft(a),s=o.pq_top,c=e.rtl,d={opacity:0},u={opacity:1},h={};(s!=l||o.pq_hideOld)&&(t=i(a),null==s?t.css(d).animate(u,r):o.pq_hideOld?(d[c]=s,u[c]=l,t.css(d).animate(u,r)):(h[c]=l,t.css(c,s).animate(h,r)),e.nodes.push(t))}),e.render.forEach(e.removeCols.bind(e)),e.cleanUp()}},removeCols:function(e){var n,r,i=this,o=e[0],a=i.model.duration,l=i.grid,s=l.iRenderB,c=l.colIndxs[o.dataIndx];o.pq_render&&(delete o.pq_render,n=e[1].each(function(n,r){t(r).removeAttr("id").appendTo(document.getElementById(e[2][n]))}),null==c||o.hidden?(n.css("opacity",1),r={opacity:0}):r={left:s.getLeft(c)},n.animate(r,a,function(){this.parentNode&&this.parentNode.removeChild(this)}),i.nodes.push(n))}},e.mixAnim)}(jQuery),function(t){var e=t.paramquery,n=e.pqGrid.defaults;t(document).on("pqGrid:bootup",function(t,e){var n=e.instance;n.iFillHandle=new r(n)}),n.autofill=!0;var r=e.cFillHandle=function(t){var e=this;e.$wrap,e.locked,e.sel,e.that=t,e.rtl=t.options.rtl,t.on("selectChange",e.onSelectChange(e)).on("selectEnd",e.onSelectEnd(e)).on("setTblDims",e.onRefresh(e)).on("keyDown",e.onKeyDown.bind(e))};r.prototype={getLT:function(t,e,n,r){var i=t-e/2;return i=Math.min(i+e,n["offset"+r])-e},create:function(){var e=this,n=e.that;if(!e.locked&&(e.remove(),1===(r=n.Selection().address()).length)){var r,i=(r=r[0]).r2,o=r.c2,a="parentNode",l=n.iMerge.getRootCellO(i,o,!0),s=n.getCell(l);if(s.length&&!1!==n._trigger("beforeFillHandle",null,l)){var c=s[0][a][a],d=c[a],u=n.iRenderB.getCellCoords(l.rowIndxPage,l.colIndx),h=e.getLT(u[2],10,c,"Width"),f={position:"absolute",top:e.getLT(u[3],10,c,"Height"),height:10,width:10,background:"#333",cursor:"crosshair",border:"2px solid #fff",zIndex:1},p=t("<div class='pq-fill-handle'></div>").appendTo(d);f[e.rtl?"right":"left"]=h,p.css(f),e.$wrap=p,e.setDraggable(),e.setDoubleClickable()}}},onSelectChange:function(t){return function(){t.remove()}},onSelectEnd:function(t){return function(){this.options.fillHandle&&t.create()}},onRefresh:function(t){var e;return function(){this.options.fillHandle?(clearTimeout(e),e=setTimeout(function(){t.that.element&&t.create()},50)):t.remove()}},remove:function(){var t=this.$wrap;t&&t.remove()},setDoubleClickable:function(){var t=this,e=t.$wrap;e&&e.on("dblclick",t.onDblClick(t.that,t))},setDraggable:function(){var t=this,e=t.$wrap,n=t.that.$cont;e&&e.draggable({helper:function(){return"<div style='height:10px;width:10px;cursor:crosshair;'></div>"},appendTo:n,start:t.onStart.bind(t),drag:t.onDrag.bind(t),stop:t.onStop.bind(t)})},patternDate:function(t){var e=this;return function(n){var r=new Date(t);return r.setDate(r.getDate()+(n-1)),e.formatDate(r)}},formatDate:function(t){return t.getFullYear()+"-"+pq.pad(t.getMonth()+1)+"-"+pq.pad(t.getDate())},patternDate2:function(t,e){var n,r=new Date(t),i=new Date(e),o=this,a=i.getDate()-r.getDate(),l=i.getMonth()-r.getMonth(),s=i.getFullYear()-r.getFullYear();return!l&&!s||!a&&!l||!s&&!a?function(e){var n=new Date(t);return a?n.setDate(n.getDate()+a*(e-1)):l?n.setMonth(n.getMonth()+l*(e-1)):n.setFullYear(n.getFullYear()+s*(e-1)),o.formatDate(n)}:(r=Date.parse(r),n=Date.parse(i)-r,function(t){var e=new Date(r+n*(t-1));return o.formatDate(e)})},getDT:function(t){for(var e,n,r,i=t.length,o=0,a=pq.valid;o<i;o++){if(e=t[o],a.isFloat(e)?r="number":a.isDate(e)&&(r="date"),n&&n!=r)return"string";n=r}return r},pattern:function(t){var e=this.getDT(t);if("string"==e||!e)return!1;var n,r,i,o=t.length,a="date"===e;return a||(t=t.map(function(t){return 1*t})),2===o?a?this.patternDate2(t[0],t[1]):(n=t[1]-t[0],r=t[0]-n,function(t){return n*t+r}):3===o&&(n=(t[2]-2*t[1]+t[0])/2,r=t[1]-t[0]-3*n,i=t[0]-n-r,function(t){return n*t*t+r*t+i})},autofillVal:function(t,e,n,r,i){var o,a,l,s,c,d=this.that,u=t.r1,h=t.c1,f=t.r2,p=t.c2,g=e.r1,m=e.c1,v=e.r2,w=e.c2,x=[],y=i[0].length,b=(t,e,n)=>{let r=e[(n-1)%y];x.push(pq.mergeDeep({},r,{val:t}))};if(r)for((s={r1:u,r2:f}).c1=m<h?m:p+1,s.c2=m<h?h-1:w,o=0,l=u;l<=f;l++){let t=n[o],e=i[o];for(c=m-h,a=m;a<=w;a++)c++,(a<h||a>p)&&b(t(c,a),e,c);o++}else for((s={c1:h,c2:p}).r1=g<u?g:f+1,s.r2=g<u?u-1:v,c=g-u,a=g;a<=v;a++)if(c++,a<u||a>f)for(o=0,l=h;l<=p;l++){b(n[o](c,a),i[o],c),o++}return d.Range(s).value(x),d.focus({rowIndxPage:t.r1,colIndx:t.c1,noscroll:!0}),!0},autofill:function(t,e){var n,r,i,o,a,l,s,c=this.that,d=c.colModel,u=[],h=c.get_p_data(),f=[],p=t.r1,g=t.c1,m=t.r2,v=t.c2,w=e.c1!=g||e.c2!=v,x=(t,e)=>{i.push(new pq.Cell({val:t[e],style:t.pq_cellstyle?.[e],prop:t.pq_cellprop?.[e]}))},y=(t,e)=>{if(c._trigger("autofillSeries",null,t),s=t.series||this.pattern(i,e))return f.push(s),u.push(i.slice()),!0};if(w)for(a=p;a<=m;a++){i=[];let t=h[a];for(l=g;l<=v;l++)x(t,o=d[l].dataIndx);if(!y({sel:{r:a,c:g},x:!0},r))return}else for(l=g;l<=v;l++){for(r=(n=d[l]).dataType,o=n.dataIndx,i=[],a=p;a<=m;a++)x(h[a],o);if(!y({cells:i,sel:{r1:p,c:l,r2:m,r:p}},r))return}return this.autofillVal(t,e,f,w,u)},onKeyDown:function(e){if(!this.oldAF&&pq.isCtrl(e)){var n=this,r=n.that.options;n.oldAF=r.autofill,r.autofill=!1,t(document.body).one("keyup",function(){r.autofill=n.oldAF,delete n.oldAF})}},onStop:function(){var t=this,e=t.that,n=e.options.autofill,r=t.sel,i=e.Selection().address()[0];r.r1==i.r1&&r.c1==i.c1&&r.r2==i.r2&&r.c2==i.c2||n&&t.autofill(r,i)||(e.Range(r).copy({dest:i}),e.focus({rowIndxPage:r.r1,colIndx:r.c1,noscroll:!0})),t.locked=!1},onStart:function(){this.locked=!0,this.sel=this.that.Selection().address()[0]},onDrag:function(e){var n=this.that,r=n.options.fillHandle,i="all"==r,o=i||"horizontal"==r,a=i||"vertical"==r,l=e.clientX-10,s=e.clientY,c=document.elementFromPoint(l,s),d=t(c).closest(".pq-grid-cell");if(d.length){var u=n.getCellIndices({$td:d}),h=this.sel,f=h.r1,p=h.c1,g=h.r2,m=h.c2,v={r1:f,c1:p,r2:g,c2:m},w=function(t,e){v[t]=e,n.Range(v).select()},x=u.rowIndx,y=u.colIndx;i&&x<=g&&x>=f||o&&!a?y>m?w("c2",y):y<p&&w("c1",y):a&&(x>g?w("r2",x):x<f&&w("r1",x))}},onDblClick:function(t,e){return function(){var n=t.options,r=n.fillHandle;if("all"==r||"vertical"==r){for(var i,o=t.Selection().address()[0],a=o.c2,l=o.r2+1,s=n.dataModel.data,c=t.getColModel()[a].dataIndx;i=s[l];){if(null!=i[c]&&""!==i[c]){l--;break}l++}e.onStart(),t.Range({r1:o.r1,c1:o.c1,r2:l,c2:a}).select(),e.onStop()}}}}}(jQuery),function(t){t(document).on("pqGrid:bootup",function(t,n){new e(n.instance)});var e=t.paramquery.cScroll=function(t){var e=this;e.that=t,e.ns=".pqgrid-csroll",e.rtl=t.options.rtl,t.on("create",e.onCreate.bind(e))};e.prototype={onCreate:function(){var e=this,n=e.that,r=n.iDrop&&n.iDrop.isOn();t(r?document:n.$cont).on("mousedown",e.onMouseDown.bind(e))},onMouseDown:function(e){var n=this,r=n.that,i=t((e.originalEvent||e).target),o=(n.$draggable=i.closest(".ui-draggable")).length,a=n.ns;(o||i.closest(r.$cont).length)&&(i.closest(".pq-fill-handle").length,t(document).on("mousemove"+a,n.process.bind(n)).on("mouseup"+a,n.onMouseUp.bind(n)))},onMouseUp:function(){t(document).off(this.ns),this.capture=!1},process:function(t){var e=this,n=e.that.$cont;if(n){var r=n[0].getBoundingClientRect(),i=r.top,o=r.bottom,a=r.left,l=r.right,s=t.clientX,c=t.clientY,d=a-s,u=s-l,h=i-c,f=c-o;s>a&&s<l?f>0&&f<=30?e.scrollV(f,!0):h>0&&h<=30&&e.scrollV(h):c>i&&c<o&&(u>0&&u<=30?e.scrollH(u,!0):d>0&&d<=30&&e.scrollH(d))}},scrollH:function(t,e){this.scroll(t,this.rtl?!e:e,!0)},scrollV:function(t,e){this.scroll(t,e)},scroll:function(t,e,n){var r=this.that.iRenderB,i=r.getContRight()[0],o=i[n?"scrollWidth":"scrollHeight"],a=pq[n?"scrollLeft":"scrollTop"](i),l=o<1e3?1:1+(o-1e3)/o;t=Math.pow(t,l);var s=a+(e?t:-t);r[n?"scrollX":"scrollY"](s)}}}(jQuery),function(t){var e=jQuery.paramquery;e.cFormula=function(t){var e=this;e.that=t,e.oldF=[],t.one("ready",function(){t.on("CMInit",e.onCMInit.bind(e))}).on("beforePivotSummary",e.calcMainData.bind(e)).on("dataAvailable",e.onDA.bind(e)).on(!0,"change",e.onChange.bind(e))},e.cFormula.prototype={onCMInit:function(){var t=this;t.isFormulaChange(t.oldF,t.formulas())&&t.calcMainData()},callRow:function(t,e,n){var r=this.that,i=0;if(t)for(;i<n;i++){var o=e[i],a=o[0],l=o[1];t[a.dataIndx]=l.call(r,t,a,o[2])}},onDA:function(){this.calcMainData()},isFormulaChange:function(t,e){var n=!1,r=0,i=t.length;if(i==e.length){for(;r<i;r++)if(t[r][1]!=e[r][1]){n=!0;break}}else n=!0;return n},calcMainData:function(){var t=this.formulaSave(),e=this.that,n=t.length;if(n){for(var r=e.options.dataModel.data,i=r.length;i--;)this.callRow(r[i],t,n);e._trigger("formulaComputed")}},onChange:function(t,e){var n,r=this,i=r.that,o=r.formulas(),a=o.length,l=e.addList,s=e.updateList,c=function(t){r.callRow(t.rowData,o,a)};a&&(l.forEach(c),s.forEach(c),1!=s.length||l.length||(n=s[0],o.forEach(function(t){i.refreshCell({rowIndx:n.rowIndx,dataIndx:t[0].dataIndx})})))},formulas:function(){var t,e,n,r=this.that,i=[],o=r.colIndxs;return(r.options.formulas||[]).forEach(function(a){n=a[0],(t=r.getColumn({dataIndx:n}))&&(e=a[1])&&i.push([t,e,o[n]])}),i},formulaSave:function(){var t=this.formulas();return this.oldF=t,t}}}(),function(t){var e=t.paramquery;e.pqGrid.defaults.treeModel={cbId:"pq_tree_cb",source:"checkboxTree",childstr:"children",iconCollapse:["ui-icon-triangle-1-se","ui-icon-triangle-1-e"],iconFolder:["ui-icon-folder-open","ui-icon-folder-collapsed"],iconFile:"ui-icon-document",id:"id",indent:1.5,parentId:"parentId",refreshOnChange:!0},e.pqGrid.prototype.Tree=function(){return this.iTree},t(document).on("pqGrid:bootup",function(t,e){var r=e.instance;r.iTree=new n(r)});var n=e.cTree=function(t){var e=this;e.Model=t.options.treeModel,e.that=t,e.fns={},e.init(),e.isTree=!0,e.cache={},e.di_prev,e.chkRows=[],Object.defineProperty(e.Model,"nodeClose",{get:function(){return e.fillState({})},set:function(t){e.nodeClose=t}})};n.prototype=t.extend({},pq.mixin.ChkGrpTree,pq.mixin.GrpTree,{addNodes:function(t,e,n){var r,i,o,a,l,s,c=this,d=c.that,u=d.options.dataModel,h=c.Model,f=u.data,p=c.parentId,g=c.childstr,m=c.id,v={},w=[],x=0,y=c.cache,b=[];if(t.forEach(function(t){l=t[p],s=s||y[l],c.eachChild(t,function(t,e){var n=t[m];y[n]||v[n]||(v[n]=t,e&&(t[p]=e[m]),w.push(t))},e||y[l])}),w.forEach(function(t){l=t[p],v[l]||y[l]||delete t[p]}),a=(o=(r=((e=e||s)||{})[g]||c.getRoots()||[]).length)?0==n?e:null==n||n>o?r[o-1]:r[n-1]:e,i=f.indexOf(a)+1,o=w.length){for(;x<o;x++)a=w[x],b.push({newRow:a,rowIndx:i++});d._digestData({addList:b,checkEditable:!1,source:"addNodes",history:h.historyAdd}),c.refreshView()}},updateId:function(t,e){var n=this.id,r=this.parentId,i=t[n],o=this.cache;o[e]||(t[n]=e,o[e]=t,delete o[i],(this.getChildren(t)||[]).forEach(function(t){t[r]=e}))},collapseAll:function(t){this[t?"expandNodes":"collapseNodes"](this.that.options.dataModel.data)},collapseNodes:function(t,e,n){for(var r,i,o=0,a=this.that,l=t.length,s=[],c=!n;o<l;o++)r=t[o],this.isFolder(r)&&this.isCollapsed(r)!==c&&s.push(r);if(s.length&&(i={close:c,nodes:s},!1!==a._trigger("beforeTreeExpand",e,i))){for(l=s.length,o=0;o<l;o++)(r=s[o]).pq_close=c;a._trigger("treeExpand",e,i),this.setCascadeInit(!1),this.refreshView()}},deleteNodes:function(t){var e,n,r=this,i=r.that,o=r.Model,a=0,l={},s=r.id,c=[];if(t){for(e=t.length;a<e;a++)n=t[a],r.eachChild(n,function(t){var e=t[s];l[e]||(l[e]=1,c.push({rowData:t}))});i._digestData({deleteList:c,source:"deleteNodes",history:o.historyDelete}),r.refreshView()}},makeLeaf:function(t){t[this.childstr]=t.pq_close=t.pq_child_sum=void 0},expandAll:function(){this.collapseAll(!0)},expandNodes:function(t,e){this.collapseNodes(t,e,!0)},expandTo:function(t){var e=[];do{t.pq_close&&e.push(t)}while(t=this.getParent(t));this.expandNodes(e)},exportCell:function(t,e){for(var n="",r=0;r<e;r++)n+="- ";return n+(t??"")},filter:function(t,e,n,r,i,o,a){for(var l,s,c,d,u=this,h=u.childstr,f=u.Model.filterShowChildren,p=0,g=t.length,m=function(t,e){c=e||c,a?t.pq_hidden=t.pq_filter=!e:e?i.push(t):o.push(t)};p<g;p++){if(s=!1,d=(l=t[p])[h]){if(f&&n.isMatchRow(l,e,r)){u.eachChild(l,function(t){m(t,!0)}),c=!0;continue}(s=u.filter(d,e,n,r,i,o,a))&&m(l,!0)}s||m(l,n.isMatchRow(l,e,r))}return c},getFormat:function(){for(var t,e,n=this,r=n.that.options.dataModel.data,i=0,o=r.length,a=n.parentId,l=n.childstr;i<o&&null==(t=r[i])[a];i++)if((e=t[l])&&e.length)return n.getParent(e[0])==t?"flat":"nested";return"flat"},getLevel:function(t){return t.pq_level},_groupById:function(t,e,n,r,i){for(var o,a=this.childstr,l=0,s=n.length;l<s;l++){var c=n[l],d=c[e];c.pq_level=i,t.push(c),(o=r[d])?(c[a]=o,this._groupById(t,e,o,r,i+1)):(null!=c.pq_close||c[a])&&(c[a]=[])}},groupById:function(t){for(var e,n,r,i=this,o=i.id,a=i.parentId,l={},s=[],c=0,d=t.length;c<d;c++)null==(e=(r=t[c])[a])&&(e=""),(n=l[e])||(n=l[e]=[]),n.push(r);return i._groupById(s,o,l[""]||[],l,0),s},init:function(){var t=this,e=t.that,n=e.options,r=t.Model,i=r.cbId,o=t.dataIndx=r.dataIndx;t.cbId=i,t.prop="pq_tree_prop",t.id=r.id,t.parentId=r.parentId,t.childstr=r.childstr,t.onCMInit(),o?t._init||(t.on("CMInit",t.onCMInit.bind(t)).on("dataAvailable",t.onDataAvailable.bind(t)).on("dataReadyAfter",t.onDataReadyAfter.bind(t)).on("beforeCellKeyDown",t.onBeforeCellKeyDown.bind(t)).on("customSort",t.onCustomSortTree.bind(t)).on("customFilter",t.onCustomFilter.bind(t)).on("clearFilter",t.onClearFilter.bind(t)).on("change",t.onChange(t,e,r)).on("cellClick",t.onCellClick.bind(t)).on("refresh refreshRow",t.onRefresh(t,r)).on("valChange",t.onCheckbox(t,r)).on("refreshHeader",t.onRefreshHeader.bind(t)).on("beforeCheck",t.onBeforeCheck.bind(t)),t.setCascadeInit(!0),t._init=!0):t._init&&(t.off(),t._init=!1),t._init&&(n.groupModel.on=r.summary)},initData:function(){var t=this,e=t.that.options.dataModel;e.data=t["flat"==t.getFormat()?"groupById":"flatten"](e.data),t.buildCache()},isCollapsed:function(t){return!!t.pq_close},isOn:function(){return null!=this.Model.dataIndx},moveNodes:function(t,e,n,r){var i,o,a,l,s,c,d,u=this,h=arguments,f=u.that,p=n,g=u.parentId,m=u.id,v=u.childstr,w=f.options,x=u.Model,y=w.dataModel,b=u.getRoots(),C=!r,q=e?e[v]=e[v]||[]:b,I=q.length,_=u.getUniqueNodes(t),R=(n=null==n||n>=I?I:n,q);if(e&&(o=e[m]),c=_.length){if(f._trigger("beforeMoveNode",null,{args:h}),C&&c>1)for(d=_[0],i=(a=u.getParent(d))?a[v]:b,l=i.indexOf(d),s=1;s<c;s++)if(i[s+l]!=_[s]){C=!1;break}for(s=0;s<c;s++)d=_[s],i=(a=u.getParent(d))?a[v]:b,l=i.indexOf(d),a==e?n=pq.moveItem(d,R,l,n):(R.splice(n++,0,d),i.splice(l,1)),x.leafIfEmpty&&a&&u.isEmpty(a)&&u.makeLeaf(a),d[g]=o;x.historyMove&&C&&f.iHistory.push({callback:function(n){var r=l;e==a&&r>p&&(r+=1),u.moveNodes(t,n?e:a,n?p:r,!0)}}),y.data=u.flatten(b),f.refreshView(),f._trigger("moveNode",null,{args:h})}},off:function(){var t,e=this.fns,n=this.that;for(t in e)n.off(t,e[t]);this.fns={}},on:function(t,e){return this.fns[t]=e,this.that.on(t,e),this},onCellClick:function(e,n){var r=this;n.dataIndx==r.dataIndx&&t(e.originalEvent.target).hasClass("pq-group-icon")&&(pq.isCtrl(e)?r[n.rowData.pq_close?"expandAll":"collapseAll"]():r.toggleNode(n.rowData,e))},onBeforeCellKeyDown:function(e,n){var r,i,o=this,a=o.that,l=n.rowData,s=n.dataIndx,c=e.keyCode,d=t.ui.keyCode;if(s==o.dataIndx){if(o.isFolder(l)&&(i=l.pq_close,c==d.ENTER&&!a.isEditable({rowIndx:l.pq_ri,dataIndx:s})||!i&&c==d.LEFT||i&&c==d.RIGHT))return o.toggleNode(l),!1;if(c==d.SPACE&&(r=a.getCell(n).find("input[type='checkbox']")).length)return r.click(),!1}},hasSummary:function(){var t=this.Model;return t.summary||t.summaryInTitleRow},onChange:function(t,e,n){return function(r,i){var o=i.source||"",a=i.addList.length,l=i.deleteList,s=l.length;-1==o.indexOf("checkbox")&&("undo"!=o&&"redo"!=o&&"rollback"!=o||!a&&!s?t.hasSummary()&&n.refreshOnChange&&!a&&!s?(t.refreshSummary(!0),e.refresh()):"addNodes"!=o&&"deleteNodes"!=o||t.refreshViewFull():t.refreshViewFull(),n.leafIfEmpty&&l.forEach(function(e){var n=t.getParent(e.rowData);n&&t.isEmpty(n)&&t.makeLeaf(n)}))}},clearFolderCheckbox:function(t){var e=this,n=e.cbId;t.forEach(function(t){e.isFolder(t)&&delete t[n]})},onClearFilter:function(t,e){return this.clearFolderCheckbox(e.data),e.data=this.groupById(e.data),!1},onCustomFilter:function(t,e){var n=this,r=n.that,i=n.groupById(e.data),o=r.iFilterData,a=e.filters,l=[],s=[],c=e.mode;return n.filter(n.getRoots(i),a,o,c,l,s,e.hideRows),e.dataTmp=n.groupById(l),e.dataUF=s,n.clearFolderCheckbox(e.dataTmp),!1},onDataAvailable:function(){this.initData()},refreshSummary:function(t){var e=this;e.summaryT(),e.that.iRefresh.addRowIndx(),t&&e.showHideRows()},onDataReadyAfter:function(){var t=this,e=t.that.options.dataModel,n=t.Model;t.hasSummary()&&(n.filterLockSummary&&n.summaryInTitleRow&&e.dataUF.length||t.refreshSummary()),t.showHideRows(),t.isCascade(n)&&t.cascadeInit()},option:function(e,n){var r,i=this,o=i.that,a=i.Model,l=a.dataIndx;t.extend(a,e),r=a.dataIndx,i.setCellRender(),i.init(),!l&&r&&i.initData(),!1!==n&&o.refreshView()},renderCell:function(t,e){return function(n){var r,i,o,a,l,s=n.rowData,c=t.that,d=e.indent,u=t.indentUnit(d),h=c.options.rtl,f=h?"right":"left",p=n.column,g=p.renderLabel||e.render,m=pq.rtlIcons(e.iconCollapse,h),v=e.checkbox,w=t.isFolder(s),x=t._iconCls(s,w,e),y=s.pq_level||0,b=y*d+d/3,C=["pq-group-title-cell"],q="",I=["padding-left:",(y+1)*d,u,";"],_=n.formatVal||n.cellData;if(g){var R=c.callFn(g,n);null!=R&&("string"!=typeof R?(R.iconCls&&(x=R.iconCls),null!=R.text&&(_=R.text),q=R.attr,C.push(R.cls),I.push(R.style)):_=R)}return n.Export?t.exportCell(_,y):(v&&(a=t.renderCB(v,s,e.cbId))&&(l=a[0],a[1]&&C.push(a[1])),w&&(i="<span style='position:absolute;"+f+":"+b+u+";' class='pq-group-icon pq-tree-icon ui-icon "+(s.pq_close?m[1]:m[0])+"'></span>"),x&&(o="<span class='pq-tree-icon ui-icon "+x+"'></span>"),r=l&&(p.useLabel||e.useLabel),{cls:C.join(" "),attr:q,outer:e.hideLines?"":t.getLines(w,s,y,d,f),style:I.join(""),text:[i,o,r?"<label>":"",l,null!=_?`<span>${_}</span>`:"",r?"</label>":""].join("")})}},refreshViewFull:function(t){var e=this,n=e.that.options.dataModel;n.data=e.groupById(n.data),e.buildCache(),t&&e.refreshView()},_iconCls:function(t,e,n){if(n.icons){var r;if(e&&(r=n.iconFolder))return t.pq_close?r[1]:r[0];if(!t.pq_gsummary)return n.iconFile}},setCellRender:function(){var t,e,n=this,r=n.that,i=n.Model,o=r.columns;i.summary&&r.iGroup.refreshColumns(),(t=n.di_prev)&&((e=o[t])&&(e._render=null),n.di_prev=null),(t=i.dataIndx)&&((e=o[t])._render=n.renderCell(n,i),n.di_prev=t)},_showHideRows:function(t,e,n){for(var r,i,o,a,l,s=this,c=s.id,d=s.nodeClose,u=e||s.getRoots(),h=s.childstr,f=n||!1,p=u.length,g=0;g<p;g++)(o=u[g]).pq_filter||(o.pq_hidden=f),(l=o[h])&&(d&&null!=(i=d[r=o[c]])&&(delete d[r],o.pq_close=i),a=f||o.pq_close,s._showHideRows(t,l,a))},showHideRows:function(){var t,e,n,r=this,i=r.that,o=0,a=i.get_p_data(),l=r.Model.summary;if(r._showHideRows(a),l)for(e=(a=i.pdata).length;o<e;o++)(n=a[o]).pq_gsummary&&(t=r.getParent(n))&&(n.pq_hidden=t.pq_hidden)},toggleNode:function(t,e){this[t.pq_close?"expandNodes":"collapseNodes"]([t],e)}})}(jQuery),function(t){var e=jQuery.paramquery,n=e.pqGrid.prototype,r=function(t){this.that=t;var e=t.options;this.options=e,this.selection=[],this.hclass=" pq-state-select ui-state-highlight"};e.cRows=r,n.SelectRow=function(){return this.iRows},r.prototype={_add:function(t,e){var n,r=this.that,i=t.rowIndxPage,o=!e,a=t.rowData,l=this.inViewRow(i);return!a.pq_hidden&&l&&(n=r.getRow(t)).length&&(n[o?"addClass":"removeClass"](this.hclass),!o&&n.removeAttr("tabindex")),a.pq_rowselect=o,t},_data:function(t){t=t||{};var e=this.that,n=t.all,r=e.riOffset,i=n?0:r,o=e.get_p_data();return[o,i,i+(n?o.length:e.pdata.length)]},add:function(t){var e=t.addList=t.rows||[{rowIndx:t.rowIndx}];t.isFirst&&this.setFirst(e[0].rowIndx),this.update(t)},extend:function(t){var e,n,r,i,o,a=t.rowIndx,l=[],s=this.getFirst();if(null!=s){if(null==(o=this.isSelected({rowIndx:s})))return;for(s>a?(r=s=[a,a=s][0],i=a-1):(r=s+1,i=a),e=r;e<=i;e++)n={rowIndx:e},l.push(n);this.update(o?{addList:l}:{deleteList:l})}},getFirst:function(){return this._firstR},getSelection:function(){for(var t,e=this.that.get_p_data(),n=0,r=e.length,i=[];n<r;n++)(t=e[n])&&t.pq_rowselect&&i.push({rowIndx:n,rowData:t});return i},inViewCol:function(t){var e=this.that,n=e.options,r=e.iRenderB;return t<n.freezeCols||t>=r.initH&&t<=r.finalH},inViewRow:function(t){var e=this.that,n=e.options,r=e.iRenderB;return t<n.freezeRows||t>=r.initV&&t<=r.finalV},isSelected:function(t){var e=t.rowData||this.that.getRowData(t);return e?!0===e.pq_rowselect:null},isSelectedAll:function(t){for(var e,n=this._data(t),r=n[0],i=n[1],o=n[2];i<o;i++)if((e=r[i])&&!e.pq_rowselect)return!1;return!0},removeAll:function(t){this.selectAll(t,!0)},remove:function(t){var e=t.deleteList=t.rows||[{rowIndx:t.rowIndx}];t.isFirst&&this.setFirst(e[0].rowIndx),this.update(t)},replace:function(t){t.deleteList=this.getSelection(),this.add(t)},selectAll:function(t,e){for(var n,r=[],i=this.that.riOffset,o=this._data(t),a=o[0],l=o[1],s=o[2];l<s;l++)(n=a[l])&&r.push({rowIndx:l,rowIndxPage:l-i,rowData:n});this.update(e?{deleteList:r}:{addList:r},!0)},setFirst:function(t){this._firstR=t},toRange:function(){for(var t,e,n=[],r=this.that,i=r.get_p_data(),o=0,a=i.length;o<a;o++)i[o].pq_rowselect?null!=t?e=o:t=e=o:null!=t&&(n.push({r1:t,r2:e}),t=e=null);return null!=t&&n.push({r1:t,r2:e}),r.Range(n)},toggle:function(t){this[this.isSelected(t)?"remove":"add"](t)},toggleAll:function(t){this[this.isSelectedAll(t)?"removeAll":"selectAll"](t)},update:function(t,e){var n=this,r=n.that,i={source:t.source},o=function(t){return e?t:r.normalizeList(t)},a=o(t.addList||[]),l=o(t.deleteList||[]);if(a=a.filter(function(t){return!1===n.isSelected(t)}),l=l.filter(n.isSelected.bind(n)),a.length||l.length){if(i.addList=a,i.deleteList=l,!1===r._trigger("beforeRowSelect",null,i))return;i.addList.forEach(function(t){n._add(t)}),i.deleteList.forEach(function(t){n._add(t,!0)}),r._trigger("rowSelect",null,i)}}}}(),function(t){var e=t.paramquery;t(document).on("pqGrid:bootup",function(t,e){var r=e.instance;r.iImport=new n(r)}),e.pqGrid.prototype.importWb=function(t){return this.iImport.importWb(t)};var n=e.cImport=function(t){this.that=t};n.prototype={fillRows:function(t,e,n){for(var r=t.length;r<e;r++)t.push(n?{}:[])},generateCols:function(t,e,n){var r,i,o=[],a=0,l=0,s=pq.excel.colWidth,c=[],d=n?n.cells:[],u=[];for(d.forEach(function(t,e){var n=t.indx||e;u[n]=t.value,c[n]=t}),(e=e||[]).forEach(function(t,e){l=t.indx||e,o[l]=t}),t=Math.max(t,e.length,l+1);a<t;a++)r=o[a]||{},i={_title:u[a]||"",title:this._render,width:r.width||s,style:{},styleHead:{},halign:"center"},this.copyStyle(r,i,i.style),this.copyStyle(c[a]||{},{},i.styleHead),r.hidden&&(i.hidden=!0),o[a]=i;return o},_render:function(t){return t.column._title||pq.toLetter(t.colIndx)},importS:function(t,n,r,i,o){var a,l,s,c,d,u,h,f,p=t.mergeCells,g=this,m=[],v={},w=g.that,x=0,y=t.rows||[],b=t.frozenRows||0,C=y.length,q=0,I=w.colModel,_=0,R=pq.getROFn("toImport"),D=I&&I.length,M=e.cFormulas.shiftRC(),S=[],T={};for(null!=o&&(_=o+1,c=y[o],x=c.cells.length,(y=y.slice(_)).forEach(function(t){null!=t.indx&&(t.indx-=_)}),b=(b-=_)>0?b:0),(t.pics||[]).forEach(t=>{let[e,n,r]=t.from,[i,o,a]=t.to;e==i&&r==a?(T[r]=T[r]||{},T[r][e]=t):S.push(t)}),q=0,C=y.length;q<C;q++){l=(a=y[q]).indx||q;let t=(s={}).pq_cellprop={},e=s.pq_cellstyle={},n=s.pq_cellattr={},r=s.pq_rowstyle={},o=s.pq_rowprop={};s.pq_celldt={};g.copyStyle(a,o,r),l!=q&&g.fillRows(m,l,!0);let c=T[l],p=a.cells||[];if(c){p=p.slice();for(let t in c)p.push({indx:t,pic:c[t]})}p.forEach(function(r,o){let a=1*(r.indx||o),l=i&&D&&I[a]?I[a].dataIndx:a,c=R(r);c?(s[l]=c.val,u=t[l]=c.prop):(s[l]=r.value,u=t[l]={}),h=e[l]={},g.copyStyle(r,u,h),(d=r.comment)&&(n[l]={title:d}),(f=r.formula)&&g.copyFormula(s,l,_?M(f,0,-_):f),x<=a&&(x=a+1)}),a.htFix>=0&&(s.pq_ht=a.htFix,s.pq_htfix=!0),a.hidden&&(s.pq_hidden=!0),m[l]=s}function F(e,n,r,i){var o=0;return(t.charts||[]).concat(t.pics||[]).forEach(t=>{var a=t.from[n],l=t.to?t.to[n]:t[r]/i+a;o=Math.max(Math.max(e,a+1,l+1)-e,o)}),o}return v.title=t.name,n=(n||0)+F(m.length,2,"cy",20),r=(r||0)+F(x,0,"cx",50),n&&g.fillRows(m,m.length+n,!0),v.dataModel={data:m},x+=r||0,!i&&x&&(v.colModel=g.generateCols(x,t.columns,c)),v.mergeCells=(p||[]).map(function(t){var e=pq.getAddress(t);return e.r1-=_,e.r2-=_,e}).filter(function(t){return t.r1>=0}),v.freezeRows=b,v.freezeCols=t.frozenCols,v.pics=S,v.charts=t.charts||[],v},copyFormula:function(t,e,n){(t.pq_fn=t.pq_fn||{})[e]=n},copyStyle:function(t,e,n){var r,i,o;if(null!=(r=t.font)&&(n["font-family"]=r),null!=(r=t.fontSize)&&(n["font-size"]=r?r+"pt":r),null!=(r=t.color)&&(n.color=r),null!=(r=t.bgColor)&&(n["background-color"]=r),null!=(r=t.bold)&&(n["font-weight"]=r?"bold":r),null!=(r=t.italic)&&(n["font-style"]=r?"italic":r),null!=(r=t.underline)&&(n["text-decoration"]=r?"underline":r),null!=(r=t.wrap)&&(n["white-space"]=r?"normal":""),null!=(r=t.align)&&(e.align=r),null!=(r=t.valign)&&(e.valign=r),null!=(r=t.format)&&(e.format=r),r=t.border)for(i in r)o=r[i],n["border-"+i]=o},applyOptions:function(t,e){var n=t.options.dataModel,r=e.dataModel;if(r){for(var i in r)n[i]=r[i];delete e.dataModel}t.option(e)},importWb:function(t){var e,n=t.workbook,r=n.activeId||0,i=this,o=i.that.iTab,a=o.tabs(),l=o.main(),s=t.sheet,c=function(e){return i.importS(e,t.extraRows,t.extraCols,t.keepCM,t.headerRowIndx)},d=function(t){i.applyOptions(l,t)};a?(o.clear(),n.sheets.forEach(function(e,n){var i={sheet:e,extraRows:t.extraRows,extraCols:t.extraCols,name:e.name,hidden:e.hidden};a.push(i),n==r&&(i._inst=l,d(c(e)))}),o.model.activeId=r,l._trigger("tabsReady"),l.element.show(),o.refresh()):(s=s||0,(e=n.sheets.filter(function(t,e){return s==e||s&&s==t.name})[0])&&d(c(e))),l._trigger("importWb"),l.refreshDataAndView()}}}(jQuery),function(t){var e;pq.excelImport={attr:(e=new RegExp('([a-z]+)\\s*=\\s*"([^"]*)"',"gi"),function(t){t=(t=t||"").slice(0,t.indexOf(">"));var n={};return t.replace(e,function(t,e,r){n[e]=r}),n}),async getComment(e){var n,r=this,i={};e.length&&((n=t(e.find('Relationship[Type*="/comments"]')[0]).attr("Target"))&&(n=n.split("/").pop(),((await r.getFileText("xl/"+n)).match(/<comment\s+[^>]*>([\s\S]*?)<\/comment>/g)||[]).forEach(function(e){var n=r.attr(e).ref,o=e.match(/<t(\s+[^>]*)?>([\s\S]*?)(?=<\/t>)/g),a=r.match(o[o.length-1],/[^>]*>([\s\S]*)/,1);i[n]=pq.unescapeXml(t.trim(a))})));return i},getLinks:function(t,e){var n={},r=this;return e.length&&(t.match(/<hyperlink[^s](.*?)\/>/g)||[]).forEach(function(t){var i=r.attr(t),o=i.ref,a=i.id,l=e.find('Relationship[Type*="/hyperlink"][Id="'+a+'"]').attr("Target");l&&(n[o]=l)}),n},async getPic(e,n,r){var i,o=this,a=[],l=o.files,s=o.match(e,/<drawing\s+r:id=\"([^\"]*)\"(\s*)\/>/i,1);if(s){var c,d,u=(u=t(n.find('Relationship[Id="'+s+'"]')[0]).attr("Target")||"").split("/").pop(),h={},f={},p=9500,g=await o.pxml("xl/drawings/"+u),m=await o.pxml("xl/drawings/_rels/"+u+".rels"),v=["col","colOff","row","rowOff"];for(i in m.find("Relationship[Type*='/image']").each(function(e,n){var r=(c=t(n)).attr("Target").match(/media\/(.*)/);r&&r[1]&&(h[c.attr("Id")]=r[1])}),l)/media\/.*/.test(i)&&(f[q=i.match(/media\/(.*)/)[1]]=await o.getBase64(l[i]));for(const[e,n]of g.find("xdr\\:twoCellAnchor,xdr\\:oneCellAnchor").toArray().entries()){var w=t(n),x=w.find("xdr\\:cNvPr"),y=x.attr("descr"),b=x.attr("id"),C=w.find("a\\:blip").attr("r:embed"),q=h[C],I=w.find("xdr\\:from"),_=w.find("xdr\\:to"),R=w.find("xdr\\:ext"),D=_.length,M=[],S=D?[]:null,T=w.find("c\\:chart,cx\\:chart").attr("r:id"),F=(w.find("cx\\:chart").length,R.attr("cx")/p),k=R.attr("cy")/p;v.forEach(function(t,e){d=e%2?p:1,M.push(I.find("xdr\\:"+t).text()/d),D&&S.push(_.find("xdr\\:"+t).text()/d)}),T||(y||q)&&a.push({id:b,name:y||q,src:f[q],from:M,to:S,cx:D?0:F,cy:D?0:k})}}return[a,[]]},async getBase64(t){var e=t.async?await t.async("base64"):JSZip.base64.encode(t.asBinary());return"data:"+pq.getMimeType(e)+";base64,"+e},async pxml(e){return t(t.parseXML(await this.getFileText(e)))},pxmlstr:function(e){return t(t.parseXML(t.trim(e)))},cacheTheme:async function(){var e=this,n=e.pxmlstr(await e.getFileTextFromKey("th")).find("a\\:clrScheme").children(),r=e.themeColor=["FFFFFF","000000"],i=e.accentColors={};n.each(function(e,n){var o,a=t(n).children(),l=n.nodeName.replace("a:","");e>1?(o=a.attr("val"),2==e?r[3]=o:3==e?r[2]=o:r[e]=o):o=a.attr("lastClr")||a.attr("val"),i[l]=o});var o=(t,e)=>{i[t]=i[e],delete i[e]};o("bg1","lt1"),o("bg2","lt2"),o("tx1","dk1"),o("tx2","dk2")},colorFromNode:function(t){for(var e,n,r=t.attributes,i=0;i<r.length;i++){var o=r[i],a=o.name,l=o.value;"indexed"==a?e=this.indexes[l]:"rgb"==a?e=l.slice(2):"theme"==a?e=this.themeColor[l]:"tint"==a&&(n=l)}if(e)return n&&(e=pq.tint(e,n)),"#"+e},indexes:["000000","FFFFFF","FF0000","00FF00","0000FF","FFFF00","FF00FF","00FFFF","000000","FFFFFF","FF0000","00FF00","0000FF","FFFF00","FF00FF","00FFFF","800000","008000","000080","808000","800080","008080","C0C0C0","808080","9999FF","993366","FFFFCC","CCFFFF","660066","FF8080","0066CC","CCCCFF","000080","FF00FF","FFFF00","00FFFF","800080","800000","008080","0000FF","00CCFF","CCFFFF","CCFFCC","FFFF99","99CCFF","FF99CC","CC99FF","FFCC99","3366FF","33CCCC","99CC00","FFCC00","FF9900","FF6600","666699","969696","003366","339966","003300","333300","993300","993366","333399","333333","000000"],cacheStyles:async function(){var e,n=this,r=n.pxmlstr(await n.getStyleText()),i=t.extend(!0,{},n.preDefFormats),o=[],a=[],l=["",""],s=[];r.find("numFmts>numFmt").each(function(e,n){var r,o=t(n);r=o.attr("formatCode");i[o.attr("numFmtId")]=r}),r.find("fills>fill>patternFill>fgColor").each(function(t,e){l.push(n.colorFromNode(e))});var c={double:"3px",thick:"3px",medium:"2px"},d={thin:"solid",medium:"solid",thick:"solid",hair:"dotted"};r.find("borders>border").each(function(e,r){var i=t(r).children(),o={};i.each(function(e,r){var i,a=t(r),l=a.children()[0];l&&(i=a.attr("style"),o[r.tagName]=(c[i]||"1px")+" "+(d[i]||i)+" "+(n.colorFromNode(l)||"#000000"))}),s.push(o)}),r.find("fonts>font").each(function(e,r){var i=t(r),o=1*i.find("sz").attr("val"),l=i.find("name").attr("val"),s=i.find("color")[0],c={};i.find("b").length&&(c.bold=!0),s&&(s=n.colorFromNode(s))&&(c.color=s),l&&null!=l.toUpperCase()&&(c.font=l),o&&null!=o&&(c.fontSize=o),i.find("u").length&&(c.underline=!0),i.find("i").length&&(c.italic=!0),a.push(c)}),r.find("cellXfs>xf").each(function(n,r){var c,d,u,h=t(r),f=1*h.attr("numFmtId"),p=1*h.attr("fillId"),g=1*h.attr("borderId"),m=h.children("alignment"),v=1*h.attr("fontId"),w=null==v?{}:a[v],x={};for(u in m.length&&((c=m.attr("horizontal"))&&(x.align=c),(d=m.attr("vertical"))&&(x.valign=d),"1"==m.attr("wrapText")&&(x.wrap=!0)),f&&(e=i[f],x.format=e),g&&(x.border=s[g]),p&&l[p]&&(x.bgColor=l[p]),w)x[u]=w[u];o.push(x)}),n.getStyle=function(t){return o[t]},r=0},getMergeCells:function(t){var e=this;return(t.match(/<mergeCell\s+.*?(\/>|<\/mergeCell>)/g)||[]).map(function(t){return e.attr(t).ref})},getFrozen:function(t){var e=this.match(t,/<pane.*?(\/>|<\/pane>)/,0),n=this.attr(e),r=1*n.xSplit;return{r:1*n.ySplit||0,c:r||0}},getFormula:function(e){var n={},r=t.paramquery.cFormulas.shiftRC();return function(t,i,o){if("<f"===t.substr(0,2)){var a,l=e.match(t,/^<f.*?>(.*?)<\/f>/,1),s=e.attr(t);return"shared"==s.t&&(l?n[s.si]={r:i,c:o,f:l}:(a=n[s.si],l=r(a.f,o-a.c,i-a.r))),0==l.indexOf("_xl")&&(l=l.split(".")[1]),l}}},getCols:function(t){for(var e,n=this,r=(t.match(/<dimension\s.*?\/>/)||[])[0],i=n.attr(r||"").ref,o=[],a=t.match(/<col\s.*?\/>/g)||[],l=a.length,s=i?pq.getAddress(i).c2+1:0,c=s||l,d=pq.excel.colRatio,u=0;u<l;u++){var h,f,p=a[u],g=n.attr(p),m=1*g.min,v=1*g.max,w=1*g.hidden,x=1*g.width,y=g.style,b=m,C=y?n.getStyle(y):{};if(s){if(u>c)break;v=Math.min(v,c)}for(;b<=v;b++){for(f in h={},w?h.hidden=!0:h.width=1*(x*d).toFixed(2),b!==o.length+1&&(e=b-1,h.indx=e),C)h[f]=C[f];o.push(h)}}return o},getColor:function(t){return"#"+t.slice(2)},getPath:function(t){return this.paths[t]},getPathSheets:function(){return this.pathSheets},getFileTextFromKey:async function(t){return await this.getFileText(this.getPath(t))},getFileText:async function(t){if(t){var e=this.files[t.replace(/^\//,"")];return e?(await this.asText(e)).replace(/\<x\:/g,"<").replace(/\<\/x\:/g,"</"):""}return""},getStyleText:async function(){return await this.getFileTextFromKey("st")},getSI:function(t){var e,n=[],r=pq.unescapeXml,i=1*this.attr(this.match(t,/<sst.*?>[\s\S]*?<\/sst>/,0)).uniqueCount;if(t.replace(/<si>([\s\S]*?)<\/si>/g,function(t,i){e=[],i.replace(/<t.*?>([\s\S]*?)<\/t>/g,function(t,n){e.push(n)}),n.push(r(e.join("")))}),i&&i!==n.length)throw"si misatch";return n},getCsv:function(t,e){var n=[],r=Math.random()+"";return t=t.trim().replace(/(?:^|[^"]+)"(([^"]|"{2})+)"(?=([^"]+|$))/g,function(t,e){var i=t.indexOf(e);return n.push(e.replace(/""/g,'"')),t.slice(0,i-1)+r+(n.length-1)+r}),e=e||new RegExp(-1==t.indexOf("\t")?",":"\t","g"),{sheets:[{rows:(t=t.split(/\r\n|\r|\n/g)).map(function(t){return{cells:t.split(e).map(function(t){if(0==t.indexOf(r)){var e=t.slice(r.length,t.indexOf(r,1));t=n[e]}else'""'===t&&(t="");return{value:t}})}})}]}},getWorkBook:async function(t,e,n){let r=this,i={};e?i[e]=!0:pq.isStr(t)&&(i.base64=!0),JSZip.loadAsync?r.files=(await JSZip.loadAsync(t,i)).files:r.files=new JSZip(t,i).files,await r.readPaths(),await r.cacheTheme(),await r.cacheStyles();let o=this.getPath("ss"),a=[],l=o?this.getSI(await this.getFileText(o)):[];for(const[t,e]of r.getPathSheets().entries())if(!n||n.indexOf(t)>-1||n.indexOf(e.name)>-1){let n=await r.getFileText(e.path),i=r.match(n,/<sheetData.*?>([\s\S]*?)<\/sheetData>/,1),o=await r.getWorkSheet(n,i,l,e.name,t+1);e.hidden&&(o.hidden=!0),a.push(o)}return delete r.files,{sheets:a,activeId:r.activeId}},async getWorkSheet(t,e,n,r,i){let o,a,l,s,c,d,u,h,f,p,g,m,v,w,x,y,b,C,q,I,_,R,D=this,M=await D.pxml("xl/worksheets/_rels/sheet"+i+".xml.rels"),S=await D.getComment(M),T=D.getLinks(t,M),F=[],k=0,E=pq.toNumber,P=D.getFormula(D),$=pq.formulas,A=(pq.isDateFormat,D.getMergeCells(t)),H=e.match(/<row[^<]*?\/>|<row[\s\S]*?<\/row>/g)||[],O=D.getCols(t),L={},N=["fontSize","font","color","bgColor","format","align","valign","bold","underline","italic"],V=0,j=H.length;for(O.forEach(function(t,e){L[t.indx||e]=t});V<j;V++){for(o in d={cells:[]},C=H[V],w=D.attr(C),I=w.r,w.customHeight&&(d.htFix=1.32*w.ht),f=w.s,_=f?D.getStyle(f):{},_)d[o]=_[o];q=I?I-1:V,q!==V&&(d.indx=q),w.hidden&&(d.hidden=!0),u=C.match(/(<c[^<]*?\/>|<c[\s\S]*?<\/c>)/gm)||[];for(let t=0,e=u.length;t<e;t++){if(a=u[t],x=D.attr(a),h=x.t,v=D.match(a,/<c.*?>([\s\S]*?)(<\/c>)?$/,1),c={},"inlineStr"==h?(R=v.match(/<t><!\[CDATA\[([\s\S]*?)\]\]><\/t>/),R?p=R[1]:(R=v.match(/<t>([\s\S]*?)<\/t>/),p=pq.unescapeXml(R[1]))):(p=D.match(v,/<v>(.*?)<\/v>/,1)||void 0,null!=p&&(p="s"==h?n[p]:"str"==h?pq.unescapeXml(p):"b"==h?"1"==p:$.VALUE(p))),g=x.r,g?(m=g.replace(/\d+/,""),m=E(m)):(m=t,g=pq.toLetter(m)+(q+1)),S[g]&&(c.comment=S[g]),T[g]&&(c.link=T[g]),k=k>m?k:m,void 0!==p&&(c.value=p),m!==t&&(c.indx=m),l=P(v,q,m),l&&(c.formula=pq.unescapeXml(l)),f=x.s,b=L[m]||{},f&&(f=this.getStyle(f))){for(o in f)y=f[o],b[o]!==y&&d[o]!==y&&(c[o]=y);s=c.format}N.forEach(function(t){!b[t]&&!d[t]||f&&f[t]||(c[t]="")}),d.cells.push(c)}F.push(d)}var B=await D.getPic(t,M,r),z={rows:F,name:r,pics:B[0]},U=D.getFrozen(t);return z.charts=B[1]||[],A.length&&(z.mergeCells=A),O.length&&(z.columns=O),U.r&&(z.frozenRows=U.r),U.c&&(z.frozenCols=U.c),z},Import:function(t,e){let n=this,r=t.file,i=t.content,o=t.url,a="csv"==(o||(r||{}).name||"").slice(-3).toLowerCase()||t.csv,l=async function(r,i){e(await n[a?"getCsv":"getWorkBook"](r,a?t.separator:t.type||i,t.sheets))};o?(o+="?"+Math.random(),pq.xmlhttp(o,a?"text":"arrayBuffer",l)):r?pq.fileRead(r,a?"readAsText":"readAsArrayBuffer",l):i&&l(i)},match:function(t,e,n){var r=t.match(e);return r?r[n]:""},preDefFormats:{0:"",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",5:"$#,##0_);($#,##0)",6:"$#,##0_);[Red]($#,##0)",7:"$#,##0.00_);($#,##0.00)",8:"$#,##0.00_);[Red]($#,##0.00)",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yyyy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yyyy h:mm",37:"#,##0_);(#,##0)",38:"#,##0_);[Red](#,##0)",39:"#,##0.00_);(#,##0.00)",40:"#,##0.00_);[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mm:ss.0",48:"##0.0E+0",49:"@"},readPaths:async function(){var t,e,n=this,r=n.files,i=new DOMParser,o=i.parseFromString(await n.asText(r["[Content_Types].xml"]),"application/xml"),a=n.paths={wb:"sheet.main",ws:"worksheet",st:"styles",ss:"sharedStrings",th:"theme"};for(e in a)t=o.querySelector('[ContentType$="'+a[e]+'+xml"]'),a[e]=t?t.getAttribute("PartName"):void 0;for(e in r)if(/workbook.xml.rels$/.test(e)){a.wbrels=e;break}var l=i.parseFromString(await n.getFileTextFromKey("wbrels"),"application/xml"),s=i.parseFromString(await n.getFileTextFromKey("wb"),"application/xml"),c=n.pathSheets=[],d=s.querySelector("workbookView"),u={},h=l.querySelectorAll("Relationship");n.activeId=d&&1*d.getAttribute("activeTab")||0,h.forEach(function(t){u[t.getAttribute("Id")]=t.getAttribute("Target")}),s.querySelectorAll("sheet").forEach(function(t){var e=t.getAttribute("r:id"),n=t.getAttribute("name"),r=u[e],i=o.querySelector('Override[PartName$="'+r+'"]').getAttribute("PartName");c.push({name:n,rId:e,path:i,hidden:"hidden"==t.getAttribute("state")})}),n.definedNames={},(s.querySelectorAll("definedName")||[]).forEach(function(t){n.definedNames[t.getAttribute("name")]=t.textContent})},asText:async t=>t.async?await t.async("string"):t.asText()}}(jQuery),function(t){var e=t.paramquery,n=e._pqGrid.prototype;n.exportExcel=async function(t){return(t=t||{}).format="xlsx",await this.exportData(t)},n.exportCsv=function(t){return(t=t||{}).format="csv",this.exportData(t)},n.exportData=async function(t){var e=new r(this,t);return await e.Export(t)};var r=e.cExport=function(t){this.that=t,t.Charts=t=>({fcharts:[]})};r.prototype=t.extend({copyStyle:function(t,e,n,r,i){r=r||{},i=i||{};var o,a=function(t){var n=e[t];if(n&&r[t]!=n)return n},l=function(t){var e=n[t];if(e&&i[t]!=e)return e};if(e){e=pq.styleObj(e),(o=a("background-color"))&&(t.bgColor=o),(o=a("font-size"))&&(t.fontSize=parseFloat(o)),(o=a("color"))&&(t.color=o),(o=a("font-family"))&&(t.font=o),(o=a("font-weight"))&&(t.bold="bold"==o),(o=a("white-space"))&&(t.wrap="normal"==o),(o=a("font-style"))&&(t.italic="italic"==o),(o=a("text-decoration"))&&(t.underline="underline"==o);var s=a("border");["left","right","top","bottom"].forEach(function(e){var n;((n=a("border-"+e))||(n=s))&&((t.border=t.border||{})[e]=n)})}n&&((o=l("align"))&&(t.align=o),(o=l("valign"))&&(t.valign=o))},getOCM:function(t,e,n){for(var r,i,o,a=n||this.that.options.colModel,l=[],s=!!e&&void 0,c=a.length,d=0;d<c;d++)(r=(o=a[d]).colModel)&&r.length?(i=this.getOCM(t,e,r)).length&&l.push(Object.assign({},o,{colModel:i,hidden:s,collapsible:e?void 0:{}})):t(o)||l.push(Object.assign({},o,{hidden:s}));return l},async Export(t){t.workbook&&"xlsx"==t.format&&(t.format="wb");var e,n,i,o,a,l,s,c=this.that,d=t.format,u="xlsx"==d||"wb"==d,h=c.Tab(),f=h.tabs(),p={},g=[],m={sheets:g};if(!1===c._trigger("beforeExport",null,t))return!1;if(f){n=(h.activeTab()||{}).name,i=h.activeId(),t.activeSheet?(o=1,p[h.activeTab().name]=1):t.sheets&&(o=1,t.sheets.forEach(function(t){p[t]=1}));for(var v=0;v<f.length;v++){var w=f[v];t.skipHiddenSheets&&w.hidden||o&&!p[w.name]||(a=(l=w._inst)?null:w.sheet,l||u&&a||(l=c.iTab.create(v)),u&&a||(s=new r(l),a=await s._Export(t)),a&&(n==w.name&&(m.activeId=g.length),a.name=w.name,a.hidden=w.hidden,g.push(a)))}i!=h.activeId()&&h.activate(i)}else a=await this._Export(t),u?g[0]=a:a&&(m=a.content);if(u){if(!1===c._trigger("workbookReady",null,{workbook:m}))return m;if("wb"==d)return m;t.workbook=m,e=await pq.excel.exportWb(t)}else e=m;return c._trigger("exportData",null,t),e},async _Export(t){var e=this,n=e.that,r=n.iMerge,i=n.options,o=e.skipCI=[],a=e.hcForHead=n.headerCells,l=a.length-1,s=e.skipRI=[],c=e.xHCols=t.skipHiddenCols,d=e.xHRows=t.skipHiddenRows,u=n.Selection(),h=function(t){return c&&t.hidden||t.skipExport||f&&g&&!v[t.dataIndx]},f=t.selection,p="row"==f,g=f&&!p,m=[],v={},w=function(t){return d&&t.pq_hidden||f&&(p&&!t.pq_rowselect||g&&!m[t.pq_ri])},x=n.colModel;f&&g&&(u.eachRow(function(t,e){m[e]=!0}),u.eachCol(function(t){v[t.dataIndx]=!0})),x.forEach(function(t,e){h(t)&&(o[e]=!0)}),r.init(h,w),o.length&&l&&((a=e.hcForHead=n.Columns().getHeaderCells(e.getOCM(h,c))[0])[a.length-1]=x);var y,b,C=i.groupModel,q="remote"==i.pageModel.type,I=n.colModel,_=i.treeModel,R=(e.curPage=C.on&&C.dataIndx.length||q||_.dataIndx&&_.summary)?n.pdata:i.dataModel.data,D=(R=i.summaryData?R.concat(i.summaryData):R,!t.noheader),M=t.format;if((d||f)&&R.forEach(function(t,e){w(t)&&(s[e]=!0)}),"xlsx"==M||"wb"==M)b=await e.getWorksheet(t,R,I,D,a);else if("json"==M)b={content:e.getJsonContent(t,R)};else{var S=D?e.getHead(t):[],T=await n.getPics(),F=await e.getBody(t,R);"js"==M?y={head:S,body:F}:(t.grid=n,y=pq[pq.camelCase("export-"+M)](S,F,t)),b={content:y,pics:T}}return r.init(),b&&(b.name=t.sheetName||i.title),b},getHead:function(t){for(var e,n,r=this,i=r.that,o=t.eachCellHead,a=t.eachRowHead,l=r.hcForHead,s=l.length,c=[],d=r.skipCI,u=0,h=0;h<s;h++){for(var f,p=l[h],g=null,m=[],v=h==s-1,w=0,x=p.length;w<x;w++)if(v&&d[w])u++;else{var y=p[w],b=y.dataIndx,C=y.o_colspan,q=y.rowSpan,I=g==y?I+1:0,_=h>0?l[h-1][w-u]:null;_&&(y==_||b&&b==_.dataIndx)||I?m.push({text:"",empty:!0}):(g=y,n={text:r.getTitle(y,w),alignment:y.halign||y.align,valign:y.hvalign,style:"header"},v||(n.rowSpan=q,n.colSpan=C),(e=pq.styleStr(y.styleHead))&&(n.css=e),o&&o.call(i,n,w,h,y),m.push(n))}f={cells:m},a&&a.call(i,f,h),c.push(f)}return c},getVars:function(){var t=this.that;return{remotePage:"remote"==t.options.pageModel.type,offset:t.riOffset,iGV:t.iRenderB}},getBody:async function(t,e){var n,r,i,o,a,l,s,c,d,u,h,f,p,g,m,v,w,x,y,b,C,q,I,_,R=this,D=R.that,M=D.options.rowInit,S=e.length,T=R.getVars(),F=t.linkStyle,k=T.remotePage,E=T.offset,P=D.iMerge,$=D.colModel,A=R.skipCI,H=R.skipRI,O=$.length,L=T.iGV,N=t.render,V=[],j=t.eachCell,B=t.eachRow,z=t.format,U="htm"==z;for(i=0;i<S;i++)if(!H[i]){for(a=(w=e[i]).pq_rowprop||{},l=w.pq_cellprop||{},y=w.pq_cellstyle||{},r=[],v={rowIndx:x=k?i+E:i,rowIndxPage:x-E,rowData:w,Export:!0},m=[pq.styleStr(w.pq_rowstyle)],M&&(d=(M.call(D,v)||{}).style)&&m.push(pq.styleStr(d)),m=m.join(""),o=0;o<O;o++){if(A[o])continue;if(h=f="",s=l[q=(u=$[o]).dataIndx]||{},b=w[q],I=_="",(g=[pq.styleStr(u.style)]).push(m),g.push(pq.styleStr(y[q])),f=P.ismergedCell(x,o)){if(!(f=P.isRootCell(x,o))){r.push({text:"",empty:!0});continue}(h=P.getRootCellO(x,o)).Export=!0,_=f.colspan,I=f.rowspan,p=R.getRenderVal(h,N,L)}else v.colIndx=o,v.column=u,v.dataIndx=q,p=R.getRenderVal(v,N,L);C=p[0],g.push(pq.styleStr(p[1])),C??="",c={style:"body",alignment:s.align||a.align||u.align,valign:s.valign||a.valign||u.valign,rowSpan:I,colSpan:_};let t=s.inst;t&&(t=pq.RichObjs[t])&&t.toExport?await t.toExport(b,s,c,z):(d=R.getLink(s,C))?(c.text=d[0],c.link=d[1],c.html=U?d[2]:""):c.text=C,c.link&&F&&g.unshift(F),c.css=g.join(""),j&&j.call(D,c,o,x,u,w),r.push(c)}n={cells:r},B&&B.call(D,n,x,w,V),V.push(n)}return V},getJsonContent:function(t,e){return t.nostringify?e:JSON.stringify(e,t.nopqdata?function(t,e){if(0!==(t+"").indexOf("pq_"))return e}:null,t.nopretty?null:2)},getMC:function(t,e,n){var r=this,i=r.that,o=r.skipCI,a=r.skipRI,l=i.iMerge.getMergeCells(e,t.length),s=[],c=0,d=[],u=0;return l.length&&(o.length&&i.colModel.forEach(function(t,e){o[e]&&c++,s[e]=c}),a.length&&t.forEach(function(t,e){a[e]&&u++,d[e]=u})),l.reduce(function(t,e){var r=e.c1,i=e.c2,l=e.r1,c=e.r2;return r=r-(s[r]||0)+(o[r]?1:0),l=l-(d[l]||0)+(a[l]?1:0),i-=s[i]||0,c-=d[c]||0,(i>r&&c>=l||i>=r&&c>l)&&t.push({r1:l+n,r2:c+n,c1:r,c2:i}),t},[])},getXlsMergeCells:function(t,e){for(var n,r=[],i=pq.toLetter,o=(t=t.concat(e)).length,a=0;a<o;a++)n=i((n=t[a]).c1)+(n.r1+1)+":"+i(n.c2)+(n.r2+1),r.push(n);return r},getXlsCols:function(t,e){for(var n,r,i,o=e.length,a=this.that,l=this.skipCI,s=t.eachCol,c=0,d=[],u=0,h=pq.excel.colWidth;u<o;u++)l[u]?c++:(i=1*((r=e[u])._width||h).toFixed(2),n={},this.copyStyle(n,r.style,r),i!==h&&(n.width=i),r.hidden&&(n.hidden=!0),pq.isEmpty(n)||(d.length!==u-c&&(n.indx=u-c),s&&s.call(a,n,u,r),d.push(n)));return d},getXlsHeader:function(t,e,n,r){for(var i,o,a=this,l=a.that,s=t.eachCellHead,c=a.skipCI,d=(n=(e=a.hcForHead).length,0),u=t.eachRowHead,h=[],f=0;f<n;f++){for(var p=e[f],g=[],m=f==n-1,v=0,w=p.length;v<w;v++)if(m&&c[v])d++;else{var x,y=p[v],b=y.dataIndx,C=y.o_colspan,q=y.rowSpan,I=a.getTitle(y,v),_=f>0?e[f-1][v-d]:null;if(_&&(y==_||b&&b==_.dataIndx))I="";else if(v>0&&y==e[f][v-1]){if(v>=i+C)continue;I=""}else!m&&(C>1||q>1)&&(i=v,r.push({r1:f,c1:v,r2:f+q-1,c2:v+C-1}));x={value:I,align:y.halign||y.align,valign:y.hvalign},(o=y.styleHead)&&a.copyStyle(x,o),s&&s.call(l,x,v,f,y),g.push(x)}p={cells:g},u&&u.call(l,p,f),h.push(p)}return h},async getXlsBody(t,n,r){var i,o,a,l,s,c,d,u,h,f,p,g,m,v,w,x,y,b,C,q,I,_,R,D,M,S,T,F,k,E,P,$,A,H=this,O=H.that,L=H.skipRI||[],N=H.skipCI||[],V=t.linkStyle,j=O.colModel,B=j.length,z=t.eachCell,U=t.eachRow,W=O.options,G=W.rowInit,K=[],X=e.cFormulas.shiftRC(O),Q=n.length,Y=H.getVars(),Z=Y.remotePage,J=Y.offset,tt=Y.iGV,et=O.iMerge,nt=t.render,rt=[],it=0,ot=V?pq.styleObj(V):null;for(o=0;o<Q;o++)if(L[o])it++;else{for(E=0,_=(v=n[o]).pq_cellattr,M=v.pq_cellprop||{},C=v.pq_rowprop||{},T=v.pq_cellstyle||{},m=[],P=0,u={rowIndx:w=Z?o+J:o,rowIndxPage:w-J,rowData:v,Export:!0},a=0;a<B;a++){if(N[a]){P++;continue}y=(d=j[a]).style,b=d,F=T[x=d.dataIndx]||"",S=M[x]||{},l=c=v[x],s=O.getFormula(v,x),i=!1,et.ismergedCell(w,a)&&et.isRootCell(w,a)&&((k=et.getRootCellO(w,a)).Export=!0,l=(h=H.getRenderVal(k,nt,tt))[0],f=h[1],g=h[2],p=h[3],i=!0),i||s||(u.colIndx=a,u.column=d,u.dataIndx=x,l=(h=H.getRenderVal(u,nt,tt))[0],f=h[1],g=h[2],p=h[3]),A=W.format.call(O,v,d,S,C),I={},pq.isStr(A)&&(l!==c&&pq.formatNumber(c,A)===l&&(l=c),I.format=A);let t=S.inst;if(t&&(t=pq.RichObjs[t])&&t.toExport){if(await t.toExport(c,S,I,"wb"),I.pic){let t=a-P,e=o+r-it,{src:n,name:i,height:l,width:s}=I.pic;rt.push({id:rt.length+1e3,src:n,name:i,from:[t,0,e,0],to:[t,s,e,l]}),E=Math.max(E,l),delete I.pic}}else void 0!==l&&(I.value=l);_&&(R=_[x])&&((D=R.title)&&(I.comment=D),(D=R.style)&&H.copyStyle(I,D)),(D=H.getLink(S,l))&&(I.value=D[0],I.link=D[1]),I.link&&ot&&(F=Object.assign({},ot,pq.styleObj(F))),H.copyStyle(I,F,S,y,b),H.copyStyle(I,f,g,y,b),p&&(I.comment=p),s&&(r&&(s=X(s,0,r)),I.formula=s),pq.isEmpty(I)||(I.dataIndx=x,m.length!==a-P&&(I.indx=a-P),m.push(I),z&&z.call(O,I,a,w,d,v))}q={},m.length&&(q.cells=m),v.pq_hidden&&(q.hidden=!0),v.pq_htfix?q.htFix=v.pq_ht:E&&(q.htFix=E),H.copyStyle(q,v.pq_rowstyle,C),G&&(D=(G.call(O,u)||{}).style)&&H.copyStyle(q,D),pq.isEmpty(q)||($=o+r-it,K.length!==$&&(q.indx=$),U&&U.call(O,q,w,v,K),K.push(q))}return[K,rt]},getLink:function(t,e){var n;return e&&pq.isStr(e)&&(n=pq.isLink(e))?[n[3],n[1]||n[2],e]:(n=(t||{}).link)?[e,n]:void 0},async getWorksheet(t,e,n,r,i){var o=this,a=o.getXlsCols(t,n),l=[],s=o.that,c=s.options,d=c.freezeCols,u=i.length,h=r?u:0,f=h+(c.freezeRows||0),p=r?o.getXlsHeader(t,i,u,l):[],g=o.getMC(e,o.curPage,h),m=o.getXlsMergeCells(l,g),[v,w]=await o.getXlsBody(t,e,h),x={columns:a,rows:p.concat(v)};return c.rtl&&(x.rtl=!0),m.length&&(x.mergeCells=m),x.headerRows=p.length,f&&(x.frozenRows=f),d&&(x.frozenCols=d),x.pics=s.iPic.pics.concat(w),x.charts=s.Charts().fcharts,x}},pq.mixin.render)}(jQuery),function(t){var e,n,r=pq.excel={_tmpl:{rels:'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/></Relationships>'},eachRow:function(t,e){for(var n=t.rows,r=0,i=n.length;r<i;r++)e(n[r],r)},async exportWb(t){var e=t.workbook,n=t.replace,r=this,i=r._tmpl,o=0,a=e.sheets,l=a.length,s=[],c=[],d=new JSZip,u={},h=d.folder("xl");d.file("_rels/.rels",i.rels),d.file("xl/_rels/workbook.xml.rels",r.getWBookRels(l)),r.chartFileIndx=1;for(var f=0;f<a.length;f++){var p,g,m,v=a[f],w=r.getCols(v.columns),x=v.pics||[],y=v.charts||[],b=y.length,C=x.length||b,q=f+1,I=r.getFrozen(v.frozenRows,v.frozenCols,v.rtl),_=r.getBody(v.rows||[],v.columns||[]),R=r.getMergeCells(v.mergeCells);if(n&&(_=_.replace.apply(_,n)),p=r.comments,g=!pq.isEmpty(p),m=!pq.isEmpty(r.links),h.file("worksheets/sheet"+q+".xml",r.getSheet(I,w,_,R,g,C,q)),g&&(s.push(q),h.file("comments"+q+".xml",r.getComment()),h.file("drawings/vmlDrawing"+q+".vml",r.getVml())),C){for(var D=0;D<b;D++){var M=y[D],[S,T,F]=await M.getCanvas(),k=M.options;k.name="testchart"+k.id+".png",k.cx=T,k.cy=F,k.to=null,k.src=S.toDataURL(),x.push(k)}b=0,y=[],r.addPics(h,x,q),x.forEach(function(t){u[t.name.split(["."])[1]]=1}),c.push(q),o+=b}(g||C||m)&&h.file("worksheets/_rels/sheet"+q+".xml.rels",r.getSheetRel(q,g,C))}return d.file("[Content_Types].xml",r.getContentTypes(l,s,c,o,u)),h.file("workbook.xml",r.getWBook(a,e.activeId)),h.file("styles.xml",r.getStyle()),d.generateAsync?await d.generateAsync({type:t.type||"blob",compression:"DEFLATE"}):d.generate({type:t.type||"blob",compression:"DEFLATE"})},addPics:function(t,e,n){if(e.length){var r=['<xdr:wsDr xmlns:xdr="http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing" xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:c="http://schemas.openxmlformats.org/drawingml/2006/chart" xmlns:cx="http://schemas.microsoft.com/office/drawing/2014/chartex" xmlns:cx1="http://schemas.microsoft.com/office/drawing/2015/9/8/chartex" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:dgm="http://schemas.openxmlformats.org/drawingml/2006/diagram" xmlns:x3Unk="http://schemas.microsoft.com/office/drawing/2010/slicer" xmlns:sle15="http://schemas.microsoft.com/office/drawing/2012/slicer">'],i=['<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">'],o=1,a=parseInt,l=9500,s=function(t){return["<xdr:col>",t[0],"</xdr:col><xdr:colOff>",a(t[1]*l),"</xdr:colOff><xdr:row>",t[2],"</xdr:row><xdr:rowOff>",a(t[3]*l),"</xdr:rowOff>"].join("")};e.forEach(function(e,n){var c=e.from,d=e.name,u="rId"+o++,h=e.to,f=h&&!!h.length,p=f?"two":"one",g=a(e.cx*l),m=a(e.cy*l);r.push("<xdr:",p,"CellAnchor>","<xdr:from>",s(c),"</xdr:from>",f?"<xdr:to>"+s(h)+"</xdr:to>":'<xdr:ext cx="'+g+'" cy="'+m+'"/>','<xdr:pic><xdr:nvPicPr><xdr:cNvPr id="',e.id,'" name="Picture ',n+1,'" descr="',d,'"/>','<xdr:cNvPicPr preferRelativeResize="0"/></xdr:nvPicPr>','<xdr:blipFill><a:blip cstate="print" r:embed="',u,'"/><a:stretch><a:fillRect/></a:stretch></xdr:blipFill>','<xdr:spPr><a:prstGeom prst="rect"><a:avLst/></a:prstGeom><a:noFill/></xdr:spPr>','</xdr:pic><xdr:clientData fLocksWithSheet="0"/></xdr:',p,"CellAnchor>"),i.push('<Relationship Id="',u,'" Target="../media/',d,'" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/image" />'),t.file("media/"+d,e.src.split(",")[1],{base64:!0})}),r.push("</xdr:wsDr>"),i.push("</Relationships>"),t.file("drawings/drawing"+n+".xml",r.join("")),t.file("drawings/_rels/drawing"+n+".xml.rels",i.join(""))}},eachCell:function(t,e,n){t.forEach(function(t,r){var i,o;if(i=t.cells){r=t.indx||r;for(var a=0,l=i.length;a<l;a++)o=i[a],e(o,o.indx||a,r,n)}else(i=t.rows)&&this.eachCell(i,e,r)},this)},findIndex:function(t,e){var n=t.findIndex(e);return t[n].indx||n},getArray:function(t){var e=[],n=this;return this.eachRow(t,function(t){var r=[];t.cells.forEach(function(t){r.push(n.getCell(t))}),e.push(r)}),e},getBody:function(e,n){var r,i,o,a,l,s,c,d,u,h,f,p,g,m,v,w,x,y,b,C,q,I,_=this,R={},D=pq.formulas,M=[],S=_.comments={},T=_.links={},F=e.length;for((n||[]).forEach(function(t,e){R[t.indx||e]=t}),o=0;o<F;o++){for(x=(m=(w=e[o]).cells||[]).length,y=w.hidden?'hidden="1" ':"",b=w.htFix?'customHeight="1" ht="'+w.htFix/1.32+'" ':"",l=s,s=(w.indx||o)+1,o>0&&(s=Math.max(s,l+1)),d='r="'+s+'"',h=(h=_.getStyleIndx(w))?' s="'+h+'" customFormat="1"':"",M.push("<row "+y+b+d+h+">"),a=0;a<x;a++)v=(g=m[a]).value,c=g.indx||a,u="",h="",C=R[c]||{},d=c===a?"":'r="'+pq.toLetter(c)+s+'"',q=t.extend({},C,w,g),r="@"!=(I=g.format),p=(p=g.formula)?"<f>"+pq.escapeXml(p)+"</f>":"",null==v?f="<v></v>":r&&"boolean"==typeof v?(f="<v>"+(v?"1":"0")+"</v>",u='t="b"'):r&&v==1*v&&(v+"").length==(1*v+"").length?f="<v>"+v+"</v>":r&&I&&D.isDateTime(v)?f="<v>"+D.VALUE(v)+"</v>":(u='t="inlineStr"',f="<is><t>"+pq.escapeXml(v)+"</t></is>"),h=(h=_.getStyleIndx(q))?'s="'+h+'"':"",(i=g.comment)&&(S[pq.toLetter(c)+s]=i),(i=g.link)&&(T[pq.toLetter(c)+s]=i),M.push("<c "+u+" "+d+" "+h+">"+p+f+"</c>");M.push("</row>")}return M.join("")},getCell:function(t){var e=t.format,n=t.value;return e?pq.formulas.TEXT(n,e):n},getCSV:function(t){var e=[],n=this;return this.eachRow(t,function(t){var r=[];t.cells.forEach(function(t){r.push(n.getCell(t))}),e.push(r.join(","))}),e.join("\r\n")},getColor:(e={},n=function(t){return 1===t.length?"0"+t:t},function(t){var r,i,o=e[t];if(o||(/^#[0-9,a,b,c,d,e,f]{6}$/i.test(t)?i=t.replace("#",""):(r=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i))&&(i=n((1*r[1]).toString(16))+n((1*r[2]).toString(16))+n((1*r[3]).toString(16))),i&&6===i.length&&(o=e[t]="ff"+i)),o)return o;throw"invalid color: "+t}),_getCol:function(t,e,n,r,i,o){o=o?' style="'+o+'"':"",r&&!i||(i=' customWidth="1" width="'+(i=1*((i=i||this.colWidth)/this.colRatio).toFixed(2))+'"'),t.push('<col min="',e,'" max="',n,'" hidden="',r,'"',i,o,"/>")},getCols:function(t){if(!t||!t.length)return"";var e,n,r,i,o,a,l=[],s=0,c=0,d=0,u=t.length;for(l.push("<cols>");d<u;d++){var h=t[d],f=h.hidden?1:0,p=h.width,g=this.getStyleIndx(h);s=(h.indx||s)+1,r===p&&i===f&&g==o&&s==c+1?n=s:(a&&(this._getCol(l,e,n,i,r,o),e=null),n=s,null==e&&(e=s)),r=p,i=f,o=g,c=s,a=!0}return this._getCol(l,e,n,i,r,o),l.push("</cols>"),l.join("")},getComment:function(){var t,e=[],n=this.comments;for(t in n)e.push('<comment authorId="0" ref="',t,'"><text><t xml:space="preserve">',pq.escapeXml(n[t]),"</t></text></comment>");return['<?xml version="1.0" encoding="UTF-8" standalone="yes"?>','<comments xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">',"<authors><author></author></authors>","<commentList>",e.join(""),"</commentList></comments>"].join("")},getContentTypes:function(t,e,n,r,i){for(var o,a=[],l=1,s=[],c=[];l<=t;l++)a.push('<Override PartName="/xl/worksheets/sheet'+l+'.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"/>');for(o in e.forEach(function(t){s.push('<Override PartName="/xl/comments',t,'.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml" />')}),i)c.push('<Default Extension="'+o+'" ContentType="image/'+o+'" />');for(n.forEach(function(t){c.push('<Override PartName="/xl/drawings/drawing',t,'.xml" ContentType="application/vnd.openxmlformats-officedocument.drawing+xml"/>')}),l=1;l<=r;l++)c.push('<Override PartName="/xl/charts/chart',l,'.xml" ContentType="application/vnd.openxmlformats-officedocument.drawingml.chart+xml" />');return['<?xml version="1.0" encoding="UTF-8" standalone="yes"?>','<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">','<Override PartName="/xl/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml"/>','<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>','<Default Extension="xml" ContentType="application/xml" />','<Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"/>',a.join(""),'<Default Extension="vml" ContentType="application/vnd.openxmlformats-officedocument.vmlDrawing" />',s.join(""),c.join(""),"</Types>"].join("")},getFillIndx:function(t){var e=this,n=e.fills=e.fills||{length:2};return e.getIndx(n,t)},getBorderIndx:function(t){var e=this,n=e.borders=e.borders||{length:1};return e.getIndx(n,JSON.stringify(t))},getFontIndx:function(t,e,n,r,i,o){var a=this,l=a.fonts=a.fonts||{length:1};return a.getIndx(l,(t||"")+"_"+(e||"")+"_"+(n||"")+"_"+(r||"")+"_"+(i||"")+"_"+(o||""))},getFormatIndx:function(t){var e=this,n=e.formats=e.formats||{length:164};return e.numFmtIds[t]||e.getIndx(n,t)},getFrozen:function(t,e,n){return["<sheetViews><sheetView ",n?'rightToLeft="1"':"",' workbookViewId="0">','<pane xSplit="',e=e||0,'" ySplit="',t=t||0,'" topLeftCell="',pq.toLetter(e)+(t+1),'" activePane="bottomLeft" state="frozen"/>',"</sheetView></sheetViews>"].join("")},getIndx:function(t,e){var n=t[e];return null==n&&(n=t[e]=t.length,t.length++),n},getItem:function(t,e){var n,r,i=t[e],o=0,a=0,l=i?i.indx:-1;if(null==l||e==l)return i;if((n=-1==l?t.length-1:e)>=0)for(;;){if(++a>20)throw"not found";if((l=(i=t[r=Math.floor((n+o)/2)]).indx)==e)return i;if(l>e?n=r:o=r==o?r+1:r,o==n&&r==o)break}},getMergeCells:function(t){var e=[],n=0,r=(t=t||[]).length;for(e.push('<mergeCells count="'+r+'">');n<r;n++)e.push('<mergeCell ref="',t[n],'"/>');return e.push("</mergeCells>"),r?e.join(""):""},getSheetRel:function(t,e,n){var r=['<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">'],i='Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/';e&&r.push(`<Relationship Id="com${t}" Target="../comments${t}.xml" ${i}comments" />\n<Relationship Id="vml${t}" Target="../drawings/vmlDrawing${t}.vml" ${i}vmlDrawing" />`),n&&r.push(`<Relationship Id="rId${t}" Target="../drawings/drawing${t}.xml" ${i}drawing"/>`);var o=this.links,a=0;for(var l in o)a++,r.push(`<Relationship Id="hid${a}" ${i}hyperlink" Target="${o[l]}" TargetMode="External"/>`);return r.push("</Relationships>"),r.join("")},getSheet:function(t,e,n,r,i,o,a){var l,s=this.links,c=0,d="";if(!pq.isEmpty(s)){for(l in d="<hyperlinks>",s)d+='<hyperlink ref="'+l+'" r:id="hid'+ ++c+'"/>';d+="</hyperlinks>"}return['<?xml version="1.0" encoding="UTF-8" standalone="yes"?><worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">',t,e,"<sheetData>",n,"</sheetData>",r,d,o?'<drawing r:id="rId'+a+'" />':"",i?'<legacyDrawing r:id="vml'+a+'" />':"","</worksheet>"].join("")},getStyleIndx:function(t){var e=t.format,n=t.bgColor,r=t.color,i=t.font,o=t.fontSize,a=t.align,l=t.valign,s=t.wrap,c=t.bold,d=t.italic,u=t.underline,h=t.border;if(e||n||r||i||o||a||l||s||c||d||u||h){var f=this,p=e?f.getFormatIndx(e):"",g=n?f.getFillIndx(n):"",m=h?f.getBorderIndx(h):"",v=p+"_"+g+"_"+(r||i||o||c||d||u?f.getFontIndx(r,i,o,c,d,u):"")+"_"+(a||"")+"_"+(l||"")+"_"+(s||"")+"_"+m,w=f.styles=f.styles||{length:1};return f.getIndx(w,v)}},getStyle:function(){var t,e,n,r,i,o,a,l,s,c,d,u,h,f,p,g,m,v,w,x,y=this,b=y.formats,C=y.fills,q=y.fonts,I=y.borders,_=["left","right","top","bottom"],R=y.styles,D=[],M=[],S=[],T=[],F=['<xf numFmtId="0" applyNumberFormat="1"/>'],k={"1px solid":"thin","2px solid":"medium","3px solid":"thick","3px double":"double","1px dotted":"dotted","1px dashed":"dashed"};if(b){for(x in delete b.length,b){var E=pq.escapeXmlAttr(x);D.push('<numFmt numFmtId="'+b[x]+'" formatCode="'+E+'"/>')}delete y.formats}if(C){for(x in delete C.length,C)M.push('<fill><patternFill patternType="solid"><fgColor rgb="'+this.getColor(x)+'"/></patternFill></fill>');delete y.fills}if(q){for(x in delete q.length,q)t=(a=x.split("_"))[0]?'<color rgb="'+this.getColor(a[0])+'" />':"",n=a[1]?'<name val="'+pq.escapeXmlAttr(a[1])+'"/>':"",e=a[2]?'<sz val="'+a[2]+'"/>':"",r=a[3]?"<b/>":"",i=a[4]?"<i/>":"",o=a[5]?"<u/>":"",S.push("<font>",r,i,o,e,t,n,'<family val="2"/></font>');delete y.fonts}if(I){for(x in delete I.length,I){var P=JSON.parse(x);T.push("<border>"),_.forEach(function(t){P[t]&&(a=P[t].split(" "),T.push("<"+t+' style="'+k[[a[0],a[1]].join(" ")]+'"><color rgb="'+y.getColor(a[2])+'"/></'+t+">"))}),T.push("</border>")}delete y.borders}if(R){for(x in delete R.length,R)l=(a=x.split("_"))[0],s=a[1],c=a[2],d=a[3],u=a[4],h=a[5],p=s?' applyFill="1" fillId="'+s+'" ':"",m=c?' applyFont="1" fontId="'+c+'" ':"",g=l?' applyNumberFormat="1" numFmtId="'+l+'"':"",w=(f=a[6])?' applyBorder="1" borderId="'+f+'"':"",u=u?' vertical="'+u+'" ':"",h=h?' wrapText="1" ':"",v=(d=d?' horizontal="'+d+'" ':"")||u||h?' applyAlignment="1"><alignment '+d+u+h+"/></xf>":"/>",F.push("<xf "+g+p+m+w+v);delete this.styles}return D=D.join("\n"),F=F.join("\n"),M=M.join("\n"),['<?xml version="1.0" encoding="UTF-8" standalone="yes"?>','<styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">',"<numFmts>",D,"</numFmts>","<fonts>",'<font><sz val="11"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font>',S=S.join(""),"</fonts>",'<fills><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill>',M,"</fills>","<borders><border><left/><right/><top/><bottom/><diagonal/></border>",T=T.join("\n"),"</borders>",'<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/>',"</cellStyleXfs>","<cellXfs>",F,"</cellXfs>",'<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>','<dxfs count="0"/><tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleLight16"/>',"</styleSheet>"].join("")},getVml:function(){var t,e=[],n=this.comments;for(t in n){var r=t.match(/([A-Z]+)(\d+)/),i=pq.toNumber(r[1]),o=r[2]-1;e.push('<v:shape id="1" type="#0" style="position:absolute;margin-left:259.25pt;margin-top:1.5pt;width:108pt;height:59.25pt;z-index:1;visibility:hidden" fillcolor="#ffffe1" o:insetmode="auto"><v:fill color2="#ffffe1"/><v:shadow on="t" color="black" obscured="t"/><v:path o:connecttype="none"/><v:textbox style="mso-direction-alt:auto"><div style="text-align:right"></div></v:textbox><x:ClientData ObjectType="Note"><x:MoveWithCells/><x:SizeWithCells/><x:Anchor>1, 15, 0, 2, 3, 31, 4, 1</x:Anchor><x:AutoFill>False</x:AutoFill>',"<x:Row>",o,"</x:Row>","<x:Column>",i,"</x:Column></x:ClientData></v:shape>")}return['<xml xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel"><o:shapelayout v:ext="edit"><o:idmap v:ext="edit" data="1"/></o:shapelayout>','<v:shapetype id="0" coordsize="21600,21600" o:spt="202" path="m,l,21600r21600,l21600,xe"><v:stroke joinstyle="miter"/><v:path gradientshapeok="t" o:connecttype="rect"/></v:shapetype>',e.join(""),"</xml>"].join("")},getWBook:function(t,e){return['<?xml version="1.0" encoding="UTF-8" standalone="yes"?><workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">',"<bookViews><workbookView "+(e>=0?"activeTab='"+e+"'":"")+" /></bookViews><sheets>",t.map(function(t,e){e++;var n=t.name;return["<sheet ",t.hidden?'state="hidden"':"",' name="',n?pq.escapeXml(n):"sheet"+e,'" sheetId="',e,'" r:id="rId',e,'"/>'].join("")}).join(""),"</sheets></workbook>"].join("")},getWBookRels:function(t){for(var e=[],n=1;n<=t;n++)e.push('<Relationship Id="rId'+n+'" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet'+n+'.xml"/>');return['<?xml version="1.0" encoding="UTF-8" standalone="yes"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">',e.join(""),'<Relationship Id="rId',n,'" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/>',"</Relationships>"].join("")},importXl:function(){var t=pq.excelImport;return t.Import.apply(t,arguments)},SpreadSheet:function(t){var e,n=r.SpreadSheet;if(this instanceof n==0)return new n(t);for(e in t)this[e]=t[e]}};r.colRatio=7.1,r.colWidth=8.43*r.colRatio,r.numFmtIds=function(){var t=pq.excelImport.preDefFormats,e={};for(var n in t)e[t[n]]=n;return e}(),r.SpreadSheet.prototype={getCell:function(t,e){var n=this.rows||[],i=r.getItem(n,t)||{cells:[]};return r.getItem(i.cells,e)}}}(jQuery),function(t){var e=t.paramquery;e.pqGrid.defaults.formulasModel={on:!0},e.pqGrid.prototype.getFormula=function(t,e){var n=this.iFormulas.getFnW(t,e);return n?n.fn:void 0},pq.myObject=class extends String{constructor(t,e,n){super(t),this._value=t,this._address=e,this._grid=n}valueOf(){return this._value}toString(){return this._value}address(){return this._address}grid(){return this._grid}},t(document).on("pqGrid:bootup",function(t,e){var r,i=e.instance;i.options.formulasModel.on&&(r=i.iFormulas=new n(i)),i.Formulas=function(){return r}});var n=e.cFormulas=function(t){var e=this;e.that=t,e.fn={},e.tabNames={},t.options.skipSSFn||t.on("dataReadyDone",e.onDataReadyDone.bind(e)).on("colMove colAdd colRemove",e.onColumnAMR.bind(e)).on("beforeValidateDone",e.onBeforeValidateDone.bind(e)).on("autofillSeries",e.onAutofill.bind(e)).on("editorBegin",e.onEditorBegin.bind(e)).on("editorEnd",e.onEditorEnd.bind(e)).on("editorKeyUp editorClick",e.onEditorKeyUp.bind(e)).on(!0,"change",e.onChange.bind(e)).on("tabChange",e.onTabChange.bind(e)).on("tabRename",e.onTabRename.bind(e))};t.extend(n,{deString:function(t,e,n){var r=[];return t=e(t=t.replace(/(?:^|[^"]+)"(([^"]|"{2})+)"(?=([^"]+|$))/g,function(t,e){var n=t.indexOf('"'+e+'"');return r.push(e),t.slice(0,n)+"#"+(r.length-1)+"#"})),r.forEach(function(e,r){n&&(e=e.replace(/""/g,'\\"')),t=t.replace("#"+r+"#",'"'+e+'"')}),t},reSheet:"(?:(?:'(?:''|[^'])+'|[A-Za-z0-9_\\u0080-\\uFFFF]{1,31})!)?",selectExp:function(t,e){var n,r,i,o=t.slice(0,e).replace(/"[^"]*"/g,"");if(!/"[^"]+$/.test(o)&&(i=t.slice(e),(n=o.match(/.*?([a-z0-9:$]+)$/i))&&(""===i&&(r=[])||(r=i.match(/^([a-z0-9:$]+)?.*/i)))))return(n[1]+(r[1]??"")).replace(/\$/g,"").toUpperCase()},shiftRC:function(t){var e=n,r=t?t.get_p_data().length-1:0,i=t?t.colModel.length-1:0;return function(t,n,o){return n&&(t=e.shiftC(t,n,i)),o&&(t=e.shiftR(t,o,r)),t}},getTab:function(t){var e=t.slice(0,t.length-1).replace(/''/g,"'");return"'"==e[0]&&(e=e.slice(1,e.length-1)),e},shiftR:function(t,e,r,i){var o=n.reSheetC,a=new RegExp(o+"(\\$?)([A-Z]+)(\\$?)([\\d]+(?!!))","g"),l=new RegExp(o+"(\\$?)([0-9]+):(\\$?)([0-9]+)","g"),s=function(t){return i[n.getTab(t)].pdata.length-1};return n.deString(t,function(t){return t.replace(a,function(t,n,i,o,a,l){if(a)return t;var c=1*l+e-1;return r=n?s(n):r,(n||"")+i+o+((c=c<0?0:r&&c>r?r:c)+1)}).replace(l,function(t,n,i,o,a,l){var c;return r=n?s(n):r,i||(o=(c=(c=1*o+e-1)<0?0:r&&c>r?r:c)+1),a||(l=(c=(c=1*l+e-1)<0?0:r&&c>r?r:c)+1),(n||"")+i+o+":"+a+l})})},shiftC:function(t,e,r,i){var o=n.reSheetC,a=new RegExp(o+"(\\$?)([A-Z]+)(\\$?)([\\d]+)","g"),l=new RegExp(o+"(\\$?)([A-Z]+):(\\$?)([A-Z]+)","g"),s=function(t){return i[n.getTab(t)].colModel.length-1};return n.deString(t,function(t){return(t=t.replace(a,function(t,n,i,o,a,l){if(i)return t;var c=pq.toNumber(o)+e;return r=n?s(n):r,c=c<0?0:r&&c>r?r:c,(n||"")+pq.toLetter(c)+a+l})).replace(l,function(t,n,i,o,a,l){var c;return r=n?s(n):r,i||(c=(c=pq.toNumber(o)+e)<0?0:r&&c>r?r:c,o=pq.toLetter(c)),a||(c=(c=pq.toNumber(l)+e)<0?0:r&&c>r?r:c,l=pq.toLetter(c)),(n||"")+i+o+":"+a+l})})}}),n.reSheetC=n.reSheet.replace("?:",""),n.prototype={addRowIndx:function(t){t.forEach(function(t){var e,n,r=t.newRow,i=r.pq_fn;if(i)for(n in i)(e=i[n]).ri=e.riO=r.pq_ri})},cell:function(t){var e=this.toCell(t),n=e.r,r=e.c;return this.valueArr(n,r)[0]},check:function(t){return n.deString(t,function(t){return(t=t.replace(new RegExp("(s+)"+n.reSheet+"(s+)","g"),function(t){return t.replace(/\s/g,"")})).toUpperCase().replace(/([A-Z]+)([0-9]+)\:([A-Z]+)([0-9]+)/g,function(t,e,n,r,i){return(e=pq.toNumber(e))>(r=pq.toNumber(r))&&(e=[r,r=e][0]),1*n>1*i&&(n=[i,i=n][0]),pq.toLetter(e)+n+":"+pq.toLetter(r)+i})})},computeAll:function(){var t,e=this;if(e.initObj(),e.eachFormula(function(e){e.clean=0,t=!0}),t)return e.eachFormula(function(t,n,r,i,o){try{var a=e.execIfDirty(t)}catch(t){a=pq.isStr(t)?t:t.message}n[r]=a}),!0},eachFormula:function(t){var e=!0,n=this.that,r=n.columns,i=function(n,i,o){var a,l;for(a in o)r[a]&&"string"!=typeof(l=o[a])&&t(l,n,a,i,e)},o=function(t){for(var e,n,r=(t=t||[]).length;r--;)(e=t[r])&&(n=e.pq_fn)&&i(e,r,n)};o(n.get_p_data()),e=!1,o(n.options.summaryData)},execIfDirty:function(t,e){if(t.clean){if(.5==t.clean)return e}else t.clean=.5,t.val=this.exec(t.fn,t.ri,t.ci),t.clean=1;return t.val},replace:function(t,e,n,r){var i,o=e.lastIndexOf("!"),a=this,l=t===e,s=a.obj;if(o>0){var c,d,u=a.that.iTab,h=u.tabs(),f=e.substr(0,o).toUpperCase(),p=e.substr(o+1,e.length-1);"'"==f[0]&&(e=(f=(f=f.slice(1,f.length-1)).replace(/''/g,"'"))+"!"+p),(c=h.findIndex(function(t){return t.name.toUpperCase()==f}))>=0&&(d=h[c],a.tabNames[f]=instance=u.grid(d)||u.create(c),s[e]=s[e]||instance.iFormulas[n](p)),e=e.replace(/'/g,"\\'")}else s[e]=s[e]||a[n](e);if("range"==n)return"this['"+e+"']";i=t.charAt(0);var g="this['"+e+"']";return r&&(g="("+g+").valueOf()"),(l||"$"==i?"":i)+g},exec:function(t,e,r){var i=this,o=i.obj,a=i.replaceOutSheet,l=n.reSheet,s=n.deString(t,function(t){var e="(?:\\(|\\,|^|\\+)(("+l+"\\$?[A-Z]+\\$?[0-9]+\\+?){2,})(?:\\)|\\,|$|\\+)";return t=t.replace(new RegExp(e,"g"),function(t,e){var n="SUM("+a(e,"\\+","?").split("?").join(",")+")",r=t[0],i=t[t.length-1];return(r=r==e[0]?"":r)+n+(i=i==e[e.length-1]?"":i)}),t=a(t,"\\^","**"),t=a(t,"\\%","/100"),t=a(t,"{","["),t=a(t,"}","]"),t=a(t,"(<>|=)",function(t){return"="==t?"===":"!=="}),t=a(t,"&","+"),e="("+l+"\\$?([A-Z]+)?\\$?([0-9]+)?\\:\\$?([A-Z]+)?\\$?([0-9]+)?)",t=t.replace(new RegExp(e,"g"),function(t,e){return i.replace(t,e,"range")}),e="((===|!==|[^:A-Z'$]|^)("+l+"\\$?[A-Z]+\\$?[0-9]+))(?![:\\d]+)(?=(===|!==)?)",t=t.replace(new RegExp(e,"g"),function(t,e,n,r,o){if(r.indexOf(":")>0)return r;var a=t=>["===","!=="].includes(t);return a(n)?n+i.replace(r,r,"cell",!0):a(o)?i.replace(e,r,"cell",!0):i.replace(e,r,"cell")})},!0);o.getRange=function(){return{r1:e,c1:r}};try{var c=new Function("with(this){return "+s+"}").call(o);pq.isFn(c)&&(c="#NAME?"),c instanceof pq.myObject&&(c=c.valueOf()),c!=c&&(c=null)}catch(t){c=pq.isStr(t)?t:t.message}return c},replaceOutSheet:function(t,e,n){return t.replace(new RegExp("'(?:[^']|'')+'|("+e+")","g"),function(t,e){return t==e?"function"==typeof n?n.apply(this,Array.from(arguments).slice(1)):n:t})},initObj:function(){var t=this;t.obj=Object.assign({iFormula:t,locale:t.that.options.localeFmt},pq.formulas)},onAutofill:function(t,e){var r=e.sel,i=this,o=i.that,a=r.r,l=r.c,s=e.x,c=o.getRowData({rowIndx:a}),d=o.colModel,u=d.length-1,h=o.get_p_data().length-1,f=i.tabNames,p=d[l].dataIndx,g=i.getFnW(c,p);g&&(e.series=function(t){return"="+(s?n.shiftC(g.fn,t-1,u,f):n.shiftR(g.fn,t-1,h,f))})},onBeforeValidateDone:function(t,e){var n=this,r=this.that.colIndxs,i=function(t){t.forEach(function(t){var i,o,a,l=t.newRow,s=t.rowData;for(o in l)if(i=l[o],pq.isStr(i)&&"="===i[0]){e.allowInvalid=!0;var c=n.check(i),d=s?n.getFnW(s,o):null;d?c!==d.fn&&(t.oldRow[o]="="+d.fn,n.save(s,o,c,t.rowIndx,r[o])):n.save(s||l,o,c,t.rowIndx,r[o])}else s&&(a=n.remove(s,o))&&(t.oldRow[o]="="+a.fn)})};i(e.addList),i(e.updateList)},onTabChange:function(t,e){!this.tabNames[e.tab.name.toUpperCase()]||e.addList.length||e.deleteList.length||(this.computeAll(),this.that.refresh())},onTabRename:function(t,e){var n=this.tabNames,r=e.oldVal.toUpperCase(),i=e.tab.name.toUpperCase(),o=function(t){return t=t.replace(/'/g,"''"),/[\s~!@#'\.,$%^&(\)<>]+/.test(t)&&(t="'"+t+"'"),t+"!"};n[r]&&(delete n[r],n[i]=1,i=o(i),r=o(r),this.eachFormula(function(t){t.fn=t.fn.split(r).join(i)}))},onChange:function(t,e){this.addRowIndx(e.addList),e.addList.length||e.deleteList.length||this.computeAll(),((this.that.options.tabModel||{})._options||{}).initSSFn=!0},onColumnAMR:function(){var t,e,r=this,i=r.that,o=n.shiftRC(i),a=i.colIndxs;r.eachFormula(function(n,r,i){t=a[i],n.ci!=t&&(e=t-n.ciO,n.ci=t,n.fn=o(n.fnOrig,e,n.ri-n.riO))}),null!=t&&r.computeAll()},onEditorBegin:function(t,e){var n=this.getFnW(e.rowData,e.dataIndx);n&&e.$editor.val("="+n.fn)},onEditorEnd:function(){pq.intel.hide()},onEditorKeyUp:function(t,e){var n,r,i=e.$editor,o=i.val(),a=pq.intel;o&&0===o.indexOf("=")&&(n=i.is("textarea")?1:i.is("div[contenteditable")?2:0)&&(r=2==n?window.getSelection().getRangeAt(0).startOffset:ed.selectionEnd,a.popup(o,r,i),this.select(o,r))},onDataReadyDone:function(){var t,e=this,r=e.that,i=r.options,o=n.shiftRC(r),a=r.colIndxs,l=function(n,r,i){var l,s,c;for(s in i)l=i[s],t=!0,pq.isStr(l)?e.save(n,s,e.check(l),r,a[s]):l.ri!=r&&(c=r-l.riO,l.ri=r,l.fn=o(l.fnOrig,l.ci-l.ciO,c))},s=function(t){for(var e,n,r=(t=t||[]).length;r--;)(e=t[r])&&(n=e.pq_fn)&&l(e,r,n)};s(r.get_p_data()),s(i.summaryData),e.initObj(),i.initSSFn&&t&&e.computeAll()},getFnW:function(t,e){var n;if(n=t.pq_fn)return n[e]},remove:function(t,e){var n,r=t.pq_fn;if(r&&(n=r[e]))return delete r[e],pq.isEmpty(r)&&delete t.pq_fn,n},range:function(t){var e=t.split(":"),n=this.that,r=this.toCell(e[0]),i=r.r,o=r.c,a=this.toCell(e[1]),l=a.r,s=a.c;return this.valueArr(i??0,o??0,l??n.get_p_data().length-1,s??n.colModel.length-1)},save:function(t,e,n,r,i){var o=n.replace(/^=/,""),a={clean:0,fn:o,fnOrig:o,riO:r,ciO:i,ri:r,ci:i};return(t.pq_fn=t.pq_fn||{})[e]=a,a},selectRange:function(t,e){var r,i,o,a,l=n.selectExp(t,e);if(l)return/^([a-z0-9]+):([a-z0-9]+)$/i.test(l)?(r=l.split(":"),i=this.toCell(r[0]),o=this.toCell(r[1]),a={r1:i.r,c1:i.c,r2:o.r,c2:o.c}):/^[a-z]+[0-9]+$/i.test(l)&&(a={r1:(i=this.toCell(l)).r,c1:i.c}),a},select:function(t,e){var n=this.selectRange(t,e),r=this.that;n?r.Range(n).select():r.Selection().removeAll()},toCell:function(t){var e=t.match(/\$?([A-Z]+)?\$?(\d+)?/);return{c:e[1]?pq.toNumber(e[1]):null,r:e[2]?e[2]-1:null}},valueArr:function(t,e,n,r){var i,o,a,l,s,c,d=this.that,u=d.colModel,h=u.length,f=[],p=[],g=[],m=d.get_p_data(),v=m.length;for(n??=t,r??=e,e=e<0?0:e,n=n>=v?v-1:n,r=r>=h?h-1:r,i=t=t<0?0:t;i<=n;i++){for(a=m[i],o=e;o<=r;o++)l=u[o].dataIndx,(s=this.getFnW(a,l))?c=this.execIfDirty(s,a[l]):null==(c=a[l])&&(c=""),c=new pq.myObject(c,{ri:i,ci:o,di:l},d),f.push(c),g.push(c);p.push(g),g=[]}return f.get2Arr=function(){return p},f.getRange=function(){return{r1:t,c1:e,r2:n,c2:r}},f}}}(jQuery),function(t){pq.intel={removeFn:function(t){return t.length===(t=t.replace(/[a-z]*\([^()]*\)/gi,"")).length?t:this.removeFn(t)},removeStrings:function(t){return(t=t.replace(/"[^"]*"/g,"")).replace(/"[^"]*$/,"")},getMatch:function(t,e){var n,r=pq.formulas,i=[];for(n in t=t.toUpperCase(),r)if(e){if(n===t)return[n]}else 0===n.indexOf(t)&&i.push(n);return i},intel:function(t){t=this.removeStrings(t);var e,n,r;return(e=(t=this.removeFn(t)).match(/^=(.*[,+\-&*\s(><=])?([a-z]+)((\()[^)]*)?$/i))&&(n=e[2],e[4]&&(r=!0)),[n,r]},movepos:function(t){var e;return(e=t.match(/([^a-z].*)/i))?t.indexOf(e[1])+1:t.length},intel3:function(t,e){e<t.length&&/=(.*[,+\-&*\s(><=])?[a-z]+$/i.test(t.slice(0,e))&&(e+=this.movepos(t.slice(e)));var n=t.substr(0,e);return this.intel(n)},item:function(t){var e=this.that.options.strFormulas;return"<div>"+((e=e?e[t]:null)?e[0]:t)+"</div>"+(e?"<div style='font-size:0.9em;color:#888;margin-bottom:5px;'>"+e[1]+"</div>":"")},popup:function(e,n,r){var i,o,a=r.closest(".pq-grid"),l=t(".pq-intel"),s=a,c=this.intel3(e,n);this.that=a.pqGrid("instance"),l.remove(),(i=c[0])&&(o=this.getMatch(i,c[1]).map(this.item,this).join(""))&&t("<div class='pq-intel'></div>").appendTo(s).html(o).position({my:"center top",at:"center bottom",collision:"flipfit",of:r})},hide:function(){t(".pq-intel").remove()}}}(jQuery),function($){var f=pq.formulas={evalify:function(t){var e,n=(t+"").match(/([><=]{1,2})?(.*)/),r=n[1]||"=",i=n[2],o="<>"!==r;if(/(\*|\?)/.test(i))e=i.replace(/\*/g,".*").replace(/\?/g,"\\S").replace(/\(/g,"\\(").replace(/\)/g,"\\)"),e=new RegExp("^"+e+"$","i");else{if(r="="===r?"==":"<>"===r?"!=":r,this.ISNUMBER(i)){i=i.valueOf();return new Function("a",`return this.ISNUMBER(a)? a.valueOf() ${r} ${i}: false;`).bind(this)}i=i.toUpperCase()}return t=>{t??="";var n=e?e.test(t):(t+"").toUpperCase()==i;return n=o?n:!n}},get2Arr:function(t){return t.get2Arr?t.get2Arr():t},ISNUMBER:function(t){return parseFloat(t)==t},_reduce:function(t,e){var n=[],r=e.map(function(){return[]});return t.forEach(function(t,i){null!=t&&(t*=1,isNaN(t)||(n.push(t),r.forEach(function(t,n){t.push(e[n][i])})))}),[n,r]},reduce:function(t){var e=(t=this.toArray(t)).shift(),n=t.filter(function(t,e){return e%2==0}),r=this._reduce(e,n);return e=r[0],n=r[1],[e].concat(t.map(function(e,r){return r%2==0?n[r/2]:t[r]}))},strDate1:"(\\d{1,2})/(\\d{1,2})/(\\d{2,4})",strDate2:"(\\d{4})-(\\d{1,2})-(\\d{1,2})",strDate3:"(\\d{1,2})-(\\d{1,2})-(\\d{4})",strTime:"(\\d{1,2})(:(\\d{1,2}))?(:(\\d{1,2}))?(\\s(AM|PM))?",isDateTime:function(t){return(this.reDateTime.test(t)||this.reDate.test(t))&&!isNaN(Date.parse(t))||t&&t.constructor==Date},toArray:function(t){for(var e=[],n=0,r=t.length;n<r;n++)e.push(t[n]);return e},serialToDate:function(t){var e=new Date(Date.UTC(1900,0,1)),n=parseInt(t),r=t-n;return e.setUTCDate(e.getUTCDate()+n-2),r&&(r=Math.round(24*r*3600),e.setUTCSeconds(r)),e},varToDate:function(t){var e;if(this.ISNUMBER(t))e=this.serialToDate(t);else if(t.getTime)e=t;else if(pq.isStr(t)){t=$.trim(t);var n=pq.parseDate(t,void 0,"en-US",!0);e=new Date(Date.UTC(n[0],n[1]-1,n[2],n[3]||0,n[4]||0,n[5]||0))}return e},_IFS:function(t,e){for(var n=t.length,r=0,i=[],o=0;r<n;r+=2)i.push(this.evalify(t[r+1]));for(var a,l=t[0].length,s=n/2;l--;){for(a=0;a<s&&i[a](t[2*a][l]);a++);o+=a===s?e(l):0}return o},ABS:function(t){return Math.abs(t.map?t[0]:t)},ACOS:function(t){return Math.acos(t)},ADDRESS:function(t,e,n){return(2==n||4==n?"":"$")+pq.toLetter(e-1)+(3==n||4==n?"":"$")+t},AND:function(){var arr=this.toArray(arguments);return eval(arr.join(" && "))},ASIN:function(t){return Math.asin(t)},ATAN:function(t){return Math.atan(t)},_AVERAGE:function(t){var e=0,n=0;return t.forEach(function(t){parseFloat(t)==t&&(n+=1*t,e++)}),e?n/e:"#VALUE!"},AVERAGE:function(){return this._AVERAGE(pq.flatten(arguments))},AVERAGEIF:function(t,e,n){return this.AVERAGEIFS(n||t,t,e)},AVERAGEIFS:function(){var t=this.reduce(arguments),e=0,n=t.shift(),r=this._IFS(t,function(t){return e++,n[t]});return e?r/e:"#DIV/0!"},TRUE:!0,FALSE:!1,CEILING:function(t){return Math.ceil(t)},CHAR:function(t){return String.fromCharCode(t)},CHOOSE:function(){var t=pq.flatten(arguments),e=t[0];return e>0&&e<t.length?t[e]:"#VALUE!"},CODE:function(t){return(t+"").charCodeAt(0)},COLUMN:function(t){return(t||this).getRange().c1+1},COLUMNS:function(t){var e=t.getRange();return e.c2-e.c1+1},CONCAT:function(){return this.CONCATENATE.apply(this,arguments)},CONCATENATE:function(){var t=pq.flatten(arguments),e="";return t.forEach(function(t){e+=t}),e},COS:function(t){return Math.cos(t)},_COUNT:function(t){var e=pq.flatten(t),n=this,r=0,i=0,o=0;return e.forEach(function(t){null==t||""===t?r++:(i++,n.ISNUMBER(t)&&o++)}),[r,i,o]},COUNT:function(){return this._COUNT(arguments)[2]},COUNTA:function(){return this._COUNT(arguments)[1]},COUNTBLANK:function(){return this._COUNT(arguments)[0]},COUNTIF:function(t,e){return this.COUNTIFS(t,e)},COUNTIFS:function(){return this._IFS(arguments,function(){return 1})},DATE:function(t,e,n){return t<0||t>9999?"#NUM!":(t<=1899&&(t+=1900),this.VALUE(new Date(Date.UTC(t,e-1,n))))},DATEVALUE:function(t){if(pq.isStr(t)){var e=pq.parseDate(t,void 0,"en-US",!0);t=e[0]+"-"+e[1]+"-"+e[2]}return this.DATEDIF("1/1/1900",t,"D")+2},DATEDIF:function(t,e,n){var r,i=this.varToDate(e),o=this.varToDate(t),a=(i.getTime()-o.getTime())/864e5;return"Y"===n?parseInt(a/365):"M"===n?(r=i.getUTCMonth()-o.getUTCMonth()+12*(i.getUTCFullYear()-o.getUTCFullYear()),o.getUTCDate()>i.getUTCDate()&&r--,r):"D"===n?Math.round(a):"#NUM!."},DAY:function(t){return this.varToDate(t).getUTCDate()},DAYS:function(t,e){return this.DATEDIF(e,t,"D")},DEGREES:function(t){return 180/Math.PI*t},EOMONTH:function(t,e){e=e||0;var n=this.varToDate(t);return n.setUTCMonth(n.getUTCMonth()+e+1),n.setUTCDate(0),this.VALUE(n)},EXP:function(t){return Math.exp(t)},FIND:function(t,e,n){return e.indexOf(t,n?n-1:0)+1},FLOOR:function(t,e){return t*e<0?"#NUM!":parseInt(t/e)*e},FORMULATEXT(t){var e=t.grid(),{ri:n,di:r}=t.address(),i=((e.getRowData({rowIndx:n}).pq_fn||{})[r]||{}).fn;return i?"="+i:i},HLOOKUP:function(t,e,n,r){null==r&&(r=!0),e=this.get2Arr(e);var i=this.MATCH(t,e[0],r?1:0);return this.INDEX(e,n,i)},XLOOKUP:function(t,e,n,r=0,i=1){var o=this.MATCH(t,e,r);return this.INDEX(n,o)},HOUR:function(t){return Date.parse(t)?new Date(t).getHours():24*t},HYPERLINK:function(t,e){return e||t},IF:function(t,e,n){return t?e:n},IFERROR:function(t,e){return Math.abs(t)==1/0||isNaN(t)?e:t},INDEX:function(t,e,n){return t=this.get2Arr(t),e=e||1,n=n||1,pq.isFn(t[0].push)?t[e-1][n-1]:t[e>1?e-1:n-1]},INDIRECT:function(t){return this.iFormula[t.indexOf(":")>0?"range":"cell"](t)},ISBLANK:function(t){return""===(t?t.valueOf():t)},LARGE:function(t,e){return t.sort(),t[t.length-(e||1)]},LEFT:function(t,e){return t.substr(0,e||1)},LEN:function(t){return(t=(t.map?t:[t]).map(function(t){return t.length})).length>1?t:t[0]},LOOKUP:function(t,e,n){n=n||e;var r=this.MATCH(t,e,1);return this.INDEX(n,1,r)},LOWER:function(t){return(t+"").toLocaleLowerCase()},_MAXMIN:function(t,e){var n,r=this;return t.forEach(function(t){null!=t&&(t=r.VALUE(t),r.ISNUMBER(t)&&(t*e>n*e||null==n)&&(n=t))}),null!=n?n:0},MATCH:function(t,e,n){var r,i,o,a=this.ISNUMBER(t),l=0,s=e.length;if(null==n&&(n=1),t=a?t:t.toUpperCase(),0===n){var c=this.evalify(t);for(l=0;l<s;l++)if(c(e[l])){i=l+1;break}}else{for(l=0;l<s;l++)if(o=e[l],r=this.ISNUMBER(o),t==(o=e[l]=r?o:o?o.toUpperCase():"")){i=l+1;break}if(!i){for(l=0;l<s;l++)if(o=e[l],r=this.ISNUMBER(o),n*(o<t?-1:1)==1&&a==r){i=l;break}i=null==i?l:i}}return i||"#N/A"},MAX:function(){var t=pq.flatten(arguments);return this._MAXMIN(t,1)},MEDIAN:function(){var t=pq.flatten(arguments).filter(function(t){return 1*t==t}).sort(function(t,e){return e-t}),e=t.length,n=e/2;return n===parseInt(n)?(t[n-1]+t[n])/2:t[(e-1)/2]},MID:function(t,e,n){return e<1||n<0?"#VALUE!":t.substr(e-1,n)},MIN:function(){var t=pq.flatten(arguments);return this._MAXMIN(t,-1)},MODE:function(){var t,e,n=pq.flatten(arguments),r={},i=0;return n.forEach(function(n){t=r[n]=r[n]?r[n]+1:1,i<t&&(i=t,e=n)}),i<2?"#N/A":e},MONTH:function(t){return this.varToDate(t).getUTCMonth()+1},OR:function(){var arr=this.toArray(arguments);return eval(arr.join(" || "))},PI:function(){return Math.PI},POWER:function(t,e){return Math.pow(t,e)},PRODUCT:function(){var t=pq.flatten(arguments),e=1;return t.forEach(function(t){e*=t}),e},PROPER:function(t){return t=t.replace(/(\S+)/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},QUARTILE:function(t,e){var n=t.slice().sort((t,e)=>t-e),r=n.length;if(0==e)return n[0];if(4==e)return n[r-1];var i=1==e?(r+3)/4:3==e?(3*r+1)/4:(r+1)*(25*e)/100,o=Math.floor(i),a=i-o;return n[o-1]+a*(n[o]-n[o-1])},RADIANS:function(t){return Math.PI/180*t},RAND:function(){return Math.random()},RANK:function(t,e,n){for(var r=JSON.stringify(e.getRange()),i=this,o=r+"_range",a=0,l=(e=this[o]||(i[o]=e,e.sort(function(t,e){return t-e}))).length;a<l;a++)if(t===e[a])return n?a+1:l-a},RATE:function(){},REPLACE:function(t,e,n,r){return(t+="").substr(0,e-1)+r+t.substr(e+n-1)},REPT:function(t,e){for(var n="";e--;)n+=t;return n},RIGHT:function(t,e){return e=e||1,t.substr(-1*e,e)},_ROUND:function(t,e,n){var r=Math.pow(10,e),i=t*r,o=parseInt(i),a=i-o;return isNaN(o)||isNaN(a)?"#VALUE!":n(o,a)/r},ROUND:function(t,e){return this._ROUND(t,e,function(t,e){var n=Math.abs(e);return t+(n>=.5?n/e:0)})},ROUNDDOWN:function(t,e){return this._ROUND(t,e,function(t){return t})},ROUNDUP:function(t,e){return this._ROUND(t,e,function(t,e){return t+(e?Math.abs(e)/e:0)})},ROW:function(t){return(t||this).getRange().r1+1},ROWS:function(t){var e=t.getRange();return e.r2-e.r1+1},SEARCH:function(t,e,n){return t=t.toUpperCase(),(e=e.toUpperCase()).indexOf(t,n?n-1:0)+1},SIN:function(t){return Math.sin(t)},SMALL:function(t,e){return t.sort(),t[(e||1)-1]},SQRT:function(t){return Math.sqrt(t)},_STDEV:function(t){var e=(t=pq.flatten(t)).length,n=this._AVERAGE(t),r=0;return t.forEach(function(t){r+=(t-n)*(t-n)}),[r,e]},STDEV:function(){var t=this._STDEV(arguments);return 1===t[1]?"#DIV/0!":Math.sqrt(t[0]/(t[1]-1))},STDEVP:function(){var t=this._STDEV(arguments);return Math.sqrt(t[0]/t[1])},SUBSTITUTE:function(t,e,n,r){var i=0;return t.replace(new RegExp(e,"g"),function(){return i++,r?i===r?n:e:n})},SUM:function(){var t=pq.flatten(arguments),e=0,n=this;return t.forEach(function(t){t=n.VALUE(t),n.ISNUMBER(t)&&(e+=parseFloat(t))}),e},SUMIF:function(t,e,n){return this.SUMIFS(n||t,t,e)},SUMIFS:function(){var t=this.reduce(arguments),e=t.shift();return this._IFS(t,function(t){return e[t]})},SUMPRODUCT:function(){var t=this.toArray(arguments);return t=t[0].map(function(e,n){var r=1;return t.forEach(function(t){var e=t[n];r*=parseFloat(e)==e?e:0}),r}),pq.aggregate.sum(t)},TAN:function(t){return Math.tan(t)},TEXT:function(t,e){return pq.formatNumber(t,e,this.locale)},TIME:function(t,e,n){return(t+e/60+n/3600)/24},TIMEVALUE:function(t){if(t.getTime)return(t.getUTCHours()+t.getUTCMinutes()/60+t.getUTCSeconds()/3600)/24;var e=t.match(this.reTime);if(null==e&&this.reDate.test(t))return 0;if(e&&null!=e[1]&&(null!=e[3]||null!=e[7]))var n=1*e[1],r=1*(e[3]||0),i=1*(e[5]||0),o=(e[7]||"").toUpperCase(),a=n+r/60+i/3600;return 0<=a&&(o&&a<13||!o&&a<24)?("PM"==o&&n<12?a+=12:"AM"==o&&12==n&&(a-=12),a/24):"#VALUE!"},TODAY:function(){var t=new Date;return this.VALUE(new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())))},TRIM:function(t){return t.replace(/^\s+|\s+$/gm,"")},TRUNC:function(t,e){return~~(t*(e=Math.pow(10,e||0)))/e},UNIQUE:function(t){return pq.arrayUnique(t)},UPPER:function(t){return(t+"").toLocaleUpperCase()},VALUE:function(t){return t?parseFloat(t)==t?parseFloat(t):this.isDateTime(t)?this.DATEVALUE(t)+1*this.TIMEVALUE(t):t.match(this.reTime)?this.TIMEVALUE(t):t.replace(/[^0-9\-.]/g,"").replace(/(\.[1-9]*)0+$/,"$1").replace(/\.$/,""):0},VAR:function(){var t=this._STDEV(arguments);return t[0]/(t[1]-1)},VARP:function(){var t=this._STDEV(arguments);return t[0]/t[1]},VLOOKUP:function(t,e,n,r){null==r&&(r=!0);var i=(e=this.get2Arr(e)).map(function(t){return t[0]}),o=this.MATCH(t,i,r?1:0);return this.INDEX(e,o,n)},YEAR:function(t){return this.varToDate(t).getUTCFullYear()}};f.reDate1=new RegExp("^"+f.strDate1+"$"),f.reDate2=new RegExp("^"+f.strDate2+"$"),f.reDate3=new RegExp("^"+f.strDate3+"$"),f.reDate=new RegExp("^"+f.strDate1+"$|^"+f.strDate2+"$|^"+f.strDate3+"$"),f.reTime=new RegExp("(?:^|\\s|T)"+f.strTime+"$","i"),f.reDateTime=new RegExp("^("+f.strDate1+")\\s"+f.strTime+"$|^("+f.strDate2+")(?:\\s|T)"+f.strTime+"$|^("+f.strDate3+")\\s"+f.strTime+"$")}(jQuery),function(t){pq.Select=function(e,n,r){var i=document.body,o=t("<div/>").appendTo(i);return pq.grid(o,t.extend({width:"flex",height:"flex",autoRow:!1,rowBorders:!1,columnBorders:!1,editable:!1,numberCell:{show:!1},hoverMode:"row",fillHandle:"",stripeRows:!1,showTop:!1,showHeader:!1},e)),pq.makePopup(o[0],n[0],{onPopupRemove:r}),pq.position(o,{my:"left top",at:"left bottom",of:n}),o}}(jQuery),function(t){var e=function(t){this.options=t.options};e.prototype={empty:function(){for(var t in this)0==t.indexOf("_")&&delete this[t];delete this.options.dataModel.dataPrimary},getCM:function(){return this._cm},setCM:function(t){this._cm=t},getCols:function(){return this._columns},setCols:function(t){this._columns=t},getDMData:function(){return this.options.dataModel.dataPrimary},setDMData:function(t){this.options.dataModel.dataPrimary=t},getOCM:function(){return this._ocm},setOCM:function(t){this._ocm=t}},t(document).on("pqGrid:bootup",function(t,n){var r=n.instance,i=r.Group();i.primary=new e(r),r.on("beforeFilterDone",i.onBeforeFilterDone.bind(i)).one("CMInit",i.oneCMInit.bind(i))});var n={},r={clearPivot:function(t){if(this.isPivot()){var e=this.that,n=e.options.dataModel,r=this.primary,i=r.getOCM(),o=r.getDMData();if(i&&e.refreshCM(i),t){if(!o)throw"!primary.getDMData";n.data=o}else o&&(n.data=o);return this.primary.empty(),this.setPivot(!1),!0}},getColsPrimary:function(){return this.primary.getCols()||this.that.columns},getCMPrimary:function(){return this.primary.getCM()||this.that.colModel},getOCMPrimary:function(){return this.primary.getOCM()||this.that.options.colModel},getSumCols:function(){var t=")"+(this.that.options.rtl?"&lrm;":"");return(n.getSumCols.call(this)||[]).map(function(e){return[e.dataIndx,e.dataType,e.summary,e.summary.type+"("+e.title+t,e.width,e.format,e.showifOpen]})},getVal:function(){return this._pivot?function(t,e){return t[e]}:n.getVal.apply(this,arguments)},groupData:function(){var t,e,r,i,o,a=this,l=a.that,s=l.options.groupModel,c=s.dataIndx,d=s.groupCols,u=a.primary,h=d.length;if(!(o=u.getDMData())||o[0]==l.pdata[0]){if(s.pivot&&(t=c.slice(),s.dataIndx=c=c.concat(d),e=s.titleInFirstCol,r=s.titleIndx,i=s.merge,s.titleInFirstCol=!1,s.titleIndx=null,s.merge=!1),n.groupData.call(a),s.pivot){if(l.pdata=l.pdata.reduce(function(t,e){return e.pq_gtitle&&t.push(e),t},[]),r?(s.titleInFirstCol=e,s.titleIndx=r):t.length>1&&(s.merge=i),a.pivotData(c,t),s.dataIndx=t.slice(0,t.length-1),s.summaryInTitleRow="all",h){var f=r,p=t[t.length-1];n.groupData.call(a,!0),r&&f!=p&&l.pdata.forEach(function(t){t.pq_gtitle||(t[f]=t[p])})}else r&&l.pdata.forEach(function(t){t[r]=t[[c[t.pq_level]]]});s.dataIndx=t,a.setPivot(!0)}l._trigger("groupData")}},isPivot:function(){return this._pivot},getSorter:function(t){var e=t.pivotSortFn;return e||(e="number"==pq.getDataType(t)?function(t,e){return 1*t.sortby>1*e.sortby?1:-1}:function(t,e){return t.sortby>e.sortby?1:-1}),e},nestedCM:function(e,n){var r=this,i=n.groupCols,o=n.pivotColsTotal,a="hideifOpen"!=o&&null,l=[],s=[],c=r.that,d=c.columns;return d=i.map(function(t){var e=d[t];return l.push(r.getSorter(e)),s.push(pq.getDataType(e)),e}),function n(r,i,u){i=i||0,u=u||[];var h,f,p,g,m,v,w,x,y=0,b=[];if(t.isEmptyObject(r))for(;y<e.length;y++)h=e[y],(f=u.slice()).push(h[0]),p={dataIndx:f.join("_"),dataType:h[1],summary:h[2],title:h[3],width:h[4],format:h[5],showifOpen:h[6]},b.push(p);else{for(m in h=d[i],g=s[i],r)w="aggr"===m,(f=u.slice()).push(m),v=n(r[m],i+1,f),w?(x=v).forEach(function(t){t.showifOpen=a,t.type="aggr"}):(p={showifOpen:!0,sortby:m,title:c.formatCol(h,m,g),colModel:v},v.length>1&&!v.find(function(t){return!t.type}).dataIndx&&(p.collapsible={on:!0,last:null}),b.push(p));b.sort(l[i]),x&&b["before"==o?"unshift":"push"].apply(b,x)}return b}},onBeforeFilterDone:function(t,e){if(this.isPivot()){for(var n=e.rules,r=this.primary.getCols(),i=0;i<n.length;i++)if(!r[n[i].dataIndx])return!1;this.clearPivot(!0),e.header=!0}},oneCMInit:function(){this.updateAgg(this.that.options.groupModel.agg)},option:function(t,e,r,i){this.clearPivot(),n.option.call(this,t,e,r,i)},pivotData:function(e,n){var r,i=this.that,o=this.getSumCols(),a=this.getSumDIs(),l=i.options,s=l.groupModel,c=this.primary,d=i.pdata,u=i.columns,h=s.titleIndx;r=h?[u[h]].concat(n.reduce(function(e,n){return n!=h&&e.push(t.extend({hidden:!0},u[n])),e},[])):n.map(function(t){return u[t]});var f=this.transformData(d,a,e,n),p=this.nestedCM(o,s)(f),g={};g.CM=r=r.concat(p),i._trigger("pivotCM",null,g),c.setOCM(l.colModel),c.setCM(i.colModel),c.setCols(i.columns),i.refreshCM(g.CM,{pivot:!0})},setPivot:function(t){this._pivot=t},transformData:function(t,e,n,r){var i,o,a,l,s=this,c=[],d=this.that,u=this.primary,h={},f=[],p=d.options,g=p.dataModel,m=p.groupModel,v=m.pivotColsTotal,w=r.length,x={},y=n.length;return w==y?(t.forEach(function(t){t.pq_level==w-1&&(delete t.children,delete t.pq_gtitle)}),s.updateItems(t),c=t):t.forEach(function(t){var d,u,p=t.pq_level,g=p-w,m=x,b=n[p],C=t[b];if(g>=0)for(f[g]=C,d=0;d<g+1;d++)m=m[u=f[d]]=m[u]||{};p===y-1?(a||={},e.forEach(function(e){(l=f.slice()).push(e),a[l.join("_")]=t[e]})):((!a||o>p&&p<w)&&(a={pq_gid:s.idCount++},i=!0),p<w&&(h[b]=a[b]=C),v&&p<=y-2&&p>=w-1&&e.forEach(function(e){(l=f.slice(0,g+1)).push("aggr"),l.push(e),a[l.join("_")]=t[e]})),o=p,i&&(c.push(a),r.forEach(function(t){void 0===a[t]&&(a[t]=h[t])}),i=!1)}),u.setDMData(g.data),g.data=d.pdata=c,v&&this.addAggrInCM(x,m.pivotTotalForSingle),x},addAggrInCM:function(t,e){var n,r=0;for(n in t)r++,this.addAggrInCM(t[n],e);r>(e?0:1)&&(t.aggr={})},updateAgg:function(t,e){var n,r=this.that.columns;if(e)for(n in e)r[n].summary=null;if(t)for(n in t)r[n].summary={type:t[n]}}},i=t.paramquery.cGroup.prototype;for(var o in r)n[o]=i[o],i[o]=r[o]}(jQuery),function(t){var e,n=t.paramquery;n.pqGrid.defaults.toolPanel={},n.pqGrid.prototype.ToolPanel=function(){return this.iToolPanel},t(document).on("pqGrid:bootup",function(t,e){var r=e.instance;r.iToolPanel=new n.cToolPanel(r)}),n.cToolPanel=function(t){var e=this;e.that=t,e.panes=[],e.clsSort="pq-sortable",t.one("render",e.init.bind(e))},n.cToolPanel.prototype={getArray:function(t){return t.find(".pq-pivot-col").get().map(function(t){return t.dataset.di})},getInit:function(){return this._inited},getObj:function(t){var e={},n=this.that;return t.find(".pq-pivot-col").each(function(t,r){var i=r.dataset.di,o=n.getColumn({dataIndx:i}),a=r.getAttribute("type")||o.summaryDefault||n.iGroup.getAggOptions(o.dataType)[0];o.summaryDefault=e[i]=a}),e},getSortCancel:function(){return this._sortCancel},_hide:function(t){this.$ele[t?"hide":"show"](),this.init(),this.that.refresh({soft:!0})},hide:function(){this._hide(!0)},disablePivotChkBox:function(t){this.$pivotChk.prop("disabled",t)},init:function(){var t=this,e=t.that,n=t.$ele=e.$toolPanel;if(t.isVisible()&&!t.getInit()){var r=e.options,i=r.toolPanel,o=r.groupModel,a=" pq-pivot-label pq-bg-3 ",l=" pq-pivot-pane pq-border-1 ",s=t.isHideColPane(),c=i.hidePivotChkBox,d=i.disablePivotChkBox,u=o.pivot?"checked":"",h=o.on?"checked":"",f=t.clsSort;n.html(["<div class='pq-pivot-cols-all",l,"'>","<div class='",f,"' style='",c?"padding-top:0;":"","'></div>",c?"":["<div class='",a,"'>","<label><input type='checkbox' ",d?"disabled":""," class='pq-pivot-checkbox' ",u,"/>",r.strTP_pivot,"</label>","</div>"].join(""),"</div>","<div class='pq-pivot-rows",l,"' style='display:",i.hideRowPane?"none":"",";'>","<div deny='denyGroup' class='",f,"'></div>","<div class='",a,"'>",i.hideGroupChkBox?"<span class='pq-icon-pivot-rows'></span>"+r.strTP_rowPane:"<label><input type='checkbox' class='pq-group-checkbox' "+h+"/>"+r.strTP_rowPane+"</label>","</div>","</div>","<div class='pq-pivot-cols",l,"' style='display:",s?"none":"",";'>","<div deny='denyPivot' class='",f,"'></div>","<div class='",a,"'><span class='pq-icon-pivot-cols'></span>",r.strTP_colPane,"</div>","</div>","<div class='pq-pivot-vals",l,"' style='display:",i.hideAggPane?"none":"",";'>","<div deny='denyAgg' class='",f,"'></div>","<div class='",a,"'><span class='pq-icon-pivot-vals'></span>",r.strTP_aggPane,"</div>","</div>"].join("")),t.$pivotChk=n.find(".pq-pivot-checkbox").on("click",t.onPivotChange(t,e)),t.$groupChk=n.find(".pq-group-checkbox").on("click",t.onGroupChange(t,e)),t.$colsAll=n.find(".pq-pivot-cols-all>."+f),t.$colsPane=n.find(".pq-pivot-cols"),t.$cols=n.find(".pq-pivot-cols>."+f),t.$rows=n.find(".pq-pivot-rows>."+f),t.$aggs=n.find(".pq-pivot-vals>."+f).on("click contextmenu",t.onClick.bind(t)),e.on("refreshFull",t.setHt.bind(t)).on("groupOption",t.onGroupOption.bind(t)),setTimeout(function(){e.element&&(e.on("CMInit",t.onCMInit.bind(t)),t.render())}),t.setInit()}},isHideColPane:function(){var t=this.that.options;return t.toolPanel.hideColPane||!t.groupModel.pivot},isDeny:function(t,e,n){var r=e.attr("deny");return this.that.iGroup.getColsPrimary()[n[0].dataset.di][r]},isVisible:function(){return this.$ele.is(":visible")},onCMInit:function(t,e){e.pivot||e.flex||e.group||this.that.Group().isPivot()||this.refresh()},onClick:function(e){var n=t(e.target),r=this,i=r.that;if(!r.$popup&&n.hasClass("pq-pivot-col")){var o=n[0].dataset.di,a=i.iGroup.getColsPrimary()[o],l={dataModel:{data:i.iGroup.getAggOptions(a.dataType).sort().map(function(t){return[t]})},colModel:[{title:a.title,width:100},{width:28,title:"",minWidth:28,render:function(t){return t.rowData[0]==(a.summary||{}).type?"<span class='ui-icon ui-icon-check'></span>":""}}],showHeader:!0,destroy:function(){r.$popup=null},cellClick:function(t,e){var i=e.rowData[0];n.attr("type",i),setTimeout(function(){r.$popup.remove(),r.refreshGrid(),r.refresh()})}};return r.$popup=pq.Select(l,n),!1}},onGroupOption:function(t,e){if("tp"!=e.source){var n=e.oldGM,r=this.that.options.groupModel;r.groupCols==n.groupCols&&r.agg==n.agg&&r.dataIndx==n.dataIndx&&r.pivot==n.pivot||this.refresh()}},onPivotChange:function(t,e){return function(){e.Group().option({pivot:!!this.checked},null,"tp"),t.showHideColPane()}},onGroupChange:function(t,e){return function(){e.Group().option({on:!!this.checked},null,"tp")}},ph:function(t){return"<span style='color:#999;margin:1px;display:inline-block;'>"+t+"</span>"},refreshGrid:function(){var t=this,e=t.that,n=t.getArray(t.$cols),r=t.getObj(t.$aggs),i=t.getArray(t.$rows);e.Group().option({groupCols:n,dataIndx:i,agg:r},null,"tp"),setTimeout(function(){t.refresh()})},onReceive:function(t,e){if(this.getSortCancel())return this.setSortCancel(!1);this.refreshGrid()},onOver:function(e){return function(n,r){var i=t(this),o=r.item,a=o.parent(),l="addClass",s="removeClass",c=a[0]!=i[0]&&e.isDeny(a,i,o);r.helper.find(".ui-icon")[c?l:s]("ui-icon-closethick")[c?s:l]("ui-icon-check")}},onStop:function(e){return function(n,r){var i=t(this),o=r.item,a=o.parent();i[0]!=a[0]&&e.isDeny(i,a,o)&&(i.sortable("cancel"),e.setSortCancel(!0))}},onTimer:function(t,n){clearTimeout(e);var r=this;e=setTimeout(function(){r.onReceive(t,n)})},refresh:function(){var e=this;e.that.element.is(":visible")?(e.setHtml(),t(e.panes).sortable("refresh")):e.pendingRefresh=!0},render:function(){var e,n=this,r="."+n.clsSort,i=n.that;i.element&&(n.panes=[n.$colsAll,n.$cols,n.$rows,n.$aggs],n.setHtml(),t(n.panes).sortable({appendTo:n.$ele,connectWith:r,distance:5,containment:n.$ele,cursor:"move",items:"> .pq-pivot-col:not('.pq-deny-drag')",helper:function(t,e){return e.clone(!0).css({opacity:"0.8"}).prepend("<span class='ui-icon-check ui-icon'></span>")},start:function(){e=i.getScale()},sort:function(t,n){n.helper.css({left:n.position.left/e[0],top:n.position.top/e[1]})},receive:n.onTimer.bind(n),stop:n.onStop(n),over:n.onOver(n),update:n.onTimer.bind(n),tolerance:"pointer"}),i._trigger("tpRender"))},setHtml:function(){var t,e,n=this,r=n.that,i=[],o=[],a=[],l=[],s=n.template,c=n.templateVals,d={},u=r.options,h=r.iGroup,f=h.getColsPrimary(),p=h.getCMPrimary(),g=u.groupModel,m=g.dataIndx,v=g.groupCols,w=0,x=p.length,y=n.$groupChk[0],b=n.$pivotChk[0];for(m.concat(v).forEach(function(t){d[t]=1}),y&&(y.checked=g.on),b&&(b.checked=g.pivot),n.showHideColPane();w<x;w++)e=(t=p[w]).dataIndx,t.tpHide||d[e]||(t.summary&&t.summary.type?l.push(c(e,t)):i.push(s(e,t)));m.forEach(function(t){a.push(s(t,f[t]))}),v.forEach(function(t){o.push(s(t,f[t]))}),n.$colsAll.html(i.join("")),n.$rows.html(a.join("")||n.ph(u.strTP_rowPH)),n.$cols.html(o.join("")||n.ph(u.strTP_colPH)),n.$aggs.html(l.join("")||n.ph(u.strTP_aggPH))},setAttrPanes:function(){this.$ele.attr("panes",this.panes.filter(function(t){return t.is(":visible")}).length)},setHt:function(){var t=this;t.$ele.height(this.$ele.parent()[0].offsetHeight),t.pendingRefresh&&(t.pendingRefresh=!1,t.refresh())},setSortCancel:function(t){this._sortCancel=t},setInit:function(){this._inited=!0},show:function(){this._hide(!1)},showHideColPane:function(){var t=this;t.$colsPane.css("display",t.isHideColPane()?"none":""),t.setAttrPanes()},template:function(t,e){return[`<div data-di="${t}" class="pq-pivot-col pq-border-2 ${e.tpCls||""}" >`,e.title,"</div>"].join("")},templateVals:function(t,e){var n=e.summary.type;return[`<div data-di="${t}" type="${n}" class="pq-pivot-col pq-border-2 ${e.tpCls||""}">`,n,"(",e.title,")</div>"].join("")},toggle:function(){this._hide(this.isVisible())}}}(jQuery),function(t){pq.mixin.HeadTP={getCM:function(){var t=this.that.options.strSelectAll||"Select All",e=null,n=this.nested;return[{editor:!1,dataIndx:"title",title:t,filter:{crules:[{condition:"contain"}]},type:n?e:"checkbox",cbId:n?e:"visible"},{hidden:!0,dataIndx:"visible",dataType:"bool",editable:function(t){return!t.rowData.pq_disable},cb:n?e:{header:!0}}]},isToolPanel:function(){},getData:function(){var t=1,e=this,n="export"==e.tab,r=n?"skipExport":"hidden",i=e.that,o=e.isToolPanel()?i.getOCMPrimary():null,a=i.iRenderHead;return i.Columns().reduce(function(i){var o=this.getColIndx({column:i}),l=!i[r],s=i.childCount;if(!i.menuInHide&&(!i.collapsible||n))return s&&(e.nested=!0),{visible:s?void 0:l,get title(){return s?i.title:a.getTitle(i,o)||i.dataIndx},column:i,id:t++,pq_disable:i.menuInDisable,pq_close:i.menuInClose,colModel:s?i.colModel:void 0}},o)},getGridObj:function(e){var n=this,r=n.that;return t.extend({sideBar:"",dataModel:{data:n.getData()},rtl:r.options.rtl,colModel:n.getCM(),check:n.onChange.bind(n),treeExpand:n.onTreeExpand.bind(n),treeModel:n.nested?{dataIndx:"title",childstr:"colModel",checkbox:!0,checkboxHead:!0,cbId:"visible",cascade:!0}:void 0},r.options.menuUI.gridOptions,e)},onChange:function(t,e){if(!e.init){var n=[],r=[],i=this.that,o="export"==this.tab,a=[];(e.getCascadeList?e.getCascadeList():e.rows).forEach(function(t){var e=t.rowData,i=e.visible,l=e.column,s=l.dataIndx;(l.colModel||[]).length||(o?(r.push(s),l.skipExport=!i):i?n.push(s):a.push(s))}),o?(i.refreshCM(),i._trigger("skipExport",null,{di:r})):i.Columns().hide({diShow:n,diHide:a})}},onTreeExpand:function(t,e){e.nodes.forEach(function(t){t.column.menuInClose=e.close})}}}(jQuery),function(t){t.paramquery;function e(t){var e=this;e.that=t,e.rtl=t.options.rtl,t.on("headerCellClick",e.onHeadCellClick.bind(e)).on("destroy",e.onDestroy.bind(e))}t(document).on("pqGrid:bootup",function(t,n){var r=n.instance;r.iHeaderMenu=new e(r),r.HeaderMenu=function(){return r.iHeaderMenu}}),e.prototype=t.extend({},pq.mixin.HeadTP,{close:function(){this.$popup.remove()},popup:function(){return this.$popup},openFilterTab:function(){var t=this.menuH.tabs.findIndex(function(t){return"filter"==t});return this.$tabs.tabs("option","active",t),this.filterMenu},FilterMenu:function(){return this.filterMenu},onDestroy:function(){var t=this.$popup;t&&t.remove(),delete this.$popup},onHeadCellClick:function(e,n){var r=t(e.originalEvent.target);return r.hasClass("pq-icon-filter")?this.onFilterClick(e,n,r):r.hasClass("pq-icon-menu")||-1==n.colIndx?this.onMenuClick(e,n,r):void 0},getMenuHtml:function(t){var e=this.that.options.strMenu,n={hideCols:"visible",filter:"filter",export:"download"},r=t.map(function(t){return['<li title="',e[t],'"><a href="#tabs-',t,'"><span class="pq-icon-tab-',n[t],'">&nbsp;</span></a></li>'].join("")}).join(""),i=t.map(function(t){return'<div id="tabs-'+t+'"></div>'}).join("");return["<div class='pq-head-menu pq-theme' dir='",this.rtl?"rtl":"ltr","'>","<div class='pq-tabs' style='border-width:0;'>","<ul>",r,"</ul>",i,"</div>","</div>"].join("")},getMenuH:function(e,n){return t.extend({},e.menuUI,(n||e.numberCell).menuUI)},activate:function(e,n){var r=this,i=r.tabs,o=r.tab=i[e],a=t("#tabs-"+o);if(0==a.children().length)if("hideCols"==o||"export"==o){var l=r.$grid=t("<div/>").appendTo(a);pq.grid(l,r.getGridObj())}else"filter"==o&&r.appendFilter(a,n);else a.find(".pq-grid").pqGrid("refresh")},open:function(e,n,r){var i=this,o=i.that,a=o.options,l=o.columns[e],s=i.menuH=i.getMenuH(a,l),c=i.tabs=s.tabs;if(n=n||o.getCellHeader({dataIndx:e}),c&&c.length){var d=i.$popup=t(i.getMenuHtml(c)).appendTo(document.body),u=c.length,h=localStorage["pq-menu-tab"]||1,f=i.$tabs=d.find(".pq-tabs");return h>u-1&&(h=u-1),pq.makePopup(d[0],r[0],{onPopupRemove:function(){i.$popup=null,o.focusHead({ri:o.headerCells.length-1,colIndx:o.colModel.indexOf(l)})},keepPopupWithoutEle:!0,closeOnEle:!0}),pq.position(d,{my:"left top",at:"left bottom",of:r||n}),i.activate(h,l),f.tabs({active:h,activate:function(e,n){h=t(this).tabs("option","active"),localStorage["pq-menu-tab"]=h,i.activate(h,l)}}),d.resizable({handles:"e,w",maxWidth:600,minWidth:220}),pq.focusEle(null,d),this}},onMenuClick:function(t,e,n){return this.open(e.dataIndx,t,n),!1},appendFilter:function(e,n,r,i){var o,a=this,l=a.that,s=t("<div class='pq-filter-menu pq-theme'/>").appendTo(e),c=a.$popup||s,d=a.filterMenu=new pq.cFilterMenu(i);a.filterPanel=i;var u={filterRow:r,grid:l,column:n,$popup:c,menuH:this.menuH||this.getMenuH(l.options,n)};return d.init(u),o=d.getHtml(),s.html(o),d.ready(s.children().get()),d.addEvents(),s},onFilterClick:function(e,n,r){var i=n.column,o=this,a=o.that,l=o.$popup=this.appendFilter(t(document.body),i,!0);return pq.makePopup(l[0],r[0],{onPopupRemove:function(){o.$popup=null,a.focusHead({ri:a.headerCells.length,colIndx:a.colModel.indexOf(i)})},keepPopupWithoutEle:!0,closeOnEle:!0}),pq.position(l,{my:"left top",at:"left bottom",of:r}),pq.focusEle(null,l),!1}})}(jQuery),function(t){var e=pq.cFilterMenu=function(t){this.filterPanel=t};e.select=function(t,e,n){var r=this;r.that=t,r.filterPanel=n,r.di1="selected",r.grid=null,r.column=e},e.select.prototype={change:function(t){this.onChange(t).call(this.grid)},create:function(e,n,r){var i=this,o=i.that,a=i.getGridObj(n,r),l=function(t){var e=n[t];e&&e.call(o,s),o._trigger(t,null,s)},s=t.extend({obj:a,column:i.column},n);return l("selectGridObj"),a.rtl=o.options.rtl,e.hasClass("pq-grid")&&e.pqGrid("destroy"),s.grid=i.grid=pq.grid(e,a),l("selectGridCreated"),i.grid},getCM:function(e,n,r,i,o,a){var l=e.dataIndx,s=t.extend({filter:{crules:[{condition:"contain"}]},align:"left",format:a.format||e.format,deFormat:e.deFormat,title:e.pq_title||e.title,dataType:e.dataType,dataIndx:l,editor:!1,useLabel:!0,renderLabel:this.getRenderLbl(i,l,this.that.options.strBlanks)},r?{}:{type:"checkbox",cbId:n});return r?[s,{dataIndx:n,dataType:"bool",hidden:!0},{dataIndx:r,hidden:!0}]:[s,{dataIndx:n,dataType:"bool",hidden:!0,cb:{header:!o,maxCheck:o}}]},getData:function(e,n){var r=this.column,i=this.that,o={},a=this.di1,l=r.dataIndx,s=e.maxCheck,c=pq.filter.getVal(n)[0],d=pq.filter.getOptions(r,e,i,!0);return t.isArray(c)?s&&(c=c.slice(0,s)):c=1==s?[c]:[],c.forEach(function(t){o[t]=!0}),c.length?d.forEach(function(t){t[a]=o[t[l]]}):d.forEach(function(t){t[a]=!s}),d},getGridObj:function(e,n){var r=this,i=r.column,o=r.that.options,a=i.filter,l="gridOptions",s=e.groupIndx,c=e.maxCheck,d=r.di1,u=r.getData(e,a),h=u&&u.length&&null!=u[0].pq_label?"pq_label":e.labelIndx;return r.filterUI=e,t.extend({colModel:r.getCM(i,d,s,h,c,e),check:r.onChange(!n),filterModel:"bool"===i.dataType?{}:void 0,groupModel:s?{on:!0,dataIndx:s?[s]:[],titleInFirstCol:!0,fixCols:!1,indent:18,checkbox:!0,select:!1,checkboxHead:!c,cascade:!c,maxCheck:c,cbId:d}:{},dataModel:{data:u}},o.menuUI[l],o.filterModel[l],e[l],r.filterPanel?{numberCell:{show:!1},height:"flex",maxHeight:250,columnTemplate:{filter:{attr:'placeholder="Search.."'}}}:{})},getRenderLbl:function(t,e,n){return t===e&&(t=void 0),function(r){var i=r.rowData,o=i[t];return o||""!==i[e]?o:n}},onChange:function(t){var e=this,n=e.filterUI,r=(n.maxCheck,n.condition);return function(){if(t){var n=!1,i=e.column.dataIndx,o=e.di1,a=e.that,l=this.getData().filter(function(t){var e=t[o];return e||(n=!0),e}).map(function(t){return t[i]});n?a.filter({oper:"add",rule:{dataIndx:i,condition:r,value:l}}):a.filter({rule:{dataIndx:i,condition:r,value:[]}}),e.refreshRowFilter()}}},refreshRowFilter:function(){this.that.iRenderHead.postRenderCell(this.column)}},e.prototype={addEvents:function(){var t=this;t.$sel0.on("change",t.onSel1Change.bind(t)),t.$sel1.on("change",t.onSel2Change.bind(t)),t.$filter_mode.on("change",t.onModeChange.bind(t)),t.$clear.button().on("click",t.clear.bind(t)),t.$ok.button().on("click",t.ok.bind(t))},addEventsInput:function(){var t=this;t.$inp&&(t.$inp.filter("[type='checkbox']").off("click").on("click",t.onInput.bind(t)),t.$inp.filter("[type='text']").off("change").on("change",t.onInput.bind(t)))},clear:function(){var t=this.that,e=this.column,n=this.cond0,r=this.getType(n),i=e.dataIndx;t.filter({rule:{dataIndx:i,condition:r?n:void 0},oper:"remove"}),this.refreshRowFilter(),this.ready()},close:function(){this.$popup.remove()},filterByCond:function(t){var e=this,n=e.that,r=e.column.dataIndx,i=e.cond0,o=""===i,a=e.cond1,l=e.filterRow;if(e.showHide(i,a),!l)var s=e.getModeVal(),c=e.getType(i),d=e.getVal(0),u=d[0],h=d[1],f=e.getVal(1),p=f[0],g=f[1],m=e.$gridR;"select"==c?(t&&n.filter({oper:"add",rule:{dataIndx:r,condition:i,value:[]}}),l||e.iRange.create(m,e.filterUI[0],e.btnOk)):t&&n.filter({oper:o?"remove":"add",rule:{dataIndx:r,mode:s,crules:[{condition:i,value:u,value2:h},{condition:a,value:p,value2:g}]}})},getBtnOk:function(){return this.$ok},getInp:function(t){return this["$inp"+t]},getSel:function(t){return this["$sel"+t]},getBtnClear:function(){return this.$clear},getHtmlInput:function(t){var e=this.that.options,n=!e.filterModel.hideClearIcon,r=this.column.dataIndx,i=this.filterUI[t<2?0:1],o="checkbox",a=i.type==o?o:"text",l=`name='${r}' class='${i.cls||""}' style='width:100%;${i.style||""};display:none;' ${i.attr||""}`;return n&&"text"==a&&(l+=` is='clear-text' ctitle='${e.strClear}'`),`<input type='${a}' ${l} />`},getHtml:function(){var t=this,e=t.column.filter,n=t.menuH,r=e.crules||[],i=r[0]||e,o=r[1]||{},a=t.that.options,l=t.cond0=i.condition,s=t.cond1=o.condition,c=t.filterRow;t.readFilterUI();var d=function(e,n){return["<div style='margin:0 auto 4px;'>",t.getHtmlInput(e),"</div>","<div style='margin:0 auto 4px;'>",t.getHtmlInput(n),"</div>"].join("")},u=pq.filter.getConditionsCol(this.column,t.filterUI[0]);return["<div style='margin:8px auto;'>"," <select>",this.getOptionStr(u,l),"</select></div>",c?"":["<div>",d(0,1),"<div data-rel='grid' style='display:none;'></div>",n.singleFilter?"":["<div class='filter_mode_div' style='text-align:center;display:none;margin:4px 0 4px;'>","<label><input type='radio' name='pq_filter_mode' value='AND'/>",a.strAND,"</label>&nbsp;","<label><input type='radio' name='pq_filter_mode' value='OR'/>",a.strOR,"</label>","</div>","<div style='margin:0 auto 4px;'><select>",this.getOptionStr(u,s,!0),"</select></div>",d(2,3)].join(""),"</div>"].join(""),"<div style='margin:4px 0 0;'>",n.buttons.map(function(t){return"<button data-rel='"+t+"' type='button' style='width:calc(50% - 4px);margin:2px;' >"+(a["str"+pq.cap1(t)]||t)+"</button>"}).join(""),"</div>"].join("")},getMode:function(t){var e=this.$filter_mode;return t>=0?e[t]:e},getModeVal:function(){return this.$filter_mode.filter(":checked").val()},getOptionStr:function(t,e,n){var r=[""].concat(t),i=this,o=i.that.options.strConditions||{};return n&&(r=r.filter(function(t){return"select"!=i.getType(t)})),r.map(function(t){return'<option value="'+t+'" '+(e==t?"selected":"")+">"+(o[t]||t)+"</option>"}).join("")},getType:function(t){return pq.filter.getType(t,this.column)},getVal:function(t){var e,n,r=this.column,i=this["cond"+t],o=this["$inp"+(t?"2":"0")],a=o[0],l=this["$inp"+(t?"3":"1")],s=this.that,c=t=>s.deformatCondition(t,r,i);if(o.is("[type='checkbox']")){var d=a.indeterminate;e=!!a.checked||!!d&&null}else o.is(":visible")&&(e=c(o.val())),l.is(":visible")&&(n=c(l.val()));return[e,n]},init:function(t){var e=this.column=t.column;e.filter=e.filter||{},this.that=t.grid,this.menuH=t.menuH,this.$popup=t.$popup,this.filterRow=t.filterRow},initControls:function(){var e=this.filterUI[0],n=this.that,r=this.cond0,i=this.cond1,o=(e,n)=>t([this["$inp"+e][0],this["$inp"+n][0]]).filter(":visible"),a={column:this.column,headMenu:!0,indx:0};this.showHide(r,i),a.$editor=o(0,1),a.condition=r,a.type=e.type,a.filterUI=e,e.init.find(function(t){return t.call(n,a)}),i&&(e=this.filterUI[1],a.$editor=o(2,3),a.$editor.length&&(a.condition=i,a.type=e.type,a.filterUI=e,a.indx=1,e.init.find(function(t){return t.call(n,a)})))},isInputHidden:function(t){if("select"==t||!t)return!0},ok:function(){var t=this.cond0;"select"!=this.getType(t)||this.filterRow?t&&this.filterByCond(!0):this.iRange.change(!0),this.close(),this.refreshRowFilter()},onModeChange:function(){this.filterByCond(!this.btnOk)},onInput:function(e){var n=t(e.target),r=!this.btnOk;n.is(":checkbox")&&n.pqval({incr:!0}),this.filterByCond(r),r&&this.refreshRowFilter()},onSel1Change:function(){var t=this,e=!t.btnOk,n=t.column.filter,r=n.crules=n.crules||[];r[0]=r[0]||{},r[0].condition=t.cond0=t.getSel(0).val(),t.readFilterUI(),t.filterRow||(t.$inp0.replaceWith(this.getHtmlInput(0)),t.$inp1.replaceWith(this.getHtmlInput(1)),t.refreshInputVarsAndEvents(),t.initControls()),t.filterByCond(e),t.refreshRowFilter()},onSel2Change:function(){var t=this,e=t.column.filter.crules;e[1]=e[1]||{},e[1].condition=t.cond1=t.getSel(1).val(),t.readFilterUI(),t.$inp2.replaceWith(t.getHtmlInput(2)),t.$inp3.replaceWith(t.getHtmlInput(3)),t.refreshInputVarsAndEvents(),t.initControls(),t.filterByCond(!t.btnOk)},ready:function(e){this.node=e=e||this.node;var n,r,i,o=t(e),a=this,l=a.that,s=a.column,c=s.filter,d=c.crules||[],u=d[0]||c,h=d[1]||{},f=a.cond0=u.condition,p=a.cond1=h.condition,g=a.readFilterUI();a.iRange=new pq.cFilterMenu.select(l,s,a.filterPanel),n=a.getType(f),r=a.getType(p),i=a.$select=o.find("select"),a.$sel0=t(i[0]).val(f),a.$sel1=t(i[1]).val(p),a.$filter_mode=o.find('[name="pq_filter_mode"]'),a.$clear=o.find("[data-rel='clear']"),a.$ok=o.find("[data-rel='ok']"),a.btnOk=a.$ok.length,a.filterRow||(a.refreshInputVarsAndEvents(),a.$gridR=o.find("[data-rel='grid']"),a.$filter_mode.filter("[value="+c.mode+"]").attr("checked","checked"),a.$filter_mode_div=o.find(".filter_mode_div"),a.showHide(f,p),"select"==n?a.iRange.create(a.$gridR,g[0],a.btnOk):a.readyInput(0,n,u),a.readyInput(1,r,h),a.initControls())},readyInput:function(t,e,n){var r=this.column,i=(this["cond"+t],this["$inp"+(t?"2":"0")]),o=this["$inp"+(t?"3":"1")],a=this.that,l=t=>a.format(t,"Filter",r);i.is(":checkbox")&&i.pqval({val:n.value}),i.val(l(n.value)),"textbox2"==e&&o.val(l(n.value2))},readFilterUI:function(){var t=this.filterUI=[],e=this.that,n={column:this.column,condition:this.cond0,indx:0,headMenu:!0};return t[0]=pq.filter.getFilterUI(n,e),n.condition=this.cond1,n.indx=1,t[1]=pq.filter.getFilterUI(n,e),t},refreshInputVarsAndEvents:function(){var e=this,n=e.column,r=e.$inp=t(this.node).find("input[name='"+n.dataIndx+"']:not(.pq-search-txt)"),i=r[0],o=r[1],a=r[2],l=r[3];e.$inp0=t(i),e.$inp1=t(o),e.$inp2=t(a),e.$inp3=t(l),e.addEventsInput()},refreshRowFilter:function(){this.that.refreshHeaderFilter({dataIndx:this.column.dataIndx})},SelectGrid:function(){return this.$gridR.pqGrid("instance")},showHide:function(t,e){if(!this.filterRow){var n,r=this,i=r.$filter_mode_div,o=r.$sel1,a=r.getType(t),l=r.$inp;"select"===a?(r.$gridR.show(),l.hide(),i.hide(),o.hide()):(r.$gridR.hide(),t?(r.$inp0[r.isInputHidden(a)?"hide":"show"](),r.$inp1["textbox2"===a?"show":"hide"](),i.show(),o.show(),e?(n=r.getType(e),r.$inp2[r.isInputHidden(n)?"hide":"show"](),r.$inp3["textbox2"===n?"show":"hide"]()):(r.$inp2.hide(),r.$inp3.hide())):(l.hide(),i.hide(),o.hide()))}},updateConditions:function(){var t=this.column.filter;t.crules=t.crules||[{}],t.crules[0].condition=this.cond0,this.cond1&&(t.crules[1]=t.crules[1]||{},t.crules[1].condition=this.cond1)}}}(jQuery),function(t){var e=t.paramquery;t(document).on("pqGrid:bootup",function(t,n){new e.cEditor(n.instance)}),e.cEditor=function(t){var e=this,n=e.setDims.bind(e);e.that=t,t.on("editorBeginDone",function(r,i){i.$td.addClass("pq-edited"),e.ui=i,e.setStyle(i),e.setDims();var o=i.editor.init;o&&t.callFn(o,i),"grid"!=i.editor.appendTo&&t.on("setTblDims scroll",n)}).on("editorEnd",function(r,i){i.$td.removeClass("pq-edited"),t.off("setTblDims scroll",n),delete e.ui})},e.cEditor.prototype={setStyle:function(t){var e=t.$td,n=e.children("div"),r=e.css("background-color"),i={fontSize:e.css("font-size"),fontFamily:e.css("font-family"),backgroundColor:r,color:e.css("color")};i.padding=parseInt(n.css("padding-top"))+0+"px "+(parseInt(n.css("padding-right"))+0)+"px",t.$editor.css(i)},setDims:function(){var e=this.ui;if(e){var n=this.that,r=e.rowIndxPage,i=e.colIndx,o=e.$td,a=o[0],l=n.iRenderB,s=l.htContTop,c=l.wdContLeft,d=l.$cright[0],u=l.getCellCont(r,i)[0],h=l.getCellRegion(r,i),f=0;"right"==h&&(f=c),"left"==h&&s,"tr"==h&&(f=c);var p,g=e.$editor,m="textarea"==g[0].type,v="true"==g[0].contentEditable,w=e.$cell,x=l.getCellCoords(r,i),y=n.options,b=y.rtl,C=b?"right":"left",q=o.offset(),I=a.offsetWidth,_=a.offsetHeight,R=q.left,D=q.top,M=R+I,S=e.column,T=t.extend({},y.editModel,S.editModel),F=w.parent(),k=F.offset(),E=k.left,P=k.top,$=F[0],A=$.offsetWidth,H=(H=b?E+A-M:R-E)>f?H:f,O=O,L=I-2,N=_-2,V={minWidth:L,width:L};if($==n.element[0])(p={top:O=D-P})[C]=H,w.css(p);else{var j=(x=l.getCellCoords(r,i))[0];O=x[1]+1-u.scrollTop,H=j+1-(b?-1:1)*u.scrollLeft;var B=d.clientHeight-O,z=d.clientWidth-H;V.maxHeight=B,V.maxWidth=z,(p={top:O})[C]=H,w.css(p)}L=L>z?z:L,N=N>B?B:N,V.minHeight=N,m&&(g.attr("rows")&&(V.maxHeight=V.minHeight=void 0),g.attr("columns")&&(V.maxWidth=V.minWidth=V.width=void 0)),g.css(t.extend(V,pq.styleObj(e.editor.style))),v&&g.pqContent(T.saveKey!=t.ui.keyCode.ENTER)}}}}(jQuery),function(t){var e=t.paramquery,n=pq.grid,r=e.cProxy=function(t){this.that=t,t.options.reactive&&this.init()};t(document).on("pqGrid:bootup",function(t,e){var n=e.instance;n.iProxy=new r(n)}),pq.isEqual=function(t,e){if(pq.isObject(t)){for(var n in t)if(!pq.isEqual(t[n],e[n]))return!1;return!0}return t===e},pq.grid=function(t,e){var r=n.apply(pq,arguments),i=r.iProxy,o=r.options;return o.reactive&&(r.on("filter",function(){e.dataModel&&(e.dataModel.data=o.dataModel.data),i.prxData()}),i.prxObj(e,i.onOption,!0)),r},r.prototype={init:function(){var t=this,e=t.that;t.prxData(),t.prxCM(),e.on("refresh",t.clear.bind(t)).on("dataReady",t.clearV.bind(t)).on("dataAvailable",t.clearDV.bind(t))},onOption:function(t,e){var n,r=this,i=r.that,o={},a=i.options;if(o[t]=e,i.element&&!pq.isEqual(o,a))if(r.refresh(),pq.isObject(a[t]))if("groupModel"==t)i.Group().option(e,!1),r.refreshView();else if("treeModel"==t)i.Tree().option(e);else if("sortModel"==t)i.sort(e);else for(n in"dataModel"==t?(e.data&&r.prxData(e.data),r.refreshDataView()):"pageModel"==t&&(e.rPP||null!=e.type)&&r.refreshDataView(),e)i.option(t+"."+n,e[n]);else"colModel"==t?r.prxCM(e):"mergeCells"==t&&r.refreshView(),i.option(t,e)},onCMChange:function(){var t=this,e=t.that;clearTimeout(t.CMtimer),t.CMtimer=setTimeout(function(){e.refreshCM(),t.refresh()}),e.one("CMInit",function(){clearTimeout(t.CMtimer)})},prxCM:function(t){var e=this,n=e.that,r=t||n.options.colModel;r&&(e.prxArray(r,e.onCMChange.bind(e)),r.forEach(function(t){t.colModel&&e.prxCM(t.colModel)}))},prxData:function(t){var e=this,n=e.that,r=t||n.options.dataModel.data;r&&e.prxArray(r,function(){clearTimeout(e.datatimer),e.datatimer=setTimeout(function(){e.refreshView()}),n.one("dataReady",function(){clearTimeout(e.datatimer)})})},prxArray:function(t,e){var n=this,r=Array.prototype;"pop push reverse shift sort splice unshift".split(" ").forEach(function(i){t[i]=function(){var o=arguments,a="splice"==i,l=Object.getPrototypeOf(t)[i].apply(this,o);return("push"==i||a||"unshift"==i)&&n.prxArrayObjs(a?r.slice.call(o,2):o),e.call(n),l}}),n.prxArrayObjs(t)},prxArrayObjs:function(t){for(var e=0,n=t.length;e<n;e++)this.prxObj(t[e])},prxObj:function(t,e,n,r){if(pq.isObject(t)&&"tabModel"!=r){var i,o,a=this,l="pq_proxy";for(o in t[l]||Object.defineProperty(t,l,{value:{},enumerable:!1}),(i=t[l]).__self=a,t)"pq_"!=o.substr(0,3)&&(n&&!r&&pq.isObject(t[o])&&a.prxObj(t[o],e,n,o),i.hasOwnProperty(o)||(Object.defineProperty(i,o,Object.getOwnPropertyDescriptor(t,o)),a.defineProp(t,i,o,e,n,r)))}},defineProp:function(t,e,n,r,i,o){Object.defineProperty(t,n,{get:function(){return e[n]},set:function(t){var a,l=e.__self;i&&!o&&pq.isObject(t)&&l.prxObj(t,r,i,n),e[n]=t,r?(a=t,o&&((a={})[n]=t),r.call(l,o||n,a)):l.refresh()},enumerable:!0})},clear:function(){clearTimeout(this.timer)},clearV:function(){this.clear(),clearTimeout(this.timerV)},clearDV:function(){this.clearV(),clearTimeout(this.timerDV)},X:function(t,e){var n=this;n[e]=setTimeout(function(){n.that.element&&n.that[t]()})},refresh:function(){this.clear(),this.X("refresh","timer")},refreshView:function(){this.clearV(),this.X("refreshView","timerV")},refreshDataView:function(){this.clearDV(),this.X("refreshDataAndView","timerDV")}}}(jQuery),function(t){t.widget("pq.drag",t.ui.mouse,{_create:function(){this._mouseInit()},_mouseCapture:function(t){return this._trigger("capture",t),!0},_mouseStart:function(t){return this._trigger("start",t),!0},_mouseDrag:function(t){this._trigger("drag",t)},_mouseStop:function(t){this._trigger("stop",t)}})}(jQuery),function(t){t(document).on("pqGrid:bootup",function(t,n){var r=n.instance;r.iPic=new e(r),r.Pic=function(){return r.iPic}});var e=t.paramquery.cPic=function(t){var e=this,n=t.options,r=e.rtl=n.rtl;e.id=0,e.left=r?"right":"left",e.pics=[],e.that=t,t.on("dataAvailable",function(r,i){"filter"!=i.source&&(e.reset(),t.one("refresh",function(){e.addPics(n.pics)}))}).on("setTblDims",e.refresh.bind(e))};e.prototype={addPics:function(t){var e=this;(t||[]).forEach(function(t){e.add(t.name,t.src,t.from,t.to,t.cx,t.cy,!0)})},create:function(e,n,r,i,o,a,l,s,c){var d,u,h=this,f=new Image,p={position:"absolute",top:i,zIndex:5},g=t(f);f.src=n,p[h.left]=r,e.append(f),(u=g.attr({draggable:!1,"pic-id":c,tabindex:-1,alt:"pqgrid image"}).css({height:a,width:o,cursor:"move"}).on("focus",function(){t(s).css({outline:"2px dotted #999"})}).on("keydown",function(e){e.keyCode==t.ui.keyCode.DELETE&&h.remove(h.getId(this))}).on("blur",function(){t(s).css({outline:""})}).resizable({resize:h.onResize(h,s,l)}).parent(".ui-wrapper").css(p)).find(".ui-resizable-se").removeClass("ui-icon"),d=h.drag(u,s,l),g.drag({distance:3,capture:function(){g.focus()},start:d.start,drag:d.drag,stop:d.stop}),s.push(u[0])},drag:function(e,n,r){var i,o,a,l=this,s=l.that,c=s.iRenderB,d=c.leftArr,u=c.topArr,h=d[d.length-1],f=u[u.length-1],p=c.numColWd,g=function(t){return parseInt(e.css(t))};return{start:function(t){i=r.cx,o=r.cy,a={pageX:t.pageX,pageY:t.pageY,scrollX:s.scrollX(),scrollY:s.scrollY()}},drag:function(e){var r=s.scrollX(),c=s.scrollY(),d=(e.pageX+r-a.pageX-a.scrollX)*(l.rtl?-1:1),u=e.pageY+c-a.pageY-a.scrollY,m=g(l.left),v=g("top"),w={};a.pageX=e.pageX,a.scrollX=r,a.pageY=e.pageY,a.scrollY=c,m+d-p<0?d=p-m:m+d+i>h+p&&(d=h+p-m-i),v+u<0?u=0-v:v+d+o>f&&(u=f-v-o),w.top=v+u,w[l.left]=m+d,t(n).css(w)},stop:function(){var t=g(l.left)-p,e=g("top"),n=l.findIndx(d,t),i=l.findIndx(u,e);r.from=[n,t-d[n],i,e-u[i]]}}},onResize:function(e,n,r){return function(e,i){var o=i.size.height,a=i.size.width,l={height:o,width:a};t(n).css(l),t(n).find("img").css(l),delete r.to,r.cx=a,r.cy=o}},getPos:function(t){if(t){var e=this.that.iRenderB,n=1*t[2],r=1*t[0],i=e.getCellXY(n,r);return[i[0]+t[1],i[1]+t[3]]}return[]},name:function(t){return t.replace(/[^0-9,a-z,A-Z,_\.]/g,"_")},refresh:function(){var t=this,e=t.that.widget();t.pics.forEach(function(n){var r=n.from,[i,o,a,l,s,c]=r;if(null!=a&&null!=i){var d=n.id,[u,h]=t.getPos(r),f={top:h},p=e.find("[pic-id="+d+"]").parent();c.pq_hidden||s.hidden?p.css("display","none"):(p.css("display",""),f[t.left]=u,p.css(f))}})},createPicDOM:function(t,e,n,r,i,o,a,l,s,c,d){var u=this,h=u.that,f=h.iRenderB,p={name:t,src:e,get from(){var t=this._from,e=t[0],n=t[2];return[e?h.getColIndx({column:e}):null,t[1],(n||{}).pq_ri,t[3],e,n]},set from(t){this._from=[h.colModel[t[0]],t[1],h.getRowData({rowIndx:t[2]}),t[3]]},get to(){var t=this._to,e=this.from;if(t)return[e[0]+t[0],t[1],e[2]+t[2],t[3]]},set to(t){var e=this.from;this._to=[t[0]-e[0],t[1],t[2]-e[2],t[3]]},cx:i,cy:o,id:c};p.from=a,l&&(p.to=l),["$cright","$cleft","$clt","$ctr"].forEach(function(t){u.create(f[t],e,n,r,i,o,p,s,c)}),u.pics.push(p),d||h.iHistory.push({callback:function(n){n?c=u.add(t,e,a,l,i,o,!0):u.remove(c,!0)}}),h._trigger("picAdd")},add:function(t,e,n,r,i,o,a){var l=this;if(e){if("data:"!=e.substr(0,5))t=t||e.split("/").pop(),pq.urlToBase(e,function(e){l.add(t,e,n,r,i,o,a)});else{var s,c,d,u=l.getPos(n),h=u[0],f=u[1],p=[],g=l.id++,m=function(i,o){l.createPicDOM(t,e,h,f,i,o,n,r,p,g,a)};r&&r.length?(s=(u=l.getPos(r))[0],c=u[1],m(s-h,c-f)):o?m(i,o):((d=new Image).onload=function(){m(d.width,d.height)},d.src=e)}return g}},findIndx:function(t,e){return t.findIndex(function(t){return e<t})-1},getId:function(e){return t(e).attr("pic-id")},remove:function(t,e){var n,r=this,i=r.that,o=r.pics.findIndex(function(e){return e.id==t});i.widget().find("[pic-id="+t+"]").remove(),n=r.pics.splice(o,1)[0],e||i.iHistory.push({callback:function(e){e?r.remove(t,!0):t=r.add(n.name,n.src,n.from,n.to,n.cx,n.cy,!0)}})},reset:function(){this.that.widget().find("[pic-id]").remove(),this.pics.length=0,this.id=0}}}(jQuery),function(t){function e(e,n){t(".pq-focus-edge-box").remove();var r=e.offsetWidth-1,i=e.offsetHeight-1,o=(n,r)=>{t(`<div class='pq-focus-edge-box' style='border:1px solid #666;height:10px;width:10px;position:absolute;background:#fff;box-sizing:border-box;pointer-events:none;left:${n}px;top:${r}px;'></div>`).appendTo(e)};o(-5,-5),o(r-5,i-5),n.e&&o(r-5,(i-5)/2),o(r-5,-5),n.n&&o((r-5)/2,-5),n.s&&o((r-5)/2,i-5),o(-5,i-5),n.w&&o(-5,(i-5)/2),t(e).css("border-color","rgb(120,120,120)")}t.prototype.resizable2=function(n){return function(n,r){var i=t(n),o=i.css("position"),a={},l=(r.handles||"n,e,w,s").split(",");"absolute"!=o&&i.css({position:"relative"});l.map(t=>a[t]=1),e(n,a);new ResizeObserver(t=>{e(n,a)}).observe(n),r.aspectRatio=!0,i.resizable(r)}(this[0],n||{}),this}}(jQuery),function(t){pq.RichObjs={},pq.RichObj={async copy(t,e,n,r){let i,o=await this.toString(t,e,r);return i=n||!this.toHtml?o:await this.toHtml(t,e),[i,o,i!=o]},isEqualKey:(t,e,n)=>t[n]==e[n],isEqual(t,e){let n,r=t=>"string"==typeof t?this.toObject(t):t,i=r(t),o=r(e);if(i&&o){for(n of this.compareKeys)if(n.startsWith("prop.")&&(n=n.split(".")[1],i=i?.prop||{},o=o?.prop||{}),!this.isEqualKey(i,o,n))return!1;return!0}}};let e=pq.RichObjs.Pic=Object.assign({},pq.RichObj,{compareKeys:["val"],regexp:/"(data:image[^"]*)"/,toObject(t){let e,n,r=t.match(this.regexp);if(r)return e=t.match(/name=\"([^\"]*)\"/),n=t.match(/width=\"([^\"]*)\"/),this.toObject2(r[1],e?.[1],n?parseInt(n[1]):0)},toObject2:(t,e,n)=>({val:t,prop:{inst:"Pic",name:e,width:n}}),toImport(t){let e=t.pic;if(e)return{val:e.src,prop:{inst:"Pic",name:e.name,width:e.to?.[1]}}},svg:'<svg stroke="#e3e3e3" width="50" xmlns="http://www.w3.org/2000/svg" viewBox="25 25 150 150"><path stroke-width="5" fill="none" d="M90,140 L60,140 Q 30,120 60,100 Q 50,80 80,70 Q 100,30 120,70 Q 150,80 140,100 Q 170,120 140,140 L110,140" /><path stroke-width="5" fill="none" d="M100,170 L100,100"/><path stroke-width="5" fill="none" d="M80,120 L100,100 L120,120"/></svg>',getWidth:t=>t?parseInt(t)+"px":"100%",getName(t,e){let n=e.name;return!n&&t&&(n=t.startsWith("data:")?t.slice(25,35).replace(/\//g,"")+"."+pq.getMimeType(t).split("/")[1]:t.split("/").at(-1),e.name=n),n},get srcSVG(){return"data:image/svg+xml;base64,"+btoa(this.svg)},getDims:async(t,e)=>new Promise((n,r)=>{var i=new Image;i.onload=()=>{let r=i.width,o=i.height;e&&(o*=e/r,r=e),n([t,0|r,0|o])},i.src=t}),async getParams(t,n){let r=n.width||0,i=await e.srcBase64(t);return i?[...await e.getDims(i,r),e.getName(t,n)]:[""]},srcBase64:async t=>(t&&!t.startsWith("data:")&&await new Promise((e,n)=>{pq.urlToBase(t,n=>{t=n,e()})}),t),srcRender(t){return t||this.srcSVG},toHtml:async(t,n)=>(t=await e.srcBase64(t))?`<img name="${e.getName(t,n)}" width="${e.getWidth(n.width)}" src="${t}">`:"",toString:(t,n)=>e.getName(t,n),async toExport(t,n,r,i){if(t){var[t,o,a,l]=await e.getParams(t,n);if(t)if("wb"==i)r.pic={src:t,width:o,height:a,name:l};else if("pdf"==i){({jpg:1,jpeg:1,png:1})[pq.getMimeType(t).split("/")[1]]||(t=await pq.convertToPNG(t)),r.image=t,r.width=o}else"htm"==i&&(r.html=await e.toHtml(t,n))}},render(t){var n=t.cellData,r=t.prop,i=r.width;return t.Export&&!n?"":{text:`<img name="${e.getName(n,r)}" width="${e.getWidth(i)}" src="${e.srcRender(n)}" alt="image">`,cls:"pq-center-cont"}},editor:()=>({type:"div",init:e.editorInit}),editorInit(n){let r=n.grid,i=n.prop.width,o=n.cellData,a=n.$editor,l=`<div class='pq-img-editor pq-disable-select' style='width:${e.getWidth(i)}'>\n<img class='pq-disable-select' width="100%" src="${e.srcRender(o)}">\n<input type="file" id="fileInput" style="display:none;" accept="image/*">\n</div>`;a.html(l);var s=a.find("img");a.css({overflow:"visible",width:"auto"}).removeAttr("contenteditable"),a.addClass("pq-center-cont"),setTimeout(e=>{a.children().on("dblclick",()=>{t("#fileInput").click()}).resizable2({handles:"e",containment:r.widget()})},500),a.on("keydown",t=>{if("Delete"==t.key)return s.attr("src",e.srcSVG),!1}),t("#fileInput").on("change",t=>{const e=t.target.files[0];if(e){const t=new FileReader;t.onload=async function(t){let e=t.target.result,n=s.attr("src");s[0].onerror=t=>{s.attr("src",n)},s.attr("src",e)},t.readAsDataURL(e)}})},getEditorVal(n){var r=t(n).find("img"),i=r[0].offsetWidth,o=r.attr("src");return{val:o==e.srcSVG?"":o,prop:{width:i}}}})}(jQuery),function(t){pq.RichObjs.Link=Object.assign({},pq.RichObj,{toAbsolute:t=>t?new URL(t,document.baseURI).href:"",isEqualKey(t,e,n){let r=t[n],i=e[n];return"link"==n?this.toAbsolute(r)==this.toAbsolute(i):r==i},render(t){let e=t.prop;return`<a href="${e.link}" target="${e.target||"_blank"}" >${t.cellData}</a>`},editor:{type:"div",init(e){var n=e.grid,r=e.cellData,i=e.prop,o=n.options,a=e.$editor,l=(t,e,n)=>`<tr><td>${n}:</td><td><input value="${e||""}" name='${t}' style='width:280px;' /></td></tr>`,s=`<div class='pq-link-editor pq-disable-select' style='margin:10px;'>\n<table style='border-collapse:separate;border-spacing:2px 10px;'>\n ${l("url",i.link,"Url")+l("label",r,o.strLabel)}\n</table>\n</div>`;t(s).on("keydown",t=>{"Tab"==t.key&&t.stopPropagation()}).dialog({appendTo:a,position:{my:"center",at:"center",of:n.$cont},width:400,draggable:!1,resizable:!1,open(){n.one("editorBlur",t=>!1),setTimeout(e=>{t(this).find("input")[0].focus()},100)},close(){n.quitEditMode(),n.focus(e)},buttons:[{text:o.strApply,click:function(){n.saveEditCell(),t(this).dialog("close")}}]})}},getEditorVal(e){var n=n=>t(e).find(`[name="${n}"]`).val(),r=n("url");return{val:n("label"),prop:{link:r}}},toHtml(t,e){let n=this.toAbsolute(e.link);return n?`<a href="${n}" target="${e.target||"_blank"}">${t}</a>`:""},toExport(t,e,n,r){let i=this.toAbsolute(e.link);"wb"==r?(n.value=t,n.link=i):(n.text=t,n.link=i,"htm"==r&&(n.html=this.toHtml(t,e)))},toImport(t){if(t.link)return{val:t.value,prop:{link:t.link,inst:"Link"}}},toString(t,e,n){return n?t:this.toAbsolute(e.link)},regexp:/<a\s+[^>]*href=("([^"]*)"|'([^']*)')[^>]*>(<[^>]+>?)?(.*?)(<[^>]*>?)?<\/a>/,regexpStr:/^https?:\/\/.+/,compareKeys:["val","prop.link"],toObject(t){let e=t.match(this.regexp);if(e){let t=e[2]||e[3];return{val:e[5],prop:{link:t,inst:"Link"}}}}})}(jQuery),function(t){class e extends HTMLElement{constructor(){super()}get offsetWidth(){return this.wrapper.offsetWidth}get offsetHeight(){return this.wrapper.offsetHeight}connectedCallback(){var e=t(this);if(this.rtl="rtl"==e.css("direction"),e.parent().hasClass("pq-wrapper"))return;e.css({display:"block","box-sizing":"border-box"});const n=this.wrapper=document.createElement("div");n.classList.add("pq-wrapper"),n.style.height="100%",this.parentNode.insertBefore(n,this),n.appendChild(this),this.addResizeObserver()}init(e,n,r){var i=this;i.wdLeftPane=e,i.htTopPane=n,i.SBDIM=r,i._inited=!1;var o=t(i),a=i.rtl,l=r+"px",s=(r||13)+"px",c=i.scrollHeight,d=i.scrollWidth,u=i.clientWidth,h=i.clientHeight,f=o.css("overflow-x"),p=o.css("overflow-y"),g=(t,e)=>{i[t]&&i[t].remove(),i[t]=null,i.style[e]==`calc(100% - ${l})`&&(i.style[e]="")},m=`<div tabindex="-1" style="overflow-y:hidden;height:${s};position:absolute;bottom:0;">\n<div style="height:1px;"></div>\n</div>`,v=`<div tabindex="-1" style="overflow-x:hidden;width:${s};position:absolute;${a?"left":"right"}:0;">\n<div style="width:1px;"></div>\n</div>`;function w(e,n,r,o){i.style[e]=`calc(100% - ${l})`;let a,s=i[o]=t(r).appendTo(i.wrapper),c=s[0],d="scroll"+pq.capitalF(n);s.on("mousedown",t=>!1).on("scroll",t=>{i.scrollSwipe||(i.scrollBySlider=!0,clearTimeout(a),a=setTimeout(t=>{i.scrollBySlider=!1},300),i[d]=c[d])})}"scroll"==f||"auto"==f&&d>u?i.$hscroll||w("height","left",m,"$hscroll"):g("$hscroll","height"),"scroll"==p||"auto"==p&&c>h?i.$vscroll||w("width","top",v,"$vscroll"):g("$vscroll","width"),i.setDims(e,u,d,n,h,c,f,p),t(i).off("scroll.pq-virtual").on("scroll.pq-virtual",i.onScroll),this._inited=!0}onScroll(){var t=this;t.scrollBySlider||(t.scrollSwipe=!0,t.$hscroll&&(t.$hscroll[0].scrollLeft=t.scrollLeft),t.$vscroll&&(t.$vscroll[0].scrollTop=t.scrollTop),clearTimeout(t.scrollTimer),t.scrollTimer=setTimeout(e=>{t.scrollSwipe=!1},300))}setDims(t,e,n,r,i,o,a,l){var s=this,c=s.SBDIM,d=s.rtl,u=s.$hscroll,h=s.$vscroll;(u||h)&&(u&&(u.css({[d?"right":"left"]:t,width:e-t-(h?c?0:13:0)}),u.children().css({width:n-t}),u[0].style.overflowX=a,u[0].scrollLeft=s.scrollLeft),h&&(h.css({top:r,height:i-r-(u?c?0:13:0)}),h.children().css({height:o-r}),h[0].style.overflowY=l,h[0].scrollTop=s.scrollTop))}addResizeObserver(){var t=this;new ResizeObserver(e=>{t._inited&&t.init(t.wdLeftPane,t.htTopPane,t.SBDIM)}).observe(t)}}customElements.define("div-sb",e)}(jQuery),function(t){var e,n,r,i,o=t.fn.val,a=t.fn.select;function l(){return window.getSelection()}function s(){return document.createRange()}function c(t){var e=l().getRangeAt(0),n=s();return e.startContainer==t?[e.startOffset,t]:(n.selectNodeContents(t),n.setEnd(e.startContainer,e.startOffset),[n.toString().length])}function d(e,n,r){if(r!=e)return t(e.childNodes).toArray().forEach(function(t){if(n>=0)if("#TEXT"==t.nodeName.toUpperCase()){var e=t.textContent;if(e.length>=n){var r=s(),i=l();r.setStart(t,n),r.collapse(!0),i.removeAllRanges(),i.addRange(r),n=-1}else n-=e.length}else n=d(t,n)}),n;var i=s(),o=l();i.setStart(e,n),i.collapse(!0),o.removeAllRanges(),o.addRange(i)}function u(){e[++i]={indx:c(n),dom:n.cloneNode(!0)}}function h(){f(n)?u():(e[i].dom=n.cloneNode(!0),e[i].indx=c(n))}function f(n,r){if(e[i]){var o=t(n.childNodes).toArray(),a=t(r||e[i].dom.childNodes).toArray(),l=!1;return o.length!=a.length||(o.forEach(function(t,e){if(!l){var n=a[e];t.nodeName!=n.nodeName||3==t.nodeType&&t.nodeValue.split(/\s/).length!=n.nodeValue.split(/\s/).length?l=!0:t.childNodes&&t.childNodes.length&&(l=f(t,n))}}),l)}}t.fn.val=function(e){var n,r=this[0];return r&&"true"==r.contentEditable?arguments.length?(null!=e&&(r.innerHTML=pq.escapeHtml(e+"").replace(/(\r\n|\r|\n)/g,"<br>"),function(t){var e=l(),n=s(),r=t.lastChild;r&&(e.removeAllRanges(),n.setStartAfter(t.lastChild),e.addRange(n))}(r)),this):(n=(n=r.innerHTML).replace(/<br[^>]*>/g,"\n"),t("<p>").html(n).text()):o.apply(this,arguments)},t.fn.select=function(){var t=this[0];if(t&&"true"==t.contentEditable){var e=document.createRange(),n=window.getSelection();e.selectNodeContents(this[0]),n.removeAllRanges(),n.addRange(e)}else a.call(this)},t.fn.pqContent=function(o){var a=this,s=n=a[0],c="pq-content";a.hasClass(c)||(r=a.attr("dataType"),e=[],i=-1,a.addClass(c).on("keydown",function(a){var c,f,p,g;if(e.length||u(),13!=a.keyCode||r&&0!=r.indexOf("string")&&"html"!=r?a.ctrlKey&&(90==a.keyCode?(i>0&&(i--,c=1),p=1):89==a.keyCode&&(i<e.length-1&&(i++,c=1),p=1),c&&(f=e[i],g=f.dom.childNodes,n.innerHTML="",t(g).toArray().forEach(function(t){n.appendChild(t.cloneNode(!0))}),d(s,f.indx[0],f.indx[1]))):((a.altKey||o)&&function(t){var e=t.childNodes,n=l().getRangeAt(0),r=n.startContainer,i=n.startOffset,o=function(){var t=document.createElement("br");n.insertNode(t),n.setStartAfter(t)};!e.length||r==t&&e[i-1]&&3==e[i-1].nodeType||3==r.nodeType&&r.textContent.length==i&&null==r.nextSibling?(o(),o()):o()}(s),p=!0),c||h(),p)return!1}))}}(jQuery),function(t){t(document).on("pqGrid:bootup",function(t,n){var r=n.instance;r.iRowResize=new e(r),r.RowResize=function(){return r.iRowResize}});var e=t.paramquery.cRowResize=function(t){var e=this;e.that=t,e.ht=8,t.options.rowResize&&t.on(!0,"cellMouseDown",e.onCellDown.bind(e)).on("cellMouseEnter",e.onCellEnter.bind(e))};e.prototype={isDetail:function(t){return((t.rowData||{}).pq_detail||{}).show},onCellDown:function(e,n){if(-1==n.colIndx&&!this.isDetail(n)){var r,i=e.pageY,o=e.currentTarget,a=t(o);if(i>=a.offset().top+o.offsetHeight-this.ht)return this.createDrag(a,n),(r=t.Event("mousedown",e)).type="mousedown",a.trigger(r),!1;a.draggable("instance")&&a.draggable("destroy")}},onCellEnter:function(e,n){if(-1==n.colIndx&&!this.isDetail(n)){var r="pq-row-resize",i=t(e.currentTarget);this.drag||i.find("."+r).length||i.append("<div class='"+r+"' style='position:absolute;height:"+(this.ht-1)+"px;bottom:0;left:0;width:100%;cursor:row-resize;'></div>")}},createDrag:function(e,n){var r,i,o,a=this,l=a.that,s=n.rowData,c=n.rowIndxPage,d=l.iRenderB,u=l.$cont,h="width:100%;background-color:#000;height:1px;position:absolute;";e.hasClass("ui-draggable")||e.on("dblclick",function(){delete s.pq_htfix,d.autoHeight({})}).draggable({axis:"y",cursor:"row-resize",cursorAt:{top:-2},start:function(e){a.drag=!0,o=e.pageY,i=d.getTop(c)-d.scrollY(),a.$top=t("<div style='"+h+"top:"+i+"px;'></div>").appendTo(u),a.$helper=t("<div style='"+h+"'></div>").appendTo(u),r=l.getScale()[1]},helper:function(){return t("<span/>")},drag:function(t){var n=(t.pageY-o)/r,l=i+e[0].offsetHeight+n;a.$helper.css("top",l)},stop:function(t){a.drag=!1;var e=(t.pageY-o)/r,n=d.rowhtArr;a.$top.remove(),a.$helper.remove(),n&&(s.pq_ht=Math.max(n[c]+e,10),s.pq_htfix=!0,l.refresh())}})}}}(jQuery),function(t){t(document).on("pqGrid:bootup",function(t,e){var r=e.instance;r.iTab=new n(r),r.Tab=function(){var t=arguments,e=r.iTab,n=t[0];return n&&(e.eachGrid(e=>{e[n].apply(e,Array.from(t).slice(1))}),"option"==n&&(e.model._options[t[1]]=t[2])),e}});var e=t.paramquery,n=e.cTab=function(t){var e,n=this,r=t.options,i=r.tabModel||{},o=i.tabs;n.that=t,n.rtl=r.rtl,o&&(o.length||o.push({name:r.title,_inst:t}),i.byRef=!0,n.model=i,n._tbs=o,i._main||(null==(e=i.activeId)&&(e=o.findIndex(function(t){return!t.hidden})),Object.defineProperty(i,"activeId",{get:function(){return this.tabs.indexOf(this._at)},set:function(t){this._at=this.tabs[t]},configurable:!0}),i.activeId=e,i._main=i._at._inst=t,t.on("destroy",n.onDestroy.bind(n)),n.getSheetOptions(i._at,!0)),t.on("change",n.onChange.bind(n)).on("render",n.onRender.bind(n)).on("toggle",n.onToggle.bind(n)))};e.pqGrid.defaults.tabModel={newTab:function(){return{sheet:{},extraRows:20,extraCols:10}}},n.prototype={eachGrid(t){this._tbs.forEach(function(e,n){var r=e._inst;r&&t(r,n)})},activeId:function(){return this.model.activeId},activeTab:function(){return this.model._at},grid:function(t){return t._inst},activate:function(t,e){var n=this,r=n.model,i=n._tbs[t],o=i._inst,a=r.activeId,l=r._at._inst.widget();return o?a!=t&&(l.hide(),o.widget().show(),r._at=i,o.iTab.refresh(),o.refresh()):o=n.create(t,!0),n.trigger("tabActivate",null,{tab:i}),e&&o.focus(),o},add:function(){var t=this,e=t.model.newTab.call(t.main());e.name=e.name||t.getTitle(),t._tbs.push(e),t.refresh()},clear:function(){var t=this._tbs,e=this.model;t.forEach(function(t){var n=t._inst;n&&n!=e._main&&n.widget().remove()}),t.length=0},create:function(e,n){var r=this._tbs,i=this.model,o=r[e],a=o._inst;if(a)return a;var l=i._at._inst.widget(),s=this.getOptions(o),c=t("<div/>").insertAfter(l);return delete o.sheet,c[0].style.cssText=l[0].style.cssText,n?(i.activeId=e,l.hide()):c.hide(),s.render=function(){o._inst=this},pq.grid(c,s)},findActive:function(t){var e,n,r,i=this.model,o=this._tbs,a=i._at;if(-1==o.indexOf(a)||a.hidden){for(n=t;n<o.length;n++)if(!(e=o[n]).hidden){r=n;break}if(null==r)for(n=t;n>=0;n--)if((e=o[n])&&!e.hidden){r=n;break}this.activate(r)}else this.refresh()},remove:function(t){var e=this,n=e.model,r=e._tbs,i=r[t]._inst,o=n.activeId;e.show().length>1&&(r.splice(t,1),e.findActive(o),i&&i!=n._main&&i.destroy())},rename:function(t,e){var n=this,r=n._tbs[t],i=r.name;n.isValid(e)&&(r.name=e,n.trigger("tabRename",null,{tab:r,oldVal:i}),n.refresh())},edit:function(e){var n=this,r=n._tbs[e];t("<input class='pq-border-0' />").appendTo(n.getTab(e)).on("change",function(r){var i=t.trim(this.value);n.rename(e,i)}).on("focusout",function(){n.refresh()}).val(r.name).focus().select()},getId:function(e){if(t.isPlainObject(e))return this._tbs.indexOf(e);var n=t(e).attr("tabId");return null!=n?1*n:null},getSheetOptions:function(e,n){var r,i=this.that,o=i.iImport,a=e.sheet,l=a?o.importS(a,e.extraRows,e.extraCols):{};return n&&(a||(r=this.getGridOptions(e)))&&(t.extend(l,r),o.applyOptions(i,l)),l},getGridOptions:function(t){var e=t.gridOptions;return pq.isFn(e)&&(e=e.call(this.main())),e},getOptions:function(e){var n=this,r=n.that.options,i="collapsible",o=r[i],a=t.extend(!0,{},n.model._options);return t.extend(a,n.getSheetOptions(e),n.getGridOptions(e)),["width","height","maxHeight","maxWidth","tabModel"].forEach(function(t){a[t]=r[t]}),t.extend(!0,a[i]||={},{fsState:o.fsState,toggle:o.toggle,toggled:o.toggled}),a},getTab:function(t){return this.$tabs.find("[tabId="+t+"]")},getTitle:function(){var t=this._tbs,e=this.that.options.strTabName||"{0}",n=t.map(function(t){var n=(t.name||"").match(new RegExp(e.replace("{0}","(\\d+)"),"i"));return n?1*n[1]:0}).sort(function(t,e){return t-e});return e.replace("{0}",n.length?n.pop()+1:1)},hide:function(t){return this.show(t,!0)},isValid:function(t){if(t.length&&t.length<=31&&!this._tbs.find(function(e){return e.name.toUpperCase()==t.toUpperCase()})&&!"/\\*?:[]".split("").find(function(e){return t.indexOf(e)>=0}))return!0},main:function(){return this.model?this.model._main:this.that},trigger:function(t,e,n){this.eachGrid(function(r){r._trigger(t,e,n)})},find:function(t,e){return this._tbs.find(function(n){return n[t]==e})},onChange:function(t,e){e.tab=this.find("_inst",this.that),this.trigger("tabChange",t,e)},onClick:function(e){var n,r=t(e.target),i=this,o=r.hasClass("ui-icon-close"),a=i.that.options.strTabRemove||"",l=i.getId(r.closest(".pq-tab-item"));if(null!=l){if(n=i._tbs[l].name,o&&1!=confirm(a.replace("{0}",n)))return;i[o?"remove":"activate"](l)}},onDestroy:function(){this.clear()},onDblClick:function(e){var n=this,r=t(e.target).closest(".pq-tab-item"),i=n.getId(r);null==i||n._tbs[i].noRename||n.edit(i)},onPlus:function(){this.add()},onLeft:function(t){var e=this.$tabs[0],n=.8*e.clientWidth,r=pq.scrollLeft(e);r=1==t?r+n:Math.max(r-n,0);e.scrollTo({left:(this.rtl?-1:1)*r,behavior:"smooth"})},onRight:function(){this.onLeft(!0)},onRender:function(){var e,n,r=this,i=r.that,o=i.options,a=o.tabModel,l=o.rtl,s="click keydown",c="ui-icon-triangle-1-w",d="ui-icon-triangle-1-e",u=r.model,h=function(e){return function(n){"click"!=n.type&&n.keyCode!=t.ui.keyCode.ENTER||r[e](n)}},f=function(t,e,n){return"<div tabindex=0 "+(n||"")+" class='"+t+" pq-tab-button pq-valign-center pq-bg-3 pq-border-0'><div class='"+e+" ui-icon'></div></div>"},p=r.$cont=t("<div role='tablist' aria-label=\"Spreadsheet Sheets\" class='pq-tabs-cont ui-widget-content'>"+(a.noAdd?"":f("pq-tab-plus","ui-icon-plus","role='button' title='"+o.strTabAdd+"'"))+f("pq-tab-w",l?d:c,"role='button' aria-label='Scroll left'")+"<div class='pq-tabs-strip' style='"+(a.css||"")+"'></div>"+f("pq-tab-e",l?c:d,"role='button' aria-label='Scroll right'")+"</div>").appendTo(a.atTop?i.$top:i.$bottom);u._options||pq.copyObj(u._options={},i.origOptions,["dataModel","colModel","tabModel"]),p.find(".pq-tab-plus").on(s,h("onPlus")),r.$leftBtn=p.find(".pq-tab-w").on(s,h("onLeft")),r.$rightBtn=p.find(".pq-tab-e").on(s,h("onRight")),e=r.$tabs=p.find(".pq-tabs-strip").on(s,h("onClick")),u.noSortable||e.sortable({axis:"x",distance:3,start:function(e){n=i.getScale()[0],t(".ui-sortable-placeholder").html("a")},update:r.onMove.bind(r),sort:function(t,e){e.helper.css({left:e.position.left/n})}}),e.on("dblclick",r.onDblClick.bind(r)).on("scroll",r.onScroll.bind(r)),r.refresh()},onMove:function(t,e){var n=this,r=n._tbs,i=e.item,o=n.getId(i),a=n.getId(i.prev())||-1,l=r.splice(o,1)[0];r.splice(a+(a>o?0:1),0,l),n.refresh()},onScroll:function(t){this.model.scrollLeft=t.target.scrollLeft,this.setBtnEnable()},onToggle:function(e,n){var r=this,i=r._tbs,o=r.model,a=r.that,l=a.options.collapsible,s="max"==n.state;o.toggle||(a.one("refresh",function(){r.setBtn(),r.setBtnEnable()}),o.toggle=1,i.forEach(function(e){var n=e._inst;if(n&&n.element[0]!=a.element[0]){var r=n.options.collapsible;n.toggle({refresh:!1}),s&&(r.fsState=t.extend(!0,{},l.fsState)),n.element.hide()}}),o.toggle=0)},refresh:function(){var t,e,n=this,r=[],i=n._tbs,o=n.that,a=n.model,l=o.options.strTabClose||"",s=a._at,c=a.activeId;if(s&&(e=s._inst)&&o!=e)return e.Tab().refresh();t=n.show(),i.forEach(function(e,i){if(!e.hidden){e.name=e.name||n.getTitle();let a=pq.escapeHtml(e.name),s=`role='tab' aria-label = "${a}"`,d=i==c;d&&(s+=` aria-selected="true" aria-owns="${o.grid_id}"`),r.push(`<div ${s} tabindex=0 class='pq-tab-item pq-valign-center pq-border-0 ${d?"ui-state-highlight":"ui-state-default"}' tabId='${i}'><div>`+a+"</div>"+(t.length>1&&!e.noClose?"<div title='"+l+"' class='ui-icon ui-icon-close'></div>":"")+"</div>")}}),n.$tabs.html(r.join("")),n.setBtn(),n.restoreSL(),n.setBtnEnable()},setBtnEnable:function(){var t=this,e=t.$tabs[0],n={cursor:"default",opacity:.5},r={cursor:"",opacity:""},i=e.scrollWidth-e.clientWidth,o=pq.scrollLeft(e);t.$leftBtn.css(o?r:n),t.$rightBtn.css(o>=i?n:r)},setBtn:function(){var t=this,e=t.$tabs,n=e[0],r=t.$leftBtn,i=t.$rightBtn;r.hide(),i.hide(),e.css("width","calc(100% - 2em)"),n.scrollWidth-n.clientWidth&&(r.show(),i.show(),e.css("width","calc(100% - 6em)"))},restoreSL:function(){var t=this.model,e=t.activeId,n=this.$tabs,r=n[0];if(e>=0){r.scrollLeft=t.scrollLeft;let i,o=n.find("[tabid="+e+"]")[0].getBoundingClientRect(),a=r.getBoundingClientRect(),l=a.left-o.left,s=o.right-a.right;l>0?i=-l:s>0&&(i=s),i&&r.scrollBy({left:i,behavior:"smooth"})}},show:function(t,e){var n=this._tbs,r=[];if(!t)return n.forEach(function(t){!t.hidden==!e&&r.push(t)}),r;t.forEach(function(t){n[t].hidden=e}),this.findActive(this.model.activeId)},tabs:function(){return this._tbs}}}(jQuery),function(t){t(document).on("pqGrid:bootup",function(t,n){var r=n.instance,i=r.options;"lazy"==i.dataModel.location&&(r.iLazy=new e(r,i))});var e=t.paramquery.Lazy=function(t,e){var n=this;n.grid=t,n.rpp=e.pageModel.rPP,t.on("scrollEnd",n.onScroll.bind(n)).on("customSort",n.customSort.bind(n)).on("customFilter",n.customFilter.bind(n)).on("lazyProgress",n.progress.bind(n)).on("lazyComplete",n.onComplete.bind(n))};e.prototype={init:function(t){t=t||{};var e=this,n=e.grid,r=n.getQueryString(t);e.dataURL=r.dataURL,e.url=r.url,n._trigger("lazyInit",null,t),e.totalRecords=null,e.cachedPages=[],e.data=null,e.complete=!1,e.xhr&&e.xhr.abort(),e.bars=[],e.request(t)},customSort:function(t,e){if("local"==this.grid.option("sortModel.type")&&!this.complete)return!1},customFilter:function(t,e){var n=this.complete,r=this.grid;if("local"==r.option("filterModel.type")&&!n)return e.dataTmp=r.options.dataModel.data,e.dataUF=[],e.trigger=!1,!1},progBar:function(){var e,n=this.grid,r=this.bars,i=n.options.dataModel,o=n.iTab;return i.progressAcrossTabs&&(n=o.grid(o.activeTab())),e=n.widget().find(".pq-grid-pbar")[0],-1==r.indexOf(e)&&r.push(e),t(r)},progress:function(t,e){var n=this.progBar(),r=e.percent+"%";n.show().stop().animate({width:r},{always:function(){n.css({width:r})}})},onComplete:function(t,e){var n=this.progBar();n.animate({width:"100%"},{complete:function(){n.css({width:0}).hide()}}),this.grid._onDataAvailable(e)},onScroll:function(){this.complete||this.request()},triggerProgress:function(){var t=0,e=this.cachedPages;e.forEach(function(e){e&&t++}),this.grid._trigger("lazyProgress",null,{percent:Math.round(100*t/e.length,2)})},triggerComplete:function(t){var e=this,n=e.grid;e.complete||(e.complete=!0,n._trigger("lazyComplete",null,t))},request:function(e){e=e||{};var n,r,i,o,a=this,l=a.grid,s=l.options.pageModel,c=l.getViewPortIndx(),d=c.initV,u=a.dataURL,h=d,f=a.data,p=a.rpp,g=a.cachedPages,m=a.totalPages,v=c.finalV;if(f&&null!=d){for(;h<=v;h++)if(f[h]&&f[h].pq_empty){i=o=Math.floor(h/p)+1;break}if(!i)for(n=r=Math.floor(d/p)+1,h=0;h<=m;h++){if(0==g[n]){o=n;break}if(0==g[r]){o=r;break}n--,r++}}else o=1;if(!o)return a.triggerComplete(e),!1;s.curPage=o,a.xhr&&a.xhr.abort(),u=t.extend(u,{pq_curpage:o,pq_rpp:s.rPP}),l.callXHR(a.url,u,function(t,n,r){var o,s=t.data,c=t.totalRecords,u=s.length,h=u,f=t.curPage,v=a.data=a.data||[],w=(f-1)*a.rpp;if(null==a.totalRecords){for(o=!0;h<c;h++)v[h+w]={pq_empty:!0};for(a.totalRecords=c,m=a.totalPages=Math.ceil(c/p),h=1;h<=m;h++)g[h]=!1;l.option("dataModel.data",v)}for(g[f]=!0,h=0;h<u;h++)v[h+w]=s[h],v[h+w].pq_empty=!1;o?l.refreshView({header:e.header,trigger:!1,triggerQueue:!1,group:!1}):i&&l.refresh({header:!1}),null!=d?0!=a.request(e)&&a.triggerProgress():a.triggerComplete(e)})}}}(jQuery),function(t){t.fn.pqColorPick=function(e){e=e||{};var n,r,i,o=this,a=t(document.body),l=t.paramquery.strings,s=e.title||"",c=l.strApply;function d(){pq.position(i,{my:"left top",at:"left bottom",of:o})}function u(){i=n=r=null}function h(t){m(t,1,2,0),m(t,3,2,1),m(t,5,2,2)}function f(){var t=n.val().trim();if(t.match(/^#[0-9,A-F]{6}/i))return t}function p(){var t="#"+["red","green","blue"].map(function(t){return function(t){var e=t.slider("value").toString(16);return 1==e.length?"0"+e:e}(g(".pq-cp-"+t))}).join("");g(".pq-cp-output").css("background-color",t),n.val(t)}function g(t){return i.find(t)}function m(e,n,i,o){e=parseInt(e.substr(n,i),16),t(r[o]).slider("value",e)}return o.on("click",function(){return i?i.is(":hidden")?(i.show(),d()):i.hide():(i=t(`<div class="pq-theme pq-color-picker">\n<div class="pq-cp-title">${s}</div>\n<div class="pq-cp-1-row">\n<div style="width:75%;">\n<div class="pq-cp-red pq-slider" ></div>\n<div class="pq-cp-green pq-slider"></div>\n<div class="pq-cp-blue pq-slider"></div>\n</div>\n<div class="pq-cp-output ui-widget-content"></div>\n</div>\n<div class="pq-cp-2-row">\n<input type="text" class="pq-cp-input" />\n<button type="button" class='clear'>${l.strClear}</button>\n<button type="button" class='apply'>${c}</button>\n</div>\n</div>`).appendTo(a),n=g(".pq-cp-input").on("input",function(){var t=f();t&&h(t)}),i.find("button").button(),i.find(".clear").on("click",function(){o[0].clear=1,o.trigger("change"),delete o[0].clear,i.hide(),o.focus()}),i.find(".apply").on("click",function(){var t=f();t&&o.val(t).trigger("change"),i.hide(),o.focus()}),pq.makePopup(i[0],o[0],{onPopupRemove:u}),d(),r=g(".pq-slider").slider({max:255,range:"min",animate:!0,slide:p,change:p})),i.is(":visible")&&(pq.focusEle(!1,i),h(o.val()),p()),!1}),o}}(jQuery),function(t){t.fn.pqBorder=function(e={}){var n,r,i,o,a,l=this,s=e.grid||l.closest(".pq-grid").pqGrid("instance"),c=t(document.body),d=e.borders||["all","outer","inner","vertical","horizontal","left","right","top","bottom","none"],u=t.paramquery.strings,h={vertical:"middle",horizontal:"center"},f=t=>t.map(function(t,e){var n=u[pq.camelCase("str-"+t)];return"<div tabindex=0 data-border='"+t+"' class='pq-border-0 pq-bp-button "+("bi-border"+("none"==t?"":"-"+(h[t]||t)))+"' title = '"+n+"'></div>"}).join(""),p=f(d.slice(0,5)),g=f(d.slice(5));function m(){pq.position(o,{my:"left top",at:"left bottom",of:l})}function v(){o=a=r=null}function w(){a=null}function x(t){return o.find(t)}function y(){a?a[a.is(":hidden")?"show":"hide"]():a=pq.Select({noBorderSelection:!0,noBorderFocus:!0,colModel:[{style:"padding-top:10px;",width:120,render:function(t){return"<div style='border-bottom:"+t.cellData+";'></div>"}},{width:28,skipFocus:!0,minWidth:28,render:function(t){return t.rowData[0]==i?"<span class='ui-icon-check'></span>":""}}],dataModel:{data:[["1px solid"],["2px solid"],["3px solid"],["1px dotted"],["1px dashed"],["3px double"]]},cellClickE:function(t,e){i=e.rowData[0],l.data("style",i),r.find("div").css("border-bottom",i),setTimeout(function(){r.focus(),a.remove(),a=null})},create:function(){this.widget().addClass("pq-bp-style-grid")}},r,w),a.is(":visible")&&pq.focusEle(!1,a)}l.on("click",function(){n=l.data("color")||"#000000",i=l.data("style")||"1px solid",o?o.is(":hidden")?(o.show(),m()):o.hide():(o=t(`<div class="pq-theme pq-border-picker">\n<div style="float:left;width:72%;">\n<div style="display:flex;justify-content: space-between;padding:0 .5em 0;margin-bottom:0.8em;">${p}</div>\n<div style="display:flex;justify-content: space-between;padding:0 .5em 0;">\n ${g}\n</div>\n</div>\n<div style="float:right;width:22%;">\n<div tabindex=0 class="pq-border-0 pq-bp-button pq-bp-style" title = '${u.strBorderStyle}'>\n<div style="border-bottom:${i};"></div>\n<span class='ui-icon-triangle-1-s' style=""></span>\n</div>\n<input type=color value='${n}' class='pq-bp-button' title = '${u.strBorderColor}' />\n</div>\n<div style="clear:both;">\n</div>\n</div>`).appendTo(c),x(".pq-bp-button").on("pq:clickE",function(e){var r=t(e.target).data("border");r&&(s.Selection().border(r,i,n),o.hide(),setTimeout(function(){l.focus()}))}),x("input").pqColorPick({title:u.strBorderColor}).on("change",function(){n=t(this).val(),l.data("color",n)}),r=x(".pq-bp-style").on("pq:clickE",y),pq.makePopup(o[0],l[0],{onPopupRemove:v,noCloseSelector:".pq-color-picker,.pq-bp-style-grid"}),m()),o.is(":visible")&&pq.focusEle(!1,o)})}}(jQuery),function(t){var e=pq.cVirtual=function(){this.diffH=0,this.diffV=0};e.setSBDim=function(){var e=t("<div style='max-width:100px;height:100px;position:fixed;left:0;top:0;overflow:auto;visibility:hidden;'><div style='width:200px;height:100px;'></div></div>").appendTo(document.body),n=e[0];this.SBDIM=n.offsetHeight-n.clientHeight,e.remove()},e.prototype={setTblDims:function(t){var e,n=this,r=n.isBody(),i=n.getTopSafe(this[t?"cols":"rows"],t,!0),o=n.maxHt;i>o?(n[t?"ratioH":"ratioV"]=i/o,n[t?"virtualWd":"virtualHt"]=i,i=o):(i=i||(n.isHead()?0:1),n[t?"ratioH":"ratioV"]=1);var a=n.$tbl_right[0],l=n[t?"$tbl_tr":"$tbl_left"],s=l.length?l[0]:{style:{}},c=t?"width":"height";a.style[c]=i+"px",s.style[c]=i+"px",e=r?"Tbl":n.isHead()?"TblHead":"TblSum",t?(n.$spacerRight.css(n.rtl,i),r&&n.$spacerRR.css(n.rtl,i)):r&&(n.$spacerLB.css("top",i),n.$spacerRB.css("top",i)),n.dims[t?"wd"+e:"ht"+e]=i,r&&n.triggerTblDims(100)},calInitFinal:function(t,e,n){var r,i,o,a=this[n?"cols":"rows"],l=this[n?"freezeCols":"freezeRows"],s=l,c=this[n?"leftArr":"topArr"],d=this.getTopSafe(s,n);if(0==this.that.options[n?"virtualX":"virtualY"])return[s,a-1];if(s==a)return[0,s-1];if(n&&(d-=this.numColWd),t+=d,e+=d,s<a&&c[s]<t){for(var u,h=30,f=a;h--;)if(c[u=Math.floor((s+f)/2)]>=t)f=u;else{if(s==u){o=!0;break}s=u}if(!o)throw"ri not found"}for(;s<=a;s++)if(c[s]>t){r=s&&s>l?s-1:s;break}for(;s<=a;s++)if(c[s]>e){i=s-1;break}return null==r&&null==i&&a&&t>c[a-1]?[null,null]:(null==r&&(r=0),null==i&&(i=a-1),[r,i])},calInitFinalSuper:function(){var t=this,e=this.dims||{},n=t.calcTopBottom(),r=n[0],i=n[1],o=n[2],a=t.calcTopBottom(!0),l=a[0],s=a[1],c=t.calInitFinal(r,i),d=c[0],u=c[1],h=t.calInitFinal(l,s,!0),f=h[0],p=h[1];return this.isBody()&&(e.bottom=i,e.top=r,e.left=l,e.right=s),[d,f,u,p,o=o||a[2]]},calcTopBottom:function(n){var r,i,o=this,a=o.isBody(),l=o.dims,s=o.virtualWin,c=o.$cright,d=c[0];if(n)var u=pq.scrollLeft(d),h=o.sleft,f=l.wdCont,p=o.wdContLeft,g=o.ratioH;else s&&(q=t(window).scrollTop()-c.offset().top),u=s?o._calcTop(d,q):d.scrollTop,h=o.stop,f=o.htCont,p=o.htContTop,g=o.ratioV;if(u=u<0?0:u,1==g)return i=u+f-p,(i=n||!s?i:o._calcBot(u,i,q))>=0||(i=0),[u,i];var m,v,w,x=e.maxHt,y=o[n?"virtualWd":"virtualHt"],b=n?l.wdContClient:l.htContClient,C=n?"diffH":"diffV",q=o[C];if(u+b>=x?r=(i=y-p+(f-b))-f+p:i=(r=0==u?0:u*(m=null==h||Math.abs(u-h)>f?g:1)+(1==m&&q?q:0))+f-p,(v=r-u)!=q&&(w=!0,o[C]=v,a&&o.triggerTblDims(3e3)),o[n?"sleft":"stop"]=u,!(u>=0))throw"stop NaN";if(!(i>=0&&r>=0))throw"top bottom NaN";return[r,i,w]},_calcTop:function(t,e){return t.scrollTop+(e>0?e:0)},_calcBot:function(e,n,r){var i=e+t(window).height()+(r<0?r:0);return i<n?i:n},getHtDetail:function(t,e){var n=(t||{}).pq_detail;return n&&n.show?n.height||e:0},getTop:function(t,e){var n=this.topArr[t],r=e?0:this.diffV;if(r&&(n-=t>this.freezeRows?r:0)<0&&(n=0),n>=0)return n;throw n},getTopSafe:function(t,e,n){var r=e?this.cols:this.rows;return this[e?"getLeft":"getTop"](t>r?r:t,n)},getLeft:function(t,e){var n=this.numColWd,r=this.leftArr,i=r.length-1,o=t>i?i:t,a=-1==o?0:r[o]+n,l=e?0:this.diffH;if(l&&(a-=o>this.freezeCols?l:0)<0&&(a=0),a>=0)return a;throw a},getHeightR:function(t,e){e=e||1;var n=this.topArr,r=n[t+e]-n[t];if(r>=0)return r;throw r},getHeightCell:function(t,e){e=e||1;var n,r,i=this.topArr,o=this.rowHtDetail;if(n=o?this.getHtDetail(this.data[t+e-1],o):0,(r=i[t+e]-i[t]-n)>=0)return r;throw r},getHeightCellM:function(t,e){return this.getTopSafe(t+e)-this.getTop(t)},getHeightCellDirty:function(t,e){return this.setTopArr(t,null,t+e),this.getHeightCellM(t,e)},getWidthCell:function(t){if(-1==t)return this.numColWd;var e=this.colwdArr[t];if(e>=0)return e;throw e},getWidthCellM:function(t,e){return this.getTopSafe(t+e,!0)-this.getLeft(t)},initRowHtArr:function(){var t,e=this.rowHt,n=this.data,r=n.length,i=this.rowHtDetail,o=this.rowhtArr=new Uint16Array(r),a=(this.topArr=new Uint32Array(r+1),0);if(i)for(;a<r;a++)t=n[a],o[a]=t?t.pq_hidden?0:t.pq_ht||e+this.getHtDetail(t,i):e;else for(;a<r;a++)t=n[a],o[a]=t?t.pq_hidden?0:t.pq_ht||e:e},initRowHtArrDetailSuper:function(t){var e,n=this.rowhtArr,r=this.data;t.forEach(function(t){e=t[0],n[e]=r[e].pq_ht=n[e]+t[1]}),this.setTopArr(),this.setTblDims()},initRowHtArrSuper:function(){this.initRowHtArr(),this.setTopArr(),this.setTblDims()},refreshRowHtArr:function(t,e){var n=this.data[t],r=this.rowHtDetail,i=this.rowHt;this.rowhtArr[t]=n.pq_hidden?0:i+this.getHtDetail(n,r),e&&(this.setTopArr(t),this.setTblDims())},setTopArr:function(t,e,n){var r,i,o,a,l,s=t||0,c=this;for(e?(i=c.cols,a=c.colwdArr,l=c.leftArr):(i=c.rows,a=c.rowhtArr,l=c.topArr),o=n&&n<i?n:i-1,r=s?l[s]:0;s<=o;s++)l[s]=r,r+=a[s];l[s]=r},triggerTblDims:function(t){var e=this;e.setTimer(function(){e.that._trigger("setTblDims")},"setTblDims",t)}}}(jQuery),jQuery(document).one("pq:ready",function(){var t=pq.cVirtual;t.maxHt=5e6,t.setSBDim()}),function(t){pq.cRender=function(){this.data=[]},pq.cRender.prototype=t.extend({},{_m:function(){},autoHeight:function(t){var e=this,n=e.that,r=e.isBody(),i=t.hChanged,o=e.freezeRows,a=!1,l=e.initV,s=e.finalV;e.rows&&(r&&n._trigger("beforeAutoRowHeight"),a=e.setRowHtArr(l,s,i),(a=e.setRowHtArr(0,o-1,i)||a)?(e.setTopArr(o?0:l),e.setTblDims(),e.setPanes(),e.setCellDims(!0),r&&(t.source="autoRow",e.refresh(t),n._trigger("autoRowHeight"))):e.setCellDims(!0))},autoWidth:function(t){t=t||{};var e=this,n=e.freezeCols,r=t.colIndx,i=function(t){r.indexOf(t)>=0&&e.setColWdArr(t,t)},o=e.initH,a=e.finalH,l=a;if(r){for(;l>=o;l--)i(l);for(l=n-1;l>=0;l--)i(l)}else e.setColWdArr(o,a),e.setColWdArr(0,n-1)},_each:function(t,e,n,r,i,o){for(var a,l=this.jump,s=0;s<=n;s++)(a=r[s=l(e,o,s)]||{})[i]||t.call(this,a,s)},eachV:function(t){var e=this;e._each(t,e.initV,e.finalV,e.data,"pq_hidden",e.freezeRows)},eachH:function(t){var e=this;e._each(t,e.initH,e.finalH,e.colModel,"hidden",e.freezeCols)},saveValues:function(t){var e,n=[],r=this,i="value"==t;return r.eachV(function(t,o){n[o]=[],r.eachH(function(a,l){e=i?r.objCell(t,a.dataIndx):r.generateCell(o,l,t,a,r.getCellRegion(o,l),r.getHeightCell(o),!0),n[o][l]=e})}),n},objCell:(t,e)=>({val:t[e],prop:t.pq_cellprop?.[e],style:t.pq_cellstyle?.[e],attr:t.pq_cellattr?.[e]}),dirtyCells:function(t,e){var n,r,i=[],o=this,a="value"==e,l=["val","prop","attr","style"];return o.eachV(function(e,s){n=o.getHeightCell(s),o.eachH(function(c,d){r=a?o.objCell(e,c.dataIndx):o.generateCell(s,d,e,c,o.getCellRegion(s,d),n,!0),t[s]&&!((t,e)=>{if("object"==typeof t){for(let n of l)if(t[n]!==e[n])return!1;return!0}return t===e})(t[s][d],r)&&i.push([s,d,e,c])})}),i},generateCell:function(t,e,n,r,i,o,a){var l,s,c,d,u,h,f,p,g=this,m=g.iMerge,v=["role="+(g.isHead()&&n.length?"columnheader aria-sort=none":"gridcell"),"aria-colindex="+(e+1)],w=[],x=g.riOffset,y=t+x,b=[g.cellCls];if(g._m()&&(p=m.ismergedCell(y,e))){let i=p.o_rc,a=p.o_cc;if(!i)return t==g._initV||e==g._initH?(u=g.getCellRegion(t,e),s=(d=m.getRootCell(y,e)).v_ri-x,c=d.v_ci,s<0||(h=g.getCellRegion(s,c),g.mcLaid[s+","+c+(h==u?"":","+u)]=!0),""):"";(d=m.getClsStyle(y,e)).style&&w.push(d.style),d.cls&&b.push(d.cls),t=(y=p.o_ri)-x,n=g.data[t],e=p.o_ci,r=g.colModel[e],o=g.getHeightCellM(t,i),l=g.getWidthCellM(e,a),i>1&&v.push("aria-rowspan="+i),a>1&&v.push("aria-colspan="+a),b.push("pq-merge-cell")}else if(n.pq_hidden||r.hidden)return"";if(f=g.getCellId(t,e,i),!a&&g.getById(f))return"";var C=o||g.getHeightCell(t),q=l||g.colwdArr[e],I=g.getLeft(e);return w.push(g.rtl+":"+I+"px;width:"+q+"px;height:"+C+"px;"),v.push("id="+f),g.renderCell({style:w,cls:b,attr:v,rowData:n,rowIndxPage:t,rowIndx:y,colIndx:e,dataIndx:r.dataIndx,column:r})},generateRow:function(t,e){var n="pq-grid-row",r="top:"+this.getTop(t)+"px;height:"+this.getHeightR(t)+"px;width:100%;",i=this.getRowId(t,e),o=this.that,a=t+1;this.isHead()||(a+=o.iRenderHead.data.length,this.isSum()&&(a+=o.iRenderB.data.length));let l="role=row id="+i+" aria-rowindex="+a,s=this.getRowClsStyleAttr(t),c=this.iGroupTree;if(c){let e=this.data[t],n=e.pq_level;e.pq_gsummary||null==n&&(n=c.getParent(e)?.pq_level,null!=n&&(n++,l+=` aria-level=${n+1}`,c.isFolder(e)&&(l+=` aria-expanded='${!c.isCollapsed(e)}'`)))}return n+=" "+s[0],l+=" "+s[1],"<div class='"+n+"' "+l+" style='"+r+"'>"},getById:function(t){return document.getElementById(t)},getCell:function(t,e,n){var r,i,o=this.riOffset,a=t+o;return n||(r=this.iMerge).ismergedCell(a,e)&&(i=r.getRootCell(a,e),this.isHead()&&(t=i.o_ri,e=i.o_ci),n=this.getCellRegion(i.v_ri-o,i.v_ci)),this.getById(this.getCellId(t,e,n))},getCellIndx:function(t){var e=t.id.split("-");if(e[3]=="u"+this.uuid)return""==e[5]?[1*e[4],-1,e[7]]:[1*e[4],1*e[5],e[6]]},getCellId:function(t,e,n){return t>=this.data.length?"":(n=n||this.getCellRegion(t,e),this.cellPrefix+t+"-"+e+"-"+n)},getCellCont:function(t,e){return this["$c"+this.getCellRegion(t,e)]},getCellCoords:function(t,e){var n,r=this,i=r.maxHt,o=r.riOffset,a=t+o,l=t,s=e;r.isBody()&&(l=(n=r.that.iMerge.inflateRange(a,e,a,e))[2]-o,s=n[3]);var c=r.getTop(t),d=r.getTop(l)+r.getHeightCell(l),u=r.getLeft(e),h=r.getLeft(s+1);return d>i&&(c-=d-i,d=i),h>i&&(u-=h-i,h=i),[u,c,h,d]},getCellRegion:function(t,e){var n=this.freezeCols;return t<this.freezeRows?e<n?"lt":"tr":e<n?"left":"right"},getCellXY:function(t,e){var n=this.maxHt;return[Math.min(this.getLeft(e),n),Math.min(this.getTop(t),n)]},getContRight:function(){return this.$cright},getMergeCells:function(){return this._m()?this.$tbl.children().children(".pq-merge-cell"):t()},getRow:function(t,e){return this.getById(this.getRowId(t,e))},getAllCells:function(){return this.$ele.children().children().children().children().children(this.isHead()?".pq-grid-col":".pq-grid-cell")},get$Col:function(t,e){var n=["right","left","lt","rt"].map(function(e){return"[id$=-"+t+"-"+e+"]"}).join(",");return(e||this.getAllCells()).filter(n)},get$Row:function(t){return this.$ele.find("[id^="+this.getRowId(t,"")+"]")},getRowClsStyleAttr:function(t){var e,n,r=this,i=r.that,o=r.rowStyle,a=[],l=i.options,s=l.rowInit,c=r.data[t]||{},d=c.pq_rowcls,u=c.pq_rowattr,h=c.pq_rowstyle,f=pq.styleStr,p="",g=[],m=t+r.riOffset;return l.stripeRows&&r.stripeArr[t]&&a.push("pq-striped"),c.pq_rowselect&&a.push(i.iRows.hclass),d&&a.push(d),u&&(p+=i.processAttr(u,g)),h&&g.push(f(h)),s&&(n=s.call(i,{rowData:c,rowIndxPage:t,rowIndx:m}))&&((e=n.cls)&&a.push(e),(e=n.attr)&&(p+=" "+e),(e=n.style)&&g.push(f(e))),g=g.join(""),o[t]=g,[a.join(" "),p]},getRowId:function(t,e){if(null==e)throw"getRowId region.";return this.rowPrefix+t+"-"+e},getRowIndx:function(t){var e=t.id.split("-");return[1*e[4],e[5]]},getTable:function(t,e){return this["$tbl_"+this.getCellRegion(t,e)]},getTblCls:function(t){var e=this.isBody()?[]:["pq-grid-summary-table"];return t.rowBorders&&e.push("pq-td-border-top"),t.columnBorders&&e.push("pq-td-border-right"),t.wrap||e.push("pq-no-wrap"),e.join(" ")},getFlexWidth:function(){return this._flexWidth},preInit:function(e){var n=this,r=n.isBody(),i=n.that,o=i.options,a=i.eventNamespace,l="pq-table "+n.getTblCls(o),s=r&&!o.scrollModel.bigSB?"div-sb":"div",c='<div class="pq-r-spacer" style="position:absolute;top:0;height:10px;"></div>',d=["pq-cont-inner ui-widget-"+(r?"content ":"header "),"pq-cont-right","pq-cont-left","pq-cont-lt","pq-cont-tr"];if(e.empty(),e[0].innerHTML=['<div class="pq-grid-cont">',r?'<div class="pq-grid-norows">'+o.strNoRows+"</div>":"",`<${s} ${r?'tabindex="-1"':""} class="`,d[0]+d[1],`">\n<div class="pq-table-right ${l}"></div>`,r?'<div class="pq-rr-spacer" style="position:absolute;top:0;height:10px;"></div><div class="pq-rb-spacer" style="position:absolute;width:1px;"></div>':c,`</${s}>`,`<div class="${d[0]+d[2]}"><div class="pq-table-left ${l}"></div><div class="pq-lb-spacer" style="position:absolute;width:10px;"></div></div>`,`<div class="${d[0]+d[4]}"><div class="pq-table-tr ${l}"></div>${c}</div>`,'<div class="'+d[0]+d[3]+'"><div class="pq-table-lt '+l+'"></div></div>',"</div>"].join(""),n.$cright=e.find("."+d[1]).on("scroll",n.onNativeScroll.bind(n)),n.virtualWin&&t(window).on("scroll"+a+" resize"+a,n.onNativeScroll.bind(n)),n.$spacerRight=e.find(".pq-r-spacer"),r&&(n.$spacerLB=e.find(".pq-lb-spacer"),n.$spacerRR=e.find(".pq-rr-spacer"),n.$spacerRB=e.find(".pq-rb-spacer")),n.$cleft=e.find("."+d[2]).on("scroll",n.onScrollL.bind(n)),n.$clt=e.find("."+d[3]).on("scroll",n.onScrollLT),n.$ctr=e.find("."+d[4]).on("scroll",n.onScrollT),n.$tbl=e.find(".pq-table").on("scroll",n.onScrollLT),n.$tbl_right=e.find(".pq-table-right"),n.$tbl_left=e.find(".pq-table-left"),n.$tbl_lt=e.find(".pq-table-lt"),n.$tbl_tr=e.find(".pq-table-tr"),r){function u(t){t.on("mousewheel DOMMouseScroll",n.onMouseWheel(n))}u(n.$cleft),u(n.$ctr),n.$norows=e.find(".pq-grid-norows")}},isBody:function(){},isHead:function(){},isSum:function(){},jump:function(t,e,n){return n<t&&n>=e&&(n=t),n},hasMergeCls:function(t){return t&&t.className.indexOf("pq-merge-cell")>=0},initRefreshTimer:function(t){var e=this,n=e.onRefreshTimer(e,t);e.setTimer(n,"refresh")},initStripeArr:function(){for(var t,e,n=this.rows,r=0,i=this.stripeArr=[],o=this.data;r<n;r++)(t=o[r])&&!t.pq_hidden&&(e=i[r]=!e)},isRenderedRow:function(t){return!!this.getRow(t)},onScrollLT:function(){this.scrollTop=this.scrollLeft=0},onScrollT:function(){this.scrollTop=0},onScrollL:function(t){var e=t.target,n=this;pq.scrollLeft(e,0),n.setTimer(function(){n.$cright[0].scrollTop=e.scrollTop},"scrollL",50)},refresh:function(t){t=t||{};var e=this,n=e.that,r=e.isBody(),i=e.isHead(),o=e.mcLaid={},a=e.freezeCols,l=e.numColWd,s=!(!a&&!l),c=e.freezeRows,d=(y=e.calInitFinalSuper())[0],u=y[1],h=y[2],f=y[3],p=t.fullRefresh||y[4],g=e.initV,m=e.finalV,v=e.initH,w=e.finalH;for(var x in p&&r&&n.blurEditor({force:!0}),e._initV=d,e._finalV=h,e._initH=u,e._finalH=f,e._prependCells=e._prependRows=0,r&&n._trigger("beforeTableView",null,{initV:d,finalV:h,pageData:e.data}),p||(null!=m&&h>=g&&d<=m&&(d>g?(e.removeView(g,d-1,v,w),s&&e.removeView(g,d-1,l?-1:0,a-1)):d<g&&(e._prependRows=1,e.renderView(d,g-1,u,f),s&&e.renderView(d,g-1,0,a-1)),h<m?(e.removeView(h+1,m,v,w),s&&e.removeView(h+1,m,l?-1:0,a-1)):h>m&&(e.renderView(m+1,h,u,f),s&&e.renderView(m+1,h,0,a-1)),g=d,m=h),null!=w&&f>v&&u<w&&(u>v?(e.removeView(g,m,v,u-1),c&&e.removeView(0,c-1,v,u-1)):u<v&&(e._prependCells=1,e.renderView(g,m,u,v-1),c&&e.renderView(0,c-1,u,v-1)),f<w?(e.removeView(g,m,f+1,w),c&&e.removeView(0,c-1,f+1,w)):f>w&&(e.renderView(g,m,w+1,f),c&&e.renderView(0,c-1,w+1,f)),v=u,w=f)),p||h!==m||d!==g||u!==v||f!==w?(r&&n._trigger("beforeViewEmpty",null,{region:"right"}),e.$tbl_right.empty(),e.renderView(d,h,u,f),!s||h===m&&d===g||(e.$tbl_left.empty(),e.renderView(d,h,0,a-1)),c&&(u===v&&f===w||(n._trigger("beforeViewEmpty",null,{region:"tr"}),e.$tbl_tr.empty(),e.renderView(0,c-1,u,f)),s&&null==m&&(e.$tbl_lt.empty(),e.renderView(0,c-1,0,a-1)))):e.removeMergeCells(),o){var y,b=1*(y=x.split(","))[0],C=1*y[1],q=y[2];e.renderView(b,b,C,C,q)}var I=u!=e.initH||f!=e.finalH,_=I&&null!=e.initH;(p||h!=e.finalV||d!=e.initV||I)&&(e.initV=d,e.finalV=h,e.initH=u,e.finalH=f,r?n._trigger("refresh",null,{source:t.source,hChanged:_}):n._trigger(i?"refreshHeader":"refreshSum",null,{hChanged:_}))},refreshAllCells:function(t){var e=this;e.initH=e.initV=e.finalH=e.finalV=null,(t=t||{}).fullRefresh=!0,e.refresh(t)},refreshCell:function(e,n,r,i){var o,a=this,l=a.isBody()&&a._m()?a.iMerge.getRootCellV(e+a.riOffset,n):0,s=e,c=n,d=function(l,s){l&&(o=!0,l.id="",t(l).replaceWith(a.generateCell(e,n,r,i,s)))};return l?(e=l.rowIndxPage,n=l.colIndx,r=l.rowData,i=l.column,["lt","tr","left","right"].forEach(function(t){d(a.getCell(s,c,t),t)})):d(a.getCell(e,n)),o},removeMergeCells:function(){for(var e,n,r,i,o,a,l,s,c,d,u=this,h=u.iMerge,f=u.riOffset,p=(u.freezeCols,u.freezeRows,u.getMergeCells()),g=u._initH,m=u._finalH,v=u._initV,w=u._finalV,x=0,y=p.length;x<y;x++)s=p[x],(n=u.getCellIndx(s))&&(r=n[0],i=n[1],c=n[2],o=r+(e=h.getRootCell(r+f,i)).o_rc-1,a=i+e.o_cc-1,l=!1,r>w||i>m?l=!0:"right"==c?(o<v||a<g)&&(l=!0):"left"==c?o<v&&(l=!0):"tr"==c&&a<g&&(l=!0),d=s.parentNode,l&&t(s).remove(),d.children.length||d.parentNode.removeChild(d))},removeView:function(e,n,r,i){var o,a,l,s,c=this.getCellRegion(e,r);for(a=e;a<=n;a++)if(o=this.getRow(a,c)){for(l=r;l<=i;l++)(s=this.getCell(a,l,c))&&(this.hasMergeCls(s)||t(s).remove());o.children.length||o.parentNode.removeChild(o)}},renderNumCell:function(t,e,n){var r=this,i=r.getHeightR(t),o=r.isHead(),a=t+1+r.riOffset,l=r.numberCell,s=l.format;return"<div id='"+r.getCellId(t,-1,n)+"' style='"+("width:"+e+"px;height:"+i+"px;")+"' role='gridcell' class='pq-grid-number-cell '>"+(r.isBody()?s?pq.formatNumber(a,s):a:o&&t==r.data.length-1&&l.title||"")+"</div>"},renderRow:function(e,n,r,i,o,a){var l,s,c,d,u=this.getRow(r,a),h=this.numColWd,f=[],p=this.getHeightCell(r),g=this.colModel;for(!u&&e.push(this.generateRow(r,a)),0!=i||!h||"left"!=a&&"lt"!=a||(d=this.renderNumCell(r,h,a),f.push(d)),c=i;c<=o;c++)(s=g[c])&&!s.hidden&&(d=this.generateCell(r,c,n,s,a,p),f.push(d));l=f.join(""),u?t(u)[this._prependCells?"prepend":"append"](l):e.push(l,"</div>")},renderView:function(t,e,n,r,i){if(null!=n&&null!=r){i=i||this.getCellRegion(t,Math.min(n,r));for(var o,a=[],l=this.data,s=this["$tbl_"+i],c=t;c<=e;c++)(o=l[c]||{}).pq_hidden||null==this.rowhtArr[c]||this.renderRow(a,o,c,n,r,i);s[this._prependRows?"prepend":"append"](a.join(""))}},scrollX:function(t,e){var n=this.$cright[0];if(null==t)return pq.scrollLeft(n);this.scrollXY(t,n.scrollTop,e)},setCellDims:function(t){var e,n=this,r=n.rtl,i=n.iMerge,o=n._m(),a=n.colModel,l=n.numColWd,s=n.jump,c=n.setRowDims(),d=n.riOffset,u=n.initH,h=n.finalH,f=n.freezeCols;n.eachV(function(p,g){var m,v=n.get$Row(g),w=n.getHeightR(g),y=n.getTop(g),b=n.getHeightCell(g);c(v,w,y);for(var C=l?-1:0;C<=h;C++)((C=s(u,f,C))<0||!a[C].hidden)&&(o&&(x=i.ismergedCell(g+d,C))||(m=n.getCell(g,C))&&((e=m.style).height=(-1==C?w:b)+"px",t||(e.width=n.getWidthCell(C)+"px",e[r]=n.getLeft(C)+"px")))});for(var p=n.getMergeCells(),g=0,m=p.length;g<m;g++){var v=p[g],w=n.getCellIndx(v);if(w){var x,y=w[0],b=w[1],C=(x=i.getRootCell(y+d,b)).v_ri-d,q=n.get$Row(C),I=n.getHeightR(C),_=n.getHeightCellM(y,x.o_rc),R=n.getTop(C);c(q,I,R),(e=v.style).height=_+"px",t||(e.width=n.getWidthCellM(b,x.o_cc)+"px",e[r]=n.getLeft(b)+"px")}}},setRowDims:function(){return function(t,e,n){var r={height:e,width:"100%"};r.top=n,t.css(r)}},setColWdArr:function(e,n){var r,i,o,a,l,s,c,d,u,h,f=n,p=this,g=p.riOffset,m=p.jump,v=p.colModel,w=p.data,x=p.freezeRows,y=p.maxHt+"px",b=p.iMerge,C=p.initV,q=p.isBody(),I=p.isSum(),_=q||I,R=p.isHead()?p.that.headerCells.length-1:p.finalV;if(R>=0)for(;f>=e;f--)if(!(i=v[f]).hidden&&-1==(i.width+"").indexOf("%")&&(s=_?i.width:i._minWidth)){for(r=0;r<=R;r++)if((a=w[r=m(C,x,r)])&&!a.pq_hidden){if(c=!0,d=b.ismergedCell(r+g,f)){if(1==d)continue;if((d=b.getRootCell(r+g,f)).v_rc>1||d.v_cc>1){if(d.v_cc>1)continue;c=!1}o=p.getCell(d.o_ri-g,d.o_ci)}else o=p.getCell(r,f);o&&(o.parentNode.style.width=y,c&&(o.style.width="auto",(u=t(o).find(".pq-icon-menu,.pq-icon-filter")).length&&(u.css({position:"static",float:"left",width:20}),(h=t(o).find(".pq-td-div")).css("width","auto"))),l=o.offsetWidth+1,c&&u.length&&(u.css({position:"",float:"",width:""}),h.css("width","")),s=Math.max(l,s))}if(!(s>0))throw"wd NaN";i.width=p.colwdArr[f]=s,i._resized=!0}},setRowHtArr:function(t,e,n){for(var r,i,o,a,l,s,c,d,u,h,f=e,p=this,g=p.jump,m=p.riOffset,v=p.rowhtArr,w=p.data,x=p.colModel,y=p._m(),b=p.diffV,C=p.freezeCols,q=p.rowHt,I=p.iMerge,_=p.rowHtDetail,R=p.initH,D=p.finalH;f>=t;f--)if((a=w[f])&&!a.pq_hidden&&!a.pq_htfix){for(h=_?p.getHtDetail(a,_):0,c=n?v[f]-h:q,r=0;r<=D;r++)if(!x[r=g(R,C,r)].hidden){if(d=y&&I.ismergedCell(f+m,r)){if(1==d||b)continue;d=I.getRootCell(f+m,r),l=p.getCell(d.o_ri-m,d.o_ci)}else l=p.getCell(f,r);l&&(l.style.height="auto",s=l.offsetHeight,d&&(u=d.o_rc-(d.v_ri-d.o_ri)-1,s-=d.v_rc>1?p.getHeightCellDirty(d.v_ri-m+1,u):0),c=Math.max(s,c))}o=c+h,v[f]!=o&&(v[f]=a.pq_ht=o,i=!0)}return i},setTimer:function(t){var e={};return!0===t?function(t){t()}:function(t,n,r){clearTimeout(e[n]);var i=this;e[n]=setTimeout(function(){i.that.element&&t.call(i)},r||300)}}},new pq.cVirtual)}(jQuery),function(t){pq.cRenderBody=function(t,e){var n=this,r=n.uuid=t.uuid,i=t.options,o=n.$ele=e.$b,a=n.$sum=e.$sum,l=n.$h=e.$h,s=i.detailModel,c=s.height,d=i.postRenderInterval;n.that=t,n.iGroupTree=i.treeModel.dataIndx?t.iTree:i.groupModel.on?t.iGroup:0,n.rowStyle=[],n.rtl=i.rtl?"right":"left",n.isRTL=i.rtl,n.virtualWin=i.virtualWin,n.setTimer=n.setTimer(r),n.cellPrefix="pq-body-cell-u"+r+"-",n.rowPrefix="pq-body-row-u"+r+"-",n.cellCls="pq-grid-cell",n.iMerge=t.iMerge,n.rowHt=t.getEM(i.rowHt),n.rowHtDetail=s.init?"auto"==c?1:c:0,n.iRenderHead=t.iRenderHead=new pq.cRenderHead(t,l),n.iRenderSum=t.iRenderSum=new pq.cRenderSum(t,a),t.on("headHtChanged",n.onHeadHtChanged(n)),null!=d&&t.on("refresh refreshRow refreshCell refreshColumn",function(){d<0?n.postRenderAll():n.setTimer(n.postRenderAll,"postRender",d)}),n.preInit(o),t.on("refresh softRefresh",n.onRefresh.bind(n))},pq.cRenderBody.prototype=t.extend({},new t.paramquery.cGenerateView,new pq.cRender,{setHtCont:function(t){this.dims.htCont=t,this.$ele.css("height",t)},flex:function(t){var e=this,n=e.that;!1!==n._trigger("beforeFlex",null,t)&&(e.iRenderHead.autoWidth(t),e.iRenderSum.autoWidth(t),e.autoWidth(t),n.refreshCM(null,{flex:!0}),n.refresh({source:"flex",soft:!0}))},init:function(t){t=t||{};var e,n,r=this,i=r.that,o=t.soft,a=!o,l=t.source,s=r.iRenderHead,c=r.iRenderSum,d=i.options,u=d.scrollModel,h=(r.freezeCols=d.freezeCols||0,r.freezeRows=d.freezeRows,r.numberCell=d.numberCell),f=r.colModel=i.colModel;r.width=d.width,r.height=d.height;a&&(r.dims=i.dims,r.autoFit=u.autoFit,r.pauseTO=u.timeout,e=(n=i.pdata||[]).findIndex(function(t){return!t||!t.pq_hidden}),r.$norows.css("display",e>=0?"none":""),r.data=n,r.maxHt=pq.cVirtual.maxHt,r.riOffset=i.riOffset,r.cols=f.length,r.rows=n.length,i._mergeCells&&(r._m=function(){return!0}),r.autoRow=d.autoRow,t.skipIndx&&(r.rowhtArr||[]).length==r.rows||(r.initRowHtArrSuper(),d.stripeRows&&r.initStripeArr())),r.refreshColumnWidths(),r.numColWd=s.numColWd=c.numColWd=h.outerWidth,r.initColWdArrSuper(),c.init(t),t.header?s.init(t):(s.setCellDims(),s.setTblDims(!0),s.setPanes(),s.refreshResizeColumn()),c.initPost(t),t.header&&s.initPost(t),r.$cright[0].scrollTop>r.getTop(r.rows)||(a?r.refreshAllCells({source:l}):o&&(r.setCellDims(),r.refresh({source:l}),i._trigger("softRefresh")))},initColWdArr:function(){for(var t,e=this.colModel,n=e.length,r=(this.leftArr=this.iRenderHead.leftArr=this.iRenderSum.leftArr=[],0),i=this.colwdArr=this.iRenderHead.colwdArr=this.iRenderSum.colwdArr=[];r<n;r++)t=e[r],i[r]=t.hidden?0:t._width},initColWdArrSuper:function(){this.initColWdArr(),this.setTopArr(0,!0),this.setTblDims(!0)},inViewport:function(t,e,n){n=n||this.getCell(t,e);var r=this.dims,i=r.left-2,o=r.right-(r.wdCont-r.wdContClient)+2,a=r.top-2,l=r.bottom-(r.htCont-r.htContClient)+2,s=this.getCellRegion(t,e),c=n.parentNode,d=pq.offsetLeft(n,this.isRTL)-r.wdContLeft,u=c.offsetTop-r.htContTop,h=d+n.offsetWidth,f=u+n.offsetHeight;return"right"==s?d>i&&h<o&&u>a&&f<l:"tr"==s?d>i&&h<o:"left"!=s||u>a&&f<l},isBody:function(){return!0},onHeadHtChanged:function(t){return function(e,n){t.setPanes()}},onMouseWheel:function(t){var e;return function(t){var n=this;n.style["pointer-events"]="none",clearTimeout(e),e=setTimeout(function(){n.style["pointer-events"]=""},300)}},onNativeScroll:function(){var t=this,e=t.$cright[0],n=t.that,r=e.scrollLeft,i=e.scrollTop;n.element[0].offsetWidth&&(t.iRenderSum.setScrollLeft(r),t.iRenderHead.setScrollLeft(r),t.$cleft[0].scrollTop=i,t.$ctr[0].scrollLeft=r,t.refresh(),n._trigger("scroll"),t.setTimer(function(){n._trigger("scrollStop")},"scrollStop",t.pauseTO))},onRefresh:function(t,e){"autoRow"!=e.source&&this.initRefreshTimer(e.hChanged)},onRefreshTimer:function(t,e){return function(){var n=t.$cright[0];t.autoRow&&t.autoHeight({hChanged:e}),n.scrollTop=n.scrollTop,n.scrollLeft=n.scrollLeft}},pageDown:function(e,n){var r,i=this,o=i.topArr,a=o[e],l=e,s=i.dims,c=this.$cright[0].scrollTop,d=95*Math.min(s.htContClient-s.htContTop,t(window).height())/100,u=a+d,h=e,f=o.length-1;i.scrollY(c+d,function(){for(h=e<i.initV?i.initV:e;h<=f;h++)if((r=o[h])>a&&(a=r,l=h-1),r>u){l=h-1;break}n(l)})},pageUp:function(e,n){for(var r,i=this,o=i.topArr,a=o[e],l=this.$cright[0].scrollTop,s=i.dims,c=9*Math.min(t(window).height(),s.htContClient-s.htContTop)/10,d=a-c,u=e,h=e;h>=0;h--)if((r=o[h])<a&&(a=r,u=h),r<d){u=h;break}i.scrollY(l-c,function(){n(u)})},postRenderAll:function(){var t,e,n,r=this,i=r.that,o=r.riOffset,a=r.iMerge,l=r.data;r.colModel;r.eachH(function(l,s){(n=l.postRender)&&r.eachV(function(l,c){e=a.getRootCellO(c+o,s,!0),(t=r.getCell(e.rowIndxPage,e.colIndx))&&!t._postRender&&(e.cell=t,i.callFn(n,e),t._postRender=!0)})}),(n=r.numberCell.postRender)&&r.eachV(function(t,e){var a=r.getCell(e,-1),s=e+o,c={rowIndxPage:e,colIndx:-1,rowIndx:s,rowData:l[s]};a&&!a._postRender&&(c.cell=a,i.callFn(n,c),a._postRender=!0)})},refreshRow:function(t){var e,n,r=this,i=r.initH,o=r.finalH,a=r.freezeCols,l=r.get$Row(t),s=[];l.each(function(t,e){var n=r.getRowIndx(e);s.push(n[1])}),r.that._trigger("beforeViewEmpty",null,{rowIndxPage:t}),l.remove(),s.forEach(function(l){"left"==l||"lt"==l?(e=0,n=a-1):(e=i,n=o),r.renderView(t,t,e,n,l)})},newScrollPos:function(e,n){var r,i,o,a,l,s=this,c=s.dims,d=c[n?"wdContClient":"htContClient"],u=n?"scrollLeft":"scrollTop",h=s.$cright[0],f=s[n?"colModel":"data"].length,p=s[n?"freezeCols":"freezeRows"],g=pq[u](h),m=c[n?"wdContLeft":"htContTop"];if(e<p||e>f-1)return g;var v=s.getTopSafe(e,n),w=s[n?"getWidthCell":"getHeightR"](e);return null!=v?(!n&&s.virtualWin&&(l=(a=t(window)).scrollTop(),(o=(i=v-g+t(h).offset().top-l)-a.height())>=0?a.scrollTop(l+o+w):i<0&&a.scrollTop(l+i)),v+w+1>g+d?v<(r=v+w+1-d)+m&&(r=v-m):v<g+m&&(r=v-m),(r=r<0?0:r)>=0?r:g):void 0},scrollColumn:function(t,e){var n=this.newScrollPos(t,!0);this.scrollX(n,e)},scrollRow:function(t,e){var n=this.newScrollPos(t);this.scrollY(n,e)},scrollCell:function(t,e,n){var r=this.newScrollPos(t),i=this.newScrollPos(e,!0);this.scrollXY(i,r,n)},scrollY:function(t,e){var n=this.$cright[0];if(null==t)return n.scrollTop;t=t>=0?t:0,this.scrollXY(pq.scrollLeft(n),t,e)},scrollXY:function(t,e,n){var r,i,o=this.$cright[0],a=this.that,l=o.scrollLeft,s=o.scrollTop;if(null==t)return[l,s];pq.scrollLeft(o,t,this.isRTL),o.scrollTop=e,r=o.scrollLeft,i=o.scrollTop,n&&(r==l&&i==s?n():a.one("scroll",function(){r==l?n():a.one("scrollHead",n)}))},getSBHt:function(t){var e=this.dims,n=this.that.options,r=pq.cVirtual.SBDIM;return this.autoFit?this.canAutoFit()?0:r:("flex"!=this.width||n.maxWidth)&&t>e.wdCenter+r?r:0},getSBWd:function(){var t=this.dims,e=this.that.options.hideVScroll;return!t.htCenter||e&&t.htCenter>(t.htTblHead||0)+t.htTbl+t.htTblSum?0:pq.cVirtual.SBDIM},setPanes:function(){var t,e,n,r,i=this,o=i.that.options,a=i.autoFit&&i.canAutoFit(),l=i.dims,s=l.htCenter-l.htHead-l.htSum,c=l.wdCenter,d=i.$ele,u=i.freezeCols,h=i.freezeRows,f=i.$cright,p=f[0],g=i.$cleft,m=i.$clt,v=i.$ctr,w=i.getLeft(u),x=pq.cVirtual.SBDIM,y=l.wdTbl,b=Math.max(l.htTbl,30)+i.getSBHt(y),C=p.init,q=i.getTopSafe(h);C&&p.init(w,q,x),v.css("display",h?"":"none"),g.css("display",w?"":"none"),m.css("display",w&&h?"":"none"),f.css("overflow-y",""),"flex"==i.height?(s>0&&b>s?b=Math.min(b,s):f.css("overflow-y","hidden"),i.setHtCont(b)):i.setHtCont(s),a&&i.getSBWd()&&f.css("overflow-y","scroll"),f.css("overflow-x",a?"hidden":""),"flex"==i.width?(y=parseInt(d[0].style.height)>=l.htTbl-1?y:y+x,o.maxWidth&&y>c?y=Math.min(y,c):f.css("overflow-x","hidden"),i._flexWidth=y,d.width(i._flexWidth)):d.css("width",""),i.htCont=l.htCont=f.height(),i.wdCont=l.wdCont=f.width(),l.htContClient=r=p.clientHeight,l.wdContClient=t=p.clientWidth,w>t&&(f.css("overflow-x","hidden"),w=t),e=p.offsetWidth,n=p.offsetHeight,g.css("width",w),m.css("width",w),v.width(C?e:t),g.height(C?n:r);var I=C?x:e-t;if(["iRenderHead","iRenderSum"].forEach(t=>{i[t].setSpacerWidth(I)}),i.$spacerRight.width(I),C&&i.$spacerLB.height(n-r),q>r&&(f.css("overflow-y","hidden"),q=r),m.css("height",q),v.css("height",q),i.wdContLeft=l.wdContLeft=g.width(),i.htContTop=l.htContTop=v.height(),!x&&!C){let e;f.off("scroll.pq-edges").on("scroll.pq-edges",n=>{clearTimeout(e),v.width(t-13),g.height(r-13),e=setTimeout(e=>{v.width(t),g.height(r)},2e3)})}}},new pq.cVirtual)}(jQuery),function(t){function e(t){this.that=t}jQuery.paramquery.cMergeHead=e,e.prototype={getRootCell:function(t,e){for(var n=this.that,r=n.headerCells,i=r[t][e],o=i.rowSpan,a=i.leftPos;t&&r[t-1][a]==i;)t--;return{v_ri:t,o_ri:t,v_ci:n.getNextVisibleCI(a),o_ci:a,v_rc:o,o_rc:o,v_cc:i.colSpan,o_cc:i.o_colspan}},ismergedCell:function(t,e){var n,r,i,o=this.that,a=o.headerCells,l=a[t],s=l?l[e]:"";if(s)if(n=s.leftPos,0!=t&&a[t-1][e]===s||o.getNextVisibleCI(n)!=e){if(s.colSpan>1||s.rowSpan>1)return!0}else if(r=s.rowSpan,i=s.colSpan,r&&i&&(r>1||i>1))return{o_ri:t,o_ci:n,v_rc:r,o_rc:r,v_cc:i,o_cc:s.o_colspan}},getClsStyle:function(){return{}}}}(),function(t){pq.cRenderHS=t.extend({},new pq.cRender,{init:function(t){t=t||{};var e,n=this,r=n.that,i=r.options,o=n.colModel=r.colModel,a=n.isHead(),l=n.isSum(),s=a?i.autoRowHead:i.autoRowSum,c=r.headerCells,d=i.filterModel.header;n.freezeCols=i.freezeCols||0,n.numberCell=i.numberCell,n.width=i.width,n.height="flex",n.freezeRows=0,n.dims=r.dims,a?e=n.data=i.showHeader?d?c.concat([[]]):c:d?[[]]:[]:l&&(e=n.data=i.summaryData||[]),n.maxHt=pq.cVirtual.maxHt,n.riOffset=0,n.cols=o.length,n.rows=e.length,a?c.length>1&&(n._m=function(){return!0}):i.stripeRows&&n.initStripeArr(),n.autoRow=s??i.autoRow,n.initRowHtArrSuper(),n.setTblDims(!0),n.setPanes()},initPost:function(t){var e=this;e.data.length&&(t||{}).soft?(e.setCellDims(),e.refresh()):e.refreshAllCells()},onNativeScroll:function(){var t=this;t.refresh(),t.isHead()&&t.that._trigger("scrollHead")},onRefresh:function(t,e){this.initRefreshTimer(e.hChanged)},refreshHS:function(){this.init(),this.initPost()},setPanes:function(){var t=this,e=t.that,n=t.dims,r=t.$ele,i=t.freezeCols,o=t.$cright,a=o[0],l=t.$cleft,s=t.getLeft(i),c=t.isHead(),d=t.isSum(),u=t.getTopSafe(t.rows);t.data.length;l.css("display",s?"":"none"),r.height(u),c?(n.htHead=u,e._trigger("headHtChanged")):d&&(n.htSum=u,e._trigger("headHtChanged")),t.htCont=o.height(),t.wdCont=o.width(),l.css("width",s),l.height(a.clientHeight),t.wdContLeft=l.width(),t.htContTop=0},setScrollLeft:function(t){var e=this.$cright;e&&this.scrollLeft!==t&&(this.scrollLeft=e[0].scrollLeft=t)},setSpacerWidth:function(t){this.$spacerRight.width(t)}})}(jQuery),function(t){var e=t.paramquery;(pq.cRenderHead=function(t,n){var r=t.options,i=this,o=i.uuid=t.uuid;i.that=t,i.iMerge=new e.cMergeHead(t),i.$ele=n,i.height="flex",i.scrollTop=0,i.rtl=r.rtl?"right":"left",i.rowHt=t.getEM(r.rowHtHead),i.cellCls="pq-grid-col",i.setTimer=i.setTimer(!0),i.cellPrefix="pq-head-cell-u"+o+"-",i.rowPrefix="pq-head-row-u"+o+"-",i.preInit(n),(t.$head_i=n.children(".pq-grid-cont")).on("click",i.onHeaderClick.bind(i)),t.on("headerKeyDown",i.onHeaderKeyDown.bind(i)).on("refreshHeader softRefresh",i.onRefresh.bind(i))}).prototype=t.extend({},pq.cRenderHS,e.mixHeader,e.mixHeaderFilter,{getRowClsStyleAttr:function(t){var e=this.that.headerCells.length,n="";return t==e-1?n="pq-grid-title-row":e==t&&(n="pq-grid-header-search-row"),[n,"",""]},getTblCls:function(t){var e="pq-grid-header-table";return t.hwrap?e:e+" pq-no-wrap"},isHead:function(){return!0},onRefreshTimer:function(t,e){return function(){var n=t.$cright[0];t.autoRow&&t.autoHeight({timer:!1,hChanged:e}),n.scrollTop=0,n.scrollLeft=n.scrollLeft,t.onCreateHeader(),t.refreshResizeColumn(),t.setSortIcons(),t.that._trigger("refreshHeadAsync")}},_resizeId:function(t){return"pq-resize-div-"+this.uuid+"-"+t},_resizeCls:function(){return"pq-resize-div-"+this.uuid},_resizeDiv:function(t){return this.getById(this._resizeId(t))},refreshResizeColumn:function(){var t,e,n,r,i=this.initH,o=this.colModel,a=this._resizeCls(),l=this.finalH,s=this.numberCell,c=this.freezeCols,d=[],u=[],h=s.show?-1:0;for(this.$ele.find("."+a).remove();h<=l;h++){if(h>=i)e=u;else{if(!(h<c))continue;e=d}(t=h>=0?o[h]:s).hidden||!1===t.resizable||this._resizeDiv(h)||(n=this.getLeft(h+1)-5,r=this._resizeId(h),e.push("<div aria-hidden=true id='",r,"' pq-col-indx='",h,"' style='",this.rtl,":",n,"px;'"," class='pq-grid-col-resize-handle "+a+"'>&nbsp;</div>"))}d.length&&this.$cleft.append(d.join("")),u.length&&this.$cright.append(u.join(""))},renderCell:function(t){var e,n=t.rowData,r=t.colIndx,i=t.attr,o=t.cls,a=t.style,l=n[r];return l?(l.colSpan>1&&a.push("z-index:3;"),t.column=l,this.createHeaderCell(t)):(e=this.renderFilterCell(t.column,t.rowIndx,r,o),"<div "+i.join(" ")+" class='"+o.join(" ")+"' style='"+a.join("")+"'>"+e+"</div>")}})}(jQuery),function(t){var e=t.paramquery;(pq.cRenderSum=function(t,e){var n=t.options,r=this,i=r.uuid=t.uuid;r.that=t,r.rtl=n.rtl?"right":"left",r.rowStyle=[],r.iMerge={ismergedCell:function(){}},r.$ele=e,r.height="flex",r.scrollTop=0,r.rowHt=t.getEM(n.rowHtSum),r.cellCls="pq-grid-cell",r.setTimer=r.setTimer(!0),r.cellPrefix="pq-sum-cell-u"+i+"-",r.rowPrefix="pq-sum-row-u"+i+"-",r.preInit(e),t.on("refreshSum softRefresh",r.onRefresh.bind(r))}).prototype=t.extend({},new e.cGenerateView,pq.cRenderHS,{isSum:function(){return!0},onRefreshTimer:function(t,e){return function(){var n=t.$cright[0];t.autoRow&&t.autoHeight({timer:!1,hChanged:e}),n.scrollTop=0,n.scrollLeft=n.scrollLeft}}})}(jQuery);